<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QC System</title>

<style>
/* ======================== Variabel Warna & Radius ======================== */
:root {
  --bg: #f4f7fb;
  --card: #ffffff;
  --accent: #0ea5a4;
  --accent-2: #0369a1;
  --muted: #6b7280;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #facc15;
  --radius: 12px;
}

/* ======================== Reset & Body ======================== */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: #111;
  min-height: 100vh;
  width: 100%;
  overflow-x: hidden;
  padding-bottom: 64px; /* beri ruang agar tidak tertutup footer */
}

/* ======================== Header ======================== */
header {
  background: var(--accent);
  color: #fff;
  padding: 1rem 1.5rem;
  font-size: 1.4rem;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0, 0, 0, .1);
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

#headerTitle {
  font-size: 1.2rem;
  font-weight: bold;
  text-transform: uppercase;
  text-align: center;
}

#headerTime {
  font-size: 0.7rem;
  font-weight: normal;
  text-align: right;
  margin-top: 2px;
  line-height: 1.2;
}
#headerTime .tanggal,
#headerTime .jam { display: block; }

/* ======================== Main & Card ======================== */
main {
  flex: 1;
  padding: 1.5rem;
  display: grid;
  gap: 1rem;
}

.card {
  background: var(--card);
  padding: 1.2rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 8px rgba(0, 0, 0, .06);
}

/* ======================== Tabs ======================== */
.tabs {
  display: flex;
  gap: .5rem;
  margin-bottom: .75rem;
  flex-wrap: wrap;
}
.tabs button {
  flex: 1;
  padding: .6rem;
  border: none;
  border-radius: var(--radius);
  background: #e5e7eb;
  cursor: pointer;
  font-weight: 500;
  transition: .2s;
}
.tabs button.active {
  background: var(--accent);
  color: #fff;
}

.tab-content { display: none; }
.tab-content.active { display: block; }

/* ======================== Form Input ======================== */
input[type=text],
input[type=number],
select {
  padding: .5rem .7rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-bottom: 6px;
  width: 100%;
  transition: border .2s, box-shadow .2s;
}

/* ======================== Grid ======================== */
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
  justify-items: stretch;
  align-items: stretch;
  width: 100%;
}

.grid-container > div {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  min-height: 90px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  text-align: left;
}

.grid-card {
  background: #fff;
  padding: .8rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
  display: flex;
  flex-direction: column;
  gap: 6px;
  position: relative;
}

.grid-card input {
  padding: .4rem .6rem;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin-bottom: 4px;
  width: 100%;
}

/* ======================== Tombol Aksi di Grid ======================== */
.grid-card .btn-icon {
  border: none;
  cursor: pointer;
  border-radius: 6px;
  padding: 4px 6px;
  font-size: 0.9rem;
  transition: .2s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.btn-call { background: var(--accent); color: #fff; }
.btn-edit { background: #facc15; color: #111; }
.btn-delete { background: var(--danger); color: #fff; }
.btn-save { background: var(--success); color: #fff; }
.btn-icon:hover { opacity: .9; transform: translateY(-1px); }

/* ======================== Edit Inline ======================== */
.edit-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}
.edit-grid input,
.edit-grid select {
  flex: 1 1 48%;
  min-width: 100px;
}
.edit-grid textarea {
  flex: 1 1 100%;
  width: 100%;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px;
  font-family: inherit;
  resize: vertical;
}


/* ======================== Status ======================== */
.status-to {
  background: #fee2e2;
  color: #b91c1c;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
}
.status-proses {
  background: var(--warning);
  color: #111;
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: 600;
}
.status-selesai {
  background: var(--success);
  color: #fff;
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: 600;
}

.form-group { margin-bottom: 10px; }

/* ==================== RATA KIRI UNTUK SEMUA DASHBOARD QC ==================== */
[id^="dashboard"] .grid-card,
[id^="dashboard"] .grid-card * {
  text-align: left !important;
  align-items: flex-start !important;
  justify-content: flex-start !important;
}


  
</style>

</head>
<body>



<!-- ======================== Header ======================== -->
<header style="
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 24px;
  background: linear-gradient(to right, #0078D7, #1A86D1);
  color: white;
  font-family: 'Inter', sans-serif;
  font-weight: 500;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 1px solid rgba(255,255,255,0.15);
">
  <div style="display: flex; align-items: center; gap: 10px;">
    <button onclick="goHome()" style="
      background: linear-gradient(to bottom, #ffffff, #d1faff);
      color: #0078D7;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 6px 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
      QC
    </button>
    <div id="headerTitle" style="font-size: 0.85rem; color: #e0f7fa;">System</div>
  </div>
  <div id="headerTime" style="text-align:right; font-size:0.8rem; color:#e0f7fa;">
    <div class="tanggal">Selasa, 5 Oktober 2025</div>
    <div class="jam">14:30</div>
  </div>
</header>


<!-- ======================== Footer Nav ======================== -->
<nav class="footer-nav">
  <div class="nav-inner">
    <button onclick="showMenu('dashboard')" class="nav-btn active">DASHBOARD</button>
    <button onclick="showMenu('qcBapro')" class="nav-btn">QC BAPRO</button>
    <button onclick="showMenu('qcPA')" class="nav-btn">QC CETAK</button>
    <button onclick="showMenu('qcFinishing')" class="nav-btn">QC FINISHING</button>
    <button onclick="showMenu('qcLem')" class="nav-btn">QC LEM</button>
    <button onclick="showMenu('qcSPV')" class="nav-btn">QC REGISTER</button>
    <button onclick="showMenu('qcMeeting')" class="nav-btn">MEETING</button>
    <button onclick="showMenu('manualSection')" class="nav-btn">MANUAL</button>
  </div>
</nav>

<style>
/* ======================== Footer Nav Wrapper ======================== */
.footer-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: linear-gradient(to right, #0078D7, #1A86D1);
  height: 64px;
  z-index: 999;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 10px;
  overflow: hidden;
}

/* ======================== Kontainer tombol ======================== */
.nav-inner {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: center;
  overflow-x: auto;
  white-space: nowrap;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch; /* efek geser halus iOS */
  width: 100%;
}

/* ðŸ”½ Sembunyikan scrollbar di semua browser */
.nav-inner {
  scrollbar-width: none;          /* Firefox */
  -ms-overflow-style: none;       /* IE & Edge lama */
}
.nav-inner::-webkit-scrollbar {   /* Chrome, Safari, Opera */
  display: none;
}

/* ======================== Tombol Putih HD Modern ======================== */
.nav-btn {
  flex-shrink: 0;
  color: #0f172a;
  font-weight: 600;
  font-size: 15px;
  padding: 10px 20px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.7);
  background: #ffffff;
  text-shadow: none;
  box-shadow:
    0 2px 6px rgba(0,0,0,0.15),
    inset 0 1px 0 rgba(255,255,255,0.3);
  transition: all 0.25s ease;
  cursor: pointer;
}

/* Hover efek lembut */
.nav-btn:hover {
  background: #f5f9ff;
  transform: translateY(-2px);
  box-shadow:
    0 4px 10px rgba(0,0,0,0.2),
    inset 0 1px 0 rgba(255,255,255,0.4);
}

/* Aktif: glow hijau elegan */
.nav-btn.active {
  color: #fff;
  background: linear-gradient(145deg, #22c55e, #16a34a);
  border-color: rgba(34,197,94,0.6);
  box-shadow:
    0 0 15px rgba(34,197,94,0.6),
    0 0 30px rgba(34,197,94,0.4);
}

/* Klik efek */
.nav-btn:active {
  transform: scale(0.97);
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}

/* ======================== Responsif ======================== */
@media (max-width: 768px) {
  .nav-inner {
    justify-content: flex-start;
  }
  .nav-btn {
    font-size: 14px;
    padding: 9px 16px;
  }
}
@media (min-width: 1024px) {
  .nav-inner {
    justify-content: center;
  }
  .nav-btn {
    font-size: 15px;
    padding: 11px 22px;
  }
}
</style>

<!-- ======================== Main Section ======================== -->
<main>


<!-- ======================== Dashboard ======================== -->
<section id="dashboard" class="card qc-section">

<!-- ======================== QC BAPRO ======================== -->  
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #D32F2F, #F44336); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC BAPRO
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FF5252, #FF1744); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countBapro">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FF6677, #FF3D5A); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total TO<br><strong id="countTOBapro">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FF6F61, #FF3B30); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesBapro">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FF7F7F, #FF4444); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiBapro">0</strong>
  </div>
</div>

<!-- ========== TO / Proses / Selesai Buttons ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF5252, #FF1744); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    TO
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproTO" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproTO" style="display:none;">
  <input id="filterTOBapro" type="text" placeholder="ðŸ” Filter TO" class="filter-input">
  <div id="dashboardBaproTO" class="grid-container"></div>
</div>

<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF6F61, #FF3B30); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproProses" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproProses" style="display:none;">
  <input id="filterProsesBapro" type="text" placeholder="ðŸ” Filter Proses" class="filter-input">
  <div id="dashboardBaproProses" class="grid-container"></div>
</div>

<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF7F7F, #FF4444); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproSelesai" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproSelesai" style="display:none;">
  <input id="filterSelesaiBapro" type="text" placeholder="ðŸ” Filter Selesai" class="filter-input">
  <div id="dashboardBaproSelesai" class="grid-container"></div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;
}
.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* ========== Tombol Show/Hide Abu-abu Elegan ========== */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd);
  color: #000;
  border: 1px solid #000;
  border-radius: 4px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #cfcfcf);
  transform: translateY(-2px);
}
</style>


<!-- ======================== QC CETAK ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #FF9800, #FFB74D); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC CETAK
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FFC870, #FFB74D); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countPA">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FFD187, #FFB85C); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total TO<br><strong id="countTOPA">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FFC080, #FFB266); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesPA">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #FFD090, #FFBF70); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiPA">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFB74D, #FF9800); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    TO
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePATO" class="toggle-btn">Show</button>
</div>
<div id="sectionPATO" style="display:none;">
  <input id="filterPATO" type="text" placeholder="ðŸ” Filter TO" class="filter-input">
  <div id="dashboardPATO" class="grid-container"></div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFB266, #FF9933); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePAProses" class="toggle-btn">Show</button>
</div>
<div id="sectionPAProses" style="display:none;">
  <input id="filterPAProses" type="text" placeholder="ðŸ” Filter Proses" class="filter-input">
  <div id="dashboardPAProses" class="grid-container"></div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFD090, #FFB266); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePASelesai" class="toggle-btn">Show</button>
</div>
<div id="sectionPASelesai" style="display:none;">
  <input id="filterPASelesai" type="text" placeholder="ðŸ” Filter Selesai" class="filter-input">
  <div id="dashboardPASelesai" class="grid-container"></div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;
}
.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* ===== Tombol Show/Hide Abu-abu Metalik Modern ===== */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd) !important;
  color: #000 !important;
  border: 1px solid #000 !important;
  border-radius: 4px !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25) !important;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s !important;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #d6d6d6) !important;
  transform: translateY(-2px);
}
</style>





<!-- ======================== QC FINISHING ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #22C55E, #4ADE80); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC FINISHING
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #4ADE80, #22C55E); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countFinishing">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #38D39F, #22C55E); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total TO<br><strong id="countTOFinishing">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #4EEA8C, #22C55E); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesFinishing">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #6EE7B7, #22C55E); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiFinishing">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #4ADE80, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    TO
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingTO" class="toggle-btn">Show</button>
</div>
<div id="sectionFinishingTO" style="display:none;">
  <input id="filterFinishingTO" type="text" placeholder="ðŸ” Filter TO" class="filter-input">
  <div id="dashboardFinishingTO" class="grid-container"></div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #38D39F, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingProses" class="toggle-btn">Show</button>
</div>
<div id="sectionFinishingProses" style="display:none;">
  <input id="filterFinishingProses" type="text" placeholder="ðŸ” Filter Proses" class="filter-input">
  <div id="dashboardFinishingProses" class="grid-container"></div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #6EE7B7, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingSelesai" class="toggle-btn">Show</button>
</div>
<div id="sectionFinishingSelesai" style="display:none;">
  <input id="filterFinishingSelesai" type="text" placeholder="ðŸ” Filter Selesai" class="filter-input">
  <div id="dashboardFinishingSelesai" class="grid-container"></div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;
}
.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* ===== Tombol Show/Hide Abu-abu Metalik Modern ===== */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd) !important;
  color: #000 !important;
  border: 1px solid #000 !important;
  border-radius: 4px !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25) !important;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s !important;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #d6d6d6) !important;
  transform: translateY(-2px);
}
</style>




<!-- ======================== QC LEM ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #9C27B0, #BA68C8); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC LEM
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #BA68C8, #9C27B0); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countLem">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #C084FC, #9C27B0); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total TO<br><strong id="countTOLem">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #D8B4FE, #9C27B0); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesLem">0</strong>
  </div>
  <div style="
      flex:1; min-width:120px; 
      background: linear-gradient(to bottom, #E9D5FF, #9C27B0); 
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiLem">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #C084FC, #9C27B0); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    TO
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemTO" class="toggle-btn">Show</button>
</div>
<div id="sectionLemTO" style="display:none;">
  <input id="filterTOLem" type="text" placeholder="ðŸ” Filter TO" class="filter-input">
  <div id="dashboardLemTO" class="grid-container"></div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #D8B4FE, #9C27B0); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemProses" class="toggle-btn">Show</button>
</div>
<div id="sectionLemProses" style="display:none;">
  <input id="filterProsesLem" type="text" placeholder="ðŸ” Filter Proses" class="filter-input">
  <div id="dashboardLemProses" class="grid-container"></div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #E9D5FF, #BA68C8); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemSelesai" class="toggle-btn">Show</button>
</div>
<div id="sectionLemSelesai" style="display:none;">
  <input id="filterSelesaiLem" type="text" placeholder="ðŸ” Filter Selesai" class="filter-input">
  <div id="dashboardLemSelesai" class="grid-container"></div>
</div>

<style>
/* ===== Input & Grid ===== */
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;
}
.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* ===== Tombol Show/Hide Abu-abu Metalik Modern (Sama Finishing) ===== */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd) !important;
  color: #000 !important;
  border: 1px solid #000 !important;
  border-radius: 4px !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25) !important;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s !important;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #d6d6d6) !important;
  transform: translateY(-2px);
}
</style>






</section>

<!-- ======================== QC BAPRO ======================== -->
<section id="qcBapro" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#fff; 
    background: linear-gradient(to right, #D32F2F, #F44336); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
    border: 1px solid #000;">
    MENU QC BAPRO
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- ===== Tabs ===== -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn bapro active" data-tab="inputBapro" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn bapro" data-tab="hasilBapro" onclick="switchTab(this)">Hasil</button>
  </div>

<!-- ===== Inputan ===== -->
<div id="inputBapro" class="tab-content active">

  <div class="form-group">
    <label>Nama Order</label>
    <input type="text" id="baproNama" placeholder="GIV">
  </div>

  <div class="form-group">
    <label>CSO</label>
    <select id="baprocso">
      <option value="">Pilih CSO</option>
      <option value="Yati">Yati</option>
      <option value="Retni">Retni</option>
      <option value="Aulia">Aulia</option>
      <option value="Yuli">Yuli</option>
    </select>
  </div>

  <div class="form-group">
    <label>Jenis Kertas</label>
    <input type="text" id="baproJenis" placeholder="Duplex">
  </div>

  <div class="form-group">
    <label>Tebal Kertas (gsm)</label>
    <input type="number" id="baproKertas" placeholder="0">
  </div>

  <div class="form-group">
    <label>Nama Tinta</label>
    <input type="text" id="baproNamaTinta" placeholder="SP RED">
  </div>

  <div class="form-group">
    <label>Dmax</label>
    <input type="number" id="baproDmax" placeholder="0">
  </div>

  <div class="form-group">
    <label>L</label>
    <input type="number" id="baproL" placeholder="0">
  </div>

  <div class="form-group">
    <label>A</label>
    <input type="number" id="baproA" placeholder="0">
  </div>

  <div class="form-group">
    <label>B</label>
    <input type="number" id="baproB" placeholder="0">
  </div>

  <div class="form-group">
    <label>QC</label>
    <select id="baproQC">
      <option value="">Pilih QC</option>
      <option value="Marwan">Marwan</option>
      <option value="Kiki">Kiki</option>
    </select>
  </div>

  <div class="form-group">
    <label>Update</label>
    <select id="baproUpdate">
      <option value="Proses">Proses</option>
      <option value="Selesai">Selesai</option>
      <option value="TO">TO</option>
    </select>
  </div>

  <div class="form-group">
    <label>Resep Tinta</label>
    <textarea id="baproKeterangan" placeholder="1. 7708A CRSMAX MAGENTA : 6.5
2. TC 0105 MED.YELLOW : 4
3. MEDIUM : 11.5" rows="3"></textarea>
  </div>

  <!-- Tombol Tambah -->
  <div class="form-group">
    <button type="button" class="bapro-add-btn" onclick="addBaproItem()">âž• Tambah</button>
  </div>
</div>


  <!-- ===== Hasil ===== -->
  <div id="hasilBapro" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterBaproGrid(this.value)">
    <div id="gridBapro" class="grid-container"></div>
  </div>

</section>

<!-- ===== CSS Tab dan Style QC BAPRO ===== -->
<style>
/* ===== Tab Button ===== */
.tab-btn.bapro {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000;
  background: #e0e0e0 !important;
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}
.tab-btn.bapro.active {
  background: #FF5252 !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
.tab-btn.bapro:not(.active):hover {
  background: #FFB3B3 !important;
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(255,82,82,0.3);
}
.tab-btn.bapro:focus {
  outline: none;
  box-shadow: none;
}

/* ===== Form Input & Tombol Tambah ===== */
#inputBapro .form-group input,
#inputBapro .form-group select,
#inputBapro .form-group textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 0.95rem;
  box-sizing: border-box;
}

.bapro-add-btn {
  width: 100%;
  padding: 0.6rem;
  background: linear-gradient(135deg, #D32F2F, #F44336);
  color: #fff;
  font-weight: 600;
  border: 1px solid #000;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.25s;
}
.bapro-add-btn:hover {
  background: linear-gradient(135deg, #F44336, #D32F2F);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(244,67,54,0.4);
}

/* ===== Section Layout ===== */
#qcBapro {
  display: flex;
  flex-direction: column;
  max-height: none;
}

/* Sticky tabs */
#qcBapro .tabs {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding-top: 6px;
  padding-bottom: 6px;
}

/* Scrollable input & hasil */
#inputBapro,
#hasilBapro {
  overflow-y: auto;
  max-height: calc(80vh - 120px);
  padding-right: 4px;
}

/* Filter hasil tetap di atas */
#hasilBapro input[type="text"] {
  position: sticky;
  top: 0;
  z-index: 999 !important;
  background: #fff;
  padding: 6px;
  margin-bottom: 8px;
  border: 1px solid #ccc;
}

/* Grid card z-index fix */
#gridBapro .grid-card { position: relative; z-index:1 !important; }
#gridBapro .grid-card * { z-index:1 !important; }

/* Spinner (opsional) */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid #ddd;
  border-top: 3px solid #D32F2F;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  vertical-align: middle;
  margin-right: 6px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#inputBapro .form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 0.9rem;
  color: #333;
}

</style>





<!-- ======================== QC CETAK ======================== -->
<section id="qcPA" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #FF9800, #FFB74D); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;">
    MENU QC CETAK
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn cetak active" data-tab="inputPA" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn cetak" data-tab="hasilPA" onclick="switchTab(this)">Hasil</button>
  </div>

  <!-- Inputan -->
<div id="inputPA" class="tab-content active">

  <div class="form-group">
    <label>Nama Order</label>
    <input type="text" id="paNama" placeholder="GIV">
  </div>

  <div class="form-group">
    <label>No KS</label>
    <input type="text" id="paNoKS" placeholder="KS-xxxx-xx">
  </div>

  <div class="form-group">
    <label>Total Order (lembar)</label>
    <input type="number" id="paOrder" placeholder="0">
  </div>

  <div class="form-group">
    <label>Bagus (lembar)</label>
    <input type="number" id="paBagus" placeholder="0">
  </div>

  <div class="form-group">
    <label>Sortir (lembar)</label>
    <input type="number" id="paSortir" placeholder="0">
  </div>

  <div class="form-group">
    <label>Problem (lembar)</label>
    <input type="number" id="paProblem" placeholder="0">
  </div>

  <div class="form-group">
    <label>QC</label>
    <select id="paQC">
      <option value="">Pilih QC</option>
      <option value="Suci">Suci</option>
      <option value="Anjani">Anjani</option>
    </select>
  </div>

  <div class="form-group">
    <label>Mesin</label>
    <select id="paMesin">
      <option value="">Pilih Mesin</option>
      <option value="KM 640">KM 640</option>
      <option value="KM 644">KM 644</option>
      <option value="KM 620">KM 620</option>
      <option value="MT 430">MT 430</option>
      <option value="KM 640 GL">KM 640 GL</option>
      <option value="RL 140">RL 140</option>
    </select>
  </div>

  <div class="form-group">
    <label>Update</label>
    <select id="paUpdate">
      <option value="Proses">Proses</option>
      <option value="Selesai">Selesai</option>
      <option value="TO">TO</option>
    </select>
  </div>

  <div class="form-group">
    <label>Keterangan (opsional)</label>
    <textarea id="paKeterangan" rows="3" placeholder="1. GHOSTING (GARIS) NO.2
2. HUJAN DAN GARIS NO.1"></textarea>
  </div>

  <div class="form-group">
    <button type="button" class="pa-add-btn" onclick="addPAItem()">âž• Tambah</button>
  </div>
</div>

  <!-- Hasil -->
  <div id="hasilPA" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterPAGrid(this.value)">
    <div id="gridPA" class="grid-container"></div>
  </div>

</section>

<!-- ===== CSS Tab dan Style QC CETAK (MEETING style) ===== -->
<style>
/* Tab Buttons */
.tab-btn.cetak {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000;
  background: #e0e0e0 !important;
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}
.tab-btn.cetak.active {
  background: linear-gradient(to right, #FF9800, #FFB74D) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
.tab-btn.cetak:not(.active):hover {
  background: #FFD180 !important;
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(255,152,0,0.3);
}
.tab-btn.cetak:focus { outline:none; box-shadow:none; }

/* Form Input, Select, Textarea style MEETING */
#inputPA .form-group input,
#inputPA .form-group select,
#inputPA .form-group textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 0.95rem;
  box-sizing: border-box;
}

/* Tombol Tambah MEETING style */
.pa-add-btn {
  width: 100%;
  padding: 0.6rem;
  background: linear-gradient(135deg, #FF9800, #FFB74D);
  color: #fff;
  font-weight: 600;
  border: 1px solid #000;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.25s;
}
.pa-add-btn:hover {
  background: linear-gradient(135deg, #FFB74D, #FF9800);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(255,183,77,0.4);
}

/* Section Layout */
#qcPA { display:flex; flex-direction:column; max-height:none; }

/* Sticky Tabs */
#qcPA .tabs {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding-top:6px;
  padding-bottom:6px;
}

/* Scrollable input & hasil */
#inputPA,
#hasilPA {
  overflow-y:auto;
  max-height: calc(80vh - 120px);
  padding-right:4px;
}

/* Filter hasil tetap di atas */
#hasilPA input[type="text"] {
  position: sticky;
  top: 0;
  z-index: 999 !important;
  background:#fff;
  padding:6px;
  margin-bottom:8px;
  border:1px solid #ccc;
}

/* Grid z-index fix */
#gridPA .grid-card { position:relative; z-index:1 !important; }
#gridPA .grid-card * { z-index:1 !important; }

/* Spinner (opsional) */
.spinner {
  width: 18px;
  height: 18px;
  border:3px solid #ddd;
  border-top:3px solid #00BCD4;
  border-radius:50%;
  display:inline-block;
  vertical-align:middle;
  animation: spin 0.8s linear infinite;
  margin-right:6px;
}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

#inputPA .form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 0.9rem;
  color: #333;
}

</style>


<script>
const paNoKS = document.getElementById('paNoKS');

paNoKS.addEventListener('input', function(e) {
  let value = paNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // huruf & angka saja, uppercase

  if (value.length > 2) {
    value = value.slice(0,2) + '-' + value.slice(2);
  }

  if (value.length > 7) {
    value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
  }

  paNoKS.value = value;
});
</script>



<!-- ======================== QC FINISHING ======================== -->
<section id="qcFinishing" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #22C55E, #4ADE80); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;">
    MENU QC FINISHING
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn finishing active" data-tab="inputFinishing" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn finishing" data-tab="hasilFinishing" onclick="switchTab(this)">Hasil</button>
  </div>

<!-- Inputan -->
<div id="inputFinishing" class="tab-content active">

  <div class="form-group">
    <label>Nama Order</label>
    <input type="text" id="finishingNama" placeholder="GIV">
  </div>

  <div class="form-group">
    <label>No KS</label>
    <input type="text" id="finishingNoKS" placeholder="KS-xxxx-xx">
  </div>

  <div class="form-group">
    <label>Total Order (lembar)</label>
    <input type="number" id="finishingOrder" placeholder="0">
  </div>

  <div class="form-group">
    <label>Isi/Dus (pcs)</label>
    <input type="number" id="finishingIsi" placeholder="0">
  </div>

  <div class="form-group">
    <label>Total Bagus (pcs)</label>
    <input type="number" id="finishingBagus" placeholder="0">
  </div>

  <div class="form-group">
    <label>Total BS (pcs)</label>
    <input type="number" id="finishingJenisBS" placeholder="0">
  </div>

  <div class="form-group">
    <label>QC</label>
    <select id="finishingQC">
      <option value="">Pilih QC</option>
      <option value="Anom">Anom</option>
      <option value="Irna">Irna</option>
    </select>
  </div>

  <div class="form-group">
    <label>Update</label>
    <select id="finishingUpdate">
      <option value="Proses">Proses</option>
      <option value="Selesai">Selesai</option>
      <option value="TO">TO</option>
    </select>
  </div>

  <div class="form-group">
    <label>Keterangan (opsional)</label>
    <textarea id="finishingKeterangan" placeholder="1. WARNA BELANG 
2. MATA AYAM
3. OVER GLUE" rows="3"></textarea>
  </div>

  <!-- Tombol Tambah -->
  <div class="form-group">
    <button type="button" class="finishing-add-btn" onclick="addFinishingItem()">âž• Tambah</button>
  </div>

</div>


  <!-- Hasil -->
  <div id="hasilFinishing" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterFinishingGrid(this.value)">
    <div id="gridFinishing" class="grid-container"></div>
  </div>

</section>

<!-- ===== CSS Tab dan Style QC FINISHING (MEETING style) ===== -->
<style>
/* Tab Buttons */
.tab-btn.finishing {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000;
  background: #e0e0e0 !important;
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}
.tab-btn.finishing.active {
  background: linear-gradient(to right, #22C55E, #4ADE80) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
.tab-btn.finishing:not(.active):hover {
  background: #86efac !important;
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(34,197,94,0.3);
}
.tab-btn.finishing:focus { outline:none; box-shadow:none; }

/* Form Input, Select, Textarea style MEETING */
#inputFinishing .form-group input,
#inputFinishing .form-group select,
#inputFinishing .form-group textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 0.95rem;
  box-sizing: border-box;
}

/* Tombol Tambah MEETING style */
.finishing-add-btn {
  width: 100%;
  padding: 0.6rem;
  background: linear-gradient(135deg, #22C55E, #4ADE80);
  color: #fff;
  font-weight: 600;
  border: 1px solid #000;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.25s;
}
.finishing-add-btn:hover {
  background: linear-gradient(135deg, #4ADE80, #22C55E);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(74,222,128,0.4);
}

/* Section Layout */
#qcFinishing { display:flex; flex-direction:column; max-height:none; }

/* Sticky Tabs */
#qcFinishing .tabs {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding-top:6px;
  padding-bottom:6px;
}

/* Scrollable input & hasil */
#inputFinishing,
#hasilFinishing {
  overflow-y:auto;
  max-height: calc(80vh - 120px);
  padding-right:4px;
}

/* Filter hasil tetap di atas */
#hasilFinishing input[type="text"] {
  position: sticky;
  top: 0;
  z-index: 999 !important;
  background:#fff;
  padding:6px;
  margin-bottom:8px;
  border:1px solid #ccc;
}

/* Grid z-index fix */
#gridFinishing .grid-card { position:relative; z-index:1 !important; }
#gridFinishing .grid-card * { z-index:1 !important; }

/* Spinner (opsional) */
.spinner {
  width: 18px;
  height: 18px;
  border:3px solid #ddd;
  border-top:3px solid #22C55E;
  border-radius:50%;
  display:inline-block;
  vertical-align:middle;
  animation: spin 0.8s linear infinite;
  margin-right:6px;
}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

#inputFinishing .form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 0.9rem;
  color: #333;
}

</style>



<script>
const finishingNoKS = document.getElementById('finishingNoKS');

finishingNoKS.addEventListener('input', function(e) {
  let value = finishingNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // huruf & angka saja, uppercase

  if (value.length > 2) {
    value = value.slice(0,2) + '-' + value.slice(2);
  }

  if (value.length > 7) {
    value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
  }

  finishingNoKS.value = value;
});
</script>




<!-- ======================== QC LEM ======================== -->
<section id="qcLem" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #9C27B0, #BA68C8); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU QC LEM
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn lem active" data-tab="inputLem" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn lem" data-tab="hasilLem" onclick="switchTab(this)">Hasil</button>
  </div>

<!-- Inputan -->
<div id="inputLem" class="tab-content active">

  <div class="form-group">
    <label>Nama Order</label>
    <input type="text" id="lemNama" placeholder="GIV">
  </div>

  <div class="form-group">
    <label>No KS</label>
    <input type="text" id="lemNoKS" placeholder="KS-xxxx-xx">
  </div>

  <div class="form-group">
    <label>Total Order (lembar)</label>
    <input type="number" id="lemOrder" placeholder="0">
  </div>

  <div class="form-group">
    <label>Isi/Dus (pcs)</label>
    <input type="number" id="lemIsi" placeholder="0">
  </div>

  <div class="form-group">
    <label>Total Bagus (pcs)</label>
    <input type="number" id="lemBagus" placeholder="0">
  </div>

  <div class="form-group">
    <label>Total BS (pcs)</label>
    <input type="number" id="lemJenisBS" placeholder="0">
  </div>

  <div class="form-group">
    <label>QC</label>
    <select id="lemQC">
      <option value="">Pilih QC</option>
      <option value="Martini">Martini</option>
      <option value="Krestin">Krestin</option>
      <option value="Ismie">Ismie</option>
    </select>
  </div>

  <div class="form-group">
    <label>Update</label>
    <select id="lemUpdate">
      <option value="Proses">Proses</option>
      <option value="Selesai">Selesai</option>
      <option value="TO">TO</option>
    </select>
  </div>

  <div class="form-group">
    <label>Keterangan (opsional)</label>
    <textarea id="lemKeterangan" placeholder="1.LEM MIRING
2.DUS MELET
3.DUS SOBEK" rows="3"></textarea>
  </div>

  <!-- Tombol Tambah -->
  <div class="form-group">
    <button type="button" class="lem-add-btn" onclick="addLemItem()">âž• Tambah</button>
  </div>
</div>


  <!-- Hasil -->
  <div id="hasilLem" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterLemGrid(this.value)">
    <div id="gridLem" class="grid-container"></div>
  </div>
</section>

<!-- ===== CSS Tab dan Style QC LEM (MEETING style) ===== -->
<style>
/* Tombol tab */
.tab-btn.lem {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000;
  background: #e0e0e0 !important;
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}
.tab-btn.lem.active {
  background: linear-gradient(to right, #9C27B0, #BA68C8) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
.tab-btn.lem:not(.active):hover {
  background: #D18FE0 !important; /* ungu muda */
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(156,39,176,0.3);
}
.tab-btn.lem:focus { outline:none; box-shadow:none; }

/* Form input, select, textarea MEETING style */
#inputLem .form-group input,
#inputLem .form-group select,
#inputLem .form-group textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 0.95rem;
  box-sizing: border-box;
}

/* Tombol Tambah MEETING style */
.lem-add-btn {
  width: 100%;
  padding: 0.6rem;
  background: linear-gradient(135deg, #9C27B0, #BA68C8);
  color: #fff;
  font-weight: 600;
  border: 1px solid #000;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.25s;
}
.lem-add-btn:hover {
  background: linear-gradient(135deg, #BA68C8, #9C27B0);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(186,104,200,0.4);
}

/* Layout section */
#qcLem { display:flex; flex-direction:column; max-height:none; }

/* Sticky Tabs */
#qcLem .tabs {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding-top:6px;
  padding-bottom:6px;
}

/* Scrollable input & hasil */
#inputLem,
#hasilLem {
  overflow-y:auto;
  max-height: calc(80vh - 120px);
  padding-right:4px;
}

/* Filter hasil tetap di atas */
#hasilLem input[type="text"] {
  position: sticky;
  top: 0;
  z-index: 999 !important;
  background:#fff;
  padding:6px;
  margin-bottom:8px;
  border:1px solid #ccc;
}

/* Grid fix */
#gridLem .grid-card { position:relative; z-index:1 !important; }
#gridLem .grid-card * { z-index:1 !important; }

/* Spinner */
.spinner {
  width: 18px;
  height: 18px;
  border:3px solid #ddd;
  border-top:3px solid #9C27B0;
  border-radius:50%;
  display:inline-block;
  vertical-align:middle;
  animation: spin 0.8s linear infinite;
  margin-right:6px;
}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

#inputLem .form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 0.9rem;
  color: #333;
}

</style>


<script>
const lemNoKS = document.getElementById('lemNoKS');

if (lemNoKS) {
  lemNoKS.addEventListener('input', function() {
    let value = lemNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // huruf & angka saja, uppercase

    if (value.length > 2) {
      value = value.slice(0,2) + '-' + value.slice(2);
    }

    if (value.length > 7) {
      value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
    }

    lemNoKS.value = value;
  });
}
</script>


<!-- ======================== MENU MANUAL ======================== --> 
<section id="manualSection" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #0078D7, #1A86D1);
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU MANUAL
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="manualQC" onclick="switchTab(this)">Manual QC</button>
    <button class="tab-btn" data-tab="manualProduksi" onclick="switchTab(this)">Form QC</button>
    <button class="tab-btn" data-tab="manualUmum" onclick="switchTab(this)">Jobdes QC</button>
  </div>

  <!-- Konten Manual QC -->
  <div id="manualQC" class="tab-content active">
    <input type="text" class="filter-input" placeholder="ðŸ” Cari panduan QC..." onkeyup="filterManualList(this, 'manualQC')">
    <ul class="manual-list">
      <li><a href="https://drive.google.com/drive/folders/1oViZSpiSc4aRF-OxVQSZ6nMN0FbdD_y-?usp=drive_link">ðŸ“˜ 307900_QC -COA</a></li>
      <li><a href="https://drive.google.com/drive/folders/1xctN1tpbmLZ1tCQF-4-YLJXIBOA_HDr6?usp=drive_link">ðŸ“˜ 307700_QC -InProses</a></li>
      <li><a href="https://drive.google.com/drive/folders/1KweOfFN36PeKC9AiYpbxAJ2YtG7UKJbU?usp=drive_link">ðŸ“˜ 307800_QC -Barang Jadi</a></li>
      <li><a href="https://drive.google.com/drive/folders/1VlgxLLagD79zxuSZWYPVdUEgdbS1X2Uo?usp=drive_link">ðŸ“˜ 307600_QC -Produksi POP</a></li>
      <li><a href="https://drive.google.com/drive/folders/1utMIrQZsvTZ1aTyzGfWE00iaMJw8jIcU?usp=drive_link">ðŸ“˜ 307500_QC -Acuan</a></li>
      <li><a href="https://drive.google.com/drive/folders/1tGhpcUL4YEB4RNdBW4UozAdryLdTPDAB?usp=drive_link">ðŸ“˜ 307400_QC -Roll & Blanket Cetak</a></li>
      <li><a href="https://drive.google.com/drive/folders/1Z4atGWZUMgZhNfuseImbSlPMXSsQBFnO?usp=drive_link">ðŸ“˜ 307200_QC -Batek & Solar</a></li>
      <li><a href="https://drive.google.com/drive/folders/1zATvzsfhBneNYHSS9zLkvm9U7gN3Obnm?usp=drive_link">ðŸ“˜ 307100_QC -Bapro</a></li>
      <li><a href="https://drive.google.com/drive/folders/1sAsUUZf7bc2YFxMeAFJo9BdWzQ5VSlxz?usp=drive_link">ðŸ“˜ 307000_QC -System Mgn</a></li>
    </ul>
  </div>

  <!-- Konten Form QC -->
  <div id="manualProduksi" class="tab-content">
    <input type="text" class="filter-input" placeholder="ðŸ” Cari panduan Produksi..." onkeyup="filterManualList(this, 'manualProduksi')">
    <ul class="manual-list">
      <li><a href="https://drive.google.com/drive/folders/1kQFXtEc9AfMuihyoPwKgQiBfj9CBy6Cv?usp=drive_link">ðŸ“— Form QC Cetak</a></li>
    </ul>
  </div>

  <!-- Konten Jobdes QC -->
  <div id="manualUmum" class="tab-content">
    <input type="text" class="filter-input" placeholder="ðŸ” Cari panduan Umum..." onkeyup="filterManualList(this, 'manualUmum')">
    <ul class="manual-list">
      <li><a href="https://docs.google.com/document/d/1ZMUH69lKTdmZSqiU4ENonEWkz2mU-jEZ/edit?usp=drive_link&ouid=106732294145329226246&rtpof=true&sd=true">ðŸ“™ Jobdes SPV</a></li>
      <li><a href="https://drive.google.com/drive/folders/13KqNsG7lKYIdr_ouVYtyNMQB38j5kpoO?usp=drive_link">ðŸ“™ Jobdes QC Bapro</a></li>
      <li><a href="https://docs.google.com/document/d/1I5eMeL5lQBXrugCec3PwDknSgrs4G2wg/edit?usp=drive_link&ouid=106732294145329226246&rtpof=true&sd=true">ðŸ“™ Jobdes QC Cetak</a></li>
      <li><a href="https://drive.google.com/drive/folders/11KbszhyIqDsvoIj66-rEOP4UgTMveOUS?usp=drive_link">ðŸ“™ Jobdes QC Barang Jadi</a></li>
    </ul>
  </div>
</section>

<!-- ===== CSS Tab dan Style untuk MENU MANUAL ===== -->
<style>
#manualSection .tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  flex-wrap: wrap;
  justify-content: center;
}
#manualSection .tab-btn {
  flex: 1;
  min-width: 120px;
  padding: 8px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000 !important;
  background: #eaf4ff !important;
  color: #003366 !important;
  transition: all 0.2s;
  text-align: center;
}
#manualSection .tab-btn.active {
  background: linear-gradient(to right, #0078D7, #1A86D1) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
#manualSection .tab-btn:not(.active):hover {
  background: #d5e9ff !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,120,215,0.3);
}
.manual-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.manual-list li {
  background: #f5faff;
  margin-bottom: 8px;
  border-radius: 8px;
  padding: 10px 12px;
  border: 1px solid #c2e0ff;
  transition: all 0.2s;
}
.manual-list li:hover {
  background: #e0f0ff;
  transform: translateY(-2px);
  box-shadow: 0 2px 6px rgba(0,120,215,0.2);
}
.manual-list a {
  text-decoration: none;
  color: #004a99;
  font-weight: 600;
  display: block;
}
.filter-input {
  width: 100%;
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid #bcdfff;
  margin-bottom: 10px;
  font-size: 14px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: all 0.2s;
}
.filter-input:focus {
  outline: none;
  border-color: #0078D7;
  box-shadow: 0 0 6px rgba(0,120,215,0.4);
}
@media (max-width: 768px) {
  #manualSection h2 {
    font-size: 1rem;
  }
  #manualSection .tab-btn {
    flex: 1 1 100%;
    font-size: 14px;
    padding: 7px 0;
  }
  .manual-list li {
    padding: 8px 10px;
  }
  .filter-input {
    font-size: 13px;
  }
}
@media (min-width: 1024px) {
  #manualSection .tab-btn {
    flex: 1;
    font-size: 15px;
  }
}
</style>

<!-- ===== Script Password + Filter ===== -->
<script>
// ðŸ” Password khusus MENU MANUAL agar tidak bentrok dengan menu lain
const MANUAL_PASSWORD = 'qc123';

// ðŸ” Proteksi akses MENU MANUAL
document.addEventListener('DOMContentLoaded', () => {
  const manualBtn = document.querySelector(`nav button[onclick="showMenu('manualSection')"]`);
  if (manualBtn) {
    const originalOnClick = manualBtn.getAttribute('onclick');
    manualBtn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk MENU MANUAL:');
      if (input === null) return;
      if (input === MANUAL_PASSWORD) eval(originalOnClick);
      else alert('âŒ Password salah!');
    };
  }
});

// ðŸ”„ Ganti tab
function switchTab(btn) {
  document.querySelectorAll('#manualSection .tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('#manualSection .tab-content').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(btn.dataset.tab).classList.add('active');
}

// ðŸ” Filter daftar manual
function filterManualList(input, tabId) {
  const filter = input.value.toLowerCase();
  const items = document.querySelectorAll(`#${tabId} .manual-list li`);
  items.forEach(li => {
    const text = li.textContent.toLowerCase();
    li.style.display = text.includes(filter) ? '' : 'none';
  });
}
</script>



<!-- ======================== QC SPV ======================== -->
<section id="qcSPV" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #00BCD4, #4DD0E1); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU QC REGISTER
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn active" data-tab="spvInputSection" onclick="showSPVTab('input', this)">Inputan</button>
    <button class="tab-btn" data-tab="spvHasilSection" onclick="showSPVTab('hasil', this)">Hasil</button>
  </div>



<style>
/* ========== Tab Button QC SPV (Cyan) ========== */
.tab-btn {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000 !important; /* âœ… outline hitam muncul juga di nonaktif */
  background: #e0e0e0 !important; /* tombol nonaktif abu */
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}

.tab-btn.active {
  background: linear-gradient(to right, #00BCD4, #4DD0E1) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}

.tab-btn:not(.active):hover {
  background: #B2EBF2 !important;
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,188,212,0.3);
}

.tab-btn:focus {
  outline: none;
  box-shadow: none;
}
</style>


  <!-- ========== INPUTAN ========== -->
  <div id="spvInputSection" style="margin-top:10px;">
    <form id="spvForm">

      <style>
        /* ===== Style Form QC SPV ===== */
        #spvForm .form-group { margin-bottom: 10px; }

        #spvForm input[type="text"],
        #spvForm input[type="date"],
        #spvForm input[type="time"],
        #spvForm textarea,
        #spvForm select {
          width: 100%;
          padding: 0.6rem;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-size: 0.95rem;
          box-sizing: border-box;
        }

        #spvForm button {
          width: 100%;
          padding: .6rem;
          background: #00BCD4;
          color: #fff;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 1rem;
        }
        #spvForm button:hover { background: #00BCD4; }

        .tabs { display: flex; margin-bottom: 10px; }
        .tabs button {
          flex: 1;
          padding: 8px;
          border: none;
          cursor: pointer;
          background: #ddd;
          font-weight: bold;
        }
        .tabs button.active {
          background: #00BCD4;
          color: white;
        }

        /* ===== Spinner ===== */
        #spvSpinner {
          display: none;
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.4);
          z-index: 9999;
          align-items: center;
          justify-content: center;
        }

        #spvSpinner div {
          width: 50px;
          height: 50px;
          border: 6px solid #fff;
          border-top-color: #00BCD4;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        /* ===== Label Foto ===== */
        label {
          font-weight: 600;
          display: block;
          margin-bottom: 4px;
          color: #333;
        }
        input[type="file"] {
          width: 100%;
          padding: 6px 0;
        }
      </style>

      <!-- SPINNER OVERLAY -->
      <div id="spvSpinner"><div></div></div>

      <!-- Input Nama Order -->
      <!-- Input Nama Order -->
      <div class="form-group">
        <label>Nama Order</label>
        <input type="text" id="spvOrder" placeholder="Nama Order" required>
      </div>

      <!-- Input No KS -->
      <div class="form-group">
        <label>No KS</label>
        <input type="text" id="spvNoKS" placeholder="KS-xxxx-xx" required>
      </div>

      <!-- Tanggal & Jam -->
      <div class="form-group" style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Tanggal</label>
          <input type="date" id="spvTanggal" required style="width:100%;">
        </div>
        <div style="flex:1;">
          <label>Jam</label>
          <input type="time" id="spvJam" required style="width:100%;">
        </div>
      </div>

      <!-- Foto Acuan -->
      <div class="form-group">
        <label>Foto Acuan</label>
        <label for="spvFoto">ðŸ“¸ Pilih Foto:</label>
        <input type="file" id="spvFoto" accept="image/*">
      </div>

      <!-- Keterangan Acuan -->
      <div class="form-group">
        <label>Keterangan Acuan (opsional)</label>
        <textarea id="spvKet" placeholder="Keterangan Acuan (opsional)" rows="3"></textarea>
      </div>

      <!-- Foto Temuan -->
      <div class="form-group">
        <label>Foto Temuan</label>
        <label for="spvFoto1">ðŸ“· Pilih Foto:</label>
        <input type="file" id="spvFoto1" accept="image/*">
      </div>

      <!-- Keterangan Temuan -->
      <div class="form-group">
        <label>Keterangan Temuan (opsional)</label>
        <textarea id="spvKet1" placeholder="Keterangan Temuan (opsional)" rows="3"></textarea>
      </div>

      <!-- Nama QC -->
      <div class="form-group">
        <label>Nama QC</label>
        <select id="spvNama" required>
          <option value="" disabled selected>Pilih Nama QC</option>
          <option value="NANI">NANI</option>
          <option value="ANJANI">ANJANI</option>
          <option value="SUCI">SUCI</option>
          <option value="ANOM">ANOM</option>
          <option value="IRNA">IRNA</option>
          <option value="MARWAN">MARWAN</option>
          <option value="KIKI">KIKI</option>
          <option value="MARTINI">MARTINI</option>
          <option value="KRESTIN">KRESTIN</option>
          <option value="ISMIE">ISMIE</option>
        </select>
      </div>

      <!-- Proses -->
      <div class="form-group">
        <label>Proses</label>
        <select id="spvProses" required>
          <option value="" disabled selected>Pilih Proses</option>
          <option value="QC BAPRO">QC BAPRO</option>
          <option value="QC CETAK">QC CETAK</option>
          <option value="QC FINISHING">QC FINISHING</option>
          <option value="QC LEM">QC LEM</option>
          <option value="RETUR">RETUR</option>
        </select>
      </div>


      <!-- Tombol Submit -->
      <div class="form-group">
        <button type="button" onclick="submitSPV(event)">âž• Tambah</button>
      </div>
    </form>
  </div>

<!-- ========== HASIL ========== -->
<div id="spvHasilSection" style="display:none;">
  <div class="hasil-container">
    
    <!-- Kolom Pencarian -->
    <div class="search-wrapper">
      <input 
        type="text" 
        id="spvSearch" 
        placeholder="ðŸ” Tanggal / Order / No KS / QC / Proses">
    </div>

    <!-- Spinner Loading -->
    <div id="spvLoading" style="display:none; text-align:center; padding:10px;">
      <div class="spinner"></div>
      <p style="font-size:0.9rem; color:#555;">Memuat Data SPV</p>
    </div>

    <!-- Tabel Hasil -->
    <div class="table-wrapper">
      <table id="spvTable" border="1">
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Nama Order</th>
            <th>No KS</th>
            <th>Jam</th>
            <th>Keterangan Acuan</th>
            <th>Foto Acuan</th>
            <th>Keterangan Temuan</th>
            <th>Foto Temuan</th>
            <th>Nama QC</th>
            <th>Proses</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data diisi melalui JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>



</section>

<style>
/* ========== Spinner ========== */
.spinner {
  width: 28px;
  height: 28px;
  border: 3px solid #ddd;
  border-top: 3px solid #00BCD4;
  border-radius: 50%;
  margin: 0 auto;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ========== Tabel Dasar (Desktop) ========== */
.table-wrapper { width:100%; overflow-x:auto; }
#spvTable {
  width:100%;
  border-collapse:collapse;
  font-size:0.9rem;
  background:#fff;
}
#spvTable th, #spvTable td {
  border:1px solid #ddd;
  padding:8px 10px;
  text-align:center;
  vertical-align:middle;
}
#spvTable thead {
  background:#00BCD4;
  color:#fff;
}

/* Lebar kolom foto */
#spvTable th:nth-child(6),
#spvTable td:nth-child(6),
#spvTable th:nth-child(8),
#spvTable td:nth-child(8) {
  min-width:160px;
}

/* Input file */
#spvTable input[type="file"] {
  width:100%;
  max-width:160px;
  font-size:0.85rem;
  padding:4px;
  box-sizing:border-box;
  cursor:pointer;
}

/* Tombol umum (semua tombol) */
#spvTable button {
  padding: 6px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
  margin: 4px;
  color: #fff !important;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: 0.25s;
}

/* ======== Warna Tombol Edit / Simpan / Batal ======== */

/* Tombol Edit */
#spvTable .edit-btn {
  background: linear-gradient(135deg, #FFD740, #FFC400);
  color: #000 !important;
}
#spvTable .edit-btn:hover {
  background: linear-gradient(135deg, #FFEE58, #FFD740);
  transform: translateY(-2px);
}

/* Tombol Simpan */
#spvTable .save-btn {
  background: linear-gradient(135deg, #43A047, #66BB6A);
}
#spvTable .save-btn:hover {
  background: linear-gradient(135deg, #66BB6A, #81C784);
  transform: translateY(-2px);
}

/* Tombol Batal */
#spvTable .cancel-btn {
  background: linear-gradient(135deg, #E53935, #EF5350);
}
#spvTable .cancel-btn:hover {
  background: linear-gradient(135deg, #F44336, #E57373);
  transform: translateY(-2px);
}

/* Rata tengah semua kolom */
#spvTable th, #spvTable td { text-align:center; }

/* ========== HP ========== */
/* ===== SPV Mobile Responsive â€” Final ===== */
@media (max-width:768px){
  /* Semua elemen tabel diubah jadi block */
  #spvTable, #spvTable thead, #spvTable tbody, #spvTable th, #spvTable td, #spvTable tr {
    display:block;
  }
  #spvTable thead { display:none; }

  /* Setiap baris rapi */
  #spvTable tr {
    background:#fff;
    border:1px solid #ddd;
    border-radius:10px;
    margin-bottom:14px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:10px 12px;
  }

  /* Semua td: label di atas, rata kiri */
  #spvTable td {
    display:flex;
    flex-direction: column;
    align-items:flex-start;
    padding:6px 0;
    border-bottom:1px solid #eee;
    font-size:0.9rem;
    text-align:left;
    word-break:break-word;
  }
  #spvTable td:last-child { border-bottom:none; }

  /* Label di atas isi */
  #spvTable td::before {
    font-weight:600;
    color:#333;
    flex:0 0 auto;
    text-align:left;
    padding-bottom:4px; /* jarak label & isi */
  }

  /* Label sesuai kolom */
  #spvTable td:nth-child(1)::before { content:"Tanggal:"; }
  #spvTable td:nth-child(2)::before { content:"Nama Order:"; }
  #spvTable td:nth-child(3)::before { content:"No KS:"; }
  #spvTable td:nth-child(4)::before { content:"Jam:"; }
  #spvTable td:nth-child(5)::before { content:"Keterangan Acuan:"; }
  #spvTable td:nth-child(6)::before { content:"Foto Acuan:"; }
  #spvTable td:nth-child(7)::before { content:"Keterangan Temuan:"; }
  #spvTable td:nth-child(8)::before { content:"Foto Temuan:"; }
  #spvTable td:nth-child(9)::before { content:"Nama QC:"; }
  #spvTable td:nth-child(10)::before { content:"Proses:"; }
  #spvTable td:nth-child(11)::before { content:"Aksi:"; }

  /* Kolom Proses tetap rata kiri */
  #spvTable td:nth-child(10) {
    width:100%;
    flex-direction: column;
    align-items:flex-start;
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  /* Kolom Aksi â€” tombol & keterangan rata tengah */
  #spvTable td:nth-child(11) {
    width:100%;
    flex-direction: column;
    align-items:center;   /* rata tengah */
    text-align:center;    /* teks keterangan juga rata tengah */
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  /* Tombol Edit / Simpan / Batal di Aksi */
  #spvTable td:nth-child(11) button {
    width:80%;
    max-width:160px;
    margin:4px 0;
    display:block;
  }

  /* Input file menyesuaikan */
  #spvTable td input[type="file"] {
    width:100%;
    max-width:100%;
  }

  /* Textarea / input edit area */
  #spvTable tbody td input,
  #spvTable tbody td textarea {
    width:100%;
    box-sizing:border-box;
    padding:8px;
    border-radius:6px;
    border:1px solid #999;
    font-size:14px;
    resize: vertical;
    min-height:60px;
    max-height:200px;
    overflow-y:auto;
    text-align:left;
  }
}


/* ========== Frame & Search ========== */
.hasil-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 0 10px 20px;
  box-sizing: border-box;
}
.search-wrapper {
  width: 100%;
  margin-bottom: 16px;
}
.search-wrapper input {
  width: 100%;
  padding: 8px 12px;
  border: 1.5px solid #9c27b0;
  border-radius: 8px;
  font-size: 0.95rem;
  color: #333;
  outline: none;
}
@media (min-width: 769px) {
  .hasil-container { max-width: 100%; padding: 0; }
}

body {
  background:#f5f7fa;
  font-family:'Segoe UI', sans-serif;
}

/* ================================ */
/* QC SPV â€” Layout utama */
/* ================================ */
#qcSPV {
  display: flex;
  flex-direction: column;
  max-height: 80vh; /* sama seperti QC LEM */
  overflow: hidden;
}


/* ================================ */
/* JUDUL TETAP DI ATAS */
/* ================================ */
#qcSPV > h2 {
  position: sticky;
  top: 0;
  z-index: 100;
  background: inherit;
  margin-top: 0;
}


/* ================================ */
/* TAB INPUTAN / HASIL */
/* ================================ */
#qcSPV .tabs {
  position: sticky;
  top: 50px; /* pas di bawah judul */
  z-index: 99;
  background: #fff;
  padding: 6px 0;
  margin-bottom: 6px !important;
}


/* ================================ */
/* INPUT & HASIL â€” dapat scroll sendiri */
/* ================================ */
#spvInputSection,
#spvHasilSection {
  overflow-y: auto;
  max-height: calc(80vh - 120px);
  padding-right: 4px;
}


/* ================================ */
/* FILTER HASIL TETAP DI ATAS */
/* ================================ */
#spvHasilSection .search-wrapper {
  position: sticky;
  top: 0;
  z-index: 90;
  background: #fff;
  padding-top: 4px;
  padding-bottom: 4px;
  margin-bottom: 8px;
}


/* ================================ */
/* TABEL WRAPPER */
/* ================================ */
#spvHasilSection .table-wrapper {
  overflow-y: auto;
  max-height: calc(80vh - 180px);
  border: 1px solid #ddd;
}


/* HEADER TABEL IKUT STICKY */
#spvHasilSection table thead th {
  position: sticky;
  top: 0;
  background: #00BCD4;
  color: #fff;
  z-index: 89;
}

/* QC SPV â€” Agar hasil tetap rapi mengikuti enter + rata kiri */
#spvTable td {
  white-space: pre-line !important;
  text-align: left !important;
}

/* === Perbesar area edit SPV (input & textarea) === */
#spvTable tbody td input,
#spvTable tbody td textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #999;
  font-size: 14px;
  resize: vertical;     /* bisa ditarik ke bawah */
  min-height: 60px;      /* area edit jadi BESAR */
  max-height: 200px;     /* tetap tidak melebihi tabel */
  overflow-y: auto;      /* scroll di dalam, bukan scroll kanan tabel */
}

</style>

<script>
const spvNoKS = document.getElementById('spvNoKS');

if (spvNoKS) {
  spvNoKS.addEventListener('input', function() {
    let value = spvNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // hanya huruf & angka, uppercase

    if (value.length > 2) {
      value = value.slice(0,2) + '-' + value.slice(2);
    }

    if (value.length > 7) {
      value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
    }

    spvNoKS.value = value;
  });
}
</script>




<!-- ======================== QC MEETING ======================== -->
<section id="qcMeeting" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #00BCD4, #4DD0E1); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px;
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU MEETING QC
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn active" data-tab="meetingInputSection" onclick="showMeetingTab('input', this)">Inputan</button>
    <button class="tab-btn" data-tab="meetingHasilSection" onclick="showMeetingTab('hasil', this)">Hasil</button>
  </div>

  <!-- ========== INPUTAN ========== -->
  <div id="meetingInputSection" style="margin-top:10px;">
    <form id="meetingForm">

      <style>
        /* ===== Style Form QC Meeting ===== */
        #meetingForm .form-group { margin-bottom: 10px; }

        #meetingForm input[type="text"],
        #meetingForm input[type="date"],
        #meetingForm input[type="time"],
        #meetingForm textarea {
          width: 100%;
          padding: 0.6rem;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-size: 0.95rem;
          box-sizing: border-box;
        }

        #meetingForm button {
          width: 100%;
          padding: .6rem;
          background: #00BCD4;
          color: #fff;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 1rem;
        }
        #meetingForm button:hover { background: #00BCD4; }

        /* Tab Button */
        .tab-btn {
          flex: 1;
          padding: 6px 0;
          border-radius: 6px;
          font-weight: 600;
          cursor: pointer;
          border: 1px solid #000 !important;
          background: #e0e0e0 !important;
          color: #000 !important;
          transition: all 0.2s;
          text-align: center;
        }
        .tab-btn.active {
          background: linear-gradient(to right, #00BCD4, #4DD0E1) !important;
          color: #fff !important;
          border: 1px solid #000 !important;
        }
        .tab-btn:not(.active):hover {
          background: #B2EBF2 !important;
          color: #000 !important;
          transform: translateY(-1px);
          box-shadow: 0 2px 6px rgba(0,188,212,0.3);
        }
        .tab-btn:focus { outline:none; box-shadow:none; }

        /* Spinner overlay */
        #meetingSpinner {
          display: none;
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.4);
          z-index: 9999;
          align-items: center;
          justify-content: center;
        }
        #meetingSpinner div {
          width: 50px;
          height: 50px;
          border: 6px solid #fff;
          border-top-color: #00BCD4;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
      </style>

      <!-- SPINNER -->
      <div id="meetingSpinner"><div></div></div>

      <!-- Nama Meeting -->
      <div class="form-group">
        <label>Nama Meeting / Tema</label>
        <input type="text" id="meetingNama" placeholder="Tema" required>
      </div>

      <!-- Tanggal & Jam -->
      <div class="form-group" style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Tanggal</label>
          <input type="date" id="meetingTanggal" required style="width:100%;">
        </div>
        <div style="flex:1;">
          <label>Jam</label>
          <input type="time" id="meetingJam" required style="width:100%;">
        </div>
      </div>

      <!-- Foto Permasalahan -->
      <div class="form-group">
        <label>Foto Permasalahan</label>
        <label for="meetingFoto">ðŸ“· Pilih Foto:</label>
        <input type="file" id="meetingFoto" accept="image/*">
      </div>

      <!-- Keterangan Foto -->
      <div class="form-group">
        <label>Keterangan Foto (opsional)</label>
        <textarea id="meetingKet" placeholder="Keterangan Foto (opsional)" rows="3"></textarea>
      </div>

      <!-- Akar Masalah -->
      <div class="form-group">
        <label>Akar Masalah</label>
        <textarea id="meetingAkar" placeholder="Akar Masalah" rows="2"></textarea>
      </div>

      <!-- Tindakan Perbaikan -->
      <div class="form-group">
        <label>Tindakan Perbaikan</label>
        <textarea id="meetingTindakan" placeholder="Tindakan Perbaikan" rows="2"></textarea>
      </div>

      <!-- Catatan Tambahan -->
      <div class="form-group">
        <label>Catatan Tambahan (opsional)</label>
        <textarea id="meetingCatatan" placeholder="Catatan Tambahan (opsional)" rows="2"></textarea>
      </div>

      <!-- Peserta (checkbox, rapi) -->
      <div class="form-group">
        <label>Peserta</label>
        <div style="display:flex; flex-wrap:wrap; gap:10px;">
          <label><input type="checkbox" value="NANI"> NANI</label>
          <label><input type="checkbox" value="ANJANI"> ANJANI</label>
          <label><input type="checkbox" value="SUCI"> SUCI</label>
          <label><input type="checkbox" value="ANOM"> ANOM</label>
          <label><input type="checkbox" value="IRNA"> IRNA</label>
          <label><input type="checkbox" value="MARWAN"> MARWAN</label>
          <label><input type="checkbox" value="KIKI"> KIKI</label>
          <label><input type="checkbox" value="MARTINI"> MARTINI</label>
          <label><input type="checkbox" value="KRESTIN"> KRESTIN</label>
          <label><input type="checkbox" value="ISMIE"> ISMIE</label>
        </div>
      </div>


      <!-- Tombol Submit -->
      <div class="form-group">
        <button type="button" onclick="submitMeeting(event)">âž• Tambah Meeting</button>
      </div>
    </form>
  </div>

  <!-- ========== HASIL ========== -->
  <div id="meetingHasilSection" style="display:none;">
    <div class="hasil-container">
      <div class="search-wrapper">
        <input type="text" id="meetingSearch" placeholder="ðŸ” Tanggal / Meeting / Peserta">
      </div>

      <div id="meetingLoading" style="display:none; text-align:center; padding:10px;">
        <div class="spinner"></div>
        <p style="font-size:0.9rem; color:#555;">Memuat Data Meeting</p>
      </div>

      <div class="table-wrapper">
        <table id="meetingTable" border="1">
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Nama Meeting</th>
              <th>Jam</th>
              <th>Keterangan Foto</th>
              <th>Foto Permasalahan</th>
              <th>Akar Masalah</th>
              <th>Tindakan Perbaikan</th>
              <th>Catatan Tambahan</th>
              <th>Peserta</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data diisi melalui JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <style>
    /* ===== Spinner ===== */
    .spinner { width:28px; height:28px; border:3px solid #ddd; border-top:3px solid #00BCD4; border-radius:50%; margin:0 auto; animation:spin 0.8s linear infinite;}
    @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

    /* Table dasar */
    .table-wrapper { width:100%; overflow-x:auto; }
    #meetingTable { width:100%; border-collapse:collapse; font-size:0.9rem; background:#fff; }
    #meetingTable th, #meetingTable td { border:1px solid #ddd; padding:8px; text-align:center; vertical-align:middle; }
    #meetingTable thead { background:#00BCD4; color:#fff; }
    #meetingTable th:nth-child(5), #meetingTable td:nth-child(5) { min-width:160px; } /* Foto */
    #meetingTable input[type="file"] { width:100%; max-width:160px; font-size:0.85rem; padding:4px; cursor:pointer; }

    /* Tombol */
    #meetingTable button { padding:6px 12px; border:none; border-radius:8px; cursor:pointer; font-size:0.9rem; margin:4px; color:#fff; font-weight:600; box-shadow:0 2px 6px rgba(0,0,0,0.15); transition:0.25s; }
    #meetingTable .edit-btn { background: linear-gradient(135deg, #FFD740, #FFC400); color:#000 !important; }
    #meetingTable .edit-btn:hover { background: linear-gradient(135deg, #FFEE58, #FFD740); transform: translateY(-2px); }
    #meetingTable .save-btn { background: linear-gradient(135deg, #43A047, #66BB6A); }
    #meetingTable .save-btn:hover { background: linear-gradient(135deg, #66BB6A, #81C784); transform: translateY(-2px); }
    #meetingTable .cancel-btn { background: linear-gradient(135deg, #E53935, #EF5350); }
    #meetingTable .cancel-btn:hover { background: linear-gradient(135deg, #F44336, #E57373); transform: translateY(-2px); }

/* Mobile responsive â€” versi rapi, label di atas isi */
@media (max-width:768px){
  #meetingTable, #meetingTable thead, #meetingTable tbody, #meetingTable th, #meetingTable td, #meetingTable tr {
    display:block;
  }
  #meetingTable thead { display:none; }

  #meetingTable tr {
    background:#fff;
    border:1px solid #ddd;
    border-radius:10px;
    margin-bottom:14px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:10px 12px;
  }

  #meetingTable td {
    display:flex;
    flex-direction: column; /* label di atas isi */
    align-items: flex-start;
    padding:6px 0;
    border-bottom:1px solid #eee;
    font-size:0.9rem;
    text-align:left;
    word-break:break-word;
  }

  #meetingTable td:last-child { border-bottom:none; }

  /* Label di atas isi */
  #meetingTable td::before {
    font-weight:600;
    color:#333;
    flex:0 0 auto;
    text-align:left;
    padding-bottom:4px; /* jarak label & isi */
  }

  /* Label sesuai kolom */
  #meetingTable td:nth-child(1)::before { content:"Tanggal:"; }
  #meetingTable td:nth-child(2)::before { content:"Nama Meeting:"; }
  #meetingTable td:nth-child(3)::before { content:"Jam:"; }
  #meetingTable td:nth-child(4)::before { content:"Keterangan Foto:"; }
  #meetingTable td:nth-child(5)::before { content:"Foto Permasalahan:"; }
  #meetingTable td:nth-child(6)::before { content:"Akar Masalah:"; }
  #meetingTable td:nth-child(7)::before { content:"Tindakan Perbaikan:"; }
  #meetingTable td:nth-child(8)::before { content:"Catatan Tambahan:"; }
  #meetingTable td:nth-child(9)::before { content:"Peserta:"; }
  #meetingTable td:nth-child(10)::before { content:"Aksi:"; }

  /* Tombol Aksi â€” fleksibel & ukuran sama */
  #meetingTable td:nth-child(10) {
    width:100%;
    flex-direction: column;
    align-items:center;
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  #meetingTable td:nth-child(10) button {
    width:80%;
    max-width:160px;
    margin:4px 0;
  }

  /* Input file */
  #meetingTable td input[type="file"] { width:100%; max-width:100%; }

  /* Textarea / input edit area */
  #meetingTable tbody td input[type="text"],
  #meetingTable tbody td input[type="time"],
  #meetingTable tbody td input[type="date"],
  #meetingTable tbody td textarea {
    width:100%;
    box-sizing:border-box;
    padding:8px;
    border-radius:6px;
    border:1px solid #999;
    font-size:14px;
    resize: vertical;
    min-height:60px;
    max-height:200px;
    overflow-y:auto;
    text-align:left;
  }
}


    /* Sticky judul & tab */
    #qcMeeting > h2 { position: sticky; top: 0; z-index: 100; background: inherit; margin-top:0; }
    #qcMeeting .tabs { position: sticky; top: 50px; z-index: 99; background:#fff; padding:6px 0; margin-bottom:6px !important; }

    /* Scroll input & hasil */
    #meetingInputSection, #meetingHasilSection { overflow-y:auto; max-height:calc(80vh - 120px); padding-right:4px; }
    #meetingHasilSection .search-wrapper { position:sticky; top:0; z-index:90; background:#fff; padding-top:4px; padding-bottom:4px; margin-bottom:8px; }
    #meetingHasilSection .table-wrapper { overflow-y:auto; max-height:calc(80vh - 180px); border:1px solid #ddd; }
    #meetingHasilSection table thead th { position:sticky; top:0; background:#00BCD4; color:#fff; z-index:89; }

/* Agar hasil meeting tetap rapi dan rata kiri */
#meetingTable td {
  white-space: pre-line !important;
  text-align: left !important;
}

/* === Perbesar area edit di QC MEETING === */
#meetingTable tbody td input[type="text"],
#meetingTable tbody td input[type="time"],
#meetingTable tbody td input[type="date"],
#meetingTable tbody td textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #999;
  font-size: 14px;
  resize: vertical;
  min-height: 60px;
  max-height: 200px;
  overflow-y: auto;
  text-align: left !important;
}

/* Foto input */
#meetingTable tbody td input[type="file"] {
  width: 100%;
  max-width: 180px;
  padding: 6px;
  font-size: 13px;
  border-radius: 6px;
}

/* Kolom Peserta â€” dibuat lebar & rapi */
#meetingTable tbody td:nth-child(9) {
  min-width: 200px !important;
  white-space: pre-line !important;
  text-align: left !important;
}

/* Kolom Aksi â€” pusat & ukuran tetap */
#meetingTable tbody td:nth-child(10) {
  min-width: 130px !important;
  text-align: center !important;
}

/* ===== Tombol Share WA (samakan dengan tombol Edit) ===== */
#meetingTable .share-btn {
  background: linear-gradient(135deg, #29B6F6, #4FC3F7);
  color: #fff !important;
  padding: 4px 10px;        /* <<< ukuran yang sama seperti tombol Edit */
  font-size: 0.85rem;       /* <<< ukuran font tombol Edit */
  font-weight: 600;
  border: none;
  border-radius: 6px;       /* <<< sama dengan tombol Edit */
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  transition: 0.25s;
  margin: 2px;
  height: 30px;             /* <<< ini yang membuat benar-benar seragam */
}

#meetingTable .share-btn:hover {
  background: linear-gradient(135deg, #4FC3F7, #81D4FA);
  transform: translateY(-2px);
}

/* Mobile â€” ukuran tetap mengikuti tombol Edit */
@media (max-width: 768px) {
  #meetingTable td:nth-child(10) button.share-btn {
    width: auto;
    height: 34px;          /* match tombol Edit versi mobile */
    font-size: 0.85rem;
    margin: 4px 0;
  }
}

  </style>


  </section>



<!-- ======================== Floating Chatbot 3D Button (Premium Edition) ======================== -->
<div class="chatbot-wrapper" onclick="openChatbot()">
  <div class="chatbot-bg pulse-lines">
    <div class="bg-light"></div>

    <!-- Robot -->
    <div class="chatbot-body robot">
      <div class="chatbot-face" id="cbFace">
        <div class="reflection"></div>
        <div class="eye left"></div>
        <div class="eye right"></div>
        <div class="smile"></div>
      </div>
    </div>

    <!-- Text AI + Flare -->
    <div class="chatbot-text" id="cbText">
      AI
      <div class="flare"></div>
    </div>
  </div>
</div>

<script>
/* ---- OPEN CHATBOT ---- */
function openChatbot() {
  const pass = prompt("Masukkan password untuk membuka Chatbot:");
  if (pass === "spv123") {
    window.open("https://www.chatbase.co/chatbot-iframe/WQV6nYLIpvH1KdrwilMKh", "_blank");
  } else if (pass !== null) {
    alert("Password salah! Akses ditolak.");
  }
}

/* ---- FACE â†” TEXT LOOP ---- */
let showFace = true;

function swapFaceText() {
  const face = document.getElementById("cbFace");
  const text = document.getElementById("cbText");

  if (showFace) {
    face.style.opacity = "0";
    text.style.opacity = "1";
  } else {
    text.style.opacity = "0";
    face.style.opacity = "1";
  }

  showFace = !showFace;

  setTimeout(swapFaceText, 2600);
}

setTimeout(swapFaceText, 1500);
</script>

<style>
/* ===== Wrapper ===== */
.chatbot-wrapper {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 78px;
  height: 78px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #4b68ff, #1c2ca5);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 25px rgba(80, 120, 255, 0.55);
  cursor: pointer;
  z-index: 9999;
  overflow: hidden;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
  animation: idleFloat 5s ease-in-out infinite;
}
.chatbot-wrapper:hover {
  transform: scale(1.12) rotate3d(1, 1, 0, 6deg);
  box-shadow: 0 12px 40px rgba(120,150,255,0.85);
}

/* Shadow responsive */
.chatbot-wrapper::after {
  content: "";
  position: absolute;
  bottom: -6px;
  width: 50%;
  height: 10px;
  background: rgba(0,0,0,0.25);
  border-radius: 50%;
  filter: blur(8px);
  animation: shadowMove 5s ease-in-out infinite;
}

/* ===== Background Glow Layer ===== */
.chatbot-bg {
  width: 62px;
  height: 62px;
  position: relative;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Pulse Lines */
.pulse-lines::before {
  content: "";
  position: absolute;
  width: 200%;
  height: 200%;
  background: repeating-conic-gradient(
    from 0deg,
    rgba(255,255,255,0.18) 0deg,
    rgba(255,255,255,0) 12deg
  );
  animation: pulseLines 6s linear infinite;
  opacity: 0.4;
}

/* Rotating glow layer */
.bg-light {
  position: absolute;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, #6e8cff, #3b56ff, #6e8cff);
  animation: rotateLight 8s linear infinite;
  opacity: 0.25;
}

/* ===== Robot Body ===== */
.chatbot-body {
  position: relative;
  width: 40px;
  height: 42px;
  background: linear-gradient(145deg, #f8faff, #cad3ff);
  border-radius: 18px;
  box-shadow:
    inset 0 -4px 10px rgba(0,0,0,0.15),
    0 3px 6px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: heartbeatGlow 4s ease-in-out infinite;
}

/* ===== Face ===== */
.chatbot-face {
  width: 30px;
  height: 20px;
  background: linear-gradient(180deg, #193bff 0%, #132cad 100%);
  border-radius: 10px;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 8px rgba(255,255,255,0.25);
  opacity: 1;
  transition: opacity .55s ease;
}

/* Reflection Shine */
.reflection {
  position: absolute;
  top: 0;
  left: -40px;
  width: 35px;
  height: 20px;
  background: linear-gradient(100deg, transparent 0%, rgba(255,255,255,0.5) 50%, transparent 100%);
  transform: skewX(-20deg);
  animation: reflectionMove 4.5s ease-in-out infinite;
  opacity: 0.35;
}

/* ===== Eyes ===== */
.eye {
  position: absolute;
  top: 5px;
  width: 5px;
  height: 5px;
  background: radial-gradient(circle, #8cd2ff 40%, #3d7eff 100%);
  border-radius: 50%;
  animation: blink 6s infinite, lookAround 5s ease-in-out infinite;
  transition: transform 0.2s ease;
}
.eye.left { left: 6px; }
.eye.right { right: 6px; }

.chatbot-wrapper:hover .eye {
  transform: scale(1.25);
}

/* ===== Smile ===== */
.smile {
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
  width: 12px;
  height: 5px;
  border-bottom: 2px solid #6cb0ff;
  border-radius: 0 0 10px 10px;
  animation: smileWiden 3s ease-in-out infinite;
  transition: width 0.2s ease;
}
.chatbot-wrapper:hover .smile {
  width: 18px;
}

/* ===== AI Text ===== */
.chatbot-text {
  position: absolute;
  font-size: 18px;
  font-weight: bold;
  color: #1976D2;
  text-shadow: 0 0 8px rgba(255,255,255,0.8);
  opacity: 0;
  transition: opacity .55s ease;
}

/* Flare Effect */
.flare {
  position: absolute;
  width: 140%;
  height: 140%;
  background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 70%);
  border-radius: 50%;
  top: -20%;
  left: -20%;
  transform: scale(0);
  opacity: 0;
  animation: flarePulse 6s ease-in-out infinite;
}

/* ===== Animations ===== */
@keyframes idleFloat {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}
@keyframes shadowMove {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.25); }
}
@keyframes rotateLight {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
@keyframes pulseLines {
  from { transform: rotate(0deg); }
  to { transform: rotate(-360deg); }
}
@keyframes heartbeatGlow {
  0%,100% { box-shadow: 0 0 4px rgba(70,140,255,0.28); }
  50% { box-shadow: 0 0 12px rgba(70,140,255,0.45); }
}
@keyframes reflectionMove {
  0%,100% { left: -40px; }
  50% { left: 35px; }
}
@keyframes blink {
  0%, 94%, 100% { height: 5px; }
  96% { height: 1.5px; }
}
@keyframes lookAround {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(1.3px); }
  75% { transform: translateX(-1.3px); }
}
@keyframes smileWiden {
  0%,100% { width: 12px; }
  50% { width: 16px; }
}
@keyframes flarePulse {
  0%,40% { transform: scale(0); opacity: 0; }
  50% { transform: scale(1.2); opacity: 0.6; filter: blur(4px); }
  70% { transform: scale(1); opacity: 0.3; }
  90%,100% { transform: scale(0); opacity: 0; }
}
</style>





<!-- ======================== SPINNER GLOBAL ======================== -->
<div id="loadingSpinner"
     style="display:none; position:fixed; top:10px; left:50%; transform:translateX(-50%);
            z-index:9999; background:transparent;
            display:flex; flex-direction:column; align-items:center; justify-content:center;">

  <div class="spinner-ring"></div>
</div>

<style>
/* ================== SPINNER HEADER STYLE (HITAMâ€“HIJAU MODERN) ================== */
.spinner-ring {
  position: relative;
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background: radial-gradient(circle at center, #22c55e 10%, #0f766e 30%, #000 60%);
  animation: rotate-eye 1.2s linear infinite;
  box-shadow: inset 0 0 8px rgba(34,197,94,0.5), 0 0 10px rgba(34,197,94,0.4);
}
.spinner-ring::after {
  content: '';
  position: absolute;
  inset: 6px;
  border: 2px solid #22c55e;
  border-radius: 50%;
  animation: pulse-eye 1.5s ease-in-out infinite;
}
@keyframes rotate-eye {
  to { transform: rotate(360deg); }
}
@keyframes pulse-eye {
  0%,100% { opacity: 0.8; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

</style>



<script>
// ====================== KONFIGURASI ======================
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxb0tAadZDZa870AVQfkmf03_YthZGZkFlmhMO2OZLnQZZo8bMNqeX0sS3nX6TCRf9a/exec";

// ====================== SPINNER GLOBAL JS ======================
const spinner = document.getElementById('loadingSpinner');
const showSpinner = () => spinner.style.display = 'flex';
const hideSpinner = () => spinner.style.display = 'none';

let prosesSedangJalan = 0;

function mulaiProses() {
  prosesSedangJalan++;
  showSpinner();
}

function selesaiProses() {
  prosesSedangJalan = Math.max(0, prosesSedangJalan - 1);
  if (prosesSedangJalan === 0) hideSpinner();
}

// ====================== Hook global ======================
(function () {
  const asliJsonp = window.jsonpGet;
  const asliPost = window.postPayload;

  if (typeof asliJsonp === 'function' && !asliJsonp.__hooked) {
    window.jsonpGet = async function(...args) {
      mulaiProses();
      try { return await asliJsonp.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.jsonpGet.__hooked = true;
  }

  if (typeof asliPost === 'function' && !asliPost.__hooked) {
    window.postPayload = async function(...args) {
      mulaiProses();
      try { return await asliPost.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.postPayload.__hooked = true;
  }
})();

// ====================== Load Semua Data ======================
async function loadAllData() {
  showSpinner();
  try {
    await Promise.all([
      Promise.resolve(loadBaproItems()),
      Promise.resolve(loadPAItems()),
      Promise.resolve(loadFinishingItems()),
      Promise.resolve(loadLemItems())
    ]);
  } catch (err) {
    console.error('Gagal memuat data:', err);
  } finally {
    hideSpinner();
  }
}

window.addEventListener('load', loadAllData);

// ====================== WAKTU HEADER ======================
function updateTime() {
  const now = new Date();

  // Format tanggal (tanpa jam)
  const tanggal = now.toLocaleDateString('id-ID', {
    weekday: 'long',
    day: '2-digit',
    month: 'long',
    year: 'numeric'
  });

  // Format jam (tanpa kata 'pukul')
  let jam = now.toLocaleTimeString('id-ID', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });

  // Hapus kemungkinan ada teks 'pukul' dari locale
  jam = jam.replace('pukul', '').replace('Pukul', '').trim();

  // Masukkan hasil ke dalam elemen
  const tanggalEl = document.querySelector('#headerTime .tanggal');
  const jamEl = document.querySelector('#headerTime .jam');

  if (tanggalEl && jamEl) {
    tanggalEl.textContent = tanggal;
    jamEl.textContent = jam;
  }
}

// Jalankan setiap detik
setInterval(updateTime, 1000);
updateTime();

// ====================== MENU ======================
function showMenu(menu) {
  document.querySelectorAll('main > section').forEach(sec => sec.style.display = 'none');
  document.getElementById(menu).style.display = 'block';
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`nav button[onclick="showMenu('${menu}')"]`).classList.add('active');

  if (menu === 'dashboard') renderDashboardFinishingCompact();
}

// ====================== TABS ======================
function switchTab(btn) {
  const parent = btn.parentElement;
  parent.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  parent.parentElement.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById(btn.dataset.tab).classList.add('active');

  if (btn.dataset.tab === 'hasilFinishing') {
    loadFinishingItems(); // refresh saat buka tab hasil
  }
}

// ====================== JSONP HELPER ======================
function jsonpGet(url, params = {}) {
  return new Promise((resolve, reject) => {
    const cbName = 'jsonp_cb_' + Math.random().toString(36).slice(2, 9);
    params = params || {};
    params.callback = cbName;
    const q = Object.entries(params).map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&');
    const script = document.createElement('script');
    script.src = `${url}?${q}`;
    script.onerror = () => {
      cleanup();
      reject(new Error('JSONP load error'));
    };
    window[cbName] = (res) => {
      cleanup();
      resolve(res);
    };
    function cleanup(){
      delete window[cbName];
      script.remove();
    }
    document.body.appendChild(script);
  });
}

// ===== SCROLL OTOMATIS SETELAH DASHBOARD DIBUKA =====
function autoScrollDashboardMenu(menu) {
  const sections = [
    `section${menu}TO`,
    `section${menu}Proses`,
    `section${menu}Selesai`
  ];

  sections.forEach(id => {
    const section = document.getElementById(id);
    if (!section) return;

    const observer = new MutationObserver(() => {
      if (section.style.display !== 'none') {
        const cards = section.querySelectorAll('.grid-card');
        if (cards.length > 0) {
          cards[cards.length - 1].scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
      }
    });

    observer.observe(section, { attributes: true, attributeFilter: ['style'] });
  });
}

// panggil setelah DOM siap
document.addEventListener('DOMContentLoaded', () => {
  ['Finishing','Bapro','PA','Lem'].forEach(menu => autoScrollDashboardMenu(menu));
});

// ===== SCROLL OTOMATIS KE BAWAH SAAT TAB HASIL DIBUKA =====
function scrollGridToBottom(menu) {
  const container = document.getElementById(`grid${menu}`);
  if (!container) return;
  const cards = container.querySelectorAll('.grid-card');
  if (cards.length === 0) return;
  cards[cards.length - 1].scrollIntoView({ behavior: 'smooth', block: 'end' });
}

// Tambahkan di fungsi switchTab
function switchTab(btn) {
  const tabName = btn.dataset.tab;
  if (!tabName) return;

  // Hapus active class dari semua tab
  btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  // Tampilkan konten tab
  btn.parentElement.parentElement.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  const content = document.getElementById(tabName);
  if (content) content.classList.add('active');

  // ðŸ”¹ Scroll otomatis jika tab hasil terbuka
  ['Finishing','Bapro','PA','Lem'].forEach(menu => {
    if (tabName === `hasil${menu}`) {
      setTimeout(() => scrollGridToBottom(menu), 100);
    }
  });
}

// ====================== GLOBAL STATE ======================
let finishingItems = []; // array yang diambil dari sheet

// ====================== RENDER GRID HASIL (Fix: tampilkan TO juga) ======================
function renderGridFinishing(query = "") {
  const container = document.getElementById('gridFinishing');
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  finishingItems.forEach((item, i) => {
    // Filter pencarian
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // ðŸ”§ Tambahkan status TO
    let statusClass = '';
    if (item.update === "Proses") statusClass = "status-proses";
    else if (item.update === "Selesai") statusClass = "status-selesai";
    else if (item.update === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Isi/Dus: ${escapeHtml(item.isi || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>BS: ${escapeHtml(item.jenisBS || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callFinishing(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editFinishingInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteFinishing(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

// Render ulang dashboard setelah daftar hasil berubah
  renderDashboardFinishingCompact();

  // âœ… Scroll otomatis ke item terakhir jika ada
  const lastCard = container.querySelector('.grid-card:last-child');
  if (lastCard) lastCard.scrollIntoView({ behavior: 'smooth', block: 'end' });
}

function escapeHtml(s) {
  return String(s || '')
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;');
}

// ====================== LOAD DATA DARI SPREADSHEET ======================
async function loadFinishingItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Finishing' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      finishingItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridFinishing();
    } else console.warn('loadFinishingItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadFinishingItems', err); }
}

// ====================== TAMBAH DATA DENGAN SPINNER & NOTIF ======================
function addFinishingItem() {
  const nama = document.getElementById('finishingNama').value.trim();
  const noKS = document.getElementById('finishingNoKS').value.trim();
  const order = document.getElementById('finishingOrder').value.trim();
  const isi = document.getElementById('finishingIsi').value.trim();
  const bagus = document.getElementById('finishingBagus').value.trim();
  const jenisBS = document.getElementById('finishingJenisBS').value.trim();
  const qc = document.getElementById('finishingQC').value.trim();
  const update = document.getElementById('finishingUpdate').value.trim();
  const keterangan = document.getElementById('finishingKeterangan').value.trim();

    // âœ… Validasi wajib diisi
  if (!nama || !noKS || !qc || !update) {
    return alert('Nama Order, No KS, QC, dan Proses wajib diisi!');
  }

  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return;

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = { action:'add', sheet:'Finishing', tanggal: tanggalFormatted, nama,noKS,order,isi,bagus,jenisBS,qc,update,keterangan };

  // === Spinner tombol ===
  const btnTambah = document.querySelector('#inputFinishing button');
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    // Tunggu proses sheet selesai (simulasi 8 detik)
    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML; // kembalikan tombol
      clearFinishingForm();
      loadFinishingItems();
      alert('âœ… Data berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearFinishingForm();
    setTimeout(() => loadFinishingItems(), 8000);
    alert('âœ… Data berhasil ditambahkan!');
  }
}



// ====================== PANGGIL (isi form dari item) ======================
function callFinishing(index){
  const item = finishingItems[index];
  if(!item) return;
  document.getElementById('finishingNama').value = item.nama || '';
  document.getElementById('finishingNoKS').value = item.noKS || '';
  document.getElementById('finishingOrder').value = item.order || '';
  document.getElementById('finishingIsi').value = item.isi || '';
  document.getElementById('finishingBagus').value = item.bagus || '';
  document.getElementById('finishingJenisBS').value = item.jenisBS || '';
  document.getElementById('finishingQC').value = item.qc || '';
  document.getElementById('finishingUpdate').value = item.update || '';
  document.getElementById('finishingKeterangan').value = item.keterangan || ''; // âœ³ï¸ tambahan

  showMenu('qcFinishing');
  const tabBtn = document.querySelector('#qcFinishing .tabs button[data-tab="inputFinishing"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (langsung hilang dari grid) ======================
function deleteFinishing(index) {
  const item = finishingItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Finishing', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // ðŸ”¹ Tunggu proses di Google Sheet (sekitar 8 detik)
  setTimeout(() => {
    // hapus dari array dan DOM setelah spinner tampil cukup lama
    finishingItems.splice(index, 1);
    card.remove();
    loadFinishingItems();
  }, 8000);
}

// ====================== EDIT INLINE (FINISHING) ======================
function editFinishingInline(index){
  const item = finishingItems[index];
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama untuk cancel
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.isi||'')}" placeholder="Isi/Dus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.jenisBS||'')}" placeholder="BS">

      <select class="edit-inline">
        <option value="Anom" ${item.qc==='Anom'? 'selected':''}>Anom</option>
        <option value="Irna" ${item.qc==='Irna'? 'selected':''}>Irna</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveFinishingInline(${index})">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelFinishingInline(${index})">âœ–ï¸</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (FINISHING) ======================
function cancelFinishingInline(index){
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if(!card) return;
  delete card.dataset.originalHTML;
  renderGridFinishing(); // tampilkan ulang tampilan normal
}

// ====================== SIMPAN HASIL EDIT INLINE (FINISHING) ======================
async function saveFinishingInline(index) {
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // ðŸ”¹ ambil tombol cancel

  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // ðŸ”¹ sembunyikan tombol cancel saat menyimpan

  const inputs = card.querySelectorAll('.edit-inline');

  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    jenisBS: inputs[5].value.trim(),
    qc: inputs[6].value,
    update: inputs[7].value,
    keterangan: inputs[8].value.trim()
  };

  const orig = finishingItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Finishing', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadFinishingItems();
  } catch (err) {
    console.error('Gagal menyimpan data Finishing:', err);
    alert('Gagal menyimpan data. Silakan coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== POST PAYLOAD ======================
function ensureIframe(){
  if(document.querySelector('iframe[name="hidden_iframe_post"]')) return;
  const ifr = document.createElement('iframe');
  ifr.name = 'hidden_iframe_post';
  ifr.style.display = 'none';
  ifr.addEventListener('load', ()=> setTimeout(()=> loadFinishingItems(), 10000));
  document.body.appendChild(ifr);
}
function postPayload(payloadObj){
  ensureIframe();
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = WEBAPP_URL;
  form.target = 'hidden_iframe_post';
  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = 'payload';
  input.value = JSON.stringify(payloadObj);
  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  form.remove();
}

// ====================== FILTER BERDASARKAN ISI GRID (FINISHING) ======================
function filterFinishingGrid(query){
  const grid = document.getElementById('gridFinishing');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM ======================
function clearFinishingForm() {
  [
    'finishingNama','finishingNoKS','finishingQC','finishingUpdate','finishingKeterangan'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number fields â†’ default 0
  [
    'finishingOrder','finishingIsi','finishingBagus','finishingJenisBS'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });
}


// ====================== DASHBOARD (UPDATE: TAMBAH STATUS "TO") ======================
function renderDashboardFinishingCompact() {
  const containerTO = document.getElementById('dashboardFinishingTO');      // ðŸ”¹ container baru untuk TO
  const containerProses = document.getElementById('dashboardFinishingProses');
  const containerSelesai = document.getElementById('dashboardFinishingSelesai');

  // pastikan elemen tidak null agar tidak error
  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  finishingItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    // ðŸŸ¢ Tentukan warna/status class
    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to"; // ðŸ’™ class baru untuk TO

    // ðŸ§© Isi kartu
    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <span>ðŸ“… ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    // ðŸ§  Kelompokkan berdasarkan status
    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    // ðŸ“‹ klik kartu untuk lihat detail
    card.addEventListener('click', () => showDetailModal(item));
  });

// ðŸ§® Update counter
document.getElementById('countFinishing').textContent = finishingItems.length; // total order
document.getElementById('countTOFinishing').textContent = totalTO;
document.getElementById('countProsesFinishing').textContent = totalProses;
document.getElementById('countSelesaiFinishing').textContent = totalSelesai;
}

// ====================== DETAIL ======================
function showDetailModal(item) {
  alert(`Detail Order:
Nama: ${item.nama}
No KS: ${item.noKS}
Order: ${item.order}
Isi: ${item.isi}
Bagus: ${item.bagus}
BS: ${item.jenisBS}
QC: ${item.qc}
Update: ${item.update}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW + FILTER QC FINISHING ======================
document.addEventListener('DOMContentLoaded', () => {
  // Tombol
  const btnTO = document.getElementById('toggleFinishingTO');
  const btnProses = document.getElementById('toggleFinishingProses');
  const btnSelesai = document.getElementById('toggleFinishingSelesai');

  // Section
  const sectionTO = document.getElementById('sectionFinishingTO');
  const sectionProses = document.getElementById('sectionFinishingProses');
  const sectionSelesai = document.getElementById('sectionFinishingSelesai');

  // Filter input
  const filterTO = document.getElementById('filterFinishingTO');
  const filterProses = document.getElementById('filterFinishingProses');
  const filterSelesai = document.getElementById('filterFinishingSelesai');

  // Grid container
  const gridTO = document.getElementById('dashboardFinishingTO');
  const gridProses = document.getElementById('dashboardFinishingProses');
  const gridSelesai = document.getElementById('dashboardFinishingSelesai');

  // ðŸ” Fungsi filter universal (per grid)
  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card');
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? '' : 'none';
    });
  }

  // Event input untuk filter real-time
  [
    {input: filterTO, grid: gridTO},
    {input: filterProses, grid: gridProses},
    {input: filterSelesai, grid: gridSelesai}
  ].forEach(({input, grid}) => {
    if (input) {
      input.addEventListener('input', () => filterCards(grid, input.value));
    }
  });

  // Fungsi supaya filter tetap aktif setelah reload data
  window.applyFinishingFilters = function() {
    filterCards(gridTO, filterTO.value);
    filterCards(gridProses, filterProses.value);
    filterCards(gridSelesai, filterSelesai.value);
  };

  // Toggle show/hide tiap section
  function toggleSection(section, btn) {
    const visible = section.style.display !== 'none';
    section.style.display = visible ? 'none' : 'block';
    btn.textContent = visible ? 'Show' : 'Hide';
  }

  if (btnTO) btnTO.addEventListener('click', () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener('click', () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener('click', () => toggleSection(sectionSelesai, btnSelesai));
});


// ====================== AUTO UPPERCASE ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;

  // Berlaku untuk input text dan textarea di dalam #qcFinishing
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcFinishing')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcFinishing'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC FINISHING (ubah sesuai kebutuhan) =====
const QC_FINISHING_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcFinishing')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC FINISHING:');
      if (input === null) return;
      if (input === QC_FINISHING_PASSWORD) {
        eval(originalOnClick); // jalankan fungsi aslinya
      } else {
        alert('Password salah!');
      }
    };
  }
});




// ====================== INISIALISASI ======================
showMenu('dashboard');
loadFinishingItems();


</script>

<!-- ====== JS QC BAPRO ====== -->
<script>
// ====================== GLOBAL STATE (BAPRO) ======================
let baproItems = []; // array yang diambil dari sheet Bapro

// ====================== RENDER GRID HASIL (BAPRO) ======================
function renderGridBapro(query = "") {
  const container = document.getElementById('gridBapro');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  baproItems.forEach((item, i) => {
    // Filter pencarian (nama atau cso)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.cso || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (cocokkan nilai case-sensitive seperti di sheet)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>CSO: ${escapeHtml(item.cso || '')}</span><br>
        <span>Jenis: ${escapeHtml(item.jenisKertas || '')}</span><br>
        <span>GSM: ${escapeHtml(item.tebalKertas || '')}</span><br>
        <span>Nama Tinta: ${escapeHtml(item.NamaTinta || '')}</span><br>
        <span>Dmax: ${escapeHtml(item.dmax || '')}</span><br>
        <span>L: ${escapeHtml(item.l || '')}  A: ${escapeHtml(item.a || '')}  B: ${escapeHtml(item.b || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callBapro(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editBaproInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteBapro(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardBaproCompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (BAPRO) ======================
async function loadBaproItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Bapro' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      // NOTE: getDataFromSheet returns objects with keys sesuai header names
      baproItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridBapro();
    } else console.warn('loadBaproItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadBaproItems', err); }
}

// ====================== TAMBAH DATA (BAPRO) ======================
function addBaproItem() {
  const nama = document.getElementById('baproNama').value.trim();
  const cso = document.getElementById('baprocso').value.trim();
  const jenis = document.getElementById('baproJenis') ? document.getElementById('baproJenis').value.trim() : '';
  const kertas = document.getElementById('baproKertas') ? document.getElementById('baproKertas').value.trim() : '';
  const NamaTinta = document.getElementById('baproNamaTinta') ? document.getElementById('baproNamaTinta').value.trim() : '';
  const dmax = document.getElementById('baproDmax') ? document.getElementById('baproDmax').value.trim() : '';
  const L = document.getElementById('baproL') ? document.getElementById('baproL').value.trim() : '';
  const A = document.getElementById('baproA') ? document.getElementById('baproA').value.trim() : '';
  const B = document.getElementById('baproB') ? document.getElementById('baproB').value.trim() : '';
  const qc = document.getElementById('baproQC') ? document.getElementById('baproQC').value.trim() : '';
  const update = document.getElementById('baproUpdate') ? document.getElementById('baproUpdate').value.trim() : '';
  const keterangan = document.getElementById('baproKeterangan') ? document.getElementById('baproKeterangan').value.trim() : '';

    // âœ… Validasi wajib diisi
  if (!nama || !cso || !jenis || !kertas || !NamaTinta || !update) {
    return alert('Nama Order, CSO, Jenis Kertas, Tebal Kertas, Nama Tinta, dan Proses wajib diisi!');
  }

  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nCSO: ${cso}`);
  if (!konfirmasi) return;

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = { action:'add', sheet:'Bapro', tanggal: tanggalFormatted,
    nama, cso,
    jenisKertas: jenis,
    tebalKertas: kertas,
    NamaTinta: NamaTinta,
    dmax: dmax,
    l: L,
    a: A,
    b: B,
    qc, update, keterangan
  };

  // ===== Spinner tombol =====
  const btnTambah = document.querySelector('#inputBapro button'); // pastikan tombol ada di #inputBapro
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    // Tunggu proses sheet selesai (simulasi 8 detik)
    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML; // kembalikan tombol
      clearBaproForm();
      loadBaproItems();
      alert('âœ… Data BAPRO berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearBaproForm();
    setTimeout(() => loadBaproItems(), 8000);
    alert('âœ… Data BAPRO berhasil ditambahkan!');
  }
}


// ====================== PANGGIL (isi form dari item) ======================
function callBapro(index){
  const item = baproItems[index];
  if(!item) return;
  if (document.getElementById('baproNama')) document.getElementById('baproNama').value = item.nama || '';
  if (document.getElementById('baprocso')) document.getElementById('baprocso').value = item.cso || '';
  if (document.getElementById('baproJenis')) document.getElementById('baproJenis').value = item.jenisKertas || '';
  if (document.getElementById('baproKertas')) document.getElementById('baproKertas').value = item.tebalKertas || '';
  if (document.getElementById('baproNamaTinta')) document.getElementById('baproNamaTinta').value = item.NamaTinta || '';
  if (document.getElementById('baproDmax')) document.getElementById('baproDmax').value = item.dmax || '';
  if (document.getElementById('baproL')) document.getElementById('baproL').value = item.l || '';
  if (document.getElementById('baproA')) document.getElementById('baproA').value = item.a || '';
  if (document.getElementById('baproB')) document.getElementById('baproB').value = item.b || '';
  if (document.getElementById('baproQC')) document.getElementById('baproQC').value = item.qc || '';
  if (document.getElementById('baproUpdate')) document.getElementById('baproUpdate').value = item.update || '';
  if (document.getElementById('baproKeterangan')) document.getElementById('baproKeterangan').value = item.keterangan || '';

  showMenu('qcBapro');
  const tabBtn = document.querySelector('#qcBapro .tabs button[data-tab="inputBapro"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (BAPRO) ======================
function deleteBapro(index) {
  const item = baproItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Bapro', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // ðŸ”¹ Tunda sedikit agar spinner terlihat dan Sheet sempat update
  setTimeout(() => {
    // hapus dari array dan DOM supaya langsung hilang
    baproItems.splice(index, 1);
    if (card) card.remove();
    // muat ulang data dari spreadsheet
    loadBaproItems();
  }, 8000);
}


// ====================== EDIT INLINE (BAPRO) ======================
function editBaproInline(index){
  const item = baproItems[index];
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <select class="edit-inline">
        <option value="Yati" ${item.cso==='Yati'? 'selected':''}>Yati</option>
        <option value="Retni" ${item.cso==='Retni'? 'selected':''}>Retni</option>
        <option value="Aulia" ${item.cso==='Aulia'? 'selected':''}>Aulia</option>
        <option value="Yuli" ${item.cso==='Yuli'? 'selected':''}>Yuli</option>
      </select>
      <input type="text" class="edit-inline" value="${escapeHtml(item.jenisKertas||'')}" placeholder="Jenis">
      <input type="number" class="edit-inline" value="${escapeHtml(item.tebalKertas||'')}" placeholder="GSM">
      <input type="text" class="edit-inline" value="${escapeHtml(item.NamaTinta||'')}" placeholder="Nama Tinta">
      <input type="number" class="edit-inline" value="${escapeHtml(item.dmax||'')}" placeholder="Dmax">
      <input type="number" class="edit-inline" value="${escapeHtml(item.l||'')}" placeholder="L">
      <input type="number" class="edit-inline" value="${escapeHtml(item.a||'')}" placeholder="A">
      <input type="number" class="edit-inline" value="${escapeHtml(item.b||'')}" placeholder="B">

      <select class="edit-inline">
        <option value="Marwan" ${item.qc==='Marwan'? 'selected':''}>Marwan</option>
        <option value="Kiki" ${item.qc==='Kiki'? 'selected':''}>Kiki</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveBaproInline(${index})">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelBaproInline(${index})">âœ–ï¸</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (BAPRO) ======================
function cancelBaproInline(index){
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if(!card) return;

  // Hapus data lama dan render ulang item sesuai data aslinya
  delete card.dataset.originalHTML;
  renderGridBapro(); // panggil ulang fungsi render untuk menampilkan ulang grid normal
}

// ====================== SIMPAN HASIL EDIT INLINE (BAPRO) ======================
async function saveBaproInline(index) {
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // âœ… tambahkan ambil tombol cancel

  // Saat mulai menyimpan
  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // âœ… sembunyikan tombol cancel saat simpan

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    cso: inputs[1].value.trim(),
    jenisKertas: inputs[2].value.trim(),
    tebalKertas: inputs[3].value.trim(),
    NamaTinta: inputs[4].value.trim(),
    dmax: inputs[5].value.trim(),
    l: inputs[6].value.trim(),
    a: inputs[7].value.trim(),
    b: inputs[8].value.trim(),
    qc: inputs[9].value,
    update: inputs[10].value,
    keterangan: inputs[11].value.trim()
  };

  const orig = baproItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = {
    action: 'update',
    sheet: 'Bapro',
    id: identifier,
    index: orig.__index,
    tanggal: tanggalFormatted,
    ...updated
  };

  try {
    // kirim ke Apps Script
    await postPayload(payload);

    // beri jeda sedikit agar sheet sempat ter-update
    await new Promise(res => setTimeout(res, 5000));

    // refresh data
    await loadBaproItems();
  } catch (err) {
    console.error('Gagal menyimpan data:', err);
    alert('Gagal menyimpan perubahan. Silakan coba lagi.');
  } finally {
    // Kembalikan tombol save ke normal
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== POST PAYLOAD BAPRO ======================
function ensureIframeBapro() {
  if (document.querySelector('iframe[name="hidden_iframe_post_bapro"]')) return;

  const ifr = document.createElement('iframe');
  ifr.name = 'hidden_iframe_post_bapro';
  ifr.style.display = 'none';

  // setelah kirim data, reload data Bapro dari sheet
  ifr.addEventListener('load', () => setTimeout(() => loadBaproItems(), 10000));

  document.body.appendChild(ifr);
}

function postPayloadBapro(payloadObj) {
  ensureIframeBapro();

  const form = document.createElement('form');
  form.method = 'POST';
  form.action = WEBAPP_URL_BAPRO; // âš ï¸ pastikan ganti dengan URL WebApp sheet Bapro
  form.target = 'hidden_iframe_post_bapro';

  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = 'payload';
  input.value = JSON.stringify(payloadObj);

  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  form.remove();
}

// ====================== FILTER BERDASARKAN ISI GRID (BAPRO) ======================
function filterBaproGrid(query){
  const grid = document.getElementById('gridBapro');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM (BAPRO) ======================
function clearBaproForm() {
  [
    'baproNama','baprocso','baproJenis','baproKertas','baproNamaTinta',
    'baproQC','baproUpdate','baproKeterangan'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number fields
  ['baproDmax','baproL','baproA','baproB'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });
}


// ====================== DASHBOARD BAPRO (TO / PROSES / SELESAI) ======================
function renderDashboardBaproCompact() {
  const containerTO = document.getElementById('dashboardBaproTO');
  const containerProses = document.getElementById('dashboardBaproProses');
  const containerSelesai = document.getElementById('dashboardBaproSelesai');

  // jika elemen dashboard tidak ada, jangan error
  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  baproItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>CSO: ${escapeHtml(item.cso || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <strong>Tinta: ${escapeHtml(item.NamaTinta || '')}</strong><br>
      <span>ðŸ“… ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    // âœ… panggil fungsi detail yang benar
    card.addEventListener('click', () => showDetailModalBapro(item));
  });

  // update counters
  const elTotal = document.getElementById('countBapro');
  if (elTotal) elTotal.textContent = baproItems.length;
  const elTO = document.getElementById('countTOBapro');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesBapro');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiBapro');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL BAPRO ======================
function showDetailModalBapro(item) {
  alert(`Detail QC Bapro:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
Nama CSO: ${item.cso || '-'}
Jenis Kertas: ${item.jenisKertas || '-'}
Tebal Kertas: ${item.tebalKertas || '-'}
Nama Tinta: ${item.NamaTinta || '-'}
Dmax: ${item.dmax || '-'}
L: ${item.l || '-'}
A: ${item.a || '-'}
B: ${item.b || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW + FILTER BAPRO ======================
document.addEventListener('DOMContentLoaded', () => {
  // Tombol
  const btnTO = document.getElementById('toggleBaproTO');
  const btnProses = document.getElementById('toggleBaproProses');
  const btnSelesai = document.getElementById('toggleBaproSelesai');

  // Section
  const sectionTO = document.getElementById('sectionBaproTO');
  const sectionProses = document.getElementById('sectionBaproProses');
  const sectionSelesai = document.getElementById('sectionBaproSelesai');

  // Filter input (1 kolom di dalam tiap grid)
  const filterTO = document.getElementById('filterTOBapro');
  const filterProses = document.getElementById('filterProsesBapro');
  const filterSelesai = document.getElementById('filterSelesaiBapro');

  // Grid container
  const gridTO = document.getElementById('dashboardBaproTO');
  const gridProses = document.getElementById('dashboardBaproProses');
  const gridSelesai = document.getElementById('dashboardBaproSelesai');

  // ðŸ” Fungsi filter universal (per grid)
  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card'); // âœ… fix di sini
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? '' : 'none';
    });
  }

  // Event input untuk filter real-time
  [
    {input: filterTO, grid: gridTO},
    {input: filterProses, grid: gridProses},
    {input: filterSelesai, grid: gridSelesai}
  ].forEach(({input, grid}) => {
    if (input) {
      input.addEventListener('input', () => filterCards(grid, input.value));
    }
  });

  // Fungsi supaya filter tetap aktif setelah reload data
  window.applyBaproFilters = function() {
    filterCards(gridTO, filterTO.value);
    filterCards(gridProses, filterProses.value);
    filterCards(gridSelesai, filterSelesai.value);
  };

  // Toggle show/hide tiap section
  function toggleSection(section, btn) {
    const visible = section.style.display !== 'none';
    section.style.display = visible ? 'none' : 'block';
    btn.textContent = visible ? 'Show' : 'Hide';
  }

  if (btnTO) btnTO.addEventListener('click', () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener('click', () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener('click', () => toggleSection(sectionSelesai, btnSelesai));
});

// ====================== AUTO UPPERCASE KHUSUS BAPRO ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;

  // Berlaku untuk input text dan textarea di dalam #qcBapro
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcBapro')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcBapro'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC BAPRO (ubah sesuai kebutuhan) =====
const QC_BAPRO_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcBapro')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC BAPRO:');
      if (input === null) return;
      if (input === QC_BAPRO_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI TAMBAHAN (panggil loader) ======================
loadBaproItems();
</script>

<!-- ====== JS QC PA  ====== -->
<script>
// ====================== GLOBAL STATE (PA) ======================
let paItems = []; // array yang diambil dari sheet Cetak

// ====================== RENDER GRID HASIL (PA) ======================
function renderGridPA(query = "") {
  const container = document.getElementById('gridPA');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  paItems.forEach((item, i) => {
    // Filter pencarian (nama atau noKS)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (sama gaya dengan Bapro/Finishing)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>Sortir: ${escapeHtml(item.sortir || '')}</span><br>
        <span>Problem: ${escapeHtml(item.problem || '')}</span><br>
        <span>Mesin: ${escapeHtml(item.mesin || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callPA(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editPAInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deletePA(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardPACompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (PA) ======================
async function loadPAItems(){
  try{
    // PENTING: pakai WEBAPP_URL (sama seperti Bapro/Finishing)
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Cetak' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      // sisipkan __index & id (baris)
      paItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridPA();
    } else console.warn('loadPAItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadPAItems', err); }
}

// ====================== TAMBAH DATA (PA) ======================
function addPAItem() {
  const nama = document.getElementById('paNama').value.trim();
  const noKS = document.getElementById('paNoKS').value.trim();
  const order = document.getElementById('paOrder') ? document.getElementById('paOrder').value.trim() : '';
  const bagus = document.getElementById('paBagus') ? document.getElementById('paBagus').value.trim() : '';
  const sortir = document.getElementById('paSortir') ? document.getElementById('paSortir').value.trim() : '';
  const problem = document.getElementById('paProblem') ? document.getElementById('paProblem').value.trim() : '';
  const qc = document.getElementById('paQC') ? document.getElementById('paQC').value.trim() : '';
  const mesin = document.getElementById('paMesin') ? document.getElementById('paMesin').value.trim() : '';
  const update = document.getElementById('paUpdate') ? document.getElementById('paUpdate').value.trim() : '';
  const keterangan = document.getElementById('paKeterangan') ? document.getElementById('paKeterangan').value.trim() : '';

    // âœ… Validasi wajib diisi
  if (!nama || !noKS || !qc || !mesin || !update) {
    return alert('Nama Order, No KS, QC, Mesin, dan Proses wajib diisi!');
  }

  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return;

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = {
    action:'add', sheet:'Cetak', tanggal: tanggalFormatted,
    nama, noKS, order, bagus, sortir, problem, qc, mesin, update, keterangan
  };

  // ===== Spinner tombol =====
  const btnTambah = document.querySelector('#inputPA button'); // pastikan tombol ada di #inputPA
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML; // kembalikan tombol
      clearPAForm();
      loadPAItems();
      alert('âœ… Data PA berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearPAForm();
    setTimeout(() => loadPAItems(), 8000);
    alert('âœ… Data PA berhasil ditambahkan!');
  }
}


// ====================== PANGGIL (isi form dari item) ======================
function callPA(index){
  const item = paItems[index];
  if(!item) return;
  if (document.getElementById('paNama')) document.getElementById('paNama').value = item.nama || '';
  if (document.getElementById('paNoKS')) document.getElementById('paNoKS').value = item.noKS || '';
  if (document.getElementById('paOrder')) document.getElementById('paOrder').value = item.order || '';
  if (document.getElementById('paBagus')) document.getElementById('paBagus').value = item.bagus || '';
  if (document.getElementById('paSortir')) document.getElementById('paSortir').value = item.sortir || '';
  if (document.getElementById('paProblem')) document.getElementById('paProblem').value = item.problem || '';
  if (document.getElementById('paQC')) document.getElementById('paQC').value = item.qc || '';
  if (document.getElementById('paMesin')) document.getElementById('paMesin').value = item.mesin || '';
  if (document.getElementById('paUpdate')) document.getElementById('paUpdate').value = item.update || '';
  if (document.getElementById('paKeterangan')) document.getElementById('paKeterangan').value = item.keterangan || '';

  showMenu('qcPA');
  const tabBtn = document.querySelector('#qcPA .tabs button[data-tab="inputPA"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (PA) ======================
function deletePA(index) {
  const item = paItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Cetak', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // ðŸ”¹ Spinner tetap tampil beberapa detik sebelum data hilang
  setTimeout(() => {
    // hapus dari array & DOM supaya tampilan langsung update
    paItems.splice(index, 1);
    if (card) card.remove();

    // reload data dari sheet untuk sinkronisasi
    loadPAItems();
  }, 8000);
}

// ====================== EDIT INLINE (PA) ======================
function editPAInline(index){
  const item = paItems[index];
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama untuk tombol Cancel
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.sortir||'')}" placeholder="Sortir">
      <input type="number" class="edit-inline" value="${escapeHtml(item.problem||'')}" placeholder="Problem">

      <select class="edit-inline">
        <option value="Suci" ${item.qc==='Suci'? 'selected':''}>Suci</option>
        <option value="Anjani" ${item.qc==='Anjani'? 'selected':''}>Anjani</option>
      </select>

      <select class="edit-inline">
        <option value="KM 640" ${item.mesin==='KM 640'? 'selected':''}>KM 640</option>
        <option value="KM 644" ${item.mesin==='KM 644'? 'selected':''}>KM 644</option>
        <option value="KM 620" ${item.mesin==='KM 620'? 'selected':''}>KM 620</option>
        <option value="MT 430" ${item.mesin==='MT 430'? 'selected':''}>MT 430</option>
        <option value="KM 640 GL" ${item.mesin==='KM 640 GL'? 'selected':''}>KM 640 GL</option>
        <option value="RL 140" ${item.mesin==='RL 140'? 'selected':''}>RL 140</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="savePAInline(${index})">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelPAInline(${index})">âœ–ï¸</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (PA) ======================
function cancelPAInline(index){
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if(!card) return;
  delete card.dataset.originalHTML;
  renderGridPA(); // kembalikan tampilan normal grid PA
}

// ====================== SIMPAN HASIL EDIT INLINE (PA) ======================
async function savePAInline(index) {
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // âœ… ambil tombol cancel

  // Saat mulai menyimpan
  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // âœ… sembunyikan tombol cancel saat proses simpan

  const inputs = card.querySelectorAll('.edit-inline');

  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    bagus: inputs[3].value.trim(),
    sortir: inputs[4].value.trim(),
    problem: inputs[5].value.trim(),
    qc: inputs[6].value,
    mesin: inputs[7].value,
    update: inputs[8].value,
    keterangan: inputs[9].value.trim()
  };

  const orig = paItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = {
    action: 'update',
    sheet: 'Cetak',
    id: identifier,
    index: orig.__index,
    tanggal: tanggalFormatted,
    ...updated
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadPAItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Silakan coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== FILTER BERDASARKAN ISI GRID (PA) ======================
function filterPAGrid(query){
  const grid = document.getElementById('gridPA');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM (PA) ======================
function clearPAForm() {
  [
    'paNama','paNoKS','paQC','paMesin','paUpdate','paKeterangan'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number fields
  ['paOrder','paBagus','paSortir','paProblem'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });
}


// ====================== DASHBOARD PA (TO / PROSES / SELESAI) ======================
function renderDashboardPACompact() {
  const containerTO = document.getElementById('dashboardPATO');
  const containerProses = document.getElementById('dashboardPAProses');
  const containerSelesai = document.getElementById('dashboardPASelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  paItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <strong>Mesin: ${escapeHtml(item.mesin || '')}</strong><br>
      <span>ðŸ“… ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    card.addEventListener('click', () => showDetailModalPA(item));
  });

  // update counters
  const elTotal = document.getElementById('countPA');
  if (elTotal) elTotal.textContent = paItems.length;
  const elTO = document.getElementById('countTOPA');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesPA');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiPA');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL PA ======================
function showDetailModalPA(item) {
  alert(`Detail QC PA:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
No KS: ${item.noKS || '-'}
Order: ${item.order || '-'}
Bagus: ${item.bagus || '-'}
Sortir: ${item.sortir || '-'}
Problem: ${item.problem || '-'}
Mesin: ${item.mesin || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW + FILTER QC CETAK ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTO = document.getElementById('togglePATO');
  const btnProses = document.getElementById('togglePAProses');
  const btnSelesai = document.getElementById('togglePASelesai');

  const sectionTO = document.getElementById('sectionPATO');
  const sectionProses = document.getElementById('sectionPAProses');
  const sectionSelesai = document.getElementById('sectionPASelesai');

  const filterTO = document.getElementById('filterPATO');
  const filterProses = document.getElementById('filterPAProses');
  const filterSelesai = document.getElementById('filterPASelesai');

  const gridTO = document.getElementById('dashboardPATO');
  const gridProses = document.getElementById('dashboardPAProses');
  const gridSelesai = document.getElementById('dashboardPASelesai');

  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card');
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? '' : 'none';
    });
  }

  [{input:filterTO,grid:gridTO},{input:filterProses,grid:gridProses},{input:filterSelesai,grid:gridSelesai}]
  .forEach(({input,grid})=>{
    if(input){
      input.addEventListener('input',()=>filterCards(grid,input.value));
    }
  });

  window.applyCetakFilters = function(){
    filterCards(gridTO,filterTO.value);
    filterCards(gridProses,filterProses.value);
    filterCards(gridSelesai,filterSelesai.value);
  };

  function toggleSection(section,btn){
    const visible = section.style.display!=='none';
    section.style.display=visible?'none':'block';
    btn.textContent=visible?'Show':'Hide';
  }

  if(btnTO)btnTO.addEventListener('click',()=>toggleSection(sectionTO,btnTO));
  if(btnProses)btnProses.addEventListener('click',()=>toggleSection(sectionProses,btnProses));
  if(btnSelesai)btnSelesai.addEventListener('click',()=>toggleSection(sectionSelesai,btnSelesai));
});

// ====================== AUTO UPPERCASE KHUSUS PA ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcPA')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcPA'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC PA (ubah sesuai kebutuhan) =====
const QC_PA_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcPA')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC CETAK:');
      if (input === null) return;
      if (input === QC_PA_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadPAItems();
</script>

<!-- ====== JS QC LEM (paste this after script utama, format disesuaikan dg QC Finishing) -->
<script>
// ====================== GLOBAL STATE (LEM) ======================
let lemItems = []; // array yang diambil dari sheet Lem

// ====================== RENDER GRID HASIL (LEM) ======================
function renderGridLem(query = "") {
  const container = document.getElementById('gridLem');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  lemItems.forEach((item, i) => {
    // Filter pencarian (nama atau noKS)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (sama seperti referensi)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Isi/Dus: ${escapeHtml(item.isi || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>BS: ${escapeHtml(item.jenisBS || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callLem(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editLemInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteLem(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardLemCompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (LEM) ======================
async function loadLemItems(){
  try{
    // gunakan WEBAPP_URL (sama seperti Finishing) dan sheet 'Lem'
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Lem' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      lemItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridLem();
    } else console.warn('loadLemItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadLemItems', err); }
}

// ====================== TAMBAH DATA (LEM) ======================
function addLemItem() {
  const nama = document.getElementById('lemNama').value.trim();
  const noKS = document.getElementById('lemNoKS').value.trim();
  const order = document.getElementById('lemOrder') ? document.getElementById('lemOrder').value.trim() : '';
  const isi = document.getElementById('lemIsi') ? document.getElementById('lemIsi').value.trim() : '';
  const bagus = document.getElementById('lemBagus') ? document.getElementById('lemBagus').value.trim() : '';
  const jenisBS = document.getElementById('lemJenisBS') ? document.getElementById('lemJenisBS').value.trim() : '';
  const qc = document.getElementById('lemQC') ? document.getElementById('lemQC').value.trim() : '';
  const update = document.getElementById('lemUpdate') ? document.getElementById('lemUpdate').value.trim() : '';
  const keterangan = document.getElementById('lemKeterangan') ? document.getElementById('lemKeterangan').value.trim() : '';

    // âœ… Validasi wajib diisi
  if (!nama || !noKS || !qc || !update) {
    return alert('Nama Order, No KS, QC, dan Proses wajib diisi!');
  }

  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return;

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = {
    action:'add', sheet:'Lem', tanggal: tanggalFormatted,
    nama, noKS, order, isi, bagus, jenisBS, qc, update, keterangan
  };

  // ===== Spinner tombol =====
  const btnTambah = document.querySelector('#inputLem button'); // pastikan tombol ada di #inputLem
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML; // kembalikan tombol
      clearLemForm();
      loadLemItems();
      alert('âœ… Data Lem berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearLemForm();
    setTimeout(() => loadLemItems(), 8000);
    alert('âœ… Data Lem berhasil ditambahkan!');
  }
}


// ====================== PANGGIL (isi form dari item) ======================
function callLem(index){
  const item = lemItems[index];
  if(!item) return;
  if (document.getElementById('lemNama')) document.getElementById('lemNama').value = item.nama || '';
  if (document.getElementById('lemNoKS')) document.getElementById('lemNoKS').value = item.noKS || '';
  if (document.getElementById('lemOrder')) document.getElementById('lemOrder').value = item.order || '';
  if (document.getElementById('lemIsi')) document.getElementById('lemIsi').value = item.isi || '';
  if (document.getElementById('lemBagus')) document.getElementById('lemBagus').value = item.bagus || '';
  if (document.getElementById('lemJenisBS')) document.getElementById('lemJenisBS').value = item.jenisBS || '';
  if (document.getElementById('lemQC')) document.getElementById('lemQC').value = item.qc || '';
  if (document.getElementById('lemUpdate')) document.getElementById('lemUpdate').value = item.update || '';
  if (document.getElementById('lemKeterangan')) document.getElementById('lemKeterangan').value = item.keterangan || '';

  showMenu('qcLem');
  const tabBtn = document.querySelector('#qcLem .tabs button[data-tab="inputLem"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (LEM) ======================
function deleteLem(index) {
  const item = lemItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = {
    action: 'delete',
    sheet: 'Lem',
    id: identifier,
    index: item.__index
  };

  postPayload(payload);

  // ðŸ”¹ Delay pendek agar sheet sempat proses, lalu update UI
  setTimeout(() => {
    // Hapus item dari array & DOM agar langsung hilang dari grid
    lemItems.splice(index, 1);
    if (card) card.remove();

    // Muat ulang data agar sinkron dengan Google Sheet
    loadLemItems();
  }, 8000);
}

// ====================== EDIT INLINE (LEM) ======================
function editLemInline(index){
  const item = lemItems[index];
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // simpan HTML lama untuk tombol cancel
  const oldHtml = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.isi||'')}" placeholder="Isi/Dus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.jenisBS||'')}" placeholder="BS">

      <select class="edit-inline">
        <option value="Martini" ${item.qc==='Martini'? 'selected':''}>Martini</option>
        <option value="Krestin" ${item.qc==='Krestin'? 'selected':''}>Krestin</option>
        <option value="Ismie" ${item.qc==='Ismie'? 'selected':''}>Ismie</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveLemInline(${index}, this)">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelLemInline(${index}, \`${encodeURIComponent(oldHtml)}\`)">âŒ</button>
    </div>`;
}

// ====================== BATAL EDIT INLINE (LEM) ======================
function cancelLemInline(index, oldHtmlEncoded) {
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if (!card) return;
  card.innerHTML = decodeURIComponent(oldHtmlEncoded);
}

// ====================== SIMPAN HASIL EDIT INLINE (LEM) ======================
async function saveLemInline(index, btn) {
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // sembunyikan cancel saat menyimpan

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    jenisBS: inputs[5].value.trim(),
    qc: inputs[6].value,
    update: inputs[7].value,
    keterangan: inputs[8].value.trim()
  };

  const orig = lemItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Lem', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadLemItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== FILTER BERDASARKAN ISI GRID ======================
function filterLemGrid(query){
  const grid = document.getElementById('gridLem');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM (LEM) ======================
function clearLemForm() {
  [
    'lemNama','lemNoKS','lemQC','lemUpdate','lemKeterangan'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number fields
  ['lemOrder','lemIsi','lemBagus','lemJenisBS'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });
}


// ====================== DASHBOARD LEM (TO / PROSES / SELESAI) ======================
function renderDashboardLemCompact() {
  const containerTO = document.getElementById('dashboardLemTO');
  const containerProses = document.getElementById('dashboardLemProses');
  const containerSelesai = document.getElementById('dashboardLemSelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  lemItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <span>ðŸ“… ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    card.addEventListener('click', () => showDetailModalLem(item));
  });

  // update counters
  const elTotal = document.getElementById('countLem');
  if (elTotal) elTotal.textContent = lemItems.length;
  const elTO = document.getElementById('countTOLem');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesLem');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiLem');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL LEM ======================
function showDetailModalLem(item) {
  alert(`Detail QC Lem:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
No KS: ${item.noKS || '-'}
Order: ${item.order || '-'}
Isi/Dus: ${item.isi || '-'}
Bagus: ${item.bagus || '-'}
BS: ${item.jenisBS || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW + FILTER QC LEM ======================
document.addEventListener('DOMContentLoaded', () => {
  // Tombol
  const btnTO = document.getElementById('toggleLemTO');
  const btnProses = document.getElementById('toggleLemProses');
  const btnSelesai = document.getElementById('toggleLemSelesai');

  // Section
  const sectionTO = document.getElementById('sectionLemTO');
  const sectionProses = document.getElementById('sectionLemProses');
  const sectionSelesai = document.getElementById('sectionLemSelesai');

  // Filter input
  const filterTO = document.getElementById('filterTOLem');
  const filterProses = document.getElementById('filterProsesLem');
  const filterSelesai = document.getElementById('filterSelesaiLem');

  // Grid container
  const gridTO = document.getElementById('dashboardLemTO');
  const gridProses = document.getElementById('dashboardLemProses');
  const gridSelesai = document.getElementById('dashboardLemSelesai');

  // ðŸ” Fungsi filter universal (per grid)
  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card');
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? '' : 'none';
    });
  }

  // Event input untuk filter real-time
  [
    {input: filterTO, grid: gridTO},
    {input: filterProses, grid: gridProses},
    {input: filterSelesai, grid: gridSelesai}
  ].forEach(({input, grid}) => {
    if (input) {
      input.addEventListener('input', () => filterCards(grid, input.value));
    }
  });

  // Fungsi supaya filter tetap aktif setelah reload data
  window.applyLemFilters = function() {
    filterCards(gridTO, filterTO.value);
    filterCards(gridProses, filterProses.value);
    filterCards(gridSelesai, filterSelesai.value);
  };

  // Toggle show/hide tiap section
  function toggleSection(section, btn) {
    const visible = section.style.display !== 'none';
    section.style.display = visible ? 'none' : 'block';
    btn.textContent = visible ? 'Show' : 'Hide';
  }

  if (btnTO) btnTO.addEventListener('click', () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener('click', () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener('click', () => toggleSection(sectionSelesai, btnSelesai));
});

// ====================== AUTO UPPERCASE KHUSUS LEM ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcLem')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcLem'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC Lem (ubah sesuai kebutuhan) =====
const QC_LEM_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcLem')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC LEM:');
      if (input === null) return;
      if (input === QC_LEM_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadLemItems();
</script>




<script>
/* ====================== TAB QC Register ====================== */
function showSPVTab(tab, btn) {
  document.getElementById('spvInputSection').style.display = (tab === 'input') ? 'block' : 'none';
  document.getElementById('spvHasilSection').style.display = (tab === 'hasil') ? 'block' : 'none';

  document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');

  if (tab === 'input') {
    setupUppercaseInputs();
    updateSPVDateTime();
    if (window._spvTimer) clearInterval(window._spvTimer);
    window._spvTimer = setInterval(updateSPVDateTime, 1000);

    document.getElementById('spvTanggal').setAttribute('readonly', true);
    document.getElementById('spvJam').setAttribute('readonly', true);
  } else {
    if (window._spvTimer) clearInterval(window._spvTimer);
    loadSPV();
  }
}

/* ====================== UPDATE WAKTU REAL-TIME ====================== */
function updateSPVDateTime() {
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth() + 1).padStart(2, '0');
  const dd = String(now.getDate()).padStart(2, '0');
  const hh = String(now.getHours()).padStart(2, '0');
  const min = String(now.getMinutes()).padStart(2, '0');
  const ss = String(now.getSeconds()).padStart(2, '0');

  document.getElementById('spvTanggal').value = `${yyyy}-${mm}-${dd}`;
  document.getElementById('spvJam').value = `${hh}:${min}:${ss}`;
}

/* ====================== UPPERCASE INPUT ====================== */
function setupUppercaseInputs() {
  const inputs = document.querySelectorAll('#spvForm input[type="text"], #spvForm textarea');
  inputs.forEach(el => {
    el.removeEventListener('input', el._uppercaseListener);
    const listener = () => el.value = el.value.toUpperCase();
    el.addEventListener('input', listener);
    el._uppercaseListener = listener;
  });
}

/* ====================== FILE TO BASE64 ====================== */
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* ====================== SUBMIT FORM ====================== */
async function submitSPV(e) {
  e.preventDefault();
  const spinner = document.getElementById("spvSpinner");

  const payload = {
    sheet: "Register",
    action: "add",
    tanggal: document.getElementById('spvTanggal').value,
    jam: document.getElementById('spvJam').value,
    namaOrder: document.getElementById('spvOrder').value.trim().toUpperCase(),
    noKS: document.getElementById('spvNoKS').value.trim().toUpperCase(),
    ket: document.getElementById('spvKet').value.trim().toUpperCase(),
    ket1: document.getElementById('spvKet1').value.trim().toUpperCase(),
    namaQC: document.getElementById('spvNama').value,
    proses: document.getElementById('spvProses').value,
    foto: document.getElementById('spvFoto').files[0] ? await fileToBase64(document.getElementById('spvFoto').files[0]) : "",
    foto1: document.getElementById('spvFoto1').files[0] ? await fileToBase64(document.getElementById('spvFoto1').files[0]) : ""
  };

  if (!payload.namaOrder || !payload.noKS || !payload.tanggal || !payload.jam || !payload.namaQC || !payload.proses) {
    alert('âš ï¸ Harap lengkapi semua field termasuk Proses.');
    return;
  }

  if (!confirm('Kirim data ini?')) return;

  document.getElementById('spvForm').reset();
  spinner.style.display = "flex";

  fetch(WEBAPP_URL, {
    method: "POST",
    body: new URLSearchParams({ payload: JSON.stringify(payload) })
  })
  .then(res => res.text())
  .then(() => {
    spinner.style.display = "none";
    alert("âœ… Data SPV berhasil dikirim!");
    loadSPV();
  })
  .catch(err => {
    spinner.style.display = "none";
    alert("âŒ Gagal mengirim data SPV!");
    console.error(err);
  });
}

/* ====================== LOAD DATA HASIL + EDIT ====================== */
function loadSPV() {
  const tbody = document.querySelector('#spvTable tbody');
  if (!tbody) return;

  // ===== Spinner sama seperti Meeting =====
  let spinner = document.getElementById("spvLoadingSpinner");
  if (!spinner) {
    spinner = document.createElement("div");
    spinner.id = "spvLoadingSpinner";
    spinner.style.display = "none";
    spinner.innerHTML = `
      <div style="text-align:center; padding:10px;">
        <div class="spinner"></div>
        <p style="font-size:0.9rem; color:#555; margin-top:6px;">Memuat Data QC</p>
      </div>
    `;
    tbody.parentElement.insertAdjacentElement("beforebegin", spinner);
  }

  spinner.style.display = "block";

  fetch(WEBAPP_URL + '?action=get&sheet=Register')
    .then(res => res.text())
    .then(text => {
      let data;
      try { data = JSON.parse(text); }
      catch { const match = text.match(/\((.*)\)/); if (match) data = JSON.parse(match[1]); }
      if (!data) { console.warn("Format data SPV tidak dikenali:", text); spinner.style.display = "none"; return; }

      const list = data.data || data || [];
      tbody.innerHTML = "";

      list.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.dataset.index = index;
        tr.innerHTML = `
          <td>${formatTanggal(item.tanggal || item.Tanggal)}</td>
          <td>${item.namaOrder || item['Nama Order'] || ''}</td>
          <td>${item.noKS || item['No KS'] || ''}</td>
          <td>${formatJam(item.jam || item.Jam)}</td>
          <td>${item.ket || item['Keterangan Acuan'] || ''}</td>
          <td>${item.fotoUrl ? `<a href="${item.fotoUrl}" target="_blank">ðŸ“· Lihat Foto</a>` : '-'}</td>
          <td>${item.ket1 || item['Keterangan Temuan'] || ''}</td>
          <td>${item.fotoUrl1 ? `<a href="${item.fotoUrl1}" target="_blank">ðŸ“· Lihat Foto</a>` : '-'}</td>
          <td>${item.namaQC || item['Nama QC'] || ''}</td>
          <td>${item.proses || item['Proses'] || ''}</td>
          <td class="action-cell"><button class="edit-btn">âœï¸ Edit</button></td>
        `;
        tbody.appendChild(tr);
      });

      enableSPVEdit();
    })
    .catch(err => console.error("Gagal memuat data SPV:", err))
    .finally(() => spinner.style.display = "none");
}


/* ====================== ENABLE EDIT ====================== */
function enableSPVEdit() {
  document.querySelectorAll("#spvTable tbody tr").forEach((row, rowIndex) => {
    const editBtn = row.querySelector(".edit-btn");
    if (!editBtn) return;

    editBtn.onclick = () => {
      if (!confirm("Apakah Anda ingin mengedit data ini?")) return;

      row._original = [...row.children].map(td => td.innerHTML);

      for (let i = 0; i < 10; i++) {
        const cell = row.cells[i];
        const value = cell.textContent.trim();

        // ===== Foto Acuan & Foto Temuan =====
        if (i === 5 || i === 7) {
          const wrapper = document.createElement("div");
          wrapper.style.display = "flex";
          wrapper.style.flexDirection = "column";
          wrapper.style.alignItems = "center";

          const label = document.createElement("label");
          label.textContent = "ðŸ“ Pilih File";
          label.style.display = "inline-block";
          label.style.background = "#00bcd4";
          label.style.color = "#fff";
          label.style.padding = "6px 10px";
          label.style.borderRadius = "6px";
          label.style.cursor = "pointer";
          label.style.fontSize = "13px";
          label.style.textAlign = "center";
          label.style.width = "fit-content";

          const fileInput = document.createElement("input");
          fileInput.type = "file";
          fileInput.accept = "image/*";
          fileInput.style.display = "none";

          const fileName = document.createElement("div");
          fileName.style.fontSize = "12px";
          fileName.style.color = "#555";
          fileName.style.marginTop = "6px";
          fileName.style.wordBreak = "break-word";
          fileName.style.textAlign = "center";

          fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            fileName.textContent = file ? file.name : "";
          });

          label.onclick = () => fileInput.click();

          wrapper.appendChild(label);
          wrapper.appendChild(fileInput);
          wrapper.appendChild(fileName);

          cell.innerHTML = "";
          cell.appendChild(wrapper);
        } 
        // ===== Keterangan =====
        else if (i === 4 || i === 6) {
          const textarea = document.createElement("textarea");
          textarea.value = value;
          textarea.rows = 2;
          textarea.style.width = "100%";
          cell.innerHTML = "";
          cell.appendChild(textarea);
        } 
        // ===== Nama QC (Dropdown) =====
        else if (i === 8) {
          const select = document.createElement("select");
          select.style.width = "100%";
          select.style.padding = "6px";
          select.style.borderRadius = "6px";
          select.style.border = "1px solid #ccc";
          select.style.fontSize = "13px";

          const options = ["NANI","ANJANI","SUCI","ANOM","IRNA","MARWAN","KIKI","MARTINI","KRESTIN","ISMIE"];
          options.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            if (opt === value) option.selected = true;
            select.appendChild(option);
          });

          cell.innerHTML = "";
          cell.appendChild(select);
        }
        // ===== Proses (Dropdown) =====
        else if (i === 9) {
          const select = document.createElement("select");
          select.style.width = "100%";
          select.style.padding = "6px";
          select.style.borderRadius = "6px";
          select.style.border = "1px solid #ccc";
          select.style.fontSize = "13px";

          const options = ["QC BAPRO","QC CETAK","QC FINISHING","QC LEM","RETUR"];
          options.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            if (opt === value) option.selected = true;
            select.appendChild(option);
          });

          cell.innerHTML = "";
          cell.appendChild(select);
        }
        // ===== Input teks biasa =====
        else {
          const input = document.createElement("input");
          input.type = "text";
          input.value = value;
          input.style.width = "100%";

          // Tanggal dan Jam readonly
          if (i === 0 || i === 3) input.setAttribute('readonly', true);

          cell.innerHTML = "";
          cell.appendChild(input);
        }
      }

      // ===== Tombol aksi =====
      const aksiCell = row.cells[10];
      aksiCell.innerHTML = `
        <button class="save-btn">ðŸ’¾ Simpan</button>
        <button class="cancel-btn">âŒ Batal</button>
      `;

      const spinner = document.createElement("span");
      spinner.innerHTML = " â³ Menyimpan...";
      spinner.style.display = "none";
      aksiCell.appendChild(spinner);

      // ===== Simpan perubahan =====
      aksiCell.querySelector(".save-btn").onclick = async () => {
        if (!confirm("Apakah yakin ingin menyimpan perubahan ini?")) return;

        spinner.style.display = "inline";
        const updated = {
          tanggal: row.cells[0].querySelector("input")?.value || row.cells[0].textContent,
          namaOrder: row.cells[1].querySelector("input")?.value || row.cells[1].textContent,
          noKS: row.cells[2].querySelector("input")?.value || row.cells[2].textContent,
          jam: row.cells[3].querySelector("input")?.value || row.cells[3].textContent,
          ket: row.cells[4].querySelector("textarea")?.value || row.cells[4].textContent,
          ket1: row.cells[6].querySelector("textarea")?.value || row.cells[6].textContent,
          namaQC: row.cells[8].querySelector("select")?.value || row.cells[8].textContent,
          proses: row.cells[9].querySelector("select")?.value || row.cells[9].textContent,
          foto: row.cells[5].querySelector("input")?.files[0] ? await fileToBase64(row.cells[5].querySelector("input").files[0]) : null,
          foto1: row.cells[7].querySelector("input")?.files[0] ? await fileToBase64(row.cells[7].querySelector("input").files[0]) : null
        };

        fetch(WEBAPP_URL, {
          method: "POST",
          body: new URLSearchParams({
            payload: JSON.stringify({ sheet: "Register", action: "update", index: rowIndex, data: updated })
          })
        })
        .then(res => res.text())
        .then(() => {
          alert("âœ… Data berhasil diperbarui!");
          row._original.forEach((html, i) => (row.cells[i].innerHTML = html));
          enableSPVEdit();
          loadSPV();
        })
        .catch(err => {
          console.error(err);
          alert("âŒ Gagal memperbarui data!");
        })
        .finally(() => spinner.style.display = "none");
      };

      // ===== Batal edit =====
      aksiCell.querySelector(".cancel-btn").onclick = () => {
        if (!confirm("Batalkan edit? Semua perubahan akan hilang!")) return;
        row._original.forEach((html, i) => (row.cells[i].innerHTML = html));
        enableSPVEdit();
      };
    };
  });
}



/* ====================== FORMAT ====================== */
function formatTanggal(tgl) { if (!tgl) return ""; const parts = tgl.split("-"); return parts.length === 3 ? `${parts[2]}-${parts[1]}-${parts[0]}` : tgl; }
function formatJam(jam) { if (!jam) return ""; return jam.length >= 5 ? jam.slice(0, 5) : jam; }

/* ====================== PASSWORD ====================== */
const QC_SPV_PASSWORD = 'spv123';
document.addEventListener('DOMContentLoaded', () => {
  setupUppercaseInputs();
  const menuBtn = document.querySelector(`nav button[onclick="showMenu('qcSPV')"]`);
  if (menuBtn) {
    const originalOnClick = menuBtn.getAttribute('onclick');
    menuBtn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC REGISTER:');
      if (input === null) return;
      if (input === QC_SPV_PASSWORD) eval(originalOnClick);
      else alert('Password salah!');
    };
  }
  const inputSection = document.getElementById('spvInputSection');
  if (inputSection && inputSection.style.display !== 'none') {
    updateSPVDateTime();
    window._spvTimer = setInterval(updateSPVDateTime, 1000);
    document.getElementById('spvTanggal').setAttribute('readonly', true);
    document.getElementById('spvJam').setAttribute('readonly', true);
  }
});

/* ====================== FILTER / SEARCH DATA ====================== */
document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('spvSearch');
  if (!searchInput) return;
  searchInput.addEventListener('keyup', () => {
    const filter = searchInput.value.toUpperCase();
    document.querySelectorAll('#spvTable tbody tr').forEach(row => {
      const tanggal = (row.cells[0]?.textContent || '').toUpperCase();
      const namaOrder = (row.cells[1]?.textContent || '').toUpperCase();
      const noKS = (row.cells[2]?.textContent || '').toUpperCase();
      const namaQC = (row.cells[8]?.textContent || '').toUpperCase();
      const proses = (row.cells[9]?.textContent || '').toUpperCase();
      const match = tanggal.includes(filter) || namaOrder.includes(filter) || noKS.includes(filter) || namaQC.includes(filter) || proses.includes(filter);
      row.style.display = match ? '' : 'none';
    });
  });
});

// ====================== SCROLL OTOMATIS QC REGISTER ======================
document.addEventListener('DOMContentLoaded', () => {
  const tbody = document.querySelector('#spvTable tbody');
  if (!tbody) return;

  // Observer untuk scroll otomatis saat baris pertama muncul
  const observer = new MutationObserver(() => {
    const rows = tbody.querySelectorAll('tr');
    if (rows.length) {
      rows[rows.length - 1].scrollIntoView({ behavior: 'smooth', block: 'end' });
    }
  });

  observer.observe(tbody, { childList: true });
});

// ===== Patch rapi otomatis tinggi row saat edit inline =====
function adjustSPVRowHeight(row) {
  const tds = Array.from(row.cells).slice(0, 10); // hanya kolom data
  let maxHeight = 0;

  // Hitung tinggi maksimal
  tds.forEach(td => {
    td.style.height = 'auto'; // reset dulu
    const el = td.querySelector('input, textarea, div');
    if (el) {
      const h = el.scrollHeight;
      if (h > maxHeight) maxHeight = h;
    }
  });

  // Terapkan tinggi ke semua td
  tds.forEach(td => td.style.height = maxHeight + 'px');
}


</script>




<script>
// ====================== QC MEETING ======================

// ===== PASSWORD =====
const QC_MEETING_PASSWORD = 'spv123'; // ganti sesuai kebutuhan

// ===== FORMAT TANGGAL & JAM =====
function formatTanggal(tgl){
  if(!tgl) return "";
  const d = new Date(tgl);
  if(isNaN(d)) return tgl;
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${dd}-${mm}-${yyyy}`;
}
function formatJam(jam){
  if(!jam) return "";
  const d = new Date(jam);
  if(isNaN(d)) return jam;
  const hh = String(d.getHours()).padStart(2,"0");
  const min = String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${min}`;
}

// ===== FILE TO BASE64 =====
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    if(!file) return resolve("");
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ===== UPPERCASE INPUT =====
function setupMeetingUppercase(){
  const inputs = document.querySelectorAll('#meetingForm input[type="text"], #meetingForm textarea');
  inputs.forEach(el=>{
    el.removeEventListener('input', el._uppercaseListener);
    const listener = ()=> el.value = el.value.toUpperCase();
    el.addEventListener('input', listener);
    el._uppercaseListener = listener;
  });
}

// ===== TANGGAL & JAM OTOMATIS =====
function setMeetingDateTime(){
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,'0');
  const dd = String(now.getDate()).padStart(2,'0');
  const hh = String(now.getHours()).padStart(2,'0');
  const min = String(now.getMinutes()).padStart(2,'0');

  const tglInput = document.getElementById('meetingTanggal');
  const jamInput = document.getElementById('meetingJam');
  if(tglInput) tglInput.value = `${yyyy}-${mm}-${dd}`;
  if(jamInput) jamInput.value = `${hh}:${min}`;
  if(tglInput) tglInput.setAttribute('readonly',true);
  if(jamInput) jamInput.setAttribute('readonly',true);
}

// ===== TAB QC MEETING =====
function showMeetingTab(tab, btn){
  document.getElementById('meetingInputSection').style.display = (tab==='input')?'block':'none';
  document.getElementById('meetingHasilSection').style.display = (tab==='hasil')?'block':'none';

  document.querySelectorAll('#qcMeeting .tabs button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');

  if(tab==='input'){
    setupMeetingUppercase();
    setMeetingDateTime();
    if(window._meetingTimer) clearInterval(window._meetingTimer);
    window._meetingTimer = setInterval(setMeetingDateTime,1000);
  }else{
    if(window._meetingTimer) clearInterval(window._meetingTimer);
    loadMeeting();
  }
}

// ===== SUBMIT FORM =====
async function submitMeeting(e){
  e.preventDefault();
  const spinner = document.getElementById("meetingSpinner");

  const pesertaChecked = Array.from(document.querySelectorAll('#meetingForm input[type="checkbox"]:checked')).map(cb=>cb.value);

  const payload = {
    sheet:"Meeting",
    action:"add",
    tanggal: document.getElementById('meetingTanggal').value || '',
    jam: document.getElementById('meetingJam').value || '',
    namaMeeting: (document.getElementById('meetingNama').value || '').trim().toUpperCase(),
    ket: (document.getElementById('meetingKet').value || '').trim().toUpperCase(),
    akar: (document.getElementById('meetingAkar').value || '').trim().toUpperCase(),
    tindakan: (document.getElementById('meetingTindakan').value || '').trim().toUpperCase(),
    catatan: (document.getElementById('meetingCatatan').value || '').trim().toUpperCase(),
    peserta: pesertaChecked.join(", "),
    foto: await fileToBase64(document.getElementById('meetingFoto').files[0])
  };

  if(!payload.namaMeeting || !payload.tanggal || !payload.jam || pesertaChecked.length===0){
    alert('âš ï¸ Harap lengkapi semua field termasuk Peserta.');
    return;
  }

  if(!confirm('Kirim data Meeting ini?')) return;

  document.getElementById('meetingForm').reset();
  spinner.style.display="flex";

  try{
    await fetch(WEBAPP_URL,{
      method:"POST",
      body: new URLSearchParams({payload:JSON.stringify(payload)})
    });
    alert("âœ… Data Meeting berhasil dikirim!");
    loadMeeting();
  }catch(err){
    console.error(err);
    alert("âŒ Gagal mengirim data Meeting!");
  }finally{
    spinner.style.display="none";
  }
}

// ===== LOAD DATA HASIL =====
async function loadMeeting(){
  const tbody = document.querySelector('#meetingTable tbody');
  if(!tbody) return;
  const spinner = document.getElementById("meetingLoading");
  if(spinner) spinner.style.display="block";

  try{
    const res = await fetch(`${WEBAPP_URL}?action=get&sheet=Meeting`);
    let text = await res.text();
    let data;
    try{ data = JSON.parse(text); } 
    catch{ const match = text.match(/\((.*)\)/); if(match) data = JSON.parse(match[1]); }
    if(!data) return;

    const list = data.data || data || [];
    tbody.innerHTML="";

    list.forEach((item,index)=>{
      const tr = document.createElement('tr');
      tr.dataset.index = index;

      tr.innerHTML = `
        <td>${formatTanggal(item.tanggal)}</td>
        <td>${item.namaMeeting || ''}</td>
        <td>${formatJam(item.jam)}</td>
        <td>${item.ket || ''}</td>
        <td>${item.fotoUrl?`<a href="${item.fotoUrl}" target="_blank">ðŸ“· Lihat Foto</a>`:'-'}</td>
        <td>${item.akar || ''}</td>
        <td>${item.tindakan || ''}</td>
        <td>${item.catatan || ''}</td>
        <td>${item.peserta || ''}</td>
        <td class="action-cell">
          <button class="edit-btn">âœï¸ Edit</button>
          <button class="share-btn">ðŸ“¤ Share WA</button>
        </td>
      `;
      tbody.appendChild(tr);

// ===== Tombol Share WA =====
const shareBtn = tr.querySelector(".share-btn");
shareBtn.onclick = ()=>{
  let textWA = "";
  const br = "\n\n";  // spasi antar kolom

  textWA += `ðŸ“… Tanggal:\n${formatTanggal(item.tanggal)}${br}`;
  textWA += `â° Jam:\n${formatJam(item.jam)}${br}`;
  textWA += `ðŸ“Œ Nama Meeting:\n${item.namaMeeting || '-'}${br}`;
  textWA += `ðŸ“ Keterangan Foto:\n${item.ket || '-'}${br}`;
  textWA += `ðŸ” Akar Masalah:\n${item.akar || '-'}${br}`;
  textWA += `ðŸ›  Tindakan:\n${item.tindakan || '-'}${br}`;
  textWA += `ðŸ“š Catatan:\n${item.catatan || '-'}${br}`;
  textWA += `ðŸ‘¥ Peserta:\n${item.peserta || '-'}${br}`;

  if(item.fotoUrl){
    textWA += `ðŸ“· Foto:\n${item.fotoUrl}${br}`;
  }

  const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  const url = isMobile 
    ? `https://wa.me/?text=${encodeURIComponent(textWA)}`
    : `https://web.whatsapp.com/send?text=${encodeURIComponent(textWA)}`;

  window.open(url, "_blank");
    };
    });

    enableMeetingEdit();
  }catch(err){ console.error(err); }
  finally{ if(spinner) spinner.style.display="none"; }
}

// ===== ENABLE EDIT =====
function enableMeetingEdit(){
  document.querySelectorAll("#meetingTable tbody tr").forEach((row,rowIndex)=>{
    const editBtn = row.querySelector(".edit-btn");
    if(!editBtn) return;

    editBtn.onclick = ()=>{
      if(!confirm("Apakah Anda ingin mengedit data ini?")) return;
      row._original = [...row.children].map(td=>td.innerHTML);

      const fieldIndices = { tanggal:0, namaMeeting:1, jam:2, ket:3, foto:4, akar:5, tindakan:6, catatan:7, peserta:8 };

      for(const key in fieldIndices){
        const idx = fieldIndices[key];
        const cell = row.cells[idx];
        const value = cell.textContent.trim();

        if(key==='peserta'){
          const wrapper = document.createElement("div");
          wrapper.style.display="flex"; wrapper.style.flexWrap="wrap"; wrapper.style.gap="6px";
          const pesertaList = ["NANI","ANJANI","SUCI","ANOM","IRNA","MARWAN","KIKI","MARTINI","KRESTIN","ISMIE"];
          pesertaList.forEach(name=>{
            const label = document.createElement("label");
            label.style.fontSize="12px"; label.style.cursor="pointer";
            const cb = document.createElement("input");
            cb.type="checkbox"; cb.value=name;
            if(value.includes(name)) cb.checked = true;
            label.appendChild(cb); label.appendChild(document.createTextNode(" "+name));
            wrapper.appendChild(label);
          });
          cell.innerHTML=""; cell.appendChild(wrapper);

        }else if(key==='foto'){
          const wrapper = document.createElement("div");
          wrapper.style.display="flex"; wrapper.style.flexDirection="column"; wrapper.style.alignItems="center";
          const label = document.createElement("label"); 
          label.textContent="ðŸ“ Pilih File"; 
          label.style.cursor="pointer"; label.style.background="#00BCD4"; label.style.color="#fff"; 
          label.style.padding="6px 10px"; label.style.borderRadius="6px"; label.style.fontSize="13px";
          const fileInput = document.createElement("input"); fileInput.type="file"; fileInput.accept="image/*"; fileInput.style.display="none";
          const fileName = document.createElement("div"); fileName.style.fontSize="12px"; fileName.style.color="#555"; fileName.style.marginTop="6px";
          fileInput.addEventListener("change",e=>{ fileName.textContent = e.target.files[0]?.name || ""; });
          label.onclick = ()=>fileInput.click();
          wrapper.appendChild(label); wrapper.appendChild(fileInput); wrapper.appendChild(fileName);
          cell.innerHTML=""; cell.appendChild(wrapper);

        }else if(key==='tanggal' || key==='jam'){
          const input = document.createElement("input");
          input.type = "text"; 
          input.value = value;
          input.setAttribute('readonly',true);
          cell.innerHTML=""; cell.appendChild(input);

        }else if(key==='namaMeeting'){
          const input = document.createElement("input");
          input.type="text"; input.value=value.toUpperCase(); input.style.width="100%";
          cell.innerHTML=""; cell.appendChild(input);

        }else{
          const textarea = document.createElement("textarea");
          textarea.value=value; textarea.rows=2; textarea.style.width="100%";
          cell.innerHTML=""; cell.appendChild(textarea);
        }
      }

      const aksiCell = row.cells[9];
      aksiCell.innerHTML=`<button class="save-btn">ðŸ’¾ Simpan</button> <button class="cancel-btn">âŒ Batal</button>`;
      const spinner = document.createElement("span"); spinner.style.display="none"; spinner.textContent=" â³ Menyimpan..."; aksiCell.appendChild(spinner);

      aksiCell.querySelector(".save-btn").onclick=async()=>{
        if(!confirm("Apakah yakin ingin menyimpan perubahan ini?")) return;
        spinner.style.display="inline";

        const pesertaChecked = Array.from(row.cells[8].querySelectorAll("input[type='checkbox']:checked")).map(cb=>cb.value);

        const updated={
          tanggal: row.cells[0].querySelector("input")?.value,
          namaMeeting: row.cells[1].querySelector("input")?.value.toUpperCase(),
          jam: row.cells[2].querySelector("input")?.value,
          ket: row.cells[3].querySelector("textarea")?.value || "",
          akar: row.cells[5].querySelector("textarea")?.value || "",
          tindakan: row.cells[6].querySelector("textarea")?.value || "",
          catatan: row.cells[7].querySelector("textarea")?.value || "",
          peserta: pesertaChecked.join(", "),
          foto: await fileToBase64(row.cells[4].querySelector("input")?.files[0])
        };

        try{
          await fetch(WEBAPP_URL,{
            method:"POST",
            body:new URLSearchParams({payload:JSON.stringify({sheet:"Meeting",action:"update",index:rowIndex,data:updated})})
          });
          alert("âœ… Data berhasil diperbarui!");
          row._original.forEach((html,i)=>row.cells[i].innerHTML=html);
          enableMeetingEdit();
          loadMeeting();
        }catch(err){ console.error(err); alert("âŒ Gagal memperbarui data!"); }
        finally{ spinner.style.display="none"; }
      };

      aksiCell.querySelector(".cancel-btn").onclick=()=>{ 
        if(!confirm("Batalkan edit? Semua perubahan akan hilang!")) return;
        row._original.forEach((html,i)=>row.cells[i].innerHTML=html);
        enableMeetingEdit();
      };
    };
  });
}

// ===== PASSWORD OTOMATIS TAB =====
document.addEventListener('DOMContentLoaded',()=>{
  const menuBtn = document.querySelector(`nav button[onclick="showMenu('qcMeeting')"]`);
  if(menuBtn){
    const originalOnClick = menuBtn.getAttribute('onclick');
    menuBtn.onclick=function(e){
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC MEETING:');
      if(input===null) return;
      if(input===QC_MEETING_PASSWORD) eval(originalOnClick);
      else alert('Password salah!');
    };
  }
  setMeetingDateTime();
  setupMeetingUppercase();
});


</script>


<script>
// ====================== UNIVERSAL AUTO-DEFAULT 0 (FINAL STABLE VERSION) ======================
(function(){
  'use strict';

  // === daftar semua id input number ===
  const UNIVERSAL_NUMBER_IDS = [
    'finishingOrder','finishingIsi','finishingBagus','finishingJenisBS',
    'baproDmax','baproL','baproA','baproB',
    'paOrder','paBagus','paSortir','paProblem',
    'lemOrder','lemIsi','lemBagus','lemJenisBS'
  ];

  // Helper universal: selalu pastikan value valid
  function forceZeroIfEmpty(input){
    if (!input) return;
    if (input.tagName !== 'INPUT' || input.type !== 'number') return;
    if (input.value === '' || input.value === null) {
      input.value = 0;
    }
  }

  // Attach behavior BUT tetap bebas hapus
  function attachNumberZeroBehavior(input){
    if (!input || input._attachedAutoZero) return;
    input._attachedAutoZero = true;

    if (input.tagName !== 'INPUT' || input.type !== 'number') return;

    // default awal
    forceZeroIfEmpty(input);

    // saat blur â†’ kosong jadi 0
    input.addEventListener('blur', () => {
      forceZeroIfEmpty(input);
    });

    // saat change â†’ kosong jadi 0
    input.addEventListener('change', () => {
      forceZeroIfEmpty(input);
    });
  }

  // Terapkan ke ID yang dikenal
  function applyByIDs(){
    UNIVERSAL_NUMBER_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) attachNumberZeroBehavior(el);
    });
  }

  // Terapkan ke seluruh input number
  function applyToAllNumberInputs(){
    document.querySelectorAll('input[type="number"]').forEach(inp => {
      attachNumberZeroBehavior(inp);
    });
  }

  // Observer
  const observer = new MutationObserver(mList => {
    mList.forEach(m => {
      m.addedNodes.forEach(node => {
        if (!node || node.nodeType !== 1) return;

        if (node.matches && node.matches('input[type="number"]')){
          attachNumberZeroBehavior(node);
        }

        node.querySelectorAll && node.querySelectorAll('input[type="number"]').forEach(el => {
          attachNumberZeroBehavior(el);
        });
      });
    });
  });

  function startObserver(){
    observer.observe(document.body, { childList:true, subtree:true });
  }

  // === FIX PALING PENTING ===
  // Digunakan oleh kode submit kamu kapanpun (AMAKAN)
  window.getSafeNumberValue = function(id){
    const el = document.getElementById(id);
    if (!el) return 0;
    if (el.value === '' || el.value === null) return 0;
    return Number(el.value) || 0;
  };

  // Patch fungsi clear (tanpa mengganggu)
  function patchClearFunction(funcName){
    const ori = window[funcName];
    if (typeof ori !== 'function') return;
    if (ori._patchedAutoZero) return;

    const wrap = function(...args){
      const r = ori.apply(this, args);
      setTimeout(() => {
        applyByIDs();
        applyToAllNumberInputs();
      }, 20);
      return r;
    };

    wrap._patchedAutoZero = true;
    window[funcName] = wrap;
  }

  function patchAllClearFunctions(){
    ['clearFinishingForm','clearBaproForm','clearPAForm','clearLemForm']
      .forEach(patchClearFunction);
  }

  // Init
  function init(){
    applyByIDs();
    applyToAllNumberInputs();
    startObserver();
    patchAllClearFunctions();
  }

  // Run
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>



<script>
/* ====================== HOME QC ====================== */
function goHome() {
  // Hanya scroll halaman ke atas, tidak ubah menu aktif
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}
</script>


</body>
</html>








