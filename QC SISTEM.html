<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QC System</title>

<style>
/* ======================== Variabel Warna & Radius ======================== */
:root {
  --bg: #f4f7fb;
  --card: #ffffff;
  --accent: #0ea5a4;
  --accent-2: #0369a1;
  --muted: #6b7280;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #facc15;
  --radius: 12px;
}

/* ======================== Reset & Body ======================== */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: #111;
  min-height: 100vh;
  width: 100%;
  overflow-x: hidden;
  padding-bottom: 64px; /* beri ruang agar tidak tertutup footer */
}

/* ======================== Header ======================== */
header {
  background: var(--accent);
  color: #fff;
  padding: 1rem 1.5rem;
  font-size: 1.4rem;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0, 0, 0, .1);
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

#headerTitle {
  font-size: 1.2rem;
  font-weight: bold;
  text-transform: uppercase;
  text-align: center;
}

#headerTime {
  font-size: 0.7rem;
  font-weight: normal;
  text-align: right;
  margin-top: 2px;
  line-height: 1.2;
}
#headerTime .tanggal,
#headerTime .jam { display: block; }

/* ======================== Main & Card ======================== */
main {
  flex: 1;
  padding: 1.5rem;
  display: grid;
  gap: 1rem;
}

.card {
  background: var(--card);
  padding: 1.2rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 8px rgba(0, 0, 0, .06);
}

/* ======================== Tabs ======================== */
.tabs {
  display: flex;
  gap: .5rem;
  margin-bottom: .75rem;
  flex-wrap: wrap;
}
.tabs button {
  flex: 1;
  padding: .6rem;
  border: none;
  border-radius: var(--radius);
  background: #e5e7eb;
  cursor: pointer;
  font-weight: 500;
  transition: .2s;
}
.tabs button.active {
  background: var(--accent);
  color: #fff;
}

.tab-content { display: none; }
.tab-content.active { display: block; }

/* ======================== Form Input ======================== */
input[type=text],
input[type=number],
select {
  padding: .5rem .7rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-bottom: 6px;
  width: 100%;
  transition: border .2s, box-shadow .2s;
}

/* ======================== GRID DASBOARD ======================== */
.grid-container {
  display: grid;
  gap: 14px;
  padding: 4px;
  width: 100%;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* default desktop */
}

/* ---------------- RESPONSIF ---------------- */
/* HP â‰¤768px: 2 kolom */
@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

/* Tablet 769â€“1023px: 3 kolom */
@media (min-width: 769px) and (max-width: 1023px) {
  .grid-container {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Desktop â‰¥1024px: fleksibel sesuai minmax */
@media (min-width: 1024px) {
  .grid-container {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
}


/* ======================== CARD GLOBAL ======================== */
/* Card kaca ultra-transparan seperti speech panel */
.grid-container > div,
.grid-card {
  background: rgba(0, 207, 255, 0.15);    /* semi-transparent biru acuan */
  border-radius: 22px;                     /* lebih bulat seperti bubble */
  padding: 14px 20px;                      /* mirip padding speech panel */
  
  /* Border ringan & semi-transparent */
  border: 1px solid rgba(0, 207, 255, 0.4);

  /* efek glass/acrylic lembut */
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);

  color: #002933;
  box-shadow: 0 8px 20px rgba(0, 0, 0, .25);
  transition: all 0.35s ease;
  position: relative;
}

/* Efek highlight kaca */
.grid-card::before,
.grid-container > div::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 40%;
  border-radius: 22px 22px 0 0;
  background: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.25),
    rgba(255, 255, 255, 0)
  );
  pointer-events: none;
}

/* Efek Hover (Glow Cyan + Gelap) */
.grid-container > div:hover,
.grid-card:hover {
  transform: translateY(-2px);
  background: rgba(0, 207, 255, 0.25);   /* sedikit lebih terlihat */
  box-shadow:
    0 10px 22px rgba(0, 0, 0, .28),      /* glow gelap */
    0 0 18px rgba(0, 207, 255, .35);     /* glow cyan lembut */
}

/* Input kaca */
.grid-card input {
  padding: .55rem .75rem;
  border: 1px solid rgba(0, 0, 0, 0.45); /* outline hitam */
  background: rgba(0, 207, 255, 0.12);   /* semi-transparent biru acuan */
  border-radius: 10px;
  width: 100%;
  font-size: 14px;
  color: #003344;
  backdrop-filter: blur(6px);
  transition: 0.2s ease;
}

/* Fokus efek glow cyan + hitam */
.grid-card input:focus {
  background: rgba(0, 207, 255, 0.20);   /* semi-transparent lebih terang */
  border-color: rgba(0, 0, 0, 0.7);
  box-shadow: 
    0 0 0 2px rgba(0, 207, 255, 0.4),
    0 0 8px rgba(0, 207, 255, 0.35);
  outline: none;
}



/* ========================== CARD STYLE ========================== */
.grid-card {
  background: #ffffff;
  border-radius: 12px;
  padding: 14px 16px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  border-left: 6px solid #4b9cff;
  transition: transform .2s ease, box-shadow .2s ease;
  font-size: 14px;
  line-height: 1.35;
}

.grid-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 14px rgba(0,0,0,0.22);
}

/* ========================== TEXT ========================== */
.grid-card span,
.grid-card strong {
  display: block;
  margin-bottom: 2px;
}

/* ===========================
   GLOBAL STYLE KETERANGAN 1â€“5
   Berlaku untuk Bapro, Cetak, Finishing, Lem, PA, dll
   =========================== */

.ket-list {
  display: flex;
  flex-direction: column;
  gap: 4px;           /* Jarak antar baris nomor */
  margin-top: 4px;
}

.ket-list div {
  padding: 3px 6px;   /* Ruang dalam per baris */
  border-radius: 4px;
  background: #f8f8f8;      /* Warna latar lembut */
  border-left: 3px solid #00bcd4;  /* Garis kiri kecil sebagai indikator */
  font-size: 0.9rem;
  line-height: 1.3rem;
  min-height: 20px;   /* Agar baris yg kosong tetap rapi */
  display: flex;
  align-items: center;
}

/* ========================== STATUS COLOR CENTER ========================== */
.status-proses {
  background: #ffe08a;
  color: #886300;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: bold;
  display: inline-block;
  margin: 6px auto 0 auto; /* auto kiri & kanan â†’ center */
  text-align: center;
}

.status-selesai {
  background: #b7ffbf;
  color: #005b1a;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: bold;
  display: inline-block;
  margin: 6px auto 0 auto; /* center */
  text-align: center;
}

.status-pending {
  background: #ffb6b6;
  color: #850000;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: bold;
  display: inline-block;
  margin: 6px auto 0 auto; /* center */
  text-align: center;
}


/* ========================== BUTTON AREA ========================== */
.btn-icon {
  cursor: pointer;
  border: none;
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 16px;
  transition: 0.2s;
  display: block;       /* center tombol */
  margin: 6px auto;     /* center horizontal */
}

.btn-call {
  background: #4aa3ff;
  color: white;
}

.btn-edit {
  background: #ffc93c;
  color: #4a3700;
}

.btn-delete {
  background: #ff4d4d;
  color: white;
}

.btn-icon:hover {
  opacity: 0.75;
  transform: scale(1.08);
}

/* ========================== TOMBOL SIMPAN ========================== */
.btn-save {
  background: #28c76f;      /* hijau */
  color: #ffffff;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
  transition: 0.2s ease;
  display: block;       /* center tombol */
  margin: 6px auto;     /* center horizontal */
}

.btn-save:hover {
  background: #22ad61;
  transform: scale(1.06);
}

/* ========================== TOMBOL BATAL ========================== */
.btn-cancel {
  background: #ff4d4d;      /* merah */
  color: #ffffff;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
  transition: 0.2s ease;
  display: block;       /* center tombol */
  margin: 6px auto;     /* center horizontal */
}

.btn-cancel:hover {
  background: #d63c3c;
  transform: scale(1.06);
}




/* ======================= DETAIL GLOBAL ======================= */
.modal-fin {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(2px);
  justify-content: center;
  align-items: center;
  z-index: 999999;
}

.modal-fin-content {
  width: 92%;
  max-width: 420px;
  background: #fff;
  border-radius: 14px;
  padding: 0;
  overflow: hidden;
  animation: modalPop 0.25s ease;
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
}

@keyframes modalPop {
  from { transform: scale(0.8); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

.modal-fin-header {
  background: #3677FF;
  color: white;
  padding: 12px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-fin-title {
  font-size: 17px;
  font-weight: bold;
}

.modal-fin-close {
  background: transparent;
  color: white;
  border: none;
  font-size: 22px;
  cursor: pointer;
}

.modal-fin-body {
  padding: 16px 20px;
  font-size: 15px;
  line-height: 1.42;
}

.modal-fin-body strong {
  color: #0A3D62;
}

.modal-fin-footer {
  padding: 12px 18px;
  text-align: right;
  background: #f5f5f5;
}

.modal-fin-btn {
  background: #3677FF;
  padding: 8px 16px;
  border-radius: 8px;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

/* ======================== Edit Inline ======================== */
.edit-grid {
  display: flex;
  flex-direction: column;   /* 1 kolom semua */
  gap: 10px;
  width: 100%;
}

/* Input & Select full width */
.edit-grid input,
.edit-grid select {
  width: 100%;
  padding: 8px;
  border: 1px solid #bbb;
  border-radius: 6px;
  font-size: 15px;
}

/* Textarea lebih besar */
.edit-grid textarea {
  width: 100%;
  min-height: 110px;        /* dibuat jauh lebih besar */
  border: 1px solid #bbb;
  border-radius: 6px;
  padding: 10px;
  font-family: inherit;
  resize: vertical;
}

/* Extra: Jarak antar label biar rapi */
.edit-grid label {
  font-weight: 600;
  margin-bottom: 3px;
}



/* ======================== Status ======================== */
.status-pending {
  background: #fee2e2;
  color: #b91c1c;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
}
.status-proses {
  background: var(--warning);
  color: #111;
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: 600;
}
.status-selesai {
  background: var(--success);
  color: #fff;
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: 600;
}

.form-group { margin-bottom: 10px; }



  
</style>

</head>
<body>



<!-- ======================== Header ======================== -->
<header style="
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 24px;
  background: linear-gradient(90deg, #0078D7, #1A86D1);
  color: white;
  font-family: 'Inter', sans-serif;
  font-weight: 500;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.28);
  position: fixed; /* diubah dari sticky ke fixed */
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  border-bottom: 1px solid rgba(255,255,255,0.18);
">
  <div style="display: flex; align-items: center; gap: 12px;">

    <!-- ================= BUTTON QC ================= -->
    <button class="btnQC" onclick="goHome()">
      QC
    </button>

    <div id="headerTitle" style="font-size: 0.9rem; color: #e0f7fa;">
      System
    </div>
  </div>

  <div id="headerTime" style="text-align:right; font-size:0.8rem; color:#e0f7fa;">
    <div class="tanggal">Selasa, 5 Oktober 2025</div>
    <div class="jam">14:30</div>
  </div>
</header>

<!-- ======================== Footer Nav ======================== -->
<nav class="footer-nav">
  <div class="nav-inner">
    <button onclick="showMenu('dashboard')" class="nav-btn active">DASHBOARD</button>
    <button onclick="showMenu('reportSection')" class="nav-btn">REPORT</button>
    <button onclick="showMenu('qcBapro')" class="nav-btn">QC BAPRO</button>
    <button onclick="showMenu('qcPA')" class="nav-btn">QC CETAK</button>
    <button onclick="showMenu('qcLem')" class="nav-btn">QC LEM</button>
    <button onclick="showMenu('qcFinishing')" class="nav-btn">QC FINISHING</button>
    <button onclick="showMenu('qcSPV')" class="nav-btn">QC REGISTER</button>
    <button onclick="showMenu('qcMeeting')" class="nav-btn">MEETING</button>
    <button onclick="showMenu('manualSection')" class="nav-btn">MANUAL</button>
  </div>
</nav>

<style>
/* ======================== Body Padding untuk Header & Footer ======================== */
body {
  padding-top: 64px;   /* tinggi header */
  padding-bottom: 64px; /* tinggi footer */
  margin: 0;
}

/* ---------------- BACKGROUND QC ---------------- */
.btnQC {
  position: relative;
  background: linear-gradient(120deg, #ffffff, #f4fbff, #d6f3ff, #ffffff);
  background-size: 230% 230%;
  animation: qcBgMove 5.5s ease-in-out infinite;

  color: #0078D7;
  font-weight: 800;
  font-size: 1.25rem;
  padding: 8px 18px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  letter-spacing: 0.5px;

  transition: transform 0.25s ease;
  overflow: visible;
}

.btnQC:hover {
  transform: scale(1.06);
}

.btnQC::before,
.btnQC::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 14px;
  border: 2.6px solid rgba(0, 0, 0, 0.42);
  animation: pulseExpand 2.8s cubic-bezier(.25,.8,.35,1) infinite;
  z-index: -1;
}

.btnQC::after {
  animation-delay: 1.4s;
}

@keyframes pulseExpand {
  0% { transform: scale(1); opacity: 0.9; }
  60% { transform: scale(1.30); opacity: 0.12; }
  100% { transform: scale(1.45); opacity: 0; }
}

@keyframes qcBgMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ======================== Footer Nav Wrapper ======================== */
.footer-nav {
  position: fixed;
  bottom: env(safe-area-inset-bottom, 0); /* aman untuk iPhone notch */
  left: 0;
  width: 100%;
  background: linear-gradient(to right, #0078D7, #1A86D1);
  height: 64px;
  z-index: 999;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 10px;
  overflow: hidden;
}

/* ======================== Kontainer tombol ======================== */
.nav-inner {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: center;
  overflow-x: auto;
  white-space: nowrap;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  width: 100%;
  scrollbar-width: none;          
  -ms-overflow-style: none;       
}
.nav-inner::-webkit-scrollbar { display: none; }

/* ======================== Tombol Putih HD Modern ======================== */
.nav-btn {
  flex-shrink: 0;
  color: #0f172a;
  font-weight: 600;
  font-size: 15px;
  padding: 10px 20px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.7);
  background: #ffffff;
  text-shadow: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.3);
  transition: all 0.25s ease;
  cursor: pointer;
}
.nav-btn:hover {
  background: #f5f9ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.4);
}
.nav-btn.active {
  color: #fff;
  background: linear-gradient(145deg, #22c55e, #16a34a);
  border-color: rgba(34,197,94,0.6);
  box-shadow: 0 0 15px rgba(34,197,94,0.6), 0 0 30px rgba(34,197,94,0.4);
}
.nav-btn:active {
  transform: scale(0.97);
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}

/* ======================== Responsif ======================== */
@media (max-width: 768px) {
  .nav-inner { justify-content: flex-start; }
  .nav-btn { font-size: 14px; padding: 9px 16px; }
}
@media (min-width: 1024px) {
  .nav-inner { justify-content: center; }
  .nav-btn { font-size: 15px; padding: 11px 22px; }
}
</style>


<!-- ======================== Main Section ======================== -->
<main>


<!-- ======================== Dashboard ======================== -->
<section id="dashboard" class="card qc-section">

<!-- ======================== QC BAPRO ======================== -->  
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #D32F2F, #F44336); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC BAPRO
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,82,82,0.25); /* merah transparan */
      border: 2px solid rgba(255,82,82,0.6); /* outline merah */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countBapro">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,82,82,0.25); /* merah transparan */
      border: 2px solid rgba(255,82,82,0.6); /* outline merah */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Pending<br><strong id="countTOBapro">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,82,82,0.25); /* merah transparan */
      border: 2px solid rgba(255,82,82,0.6); /* outline merah */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesBapro">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,82,82,0.25); /* merah transparan */
      border: 2px solid rgba(255,82,82,0.6); /* outline merah */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiBapro">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF5252, #FF1744); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Pending
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproTO" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproTO" style="display:none;">
  <input id="filterTOBapro" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL -->
  <div class="grid-wrapper">
    <div id="dashboardBaproTO" class="grid-container"></div>
  </div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF6F61, #FF3B30); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproProses" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproProses" style="display:none;">
  <input id="filterProsesBapro" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL -->
  <div class="grid-wrapper">
    <div id="dashboardBaproProses" class="grid-container"></div>
  </div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FF7F7F, #FF4444); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleBaproSelesai" class="toggle-btn">Show</button>
</div>

<div id="sectionBaproSelesai" style="display:none;">
  <input id="filterSelesaiBapro" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL -->
  <div class="grid-wrapper">
    <div id="dashboardBaproSelesai" class="grid-container"></div>
  </div>
</div>

<!-- Modal Detail -->
<div id="detailBaproModal" class="modal-fin">
  <div class="modal-fin-content">
    <div class="modal-fin-header">
      <span class="modal-fin-title">Detail QC Bapro</span>
      <button class="modal-fin-close" onclick="closeDetailModalBapro()">Ã—</button>
    </div>
    <div class="modal-fin-body" id="detailBaproBody"></div>
    <div class="modal-fin-footer">
      <button class="modal-fin-btn" onclick="closeDetailModalBapro()">Tutup</button>
    </div>
  </div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;

  /* agar tidak ikut scroll */
  position: sticky;
  top: 0;
  z-index: 10;
  background: #fff;
}

/* Scroll wrapper */
.grid-wrapper {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* ========== Tombol Show/Hide Abu-abu Elegan ========== */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd);
  color: #000;
  border: 1px solid #000;
  border-radius: 4px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #cfcfcf);
  transform: translateY(-2px);
}
</style>



<!-- ======================== QC CETAK ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #FF9800, #FFB74D); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC CETAK
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,152,0,0.25); /* oranye transparan */
      border: 2px solid rgba(255,152,0,0.6); /* outline oranye */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countPA">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,152,0,0.25); /* oranye transparan */
      border: 2px solid rgba(255,152,0,0.6); /* outline oranye */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Pending<br><strong id="countTOPA">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,152,0,0.25); /* oranye transparan */
      border: 2px solid rgba(255,152,0,0.6); /* outline oranye */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesPA">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(255,152,0,0.25); /* oranye transparan */
      border: 2px solid rgba(255,152,0,0.6); /* outline oranye */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiPA">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFB74D, #FF9800); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Pending
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePATO" class="toggle-btn">Show</button>
</div>

<div id="sectionPATO" style="display:none;">
  <input id="filterPATO" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardPATO" class="grid-container"></div>
  </div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFB266, #FF9933); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePAProses" class="toggle-btn">Show</button>
</div>

<div id="sectionPAProses" style="display:none;">
  <input id="filterPAProses" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardPAProses" class="grid-container"></div>
  </div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #FFD090, #FFB266); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="togglePASelesai" class="toggle-btn">Show</button>
</div>

<div id="sectionPASelesai" style="display:none;">
  <input id="filterPASelesai" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardPASelesai" class="grid-container"></div>
  </div>
</div>

<!-- Modal Detail -->
<div id="detailCetakModal" class="modal-fin">
  <div class="modal-fin-content">
    <div class="modal-fin-header">
      <span class="modal-fin-title">Detail QC Cetak</span>
      <button class="modal-fin-close" onclick="closeDetailModalCetak()">Ã—</button>
    </div>
    <div class="modal-fin-body" id="detailCetakBody"></div>
    <div class="modal-fin-footer">
      <button class="modal-fin-btn" onclick="closeDetailModalCetak()">Tutup</button>
    </div>
  </div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;

  /* Sticky biar tidak ikut scroll */
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 10;
}

/* Scroll wrapper */
.grid-wrapper {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* Tombol Show/Hide */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd);
  color: #000;
  border: 1px solid #000;
  border-radius: 4px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #cfcfcf);
  transform: translateY(-2px);
}
</style>







<!-- ======================== QC LEM ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #9C27B0, #BA68C8); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC LEM
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: rgba(156,39,176,0.25); /* ungu transparan */
      border: 2px solid rgba(156,39,176,0.6); /* outline ungu */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countLem">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(156,39,176,0.25); /* ungu transparan */
      border: 2px solid rgba(156,39,176,0.6); /* outline ungu */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Pending<br><strong id="countTOLem">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(156,39,176,0.25); /* ungu transparan */
      border: 2px solid rgba(156,39,176,0.6); /* outline ungu */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesLem">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(156,39,176,0.25); /* ungu transparan */
      border: 2px solid rgba(156,39,176,0.6); /* outline ungu */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiLem">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #C084FC, #9C27B0); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Pending
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemTO" class="toggle-btn">Show</button>
</div>

<div id="sectionLemTO" style="display:none;">
  <input id="filterTOLem" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardLemTO" class="grid-container"></div>
  </div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #D8B4FE, #9C27B0); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemProses" class="toggle-btn">Show</button>
</div>

<div id="sectionLemProses" style="display:none;">
  <input id="filterProsesLem" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardLemProses" class="grid-container"></div>
  </div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #E9D5FF, #BA68C8); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleLemSelesai" class="toggle-btn">Show</button>
</div>

<div id="sectionLemSelesai" style="display:none;">
  <input id="filterSelesaiLem" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <div class="grid-wrapper">
    <div id="dashboardLemSelesai" class="grid-container"></div>
  </div>
</div>

<!-- Modal Detail -->
<div id="detailLemModal" class="modal-fin">
  <div class="modal-fin-content">
    <div class="modal-fin-header">
      <span class="modal-fin-title">Detail QC Lem</span>
      <button class="modal-fin-close" onclick="closeDetailModalLem()">Ã—</button>
    </div>
    <div class="modal-fin-body" id="detailLemBody"></div>
    <div class="modal-fin-footer">
      <button class="modal-fin-btn" onclick="closeDetailModalLem()">Tutup</button>
    </div>
  </div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;

  /* sticky - tidak ikut scroll */
  position: sticky;
  top: 0;
  z-index: 10;
  background: #fff;
}

.grid-wrapper {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd) !important;
  color: #000 !important;
  border: 1px solid #000 !important;
  border-radius: 4px !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25) !important;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s !important;
}
.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #d6d6d6) !important;
  transform: translateY(-2px);
}
</style>






<!-- ======================== QC FINISHING ======================== -->
<h2 style="
  text-align:center; 
  color:#000; 
  background: linear-gradient(to right, #22C55E, #4ADE80); 
  font-size:1.2rem; 
  padding:6px 12px; 
  border-radius:8px; 
  margin-bottom:12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  position: relative;
  overflow: hidden;
">
  QC FINISHING
  <span style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
    border-radius: 8px 8px 0 0;
    pointer-events: none;
  "></span>
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="
      flex:1; min-width:120px; 
      background: rgba(34,197,94,0.25); /* hijau transparan */
      border: 2px solid rgba(34,197,94,0.6); /* outline hijau */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Order<br><strong id="countFinishing">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(34,197,94,0.25); /* hijau transparan */
      border: 2px solid rgba(34,197,94,0.6); /* outline hijau */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Pending<br><strong id="countTOFinishing">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(34,197,94,0.25); /* hijau transparan */
      border: 2px solid rgba(34,197,94,0.6); /* outline hijau */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Proses<br><strong id="countProsesFinishing">0</strong>
  </div>

  <div style="
      flex:1; min-width:120px; 
      background: rgba(34,197,94,0.25); /* hijau transparan */
      border: 2px solid rgba(34,197,94,0.6); /* outline hijau */
      padding:6px 10px; border-radius:8px; 
      text-align:center; color:#000; font-weight:500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
  " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
    Total Selesai<br><strong id="countSelesaiFinishing">0</strong>
  </div>
</div>

<!-- ========== TO ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #4ADE80, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Pending
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingTO" class="toggle-btn">Show</button>
</div>

<div id="sectionFinishingTO" style="display:none;">
  <input id="filterFinishingTO" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL (ditambahkan) -->
  <div class="grid-wrapper">
    <div id="dashboardFinishingTO" class="grid-container"></div>
  </div>
</div>

<!-- ========== PROSES ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #38D39F, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Proses
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingProses" class="toggle-btn">Show</button>
</div>

<div id="sectionFinishingProses" style="display:none;">
  <input id="filterFinishingProses" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL -->
  <div class="grid-wrapper">
    <div id="dashboardFinishingProses" class="grid-container"></div>
  </div>
</div>

<!-- ========== SELESAI ========== -->
<div style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:12px;">
  <h4 style="
    margin:0; 
    color:#000; 
    background: linear-gradient(to right, #6EE7B7, #22C55E); 
    padding:4px 10px; border-radius:6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  ">
    Selesai
    <span style="
      position: absolute;
      top: 0; left: 0; width: 100%; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius:6px 6px 0 0;
      pointer-events: none;
    "></span>
  </h4>
  <button id="toggleFinishingSelesai" class="toggle-btn">Show</button>
</div>

<div id="sectionFinishingSelesai" style="display:none;">
  <input id="filterFinishingSelesai" type="text" placeholder="ðŸ” Pencarian" class="filter-input">

  <!-- WRAPPER SCROLL -->
  <div class="grid-wrapper">
    <div id="dashboardFinishingSelesai" class="grid-container"></div>
  </div>
</div>

<!-- ======================= MODAL DETAIL FINISHING ======================= -->
<div id="detailFinishingModal" class="modal-fin">
  <div class="modal-fin-content">
    <div class="modal-fin-header">
      <span class="modal-fin-title">Detail QC Finishing</span>
      <button class="modal-fin-close" onclick="closeDetailModal()">Ã—</button>
    </div>

    <div class="modal-fin-body" id="detailFinishingBody">
      <!-- data diisi otomatis -->
    </div>

    <div class="modal-fin-footer">
      <button class="modal-fin-btn" onclick="closeDetailModal()">Tutup</button>
    </div>
  </div>
</div>

<style>
.filter-input {
  width: 100%;
  max-width: 280px;
  margin: 6px auto 10px;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  display: block;

  /* sticky - tidak ikut scroll */
  position: sticky;
  top: 0;
  z-index: 10;
  background: #fff;
}

/* Scroll area */
.grid-wrapper {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

.grid-container {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.card {
  background: #fff;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  color: #000;
}

/* Tombol Show/Hide */
.toggle-btn {
  padding: 2px 6px;
  font-size: 0.8rem;
  height: 32px;
  background: linear-gradient(to bottom, #f0f0f0, #bdbdbd) !important;
  color: #000 !important;
  border: 1px solid #000 !important;
  border-radius: 4px !important;
  box-shadow: 0 3px 6px rgba(0,0,0,0.25) !important;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s !important;
}

.toggle-btn:hover {
  background: linear-gradient(to bottom, #ffffff, #d6d6d6) !important;
  transform: translateY(-2px);
}
</style>



</section>







<!-- ======================== QC BAPRO ======================== -->
<section id="qcBapro" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#fff; 
    background: linear-gradient(to right, #D32F2F, #F44336); 
    font-size:1.2rem;
    padding:6px 12px;
    border-radius:8px;
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
    border: 1px solid #000;">
    MENU QC BAPRO
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn bapro active" data-tab="inputBapro" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn bapro" data-tab="hasilBapro" onclick="switchTab(this)">Hasil</button>
  </div>

  <!-- Inputan -->
  <div id="inputBapro" class="tab-content active">
    <div class="form-group">
      <label>Nama Order</label>
      <input type="text" id="baproNama" placeholder="ETK GIV WHITE PEPAYA 72 GR">
    </div>

    <div class="form-group">
      <label>CSO</label>
      <select id="baprocso">
        <option value="">Pilih CSO</option>
        <option value="Yati">Yati</option>
        <option value="Retni">Retni</option>
        <option value="Aulia">Aulia</option>
        <option value="Yuli">Yuli</option>
      </select>
    </div>

    <div class="form-group">
      <label>Jenis Kertas</label>
      <input type="text" id="baproJenis" placeholder="Duplex">
    </div>

    <div class="form-group">
      <label>Tebal Kertas (gsm)</label>
      <input type="number" id="baproKertas" placeholder="0">
    </div>

    <div class="form-group">
      <label>Nama Tinta</label>
      <input type="text" id="baproNamaTinta" placeholder="SP RED">
    </div>

    <div class="form-group">
      <label>Dmax</label>
      <input type="number" id="baproDmax" placeholder="0">
    </div>

    <div class="form-group">
      <label>L</label>
      <input type="number" id="baproL" placeholder="0">
    </div>

    <div class="form-group">
      <label>A</label>
      <input type="number" id="baproA" placeholder="0">
    </div>

    <div class="form-group">
      <label>B</label>
      <input type="number" id="baproB" placeholder="0">
    </div>

    <div class="form-group">
      <label>QC</label>
      <select id="baproQC">
        <option value="">Pilih QC</option>
        <option value="Marwan">Marwan</option>
        <option value="Kiki">Kiki</option>
      </select>
    </div>

    <div class="form-group">
      <label>Update</label>
      <select id="baproUpdate">
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
        <option value="Pending">Pending</option>
      </select>
    </div>

    <div class="form-group">
      <label>Resep Tinta</label>
      <div class="rowKet"><span>1.</span><input type="text" id="ket1" placeholder="Resep 1"></div>
      <div class="rowKet"><span>2.</span><input type="text" id="ket2" placeholder="Resep 2"></div>
      <div class="rowKet"><span>3.</span><input type="text" id="ket3" placeholder="Resep 3"></div>
      <div class="rowKet"><span>4.</span><input type="text" id="ket4" placeholder="Resep 4"></div>
      <div class="rowKet"><span>5.</span><input type="text" id="ket5" placeholder="Resep 5"></div>
    </div>

    <div class="form-group">
      <button type="button" class="bapro-add-btn" onclick="addBaproItem()">âž• Tambah</button>
    </div>
  </div>

  <!-- Hasil -->
  <div id="hasilBapro" class="tab-content">
    <input type="text" placeholder="ðŸ” Pencarian" oninput="renderGridBapro(this.value)" class="baproFilter">
    <div class="baproGridScroll">
      <div id="gridBapro" class="grid-container"></div>
    </div>
  </div>

</section>



<style>
/* ======================== TAB BAPRO ======================== */
.tab-btn.bapro {
  flex:1; padding:6px 0; border-radius:6px; font-weight:600; cursor:pointer;
  border:1px solid #000; background:#e0e0e0 !important; color:#000 !important;
  transition:all 0.2s; text-align:center;
}
.tab-btn.bapro.active {
  background: linear-gradient(to right,#D32F2F,#F44336) !important; color:#fff !important;
  border:1px solid #000 !important;
}
.tab-btn.bapro:not(.active):hover {
  background:#F0625D !important; color:#fff !important;
  transform: translateY(-1px); box-shadow:0 2px 6px rgba(211,47,47,0.3);
}
.tab-btn.bapro:focus { outline:none; box-shadow:none; }

/* Inputan Form */
#inputBapro .form-group input,
#inputBapro .form-group select,
#inputBapro .form-group textarea {
  width:100%; padding:0.6rem; border:1px solid #ccc; border-radius:8px;
  font-size:0.95rem; box-sizing:border-box;
}
.bapro-add-btn {
  width:100%; padding:0.6rem; background:linear-gradient(135deg,#D32F2F,#F44336);
  color:#fff; font-weight:600; border:1px solid #000; border-radius:8px;
  cursor:pointer; font-size:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:all 0.25s;
}
.bapro-add-btn:hover {
  background:linear-gradient(135deg,#F44336,#D32F2F);
  transform: translateY(-2px); box-shadow:0 6px 12px rgba(244,67,54,0.4);
}

/* Container Tab */
#qcBapro { display:flex; flex-direction:column; max-height:none; }
#qcBapro .tabs { position:sticky; top:0; z-index:50; background:#fff; padding:6px 0; }
#inputBapro, #hasilBapro { overflow-y:auto; max-height:none; padding-right:4px; }

/* Row Keterangan */
.rowKet { display:flex; gap:6px; align-items:center; margin-bottom:6px; }
.rowKet input { flex:1; padding:4px 8px; }
.rowKet span { width:20px; text-align:right; font-weight:bold; }

/* Filter sticky */
#hasilBapro .baproFilter {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding: 6px;
  margin-bottom: 6px;
  border: 1px solid #ccc;
}

/* Scrollable container */
#hasilBapro .baproGridScroll {
  max-height: calc(80vh - 60px);
  overflow-y: auto;
  padding: 0 2px;
}

/* Grid container */
#hasilBapro .grid-container {
  display: grid;
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

/* Responsif */
@media (max-width: 768px) {
  #hasilBapro .baproGridScroll { padding: 0; }
  #hasilBapro .grid-container { grid-template-columns: 1fr !important; gap:4px; width:100%; }
}
@media (min-width: 769px) and (max-width: 1023px) {
  #hasilBapro .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; }
}
@media (min-width: 1024px) {
  #hasilBapro .grid-container { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:10px; }
}

/* Grid card full-width */
#hasilBapro .grid-card { width:100%; box-sizing:border-box; }

</style>






<!-- ======================== QC CETAK ======================== -->
<section id="qcPA" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#fff; 
    background: linear-gradient(to right, #FF9800, #FFB74D); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;">
    MENU QC CETAK
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn cetak active" data-tab="inputPA" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn cetak" data-tab="hasilPA" onclick="switchTab(this)">Hasil</button>
  </div>

  <!-- Inputan -->
  <div id="inputPA" class="tab-content active">
    <div class="form-group">
      <label>Nama Order</label>
      <input type="text" id="paNama" placeholder="ETK GIV WHITE PEPAYA 72 GR">
    </div>

    <div class="form-group">
      <label>No KS</label>
      <input type="text" id="paNoKS" placeholder="KS-xxxx-xx">
    </div>

    <div class="form-group">
      <label>Total Order (lembar)</label>
      <input type="number" id="paOrder" placeholder="0">
    </div>

    <div class="form-group">
      <label>Bagus (lembar)</label>
      <input type="number" id="paBagus" placeholder="0">
    </div>

    <div class="form-group">
      <label>Sortir (lembar)</label>
      <input type="number" id="paSortir" placeholder="0">
    </div>

    <div class="form-group">
      <label>Problem (lembar)</label>
      <input type="number" id="paProblem" placeholder="0">
    </div>

    <div class="form-group">
      <label>QC</label>
      <select id="paQC">
        <option value="">Pilih QC</option>
        <option value="Suci">Suci</option>
        <option value="Anjani">Anjani</option>
      </select>
    </div>

    <div class="form-group">
      <label>Mesin</label>
      <select id="paMesin">
        <option value="">Pilih Mesin</option>
        <option value="KM 640">KM 640</option>
        <option value="KM 644">KM 644</option>
        <option value="KM 620">KM 620</option>
        <option value="MT 430">MT 430</option>
        <option value="KM 640 GL">KM 640 GL</option>
        <option value="RL 140">RL 140</option>
      </select>
    </div>

    <div class="form-group">
      <label>Update</label>
      <select id="paUpdate">
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
        <option value="Pending">Pending</option>
      </select>
    </div>

    <div class="form-group">
      <label>Keterangan (opsional)</label>
      <div class="rowKet"><span>1.</span><input type="text" id="ketPA1" placeholder="Isi keterangan 1"></div>
      <div class="rowKet"><span>2.</span><input type="text" id="ketPA2" placeholder="Isi keterangan 2"></div>
      <div class="rowKet"><span>3.</span><input type="text" id="ketPA3" placeholder="Isi keterangan 3"></div>
      <div class="rowKet"><span>4.</span><input type="text" id="ketPA4" placeholder="Isi keterangan 4"></div>
      <div class="rowKet"><span>5.</span><input type="text" id="ketPA5" placeholder="Isi keterangan 5"></div>
    </div>

    <div class="form-group">
      <button type="button" class="pa-add-btn" onclick="addPAItem()">âž• Tambah</button>
    </div>
  </div>

  <!-- Hasil -->
  <div id="hasilPA" class="tab-content">
    <input type="text" placeholder="ðŸ” Pencarian" oninput="renderGridPA(this.value)" class="baproFilter">
    <div class="baproGridScroll">
      <div id="gridPA" class="grid-container"></div>
    </div>
  </div>

</section>


<style>
/* ======================== TAB PA ======================== */
.tab-btn.cetak {
  flex:1; padding:6px 0; border-radius:6px; font-weight:600; cursor:pointer;
  border:1px solid #000; background:#e0e0e0 !important; color:#000 !important;
  transition:all 0.2s; text-align:center;
}
.tab-btn.cetak.active {
  background: linear-gradient(to right,#FF9800,#FFB74D) !important;
  color:#fff !important; border:1px solid #000 !important;
}
.tab-btn.cetak:not(.active):hover {
  background:#FFD180 !important; color:#000 !important;
  transform: translateY(-1px); box-shadow:0 2px 6px rgba(255,152,0,0.3);
}
.tab-btn.cetak:focus { outline:none; box-shadow:none; }

/* Inputan Form */
#inputPA .form-group input,
#inputPA .form-group select,
#inputPA .form-group textarea {
  width:100%; padding:0.6rem; border:1px solid #ccc;
  border-radius:8px; font-size:0.95rem; box-sizing:border-box;
}
.pa-add-btn {
  width:100%; padding:0.6rem; background:linear-gradient(135deg,#FF9800,#FFB74D);
  color:#fff; font-weight:600; border:1px solid #000; border-radius:8px;
  cursor:pointer; font-size:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.3);
  transition: all 0.25s;
}
.pa-add-btn:hover {
  background: linear-gradient(135deg,#FFB74D,#FF9800);
  transform: translateY(-2px); box-shadow:0 6px 12px rgba(255,183,77,0.4);
}

/* Container Tab */
#qcPA { display:flex; flex-direction:column; max-height:none; }
#qcPA .tabs { position:sticky; top:0; z-index:50; background:#fff; padding:6px 0; }
#inputPA, #hasilPA { overflow-y:auto; max-height:none; padding-right:4px; }

/* Row Keterangan */
.rowKet { display:flex; gap:6px; align-items:center; margin-bottom:6px; }
.rowKet input { flex:1; padding:4px 8px; }
.rowKet span { width:20px; text-align:right; font-weight:bold; }

/* Filter sticky */
#hasilPA .baproFilter {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding: 6px;
  margin-bottom: 6px;
  border: 1px solid #ccc;
}

/* Scrollable container */
#hasilPA .baproGridScroll {
  max-height: calc(80vh - 60px);
  overflow-y: auto;
  padding: 0 2px;
}

/* Grid container */
#hasilPA .grid-container {
  display: grid;
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

/* Responsif */
@media (max-width: 768px) {
  #hasilPA .baproGridScroll { padding: 0; }
  #hasilPA .grid-container { grid-template-columns: 1fr !important; gap:4px; width:100%; }
}
@media (min-width: 769px) and (max-width: 1023px) {
  #hasilPA .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; }
}
@media (min-width: 1024px) {
  #hasilPA .grid-container { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:10px; }
}

/* Grid card full-width */
#hasilPA .grid-card { width:100%; box-sizing:border-box; }

</style>




<script>
const paNoKS = document.getElementById('paNoKS');

paNoKS.addEventListener('input', function(e) {
  let value = paNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // huruf & angka saja, uppercase

  if (value.length > 2) {
    value = value.slice(0,2) + '-' + value.slice(2);
  }

  if (value.length > 7) {
    value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
  }

  paNoKS.value = value;
});
</script>



<!-- ======================== QC FINISHING ======================== -->
<section id="qcFinishing" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#fff; 
    background: linear-gradient(to right, #22C55E, #4ADE80); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;">
    MENU QC FINISHING
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn finishing active" data-tab="inputFinishing" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn finishing" data-tab="hasilFinishing" onclick="switchTab(this)">Hasil</button>
  </div>

  <!-- Inputan -->
  <div id="inputFinishing" class="tab-content active">
    <div class="form-group">
      <label>Nama Order</label>
      <input type="text" id="finishingNama" placeholder="ETK GIV WHITE PEPAYA 72 GR">
    </div>

    <div class="form-group">
      <label>No KS</label>
      <input type="text" id="finishingNoKS" placeholder="KS-xxxx-xx">
    </div>

    <div class="form-group">
      <label>Total Order (lembar)</label>
      <input type="number" id="finishingOrder" placeholder="0">
    </div>

    <div class="form-group">
      <label>Isi/Dus (pcs)</label>
      <input type="number" id="finishingIsi" placeholder="0">
    </div>

    <div class="form-group">
      <label>Total Bagus (pcs)</label>
      <input type="number" id="finishingBagus" placeholder="0">
    </div>

    <div class="form-group">
      <label>Total BS (pcs)</label>
      <input type="number" id="finishingJenisBS" placeholder="0">
    </div>

    <div class="form-group">
      <label>BS Cetak (pcs)</label>
      <input type="number" id="finishingJenisBS1" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Lem (pcs)</label>
      <input type="number" id="finishingJenisBS2" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Ponch (pcs)</label>
      <input type="number" id="finishingJenisBS3" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Varnish (pcs)</label>
      <input type="number" id="finishingJenisBS4" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Potong (pcs)</label>
      <input type="number" id="finishingJenisBS5" placeholder="0">
    </div>

    <div class="form-group">
      <label>QC</label>
      <select id="finishingQC">
        <option value="">Pilih QC</option>
        <option value="Anom">Anom</option>
        <option value="Irna">Irna</option>
      </select>
    </div>

    <div class="form-group">
      <label>Update</label>
      <select id="finishingUpdate">
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
        <option value="Pending">Pending</option>
      </select>
    </div>

    <div class="form-group">
      <label>Keterangan (opsional)</label>
      <div class="rowKet"><span>1.</span><input type="text" id="finKet1" placeholder="Isi keterangan 1"></div>
      <div class="rowKet"><span>2.</span><input type="text" id="finKet2" placeholder="Isi keterangan 2"></div>
      <div class="rowKet"><span>3.</span><input type="text" id="finKet3" placeholder="Isi keterangan 3"></div>
      <div class="rowKet"><span>4.</span><input type="text" id="finKet4" placeholder="Isi keterangan 4"></div>
      <div class="rowKet"><span>5.</span><input type="text" id="finKet5" placeholder="Isi keterangan 5"></div>
    </div>

    <div class="form-group">
      <button type="button" class="finishing-add-btn" onclick="addFinishingItem()">âž• Tambah</button>
    </div>
  </div>

  <!-- Hasil -->
  <div id="hasilFinishing" class="tab-content">
    <input type="text" placeholder="ðŸ” Pencarian" oninput="renderGridFinishing(this.value)" class="baproFilter">
    <div class="baproGridScroll">
      <div id="gridFinishing" class="grid-container"></div>
    </div>
  </div>

</section>



<style>
/* ======================== TAB FINISHING ======================== */
.tab-btn.finishing {
  flex:1; padding:6px 0; border-radius:6px; font-weight:600; cursor:pointer;
  border:1px solid #000; background:#e0e0e0 !important; color:#000 !important;
  transition:all 0.2s; text-align:center;
}
.tab-btn.finishing.active {
  background: linear-gradient(to right,#22C55E,#4ADE80) !important; color:#fff !important;
  border:1px solid #000 !important;
}
.tab-btn.finishing:not(.active):hover {
  background:#86efac !important; color:#000 !important;
  transform: translateY(-1px); box-shadow:0 2px 6px rgba(34,197,94,0.3);
}
.tab-btn.finishing:focus { outline:none; box-shadow:none; }

/* Inputan Form */
#inputFinishing .form-group input,
#inputFinishing .form-group select,
#inputFinishing .form-group textarea {
  width:100%; padding:0.6rem; border:1px solid #ccc; border-radius:8px;
  font-size:0.95rem; box-sizing:border-box;
}
.finishing-add-btn {
  width:100%; padding:0.6rem; background:linear-gradient(135deg,#22C55E,#4ADE80);
  color:#fff; font-weight:600; border:1px solid #000; border-radius:8px;
  cursor:pointer; font-size:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:all 0.25s;
}
.finishing-add-btn:hover {
  background: linear-gradient(135deg,#4ADE80,#22C55E);
  transform: translateY(-2px); box-shadow:0 6px 12px rgba(74,222,128,0.4);
}

/* Container Tab */
#qcFinishing { display:flex; flex-direction:column; max-height:none; }
#qcFinishing .tabs { position:sticky; top:0; z-index:50; background:#fff; padding:6px 0; }
#inputFinishing, #hasilFinishing { overflow-y:auto; max-height:none; padding-right:4px; }

/* Row Keterangan */
.rowKet { display:flex; gap:6px; align-items:center; margin-bottom:6px; }
.rowKet input { flex:1; padding:4px 8px; }
.rowKet span { width:20px; text-align:right; font-weight:bold; }

/* BS Inputs */
#finishingJenisBS { background-color:#ff6f91; border:1px solid #ff3366; border-radius:4px; padding:6px 8px; width:100%; box-sizing:border-box; font-size:14px; }
#finishingJenisBS::placeholder { color:#660022; opacity:1; }
#finishingJenisBS1,#finishingJenisBS2,#finishingJenisBS3,#finishingJenisBS4,#finishingJenisBS5 {
  background-color:#ffc0cb; border:1px solid #ff69b4; border-radius:4px; padding:6px 8px; width:100%; box-sizing:border-box; font-size:14px;
}
#finishingJenisBS1::placeholder,#finishingJenisBS2::placeholder,#finishingJenisBS3::placeholder,#finishingJenisBS4::placeholder,#finishingJenisBS5::placeholder {
  color:#990033; opacity:1;
}
#inputFinishing .form-group label { display:block; font-weight:600; margin-bottom:4px; font-size:0.9rem; color:#333; }

/* Spinner */
.spinner { width:18px; height:18px; border:3px solid #ddd; border-top:3px solid #22C55E; border-radius:50%; display:inline-block; vertical-align:middle; animation:spin 0.8s linear infinite; margin-right:6px; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

/* ======================== HASIL FINISHING FINAL ======================== */
/* Filter sticky */
#hasilFinishing .baproFilter {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding: 6px;
  margin-bottom: 6px;
  border: 1px solid #ccc;
}
/* Scrollable container */
#hasilFinishing .baproGridScroll {
  max-height: calc(80vh - 60px);
  overflow-y: auto;
  padding: 0 2px;
}
/* Grid container */
#hasilFinishing .grid-container {
  display: grid;
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
/* Responsif */
@media (max-width: 768px) {
  /* Full-width grid di HP */
  #hasilFinishing .baproGridScroll { padding: 0; }
  #hasilFinishing .grid-container { grid-template-columns: 1fr !important; gap:4px; width:100%; }
}
@media (min-width: 769px) and (max-width: 1023px) {
  #hasilFinishing .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; }
}
@media (min-width: 1024px) {
  #hasilFinishing .grid-container { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:10px; }
}
/* Grid card full-width */
#hasilFinishing .grid-card { width:100%; box-sizing:border-box; }
</style>




<script>
const finishingNoKS = document.getElementById('finishingNoKS');

if (finishingNoKS) {
  let lastValue = "";

  finishingNoKS.addEventListener('input', function() {
    let raw = finishingNoKS.value;

    // Bersihkan input (A-Z & 0-9)
    let clean = raw.toUpperCase().replace(/[^A-Z0-9]/g, '');

    // Format KS-XXXX-XX
    let formatted = clean;

    if (clean.length > 2) {
      formatted = clean.slice(0, 2) + '-' + clean.slice(2);
    }

    if (clean.length > 7) {
      formatted = formatted.slice(0, 7) + '-' + formatted.slice(7);
    }

    // Jika nilai tidak berubah, jangan re-render (mencegah bug HP Vivo)
    if (formatted === lastValue) return;

    // Simpan posisi cursor
    let pos = finishingNoKS.selectionStart;

    // Hitung selisih panjang sebelum vs sesudah formatting
    let diff = formatted.length - raw.length;

    finishingNoKS.value = formatted;
    lastValue = formatted;

    // Set ulang posisi cursor agar tidak lompat
    finishingNoKS.setSelectionRange(pos + diff, pos + diff);
  });
}
</script>





<!-- ======================== QC LEM ======================== -->
<section id="qcLem" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#fff; 
    background: linear-gradient(to right, #9C27B0, #BA68C8); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;">
    MENU QC LEM
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;"></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn lem active" data-tab="inputLem" onclick="switchTab(this)">Inputan</button>
    <button class="tab-btn lem" data-tab="hasilLem" onclick="switchTab(this)">Hasil</button>
  </div>

  <!-- Inputan -->
  <div id="inputLem" class="tab-content active">
    <div class="form-group">
      <label>Nama Order</label>
      <input type="text" id="lemNama" placeholder="ETK GIV WHITE PEPAYA 72 GR">
    </div>

    <div class="form-group">
      <label>No KS</label>
      <input type="text" id="lemNoKS" placeholder="KS-xxxx-xx">
    </div>

    <div class="form-group">
      <label>Total Order (lembar)</label>
      <input type="number" id="lemOrder" placeholder="0">
    </div>

    <div class="form-group">
      <label>Isi/Dus (pcs)</label>
      <input type="number" id="lemIsi" placeholder="0">
    </div>

    <div class="form-group">
      <label>Total Bagus (pcs)</label>
      <input type="number" id="lemBagus" placeholder="0">
    </div>

    <div class="form-group">
      <label>Total BS (pcs)</label>
      <input type="number" id="lemJenisBS" placeholder="0">
    </div>

    <div class="form-group">
      <label>BS Cetak (pcs)</label>
      <input type="number" id="lemJenisBS1" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Lem (pcs)</label>
      <input type="number" id="lemJenisBS12" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Ponch (pcs)</label>
      <input type="number" id="lemJenisBS13" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Varnish (pcs)</label>
      <input type="number" id="lemJenisBS14" placeholder="0">
    </div>
    <div class="form-group">
      <label>BS Potong (pcs)</label>
      <input type="number" id="lemJenisBS15" placeholder="0">
    </div>

    <div class="form-group">
      <label>QC</label>
      <select id="lemQC">
        <option value="">Pilih QC</option>
        <option value="Martini">Martini</option>
        <option value="Krestin">Krestin</option>
        <option value="Ismie">Ismie</option>
      </select>
    </div>

    <div class="form-group">
      <label>Update</label>
      <select id="lemUpdate">
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
        <option value="Pending">Pending</option>
      </select>
    </div>

    <div class="form-group">
      <label>Keterangan (opsional)</label>
      <div class="rowKet"><span>1.</span><input type="text" id="lemKet1" placeholder="Isi keterangan 1"></div>
      <div class="rowKet"><span>2.</span><input type="text" id="lemKet2" placeholder="Isi keterangan 2"></div>
      <div class="rowKet"><span>3.</span><input type="text" id="lemKet3" placeholder="Isi keterangan 3"></div>
      <div class="rowKet"><span>4.</span><input type="text" id="lemKet4" placeholder="Isi keterangan 4"></div>
      <div class="rowKet"><span>5.</span><input type="text" id="lemKet5" placeholder="Isi keterangan 5"></div>
    </div>

    <div class="form-group">
      <button type="button" class="lem-add-btn" onclick="addLemItem()">âž• Tambah</button>
    </div>
  </div>

  <!-- Hasil -->
  <div id="hasilLem" class="tab-content">
    <input type="text" placeholder="ðŸ” Pencarian" oninput="renderGridLem(this.value)" class="baproFilter">
    <div class="baproGridScroll">
      <div id="gridLem" class="grid-container"></div>
    </div>
  </div>

</section>



<style>
/* ======================== TAB LEM ======================== */
.tab-btn.lem {
  flex:1; padding:6px 0; border-radius:6px; font-weight:600; cursor:pointer;
  border:1px solid #000; background:#e0e0e0 !important; color:#000 !important;
  transition:all 0.2s; text-align:center;
}
.tab-btn.lem.active {
  background: linear-gradient(to right,#9C27B0,#BA68C8) !important; color:#fff !important;
  border:1px solid #000 !important;
}
.tab-btn.lem:not(.active):hover {
  background:#D18FE0 !important; color:#000 !important;
  transform: translateY(-1px); box-shadow:0 2px 6px rgba(156,39,176,0.3);
}
.tab-btn.lem:focus { outline:none; box-shadow:none; }

/* Inputan Form */
#inputLem .form-group input,
#inputLem .form-group select,
#inputLem .form-group textarea {
  width:100%; padding:0.6rem; border:1px solid #ccc; border-radius:8px;
  font-size:0.95rem; box-sizing:border-box;
}
.lem-add-btn {
  width:100%; padding:0.6rem; background:linear-gradient(135deg,#9C27B0,#BA68C8);
  color:#fff; font-weight:600; border:1px solid #000; border-radius:8px;
  cursor:pointer; font-size:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:all 0.25s;
}
.lem-add-btn:hover {
  background: linear-gradient(135deg,#BA68C8,#9C27B0);
  transform: translateY(-2px); box-shadow:0 6px 12px rgba(186,104,200,0.4);
}

/* Container Tab */
#qcLem { display:flex; flex-direction:column; max-height:none; }
#qcLem .tabs { position:sticky; top:0; z-index:50; background:#fff; padding:6px 0; }
#inputLem, #hasilLem { overflow-y:auto; max-height:none; padding-right:4px; }

/* Row Keterangan */
.rowKet { display:flex; gap:6px; align-items:center; margin-bottom:6px; }
.rowKet input { flex:1; padding:4px 8px; }
.rowKet span { width:20px; text-align:right; font-weight:bold; }

/* BS Inputs */
#lemJenisBS { background-color:#ff6f91; border:1px solid #ff3366; border-radius:4px; padding:6px 8px; width:100%; box-sizing:border-box; font-size:14px; }
#lemJenisBS::placeholder { color:#660022; opacity:1; }

#lemJenisBS1,#lemJenisBS12,#lemJenisBS13,#lemJenisBS14,#lemJenisBS15 {
  background-color:#ffc0cb; border:1px solid #ff69b4; border-radius:4px; padding:6px 8px; width:100%; box-sizing:border-box; font-size:14px;
}
#lemJenisBS1::placeholder,#lemJenisBS12::placeholder,#lemJenisBS13::placeholder,#lemJenisBS14::placeholder,#lemJenisBS15::placeholder {
  color:#990033; opacity:1;
}

#inputLem .form-group label { display:block; font-weight:600; margin-bottom:4px; font-size:0.9rem; color:#333; }

/* Spinner */
.spinner { width:18px; height:18px; border:3px solid #ddd; border-top:3px solid #9C27B0; border-radius:50%; display:inline-block; vertical-align:middle; animation:spin 0.8s linear infinite; margin-right:6px; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

/* ======================== HASIL LEM FINAL ======================== */
/* Filter sticky */
#hasilLem .baproFilter {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;
  padding: 6px;
  margin-bottom: 6px;
  border: 1px solid #ccc;
}
/* Scrollable container */
#hasilLem .baproGridScroll {
  max-height: calc(80vh - 60px);
  overflow-y: auto;
  padding: 0 2px;
}
/* Grid container */
#hasilLem .grid-container {
  display: grid;
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
/* Responsif */
@media (max-width: 768px) {
  /* Full-width grid di HP */
  #hasilLem .baproGridScroll { padding: 0; }
  #hasilLem .grid-container { grid-template-columns: 1fr !important; gap:4px; width:100%; }
}
@media (min-width: 769px) and (max-width: 1023px) {
  #hasilLem .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; }
}
@media (min-width: 1024px) {
  #hasilLem .grid-container { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:10px; }
}
/* Grid card full-width */
#hasilLem .grid-card { width:100%; box-sizing:border-box; }
</style>




<script>
const lemNoKS = document.getElementById('lemNoKS');

if (lemNoKS) {
  lemNoKS.addEventListener('input', function() {
    let value = lemNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // huruf & angka saja, uppercase

    if (value.length > 2) {
      value = value.slice(0,2) + '-' + value.slice(2);
    }

    if (value.length > 7) {
      value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
    }

    lemNoKS.value = value;
  });
}
</script>


<!-- ======================== MENU MANUAL ======================== --> 
<section id="manualSection" class="card qc-section" style="display:none;">

  <!-- Judul -->
  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #0078D7, #1A86D1);
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU MANUAL
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="manualQC" onclick="switchTab(this)">Manual QC</button>
    <button class="tab-btn" data-tab="manualProduksi" onclick="switchTab(this)">Form QC</button>
    <button class="tab-btn" data-tab="manualUmum" onclick="switchTab(this)">Jobdes QC</button>
  </div>

  <!-- Konten Manual QC -->
  <div id="manualQC" class="tab-content active">
    <input type="text" class="filter-input" placeholder="ðŸ” Pencarian" onkeyup="filterManualList(this, 'manualQC')">
    <ul class="manual-list">
      <li><a href="https://drive.google.com/drive/folders/1oViZSpiSc4aRF-OxVQSZ6nMN0FbdD_y-?usp=drive_link">ðŸ“˜ 307900_QC -COA</a></li>
      <li><a href="https://drive.google.com/drive/folders/1xctN1tpbmLZ1tCQF-4-YLJXIBOA_HDr6?usp=drive_link">ðŸ“˜ 307700_QC -InProses</a></li>
      <li><a href="https://drive.google.com/drive/folders/1KweOfFN36PeKC9AiYpbxAJ2YtG7UKJbU?usp=drive_link">ðŸ“˜ 307800_QC -Barang Jadi</a></li>
      <li><a href="https://drive.google.com/drive/folders/1VlgxLLagD79zxuSZWYPVdUEgdbS1X2Uo?usp=drive_link">ðŸ“˜ 307600_QC -Produksi POP</a></li>
      <li><a href="https://drive.google.com/drive/folders/1utMIrQZsvTZ1aTyzGfWE00iaMJw8jIcU?usp=drive_link">ðŸ“˜ 307500_QC -Acuan</a></li>
      <li><a href="https://drive.google.com/drive/folders/1tGhpcUL4YEB4RNdBW4UozAdryLdTPDAB?usp=drive_link">ðŸ“˜ 307400_QC -Roll & Blanket Cetak</a></li>
      <li><a href="https://drive.google.com/drive/folders/1Z4atGWZUMgZhNfuseImbSlPMXSsQBFnO?usp=drive_link">ðŸ“˜ 307200_QC -Batek & Solar</a></li>
      <li><a href="https://drive.google.com/drive/folders/1zATvzsfhBneNYHSS9zLkvm9U7gN3Obnm?usp=drive_link">ðŸ“˜ 307100_QC -Bapro</a></li>
      <li><a href="https://drive.google.com/drive/folders/1sAsUUZf7bc2YFxMeAFJo9BdWzQ5VSlxz?usp=drive_link">ðŸ“˜ 307000_QC -System Mgn</a></li>
    </ul>
  </div>

  <!-- Konten Form QC -->
  <div id="manualProduksi" class="tab-content">
    <input type="text" class="filter-input" placeholder="ðŸ” Pencarian" onkeyup="filterManualList(this, 'manualProduksi')">
    <ul class="manual-list">
      <li><a href="https://drive.google.com/drive/folders/1kQFXtEc9AfMuihyoPwKgQiBfj9CBy6Cv?usp=drive_link">ðŸ“— Form QC Cetak</a></li>
    </ul>
  </div>

  <!-- Konten Jobdes QC -->
  <div id="manualUmum" class="tab-content">
    <input type="text" class="filter-input" placeholder="ðŸ” Pencarian" onkeyup="filterManualList(this, 'manualUmum')">
    <ul class="manual-list">
      <li><a href="https://docs.google.com/document/d/1ZMUH69lKTdmZSqiU4ENonEWkz2mU-jEZ/edit?usp=drive_link&ouid=106732294145329226246&rtpof=true&sd=true">ðŸ“™ Jobdes SPV</a></li>
      <li><a href="https://drive.google.com/drive/folders/13KqNsG7lKYIdr_ouVYtyNMQB38j5kpoO?usp=drive_link">ðŸ“™ Jobdes QC Bapro</a></li>
      <li><a href="https://docs.google.com/document/d/1I5eMeL5lQBXrugCec3PwDknSgrs4G2wg/edit?usp=drive_link&ouid=106732294145329226246&rtpof=true&sd=true">ðŸ“™ Jobdes QC Cetak</a></li>
      <li><a href="https://drive.google.com/drive/folders/11KbszhyIqDsvoIj66-rEOP4UgTMveOUS?usp=drive_link">ðŸ“™ Jobdes QC Barang Jadi</a></li>
    </ul>
  </div>
</section>

<!-- ===== CSS Tab dan Style untuk MENU MANUAL ===== -->
<style>
#manualSection .tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  flex-wrap: wrap;
  justify-content: center;
}
#manualSection .tab-btn {
  flex: 1;
  min-width: 120px;
  padding: 8px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000 !important;
  background: #eaf4ff !important;
  color: #003366 !important;
  transition: all 0.2s;
  text-align: center;
}
#manualSection .tab-btn.active {
  background: linear-gradient(to right, #0078D7, #1A86D1) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}
#manualSection .tab-btn:not(.active):hover {
  background: #d5e9ff !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,120,215,0.3);
}
.manual-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.manual-list li {
  background: #f5faff;
  margin-bottom: 8px;
  border-radius: 8px;
  padding: 10px 12px;
  border: 1px solid #c2e0ff;
  transition: all 0.2s;
}
.manual-list li:hover {
  background: #e0f0ff;
  transform: translateY(-2px);
  box-shadow: 0 2px 6px rgba(0,120,215,0.2);
}
.manual-list a {
  text-decoration: none;
  color: #004a99;
  font-weight: 600;
  display: block;
}
.filter-input {
  width: 100%;
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid #bcdfff;
  margin-bottom: 10px;
  font-size: 14px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: all 0.2s;
}
.filter-input:focus {
  outline: none;
  border-color: #0078D7;
  box-shadow: 0 0 6px rgba(0,120,215,0.4);
}
@media (max-width: 768px) {
  #manualSection h2 {
    font-size: 1rem;
  }
  #manualSection .tab-btn {
    flex: 1 1 100%;
    font-size: 14px;
    padding: 7px 0;
  }
  .manual-list li {
    padding: 8px 10px;
  }
  .filter-input {
    font-size: 13px;
  }
}
@media (min-width: 1024px) {
  #manualSection .tab-btn {
    flex: 1;
    font-size: 15px;
  }
}
</style>

<!-- ===== Script Password + Filter ===== -->
<script>
// ðŸ” Password khusus MENU MANUAL agar tidak bentrok dengan menu lain
const MANUAL_PASSWORD = 'qc123';

// ðŸ” Proteksi akses MENU MANUAL
document.addEventListener('DOMContentLoaded', () => {
  const manualBtn = document.querySelector(`nav button[onclick="showMenu('manualSection')"]`);
  if (manualBtn) {
    const originalOnClick = manualBtn.getAttribute('onclick');
    manualBtn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk MENU MANUAL:');
      if (input === null) return;
      if (input === MANUAL_PASSWORD) eval(originalOnClick);
      else alert('âŒ Password salah!');
    };
  }
});

// ðŸ”„ Ganti tab
function switchTab(btn) {
  document.querySelectorAll('#manualSection .tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('#manualSection .tab-content').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(btn.dataset.tab).classList.add('active');
}

// ðŸ” Filter daftar manual
function filterManualList(input, tabId) {
  const filter = input.value.toLowerCase();
  const items = document.querySelectorAll(`#${tabId} .manual-list li`);
  items.forEach(li => {
    const text = li.textContent.toLowerCase();
    li.style.display = text.includes(filter) ? '' : 'none';
  });
}
</script>



<!-- ======================== QC SPV ======================== -->
<section id="qcSPV" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #00BCD4, #4DD0E1); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU QC REGISTER
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn active" data-tab="spvInputSection" onclick="showSPVTab('input', this)">Inputan</button>
    <button class="tab-btn" data-tab="spvHasilSection" onclick="showSPVTab('hasil', this)">Hasil</button>
  </div>



<style>
/* ========== Tab Button QC SPV (Cyan) ========== */
.tab-btn {
  flex: 1;
  padding: 6px 0;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid #000 !important; /* âœ… outline hitam muncul juga di nonaktif */
  background: #e0e0e0 !important; /* tombol nonaktif abu */
  color: #000 !important;
  transition: all 0.2s;
  text-align: center;
}

.tab-btn.active {
  background: linear-gradient(to right, #00BCD4, #4DD0E1) !important;
  color: #fff !important;
  border: 1px solid #000 !important;
}

.tab-btn:not(.active):hover {
  background: #B2EBF2 !important;
  color: #000 !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,188,212,0.3);
}

.tab-btn:focus {
  outline: none;
  box-shadow: none;
}
</style>


<!-- ========== INPUTAN ========== -->
<div id="spvInputSection" style="margin-top:10px;">
  <form id="spvForm">

    <style>
      /* ===== Style Form QC SPV ===== */
      #spvForm .form-group { margin-bottom: 10px; }

      #spvForm input[type="text"],
      #spvForm input[type="date"],
      #spvForm input[type="time"],
      #spvForm textarea,
      #spvForm select {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 0.95rem;
        box-sizing: border-box;
      }

      #spvForm button {
        width: 100%;
        padding: .6rem;
        background: #00BCD4;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
      }
      #spvForm button:hover { background: #00BCD4; }

      .tabs { display: flex; margin-bottom: 10px; }
      .tabs button {
        flex: 1;
        padding: 8px;
        border: none;
        cursor: pointer;
        background: #ddd;
        font-weight: bold;
      }
      .tabs button.active {
        background: #00BCD4;
        color: white;
      }

      /* ===== Spinner ===== */
      #spvSpinner {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }

      #spvSpinner div {
        width: 50px;
        height: 50px;
        border: 6px solid #fff;
        border-top-color: #00BCD4;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      /* ===== Label Foto ===== */
      label {
        font-weight: 600;
        display: block;
        margin-bottom: 4px;
        color: #333;
      }

      /* ===== File input + tombol edit rapi vertikal ===== */
      .file-edit-wrapper {
        display: flex;
        flex-direction: column; /* vertikal */
        gap: 4px;
        align-items: flex-start; /* kiri */
      }

      .file-edit-wrapper input[type="file"],
      .file-edit-wrapper button {
        width: 100%;
        max-width: 250px; /* proporsional */
        padding: 6px 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.95rem;
        box-sizing: border-box;
        cursor: pointer;
      }

      .file-edit-wrapper button {
        background: #00BCD4;
        color: #fff;
        border: 1px solid #00BCD4;
      }

      .file-edit-wrapper button:hover {
        background: #0097a7;
      }

      /* ===== Modal Editor Foto ===== */
      .foto-modal {
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.5);
        display:flex;
        justify-content:center;
        align-items:center;
        z-index:9999;
      }
      .foto-modal-content {
        background:#fff;
        padding:12px;
        border-radius:8px;
        text-align:center;
        position:relative;
        max-width:90%;
        max-height:90%;
      }
      .close-btn {
        position:absolute;
        top:6px; right:10px;
        font-size:24px;
        cursor:pointer;
      }
      #editorCanvas {
        max-width:100%;
        max-height:80vh;
      }
      #toolButtons {
        margin-top:8px;
        display:flex;
        gap:6px;
        justify-content:center;
      }
      #toolButtons button {
        padding:6px 10px;
        border-radius:6px;
        border:1px solid #ccc;
        cursor:pointer;
        background:#f0f0f0;
      }
      #toolButtons button.active {
        background:#00bcd4;
        color:#fff;
      }
    </style>

    <!-- SPINNER OVERLAY -->
    <div id="spvSpinner"><div></div></div>

    <!-- Input Nama Order -->
    <div class="form-group">
      <label>Nama Order</label>
      <input type="text" id="spvOrder" placeholder="ETK GIV WHITE PEPAYA 72 GR" required>
    </div>

    <!-- Input No KS -->
    <div class="form-group">
      <label>No KS</label>
      <input type="text" id="spvNoKS" placeholder="KS-xxxx-xx" required>
    </div>

    <!-- Tanggal & Jam -->
    <div class="form-group" style="display:flex; gap:10px;">
      <div style="flex:1;">
        <label>Tanggal</label>
        <input type="date" id="spvTanggal" required style="width:100%;">
      </div>
      <div style="flex:1;">
        <label>Jam</label>
        <input type="time" id="spvJam" required style="width:100%;">
      </div>
    </div>

    <!-- Foto Acuan -->
    <div class="form-group">
      <label>Foto Acuan</label>
      <div class="file-edit-wrapper">
        <input type="file" id="spvFoto" accept="image/*">
        <button type="button" id="editFotoBtn" onclick="openFotoEditor('spvFoto')">âœï¸ Edit Foto</button>
      </div>
    </div>

    <!-- Keterangan Acuan -->
    <div class="form-group">
      <label>Keterangan Acuan (opsional)</label>
      <textarea id="spvKet" placeholder="Isi Keterangan" rows="3"></textarea>
    </div>

    <!-- Foto Temuan -->
    <div class="form-group">
      <label>Foto Temuan</label>
      <div class="file-edit-wrapper">
        <input type="file" id="spvFoto1" accept="image/*">
        <button type="button" id="editFoto1Btn" onclick="openFotoEditor('spvFoto1')">âœï¸ Edit Foto</button>
      </div>
    </div>

    <!-- Keterangan Temuan -->
    <div class="form-group">
      <label>Keterangan Temuan (opsional)</label>
      <textarea id="spvKet1" placeholder="Isi Keterangan" rows="3"></textarea>
    </div>

    <!-- Nama QC -->
    <div class="form-group">
      <label>Nama QC</label>
      <select id="spvNama" required>
        <option value="" disabled selected>Pilih Nama QC</option>
        <option value="NANI">NANI</option>
        <option value="ANJANI">ANJANI</option>
        <option value="SUCI">SUCI</option>
        <option value="ANOM">ANOM</option>
        <option value="IRNA">IRNA</option>
        <option value="MARWAN">MARWAN</option>
        <option value="KIKI">KIKI</option>
        <option value="MARTINI">MARTINI</option>
        <option value="KRESTIN">KRESTIN</option>
        <option value="ISMIE">ISMIE</option>
      </select>
    </div>

    <!-- Proses -->
    <div class="form-group">
      <label>Proses</label>
      <select id="spvProses" required>
        <option value="" disabled selected>Pilih Proses</option>
        <option value="QC BAPRO">QC BAPRO</option>
        <option value="QC CETAK">QC CETAK</option>
        <option value="QC FINISHING">QC FINISHING</option>
        <option value="QC LEM">QC LEM</option>
        <option value="RETUR">RETUR</option>
      </select>
    </div>

    <!-- Tombol Submit -->
    <div class="form-group">
      <button type="button" onclick="submitSPV(event)">âž• Tambah</button>
    </div>

  </form>
</div>

<!-- ======================== Modal Editor Gambar ======================== -->
<div id="fotoModal" class="foto-modal" style="display:none;">
  <div class="foto-modal-content">
    <span class="close-btn" onclick="confirmCloseFotoModal()">&times;</span>

    <canvas id="editorCanvas" class="canvas-area"></canvas>

    <!-- TOOL BUTTONS -->
    <div id="toolButtons" class="tool-buttons">
      <button onclick="setTool('move', this)">ðŸ– Move</button>
      <button onclick="setTool('arrow', this)">âž¡ï¸ Panah</button>
      <button onclick="setTool('rect', this)">â¬› Kotak</button>
      <button onclick="clearCanvas()">ðŸ§¹ Clear</button>
      <button class="full" onclick="confirmSaveCanvas()">ðŸ’¾ Simpan</button>
    </div>
  </div>
</div>

<style>
/* ===================== Modal ===================== */
.foto-modal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
  padding:10px;
  z-index:9999;
}

.foto-modal-content {
  background:#fff;
  padding:12px;
  border-radius:10px;
  width:100%;
  max-width:480px;
  max-height:95vh;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.close-btn {
  position:absolute;
  top:8px; right:12px;
  font-size:26px;
  cursor:pointer;
}

/* ===================== Canvas ===================== */
.canvas-area {
  width:100%;
  height:auto;
  max-height:60vh;
  border:1px solid #ccc;
  border-radius:6px;
}

/* ===================== Buttons FLEX FIX ===================== */
.tool-buttons {
  display:flex;
  flex-wrap:wrap;
  width:100%;
  gap:8px;
  justify-content:space-between;
}

.tool-buttons button {
  flex:1 1 calc(33.33% - 8px);
  padding:10px;
  border:none;
  border-radius:8px;
  background:#f2f2f2;
  font-size:15px;
  cursor:pointer;
  text-align:center;
}

.tool-buttons button.active {
  background:#00bcd4;
  color:#fff;
}

/* Tombol Simpan full width */
.tool-buttons .full {
  flex: 1 1 100%;
}

/* ===================== Mobile optimization ===================== */
@media (max-width:420px){
  .foto-modal-content {
    padding:8px;
  }

  .tool-buttons {
    gap:6px;
  }

  .tool-buttons button {
    flex:1 1 calc(50% - 6px); /* 2 kolom di HP */
    font-size:14px;
    padding:9px;
  }

  .tool-buttons .full {
    flex:1 1 100%;
  }
}

/* HP sangat kecil (â‰¤360px) */
@media (max-width:360px){
  .tool-buttons button {
    font-size:13px;
    padding:8px;
  }
}
</style>





<script>
let currentFileInput = null;
let canvas = document.getElementById('editorCanvas');
let ctx = canvas.getContext('2d');

let tool = "move";
let drawing = false;
let startX = 0, startY = 0;
let items = [];
let selectedItem = null;
let tempItem = null;

// ========================= SET TOOL =========================
function setTool(t, btn=null){
  tool=t;
  drawing=false;
  tempItem=null;
  selectedItem=null;

  document.querySelectorAll('#toolButtons button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

// ========================= CLEAR CANVAS =========================
function clearCanvas(){
  items=[];
  redraw();
}

// ========================= OPEN MODAL =========================
function openFotoEditor(fileInput){
  let input = (typeof fileInput==='string') ? document.getElementById(fileInput) : fileInput;
  if(input.files.length===0){
    alert("âš ï¸ Pilih file dulu!");
    return;
  }

  currentFileInput = input;
  const reader=new FileReader();
  reader.onload=function(e){
    let img=new Image();
    img.onload=function(){
      const maxW=600;
      const scale=Math.min(1,maxW/img.width);

      canvas.width = img.width*scale;
      canvas.height = img.height*scale;

      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);

      canvas.backgroundImage = img;
      items=[];
      setTool("move", document.querySelector("#toolButtons button:first-child"));
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(input.files[0]);
  document.getElementById("fotoModal").style.display="flex";
}

// ========================= CLOSE MODAL =========================
function confirmCloseFotoModal(){
  if(confirm("Tutup editor? Perubahan hilang.")){
    closeFotoModal();
  }
}
function closeFotoModal(){
  document.getElementById("fotoModal").style.display="none";
}

// ========================= POINTER POSITION (WITH SCALE) =========================
function getPos(e){
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;

  let x,y;
  if(e.touches){
    x = (e.touches[0].clientX - rect.left) * scaleX;
    y = (e.touches[0].clientY - rect.top) * scaleY;
  } else {
    x = (e.clientX - rect.left) * scaleX;
    y = (e.clientY - rect.top) * scaleY;
  }
  return {x,y};
}

// ========================= START DRAW =========================
function startDraw(e){
  e.preventDefault();
  const pos = getPos(e);

  startX = pos.x;
  startY = pos.y;

  // ========== MOVE MODE ==========
  if(tool==="move"){
    selectedItem = items.find(item=>{
      if(item.type==="rect"){
        return pos.x>=item.x-10 && pos.x<=item.x+item.w+10 &&
               pos.y>=item.y-10 && pos.y<=item.y+item.h+10;
      }
      if(item.type==="arrow"){
        const minX = Math.min(item.x,item.x2)-10;
        const maxX = Math.max(item.x,item.x2)+10;
        const minY = Math.min(item.y,item.y2)-10;
        const maxY = Math.max(item.y,item.y2)+10;
        return pos.x>=minX && pos.x<=maxX && pos.y>=minY && pos.y<=maxY;
      }
      if(item.type==="free"){
        return true;
      }
    });
    return;
  }

  // ========== FREE DRAW ==========
  if(tool==="free"){
    drawing = true;
    tempItem = {type:"free", points:[{x:startX,y:startY}]};
    return;
  }

  // ========== RECT & ARROW ==========
  drawing = true;
  tempItem = {type:tool, x:startX, y:startY, x2:startX, y2:startY, w:0, h:0};
}

// ========================= MOVE / DRAW =========================
function moveDraw(e){
  e.preventDefault();
  const pos = getPos(e);

  // ========== MOVE ==========
  if(tool==="move" && selectedItem){
    const dx = pos.x - startX;
    const dy = pos.y - startY;

    selectedItem.x += dx;
    selectedItem.y += dy;

    if(selectedItem.type==="rect"){
      // width/height tetap
    }
    if(selectedItem.type==="arrow"){
      selectedItem.x2 += dx;
      selectedItem.y2 += dy;
    }
    if(selectedItem.type==="free"){
      selectedItem.points = selectedItem.points.map(p=>({x:p.x+dx, y:p.y+dy}));
    }

    startX = pos.x;
    startY = pos.y;
    redraw();
    return;
  }

  // ========== FREE DRAW ==========
  if(tool==="free" && drawing && tempItem){
    tempItem.points.push({x:pos.x, y:pos.y});
    redraw();
    drawTemp();
    return;
  }

  // ========== RECT / ARROW ==========
  if(drawing && tempItem){
    if(tempItem.type==="rect"){
      tempItem.w = pos.x - startX;
      tempItem.h = pos.y - startY;
    } else if(tempItem.type==="arrow"){
      tempItem.x2 = pos.x;
      tempItem.y2 = pos.y;
    }
    redraw();
    drawTemp();
  }
}

// ========================= END DRAW =========================
function endDraw(e){
  e.preventDefault();

  if(tool==="move"){
    selectedItem=null;
    return;
  }

  if(drawing && tempItem){
    items.push(JSON.parse(JSON.stringify(tempItem)));
    tempItem=null;
    drawing=false;
    redraw();
  }
}

// ========================= REDRAW =========================
function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(canvas.backgroundImage){
    ctx.drawImage(canvas.backgroundImage,0,0,canvas.width,canvas.height);
  }

  items.forEach(item=>{
    ctx.lineWidth=3;
    ctx.strokeStyle="red";
    ctx.fillStyle="red";

    if(item.type==="rect"){
      ctx.strokeRect(item.x,item.y,item.w,item.h);
    }
    else if(item.type==="arrow"){
      ctx.beginPath();
      ctx.moveTo(item.x,item.y);
      ctx.lineTo(item.x2,item.y2);
      ctx.stroke();
      drawArrowHead(item.x,item.y,item.x2,item.y2);
    }
    else if(item.type==="free"){
      ctx.beginPath();
      item.points.forEach((p,i)=>{
        if(i===0) ctx.moveTo(p.x,p.y);
        else ctx.lineTo(p.x,p.y);
      });
      ctx.stroke();
    }
  });
}

// ========================= TEMP PREVIEW =========================
function drawTemp(){
  if(!tempItem) return;

  ctx.lineWidth=3;
  ctx.strokeStyle="red";
  ctx.fillStyle="red";

  if(tempItem.type==="rect"){
    ctx.strokeRect(tempItem.x,tempItem.y,tempItem.w,tempItem.h);
  }
  else if(tempItem.type==="arrow"){
    ctx.beginPath();
    ctx.moveTo(tempItem.x,tempItem.y);
    ctx.lineTo(tempItem.x2,tempItem.y2);
    ctx.stroke();
    drawArrowHead(tempItem.x,tempItem.y,tempItem.x2,tempItem.y2);
  }
  else if(tempItem.type==="free"){
    ctx.beginPath();
    tempItem.points.forEach((p,i)=>{
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    });
    ctx.stroke();
  }
}

// ========================= ARROW HEAD =========================
function drawArrowHead(x1,y1,x2,y2){
  let headlen=15;
  let dx=x2-x1;
  let dy=y2-y1;
  let angle=Math.atan2(dy,dx);

  ctx.beginPath();
  ctx.moveTo(x2,y2);
  ctx.lineTo(x2-headlen*Math.cos(angle-Math.PI/6),
             y2-headlen*Math.sin(angle-Math.PI/6));
  ctx.lineTo(x2-headlen*Math.cos(angle+Math.PI/6),
             y2-headlen*Math.sin(angle+Math.PI/6));
  ctx.closePath();
  ctx.fill();
}

// ========================= SAVE CANVAS =========================
function confirmSaveCanvas(){
  if(confirm("Simpan gambar?")){
    saveCanvas();
  }
}
function saveCanvas(){
  canvas.toBlob(blob=>{
    const file = new File([blob], currentFileInput.files[0]?.name || "edited.png",{type:"image/png"});
    const dt = new DataTransfer();
    dt.items.add(file);
    currentFileInput.files=dt.files;
    closeFotoModal();
  });
}

// ========================= EVENTS =========================
canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mousemove", moveDraw);
canvas.addEventListener("mouseup", endDraw);

canvas.addEventListener("touchstart", startDraw, {passive:false});
canvas.addEventListener("touchmove", moveDraw, {passive:false});
canvas.addEventListener("touchend", endDraw, {passive:false});
</script>




<!-- ========== HASIL ========== -->
<div id="spvHasilSection" style="display:none;">
  <div class="hasil-container">
    
    <!-- Kolom Pencarian -->
    <div class="search-wrapper">
      <input 
        type="text" 
        id="spvSearch" 
        placeholder="ðŸ” Pencarian">
    </div>

    <!-- Spinner Loading -->
    <div id="spvLoading" style="display:none; text-align:center; padding:10px;">
      <div class="spinner"></div>
      <p style="font-size:0.9rem; color:#555;">Memuat Data SPV</p>
    </div>

    <!-- Tabel Hasil -->
    <div class="table-wrapper">
      <table id="spvTable" border="1">
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Nama Order</th>
            <th>No KS</th>
            <th>Jam</th>
            <th>Keterangan Acuan</th>
            <th>Foto Acuan</th>
            <th>Keterangan Temuan</th>
            <th>Foto Temuan</th>
            <th>Nama QC</th>
            <th>Proses</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data diisi melalui JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>



</section>

<style>
/* ========== Spinner ========== */
.spinner {
  width: 28px;
  height: 28px;
  border: 3px solid #ddd;
  border-top: 3px solid #00BCD4;
  border-radius: 50%;
  margin: 0 auto;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ========== Tabel Dasar (Desktop) ========== */
.table-wrapper { width:100%; overflow-x:auto; }
#spvTable {
  width:100%;
  border-collapse:collapse;
  font-size:0.9rem;
  background:#fff;
}
#spvTable th, #spvTable td {
  border:1px solid #ddd;
  padding:8px 10px;
  text-align:center;
  vertical-align:middle;
}
#spvTable thead {
  background:#00BCD4;
  color:#fff;
}

/* Lebar kolom foto */
#spvTable th:nth-child(6),
#spvTable td:nth-child(6),
#spvTable th:nth-child(8),
#spvTable td:nth-child(8) {
  min-width:160px;
}

/* Input file */
#spvTable input[type="file"] {
  width:100%;
  max-width:160px;
  font-size:0.85rem;
  padding:4px;
  box-sizing:border-box;
  cursor:pointer;
}

/* Tombol umum (semua tombol) */
#spvTable button {
  padding: 6px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
  margin: 4px;
  color: #fff !important;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: 0.25s;
}

/* ======== Warna Tombol Edit / Simpan / Batal ======== */

/* Tombol Edit */
#spvTable .edit-btn {
  background: linear-gradient(135deg, #FFD740, #FFC400);
  color: #000 !important;
}
#spvTable .edit-btn:hover {
  background: linear-gradient(135deg, #FFEE58, #FFD740);
  transform: translateY(-2px);
}

/* Tombol Simpan */
#spvTable .save-btn {
  background: linear-gradient(135deg, #43A047, #66BB6A);
}
#spvTable .save-btn:hover {
  background: linear-gradient(135deg, #66BB6A, #81C784);
  transform: translateY(-2px);
}

/* Tombol Batal */
#spvTable .cancel-btn {
  background: linear-gradient(135deg, #E53935, #EF5350);
}
#spvTable .cancel-btn:hover {
  background: linear-gradient(135deg, #F44336, #E57373);
  transform: translateY(-2px);
}

/* Rata tengah semua kolom */
#spvTable th, #spvTable td { text-align:center; }

/* ========== HP ========== */
/* ===== SPV Mobile Responsive â€” Final ===== */
@media (max-width:768px){
  /* Semua elemen tabel diubah jadi block */
  #spvTable, #spvTable thead, #spvTable tbody, #spvTable th, #spvTable td, #spvTable tr {
    display:block;
  }
  #spvTable thead { display:none; }

  /* Setiap baris rapi */
  #spvTable tr {
    background:#fff;
    border:1px solid #ddd;
    border-radius:10px;
    margin-bottom:14px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:10px 12px;
  }

  /* Semua td: label di atas, rata kiri */
  #spvTable td {
    display:flex;
    flex-direction: column;
    align-items:flex-start;
    padding:6px 0;
    border-bottom:1px solid #eee;
    font-size:0.9rem;
    text-align:left;
    word-break:break-word;
  }
  #spvTable td:last-child { border-bottom:none; }

  /* Label di atas isi */
  #spvTable td::before {
    font-weight:600;
    color:#333;
    flex:0 0 auto;
    text-align:left;
    padding-bottom:4px; /* jarak label & isi */
  }

  /* Label sesuai kolom */
  #spvTable td:nth-child(1)::before { content:"Tanggal:"; }
  #spvTable td:nth-child(2)::before { content:"Nama Order:"; }
  #spvTable td:nth-child(3)::before { content:"No KS:"; }
  #spvTable td:nth-child(4)::before { content:"Jam:"; }
  #spvTable td:nth-child(5)::before { content:"Keterangan Acuan:"; }
  #spvTable td:nth-child(6)::before { content:"Foto Acuan:"; }
  #spvTable td:nth-child(7)::before { content:"Keterangan Temuan:"; }
  #spvTable td:nth-child(8)::before { content:"Foto Temuan:"; }
  #spvTable td:nth-child(9)::before { content:"Nama QC:"; }
  #spvTable td:nth-child(10)::before { content:"Proses:"; }
  #spvTable td:nth-child(11)::before { content:"Aksi:"; }

  /* Kolom Proses tetap rata kiri */
  #spvTable td:nth-child(10) {
    width:100%;
    flex-direction: column;
    align-items:flex-start;
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  /* Kolom Aksi â€” tombol & keterangan rata tengah */
  #spvTable td:nth-child(11) {
    width:100%;
    flex-direction: column;
    align-items:center;   /* rata tengah */
    text-align:center;    /* teks keterangan juga rata tengah */
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  /* Tombol Edit / Simpan / Batal di Aksi */
  #spvTable td:nth-child(11) button {
    width:80%;
    max-width:160px;
    margin:4px 0;
    display:block;
  }

  /* Input file menyesuaikan */
  #spvTable td input[type="file"] {
    width:100%;
    max-width:100%;
  }

  /* Textarea / input edit area */
  #spvTable tbody td input,
  #spvTable tbody td textarea {
    width:100%;
    box-sizing:border-box;
    padding:8px;
    border-radius:6px;
    border:1px solid #999;
    font-size:14px;
    resize: vertical;
    min-height:60px;
    max-height:200px;
    overflow-y:auto;
    text-align:left;
  }
}


/* ========== Frame & Search ========== */
.hasil-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 0 10px 20px;
  box-sizing: border-box;
}
.search-wrapper {
  width: 100%;
  margin-bottom: 16px;
}
.search-wrapper input {
  width: 100%;
  padding: 8px 12px;
  border: 1.5px solid #9c27b0;
  border-radius: 8px;
  font-size: 0.95rem;
  color: #333;
  outline: none;
}
@media (min-width: 769px) {
  .hasil-container { max-width: 100%; padding: 0; }
}

body {
  background:#f5f7fa;
  font-family:'Segoe UI', sans-serif;
}

/* ================================ */
/* QC SPV â€” Layout utama */
/* ================================ */
#qcSPV {
  display: flex;
  flex-direction: column;
  max-height: 80vh; /* sama seperti QC LEM */
  overflow: hidden;
}


/* ================================ */
/* JUDUL TETAP DI ATAS */
/* ================================ */
#qcSPV > h2 {
  position: sticky;
  top: 0;
  z-index: 100;
  background: inherit;
  margin-top: 0;
}


/* ================================ */
/* TAB INPUTAN / HASIL */
/* ================================ */
#qcSPV .tabs {
  position: sticky;
  top: 50px; /* pas di bawah judul */
  z-index: 99;
  background: #fff;
  padding: 6px 0;
  margin-bottom: 6px !important;
}


/* ================================ */
/* INPUT & HASIL â€” dapat scroll sendiri */
/* ================================ */
#spvInputSection,
#spvHasilSection {
  overflow-y: auto;
  max-height: calc(80vh - 120px);
  padding-right: 4px;
}


/* ================================ */
/* FILTER HASIL TETAP DI ATAS */
/* ================================ */
#spvHasilSection .search-wrapper {
  position: sticky;
  top: 0;
  z-index: 90;
  background: #fff;
  padding-top: 4px;
  padding-bottom: 4px;
  margin-bottom: 8px;
}


/* ================================ */
/* TABEL WRAPPER */
/* ================================ */
#spvHasilSection .table-wrapper {
  overflow-y: auto;
  max-height: calc(80vh - 180px);
  border: 1px solid #ddd;
}


/* HEADER TABEL IKUT STICKY */
#spvHasilSection table thead th {
  position: sticky;
  top: 0;
  background: #00BCD4;
  color: #fff;
  z-index: 89;
}

/* QC SPV â€” Agar hasil tetap rapi mengikuti enter + rata kiri */
#spvTable td {
  white-space: pre-line !important;
  text-align: left !important;
}

/* === Perbesar area edit SPV (input & textarea) === */
#spvTable tbody td input,
#spvTable tbody td textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #999;
  font-size: 14px;
  resize: vertical;     /* bisa ditarik ke bawah */
  min-height: 60px;      /* area edit jadi BESAR */
  max-height: 200px;     /* tetap tidak melebihi tabel */
  overflow-y: auto;      /* scroll di dalam, bukan scroll kanan tabel */
}

</style>

<script>
const spvNoKS = document.getElementById('spvNoKS');

if (spvNoKS) {
  spvNoKS.addEventListener('input', function() {
    let value = spvNoKS.value.toUpperCase().replace(/[^A-Z0-9]/g, ''); // hanya huruf & angka, uppercase

    if (value.length > 2) {
      value = value.slice(0,2) + '-' + value.slice(2);
    }

    if (value.length > 7) {
      value = value.slice(0,7) + '-' + value.slice(7); // sisanya bebas
    }

    spvNoKS.value = value;
  });
}
</script>




<!-- ======================== QC MEETING ======================== -->
<section id="qcMeeting" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #00BCD4, #4DD0E1); 
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px;
    margin-bottom:12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 1px solid #000;
    position: relative;
    overflow: hidden;
  ">
    MENU MEETING QC
    <span style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0));
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    "></span>
  </h2>

  <div class="tabs" style="display:flex; gap:8px; margin-bottom:10px;">
    <button class="tab-btn active" data-tab="meetingInputSection" onclick="showMeetingTab('input', this)">Inputan</button>
    <button class="tab-btn" data-tab="meetingHasilSection" onclick="showMeetingTab('hasil', this)">Hasil</button>
  </div>

  <!-- ========== INPUTAN ========== -->
  <div id="meetingInputSection" style="margin-top:10px;">
    <form id="meetingForm">

      <style>
        /* ===== Style Form QC Meeting ===== */
        #meetingForm .form-group { margin-bottom: 10px; }

        #meetingForm input[type="text"],
        #meetingForm input[type="date"],
        #meetingForm input[type="time"],
        #meetingForm textarea {
          width: 100%;
          padding: 0.6rem;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-size: 0.95rem;
          box-sizing: border-box;
        }

        #meetingForm button {
          width: 100%;
          padding: .6rem;
          background: #00BCD4;
          color: #fff;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 1rem;
        }
        #meetingForm button:hover { background: #00BCD4; }

        /* Tab Button */
        .tab-btn {
          flex: 1;
          padding: 6px 0;
          border-radius: 6px;
          font-weight: 600;
          cursor: pointer;
          border: 1px solid #000 !important;
          background: #e0e0e0 !important;
          color: #000 !important;
          transition: all 0.2s;
          text-align: center;
        }
        .tab-btn.active {
          background: linear-gradient(to right, #00BCD4, #4DD0E1) !important;
          color: #fff !important;
          border: 1px solid #000 !important;
        }
        .tab-btn:not(.active):hover {
          background: #B2EBF2 !important;
          color: #000 !important;
          transform: translateY(-1px);
          box-shadow: 0 2px 6px rgba(0,188,212,0.3);
        }
        .tab-btn:focus { outline:none; box-shadow:none; }

        /* Spinner overlay */
        #meetingSpinner {
          display: none;
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.4);
          z-index: 9999;
          align-items: center;
          justify-content: center;
        }
        #meetingSpinner div {
          width: 50px;
          height: 50px;
          border: 6px solid #fff;
          border-top-color: #00BCD4;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
      </style>

      <!-- SPINNER -->
      <div id="meetingSpinner"><div></div></div>

      <!-- Nama Meeting -->
      <div class="form-group">
        <label>Nama Meeting / Tema</label>
        <input type="text" id="meetingNama" placeholder="Meeting QC" required>
      </div>

      <!-- Tanggal & Jam -->
      <div class="form-group" style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Tanggal</label>
          <input type="date" id="meetingTanggal" required style="width:100%;">
        </div>
        <div style="flex:1;">
          <label>Jam</label>
          <input type="time" id="meetingJam" required style="width:100%;">
        </div>
      </div>

      <!-- Foto Permasalahan -->
      <div class="form-group">
        <label>Foto Permasalahan</label>
        <label for="meetingFoto">ðŸ“ Pilih File:</label>
        <input type="file" id="meetingFoto" accept="image/*">
      </div>

      <!-- Keterangan Foto -->
      <div class="form-group">
        <label>Keterangan Foto (opsional)</label>
        <textarea id="meetingKet" placeholder="Isi Keterangan" rows="3"></textarea>
      </div>

      <!-- Akar Masalah -->
      <div class="form-group">
        <label>Akar Masalah</label>
        <textarea id="meetingAkar" placeholder="Isi Keterangan" rows="2"></textarea>
      </div>

      <!-- Tindakan Perbaikan -->
      <div class="form-group">
        <label>Tindakan Perbaikan</label>
        <textarea id="meetingTindakan" placeholder="Isi Keterangan" rows="2"></textarea>
      </div>

      <!-- Catatan Tambahan -->
      <div class="form-group">
        <label>Catatan Tambahan (opsional)</label>
        <textarea id="meetingCatatan" placeholder="Isi Keterangan" rows="2"></textarea>
      </div>

      <!-- Peserta (checkbox, rapi) -->
      <div class="form-group">
        <label>Peserta</label>
        <div style="display:flex; flex-wrap:wrap; gap:10px;">
          <label><input type="checkbox" value="NANI"> NANI</label>
          <label><input type="checkbox" value="ANJANI"> ANJANI</label>
          <label><input type="checkbox" value="SUCI"> SUCI</label>
          <label><input type="checkbox" value="ANOM"> ANOM</label>
          <label><input type="checkbox" value="IRNA"> IRNA</label>
          <label><input type="checkbox" value="MARWAN"> MARWAN</label>
          <label><input type="checkbox" value="KIKI"> KIKI</label>
          <label><input type="checkbox" value="MARTINI"> MARTINI</label>
          <label><input type="checkbox" value="KRESTIN"> KRESTIN</label>
          <label><input type="checkbox" value="ISMIE"> ISMIE</label>
        </div>
      </div>


      <!-- Tombol Submit -->
      <div class="form-group">
        <button type="button" onclick="submitMeeting(event)">âž• Tambah Meeting</button>
      </div>
    </form>
  </div>

  <!-- ========== HASIL ========== -->
  <div id="meetingHasilSection" style="display:none;">
    <div class="hasil-container">
      <div class="search-wrapper">
        <input type="text" id="meetingSearch" placeholder="ðŸ” Pencarian">
      </div>

      <div id="meetingLoading" style="display:none; text-align:center; padding:10px;">
        <div class="spinner"></div>
        <p style="font-size:0.9rem; color:#555;">Memuat Data Meeting</p>
      </div>

      <div class="table-wrapper">
        <table id="meetingTable" border="1">
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Nama Meeting</th>
              <th>Jam</th>
              <th>Keterangan Foto</th>
              <th>Foto Permasalahan</th>
              <th>Akar Masalah</th>
              <th>Tindakan Perbaikan</th>
              <th>Catatan Tambahan</th>
              <th>Peserta</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data diisi melalui JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <style>
    /* ===== Spinner ===== */
    .spinner { width:28px; height:28px; border:3px solid #ddd; border-top:3px solid #00BCD4; border-radius:50%; margin:0 auto; animation:spin 0.8s linear infinite;}
    @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

    /* Table dasar */
    .table-wrapper { width:100%; overflow-x:auto; }
    #meetingTable { width:100%; border-collapse:collapse; font-size:0.9rem; background:#fff; }
    #meetingTable th, #meetingTable td { border:1px solid #ddd; padding:8px; text-align:center; vertical-align:middle; }
    #meetingTable thead { background:#00BCD4; color:#fff; }
    #meetingTable th:nth-child(5), #meetingTable td:nth-child(5) { min-width:160px; } /* Foto */
    #meetingTable input[type="file"] { width:100%; max-width:160px; font-size:0.85rem; padding:4px; cursor:pointer; }

    /* Tombol */
    #meetingTable button { padding:6px 12px; border:none; border-radius:8px; cursor:pointer; font-size:0.9rem; margin:4px; color:#fff; font-weight:600; box-shadow:0 2px 6px rgba(0,0,0,0.15); transition:0.25s; }
    #meetingTable .edit-btn { background: linear-gradient(135deg, #FFD740, #FFC400); color:#000 !important; }
    #meetingTable .edit-btn:hover { background: linear-gradient(135deg, #FFEE58, #FFD740); transform: translateY(-2px); }
    #meetingTable .save-btn { background: linear-gradient(135deg, #43A047, #66BB6A); }
    #meetingTable .save-btn:hover { background: linear-gradient(135deg, #66BB6A, #81C784); transform: translateY(-2px); }
    #meetingTable .cancel-btn { background: linear-gradient(135deg, #E53935, #EF5350); }
    #meetingTable .cancel-btn:hover { background: linear-gradient(135deg, #F44336, #E57373); transform: translateY(-2px); }

/* Mobile responsive â€” versi rapi, label di atas isi */
@media (max-width:768px){
  #meetingTable, #meetingTable thead, #meetingTable tbody, #meetingTable th, #meetingTable td, #meetingTable tr {
    display:block;
  }
  #meetingTable thead { display:none; }

  #meetingTable tr {
    background:#fff;
    border:1px solid #ddd;
    border-radius:10px;
    margin-bottom:14px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:10px 12px;
  }

  #meetingTable td {
    display:flex;
    flex-direction: column; /* label di atas isi */
    align-items: flex-start;
    padding:6px 0;
    border-bottom:1px solid #eee;
    font-size:0.9rem;
    text-align:left;
    word-break:break-word;
  }

  #meetingTable td:last-child { border-bottom:none; }

  /* Label di atas isi */
  #meetingTable td::before {
    font-weight:600;
    color:#333;
    flex:0 0 auto;
    text-align:left;
    padding-bottom:4px; /* jarak label & isi */
  }

  /* Label sesuai kolom */
  #meetingTable td:nth-child(1)::before { content:"Tanggal:"; }
  #meetingTable td:nth-child(2)::before { content:"Nama Meeting:"; }
  #meetingTable td:nth-child(3)::before { content:"Jam:"; }
  #meetingTable td:nth-child(4)::before { content:"Keterangan Foto:"; }
  #meetingTable td:nth-child(5)::before { content:"Foto Permasalahan:"; }
  #meetingTable td:nth-child(6)::before { content:"Akar Masalah:"; }
  #meetingTable td:nth-child(7)::before { content:"Tindakan Perbaikan:"; }
  #meetingTable td:nth-child(8)::before { content:"Catatan Tambahan:"; }
  #meetingTable td:nth-child(9)::before { content:"Peserta:"; }
  #meetingTable td:nth-child(10)::before { content:"Aksi:"; }

  /* Tombol Aksi â€” fleksibel & ukuran sama */
  #meetingTable td:nth-child(10) {
    width:100%;
    flex-direction: column;
    align-items:center;
    gap:6px;
    margin-top:4px;
    padding-top:4px;
    border-top:1px dashed #ddd;
  }

  #meetingTable td:nth-child(10) button {
    width:80%;
    max-width:160px;
    margin:4px 0;
  }

  /* Input file */
  #meetingTable td input[type="file"] { width:100%; max-width:100%; }

  /* Textarea / input edit area */
  #meetingTable tbody td input[type="text"],
  #meetingTable tbody td input[type="time"],
  #meetingTable tbody td input[type="date"],
  #meetingTable tbody td textarea {
    width:100%;
    box-sizing:border-box;
    padding:8px;
    border-radius:6px;
    border:1px solid #999;
    font-size:14px;
    resize: vertical;
    min-height:60px;
    max-height:200px;
    overflow-y:auto;
    text-align:left;
  }
}


    /* Sticky judul & tab */
    #qcMeeting > h2 { position: sticky; top: 0; z-index: 100; background: inherit; margin-top:0; }
    #qcMeeting .tabs { position: sticky; top: 50px; z-index: 99; background:#fff; padding:6px 0; margin-bottom:6px !important; }

    /* Scroll input & hasil */
    #meetingInputSection, #meetingHasilSection { overflow-y:auto; max-height:calc(80vh - 120px); padding-right:4px; }
    #meetingHasilSection .search-wrapper { position:sticky; top:0; z-index:90; background:#fff; padding-top:4px; padding-bottom:4px; margin-bottom:8px; }
    #meetingHasilSection .table-wrapper { overflow-y:auto; max-height:calc(80vh - 180px); border:1px solid #ddd; }
    #meetingHasilSection table thead th { position:sticky; top:0; background:#00BCD4; color:#fff; z-index:89; }

/* Agar hasil meeting tetap rapi dan rata kiri */
#meetingTable td {
  white-space: pre-line !important;
  text-align: left !important;
}

/* === Perbesar area edit di QC MEETING === */
#meetingTable tbody td input[type="text"],
#meetingTable tbody td input[type="time"],
#meetingTable tbody td input[type="date"],
#meetingTable tbody td textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #999;
  font-size: 14px;
  resize: vertical;
  min-height: 60px;
  max-height: 200px;
  overflow-y: auto;
  text-align: left !important;
}

/* Foto input */
#meetingTable tbody td input[type="file"] {
  width: 100%;
  max-width: 180px;
  padding: 6px;
  font-size: 13px;
  border-radius: 6px;
}

/* Kolom Peserta â€” dibuat lebar & rapi */
#meetingTable tbody td:nth-child(9) {
  min-width: 200px !important;
  white-space: pre-line !important;
  text-align: left !important;
}

/* Kolom Aksi â€” pusat & ukuran tetap */
#meetingTable tbody td:nth-child(10) {
  min-width: 130px !important;
  text-align: center !important;
}

/* ===== Tombol Share WA (samakan dengan tombol Edit) ===== */
#meetingTable .share-btn {
  background: linear-gradient(135deg, #29B6F6, #4FC3F7);
  color: #fff !important;
  padding: 4px 10px;        /* <<< ukuran yang sama seperti tombol Edit */
  font-size: 0.85rem;       /* <<< ukuran font tombol Edit */
  font-weight: 600;
  border: none;
  border-radius: 6px;       /* <<< sama dengan tombol Edit */
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  transition: 0.25s;
  margin: 2px;
  height: 30px;             /* <<< ini yang membuat benar-benar seragam */
}

#meetingTable .share-btn:hover {
  background: linear-gradient(135deg, #4FC3F7, #81D4FA);
  transform: translateY(-2px);
}

/* Mobile â€” ukuran tetap mengikuti tombol Edit */
@media (max-width: 768px) {
  #meetingTable td:nth-child(10) button.share-btn {
    width: auto;
    height: 34px;          /* match tombol Edit versi mobile */
    font-size: 0.85rem;
    margin: 4px 0;
  }
}

  </style>

  </section>









<!-- ======================== REPORT ======================== -->
<section id="reportSection" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center; 
    color:#000; 
    background: linear-gradient(to right, #3B82F6, #60A5FA);
    font-size:1.2rem; 
    padding:6px 12px; 
    border-radius:8px; 
    margin-bottom:10px;
  ">
    REPORT QC
  </h2>

  <div style="margin-bottom:12px;">
    <input 
      type="text" 
      id="reportSearchID" 
      placeholder="ðŸ” Masukkan No KS"
      oninput="searchReportByID()"
      style="
        width:100%;
        padding:10px;
        border:1px solid #ccc;
        border-radius:8px;
        font-size:0.95rem;
      "
    />
  </div>

  <div style="text-align:center; margin:12px 0;">
    <button id="previewReportBtn" style="
      padding:8px 20px;
      border:none;
      background: linear-gradient(to right,#3B82F6,#60A5FA);
      color:#fff;
      font-weight:600;
      border-radius:6px;
      cursor:pointer;
      font-size:0.95rem;
    ">
      Preview Report
    </button>
  </div>

  <div id="reportResult" style="padding:10px; border-radius:10px;"></div>

  <div id="reportPreviewModal" style="
    display:none;
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
    z-index:9999;
  ">
    <div style="
      background:#fff;
      max-width:900px;
      width:90%;
      max-height:90%;
      overflow:auto;
      border-radius:12px;
      padding:20px;
      position:relative;
      font-family:Arial, sans-serif;
    ">

      <div class="modal-header">
        REPORT QC
        <button id="closePreviewBtn" style="
          position:absolute;
          top:50%;
          right:12px;
          transform:translateY(-50%);
          background:#f87171;
          color:#fff;
          border:none;
          border-radius:6px;
          padding:4px 10px;
          cursor:pointer;
        ">âœ•</button>
      </div>

      <div style="text-align:center; margin-bottom:15px;">
        <button id="shareWaBtn" style="
          padding:8px 14px;
          background:#25D366;
          color:#fff;
          border:none;
          border-radius:6px;
          font-weight:600;
          cursor:pointer;
          margin-right:10px;
        ">Share WA</button>

        <button id="downloadPdfBtn" style="
          padding:8px 14px;
          background:#EF4444;
          color:#fff;
          border:none;
          border-radius:6px;
          font-weight:600;
          cursor:pointer;
        ">Download PDF</button>
      </div>

      <div id="previewContent" style="line-height:1.5;"></div>
    </div>
  </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
// ======================== DOWNLOAD PDF CEPAT + SPINNER LANGSUNG ========================
document.getElementById("downloadPdfBtn").addEventListener("click", () => {

  // ðŸ”¥ KONFIRMASI DOWNLOAD
  if (!confirm("Yakin ingin mendownload PDF laporan ini?")) return;

  const btn = document.getElementById("downloadPdfBtn");
  const originalText = btn.innerHTML;

  // tampilkan spinner / disable tombol
  btn.disabled = true;
  btn.innerHTML = "Generating PDF... â³";

  // jalankan generate PDF setelah browser sempat render spinner
  setTimeout(() => {
    // wrapper PDF
    const pdfWrapper = document.createElement("div");
    pdfWrapper.style.padding = "8px";
    pdfWrapper.style.boxSizing = "border-box";

    const sections = [...previewContent.querySelectorAll(".section-title")];

    sections.forEach((section, idx) => {
      const secDiv = document.createElement("div");
      secDiv.className = section.className + " section-title";
      secDiv.innerHTML = section.innerHTML;
      if(idx !== 0) secDiv.style.pageBreakBefore = "always";
      pdfWrapper.appendChild(secDiv);

      let next = section.nextElementSibling;
      let cardCount = 0;

      while(next && !next.classList.contains("section-title")){
        if(next.classList.contains("report-card")){
          const card = next.cloneNode(true);

          // styling PDF ringan â†’ hilangkan shadow & border-radius
          card.style.pageBreakInside = "avoid";
          card.style.marginBottom = "4px";
          card.style.fontSize = "0.8rem";
          card.querySelectorAll("h3").forEach(h => h.style.fontSize = "0.9rem");

          card.style.maxWidth = "calc(100% - 4px)";
          card.style.boxSizing = "border-box";
          card.style.boxShadow = "none";
          card.style.borderRadius = "4px";

          pdfWrapper.appendChild(card);
          cardCount++;

          if(cardCount % 4 === 0){
            const pb = document.createElement("div");
            pb.style.pageBreakAfter = "always";
            pdfWrapper.appendChild(pb);
          }
        }
        next = next.nextElementSibling;
      }
    });

    // style PDF
    const style = document.createElement("style");
    style.innerHTML = `
      body, div { font-family: Arial, sans-serif; box-sizing: border-box; }
      body { padding: 8px; }
      .section-title { font-weight:700; padding:6px 0; font-size:1rem; text-align:center; border-radius:4px; margin:12px 0 4px; page-break-after: avoid; }
      .report-card { border:1px solid #e2e8f0; padding:4px 6px; margin-bottom:4px; page-break-inside: avoid; max-width:calc(100% - 4px); box-sizing:border-box; }
      .report-card h3 { font-size:0.9rem; font-weight:700; margin-bottom:3px; color:#1e293b; border-bottom:1px solid #e2e8f0; padding-bottom:2px; text-align:center; }
      .report-field { margin:1px 0; font-size:0.75rem; color:#334155; }
      .report-status { display:inline-block; margin-top:2px; padding:2px 4px; border-radius:4px; font-weight:700; color:#000; }
      .report-percentage div { margin-top:2px; font-weight:600; font-size:0.75rem; }
      .ket-list div { margin-left:4px; line-height:1.2; color:#475569; }
      .pending { background:#f8d7da; color:#721c24; }
      .done { background:#d4edda; color:#155724; }
      .proses { background:#fff3cd; color:#856404; }
    `;
    pdfWrapper.prepend(style);

    // generate PDF
    html2pdf().set({
      margin: 15,
      filename:'report-qc.pdf',
      image:{type:'jpeg', quality:0.85},
      html2canvas:{scale:1.2, logging:false},
      jsPDF:{unit:'mm', format:'a4', orientation:'portrait'}
    }).from(pdfWrapper).save().then(() => {
      // selesai â†’ kembalikan tombol
      btn.disabled = false;
      btn.innerHTML = originalText;
    });

  }, 50);
});


// ======================== Tombol Preview ========================
document.getElementById("previewReportBtn").addEventListener("click", () => {
  document.getElementById("reportPreviewModal").style.display = "flex";
});

// ======================== Close Preview Modal ========================
document.getElementById("closePreviewBtn").addEventListener("click", () => {
  document.getElementById("reportPreviewModal").style.display = "none";
});


// ======================== Tombol Share WA ========================
document.getElementById("shareWaBtn").addEventListener("click", () => {

  // ðŸ”¥ KONFIRMASI SHARE WA
  if (!confirm("Bagikan laporan ini ke WhatsApp?")) return;

  const sections = previewContent.querySelectorAll(".section-title");

  const headerLine = "==============================";

  let text = `${headerLine}\n                         *REPORT QC*\n${headerLine}\n\n`;

  sections.forEach(section => {
    const line = "====================";
    const title = section.innerText.trim();

    text += `${line}\n*${title}*\n${line}\n\n`;

    let next = section.nextElementSibling;
    while (next && !next.classList.contains("section-title")) {

      if (next.classList.contains("report-card")) {
        const lines = next.innerText.trim().split("\n");

        lines.forEach(l => {
          const trimmed = l.trim();

          if (/^Keterangan:?$/i.test(trimmed)) {
            text += `* ${trimmed}\n`;
            return;
          }

          if (/^\d+\./.test(trimmed)) {
            text += `        ${trimmed}\n`;
          } else {
            text += `* ${trimmed}\n`;
          }
        });

        text += "\n";
      }

      next = next.nextElementSibling;
    }

    text += "\n";
  });

  const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
});





</script>

<script>
// ===========================================
// AUTO FOCUS SAAT MENU REPORT DIBUKA
// ===========================================
const reportSection = document.getElementById("reportSection");
const reportInput = document.getElementById("reportSearchID");

// Observer untuk mendeteksi saat reportSection ditampilkan
const obs = new MutationObserver(() => {
  if (reportSection.style.display !== "none") {
    setTimeout(() => {
      reportInput.focus();
      reportInput.select(); // pilih isi kalau ada
    }, 50);
  }
});

// Pantau perubahan style
obs.observe(reportSection, { attributes: true, attributeFilter: ["style"] });
</script>








<style>
/* ======================== REPORT CARD GRID ======================== */
#reportResult {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  margin-top: 10px;
}

#reportResult .grid-card {
  background: #f3f4f6;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  transition: transform 0.2s, box-shadow 0.2s;
}

#reportResult .grid-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.12);
}

#reportResult .grid-card h3 {
  margin: 0 0 10px;
  font-size: 1.15rem;
  font-weight: 700;
  color: #1e293b;
}

#reportResult .grid-card p {
  margin: 4px 0;
  font-size: 0.95rem;
  color: #334155;
}

#reportResult .grid-card .ket-list div {
  margin-left: 8px;
  line-height: 1.35;
  color: #475569;
}

#reportResult .grid-card div[style*="STATUS:"] {
  display: inline-block;
  margin-top: 10px;
  padding: 6px 12px;
  border-radius: 6px;
  color: #fff;
  font-weight: 700;
  font-size: 0.95rem;
  white-space: nowrap;
}

#reportResult .section-title {
  grid-column: 1 / -1;
  font-size: 1.2rem;
  font-weight: 700;
  text-align: center;
  padding: 6px 12px;
  border-radius: 8px;
  margin-top: 20px;
  margin-bottom: 6px;
  color: #000;
}

#reportResult .cetak-title { background: linear-gradient(to right, #FF9800, #FFB74D); }
#reportResult .lem-title { background: linear-gradient(to right, #9C27B0, #BA68C8); }
#reportResult .finishing-title { background: linear-gradient(to right, #22C55E, #4ADE80); }

/* ======================== REPORT RAPIH (MODAL PREVIEW) ======================== */
.report-card {
  background:#fff;
  border:1px solid #e2e8f0;
  border-radius:8px;
  padding:14px 16px;
  margin-bottom:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

.report-card h3 {
  font-size:1.1rem;
  font-weight:700;
  margin-bottom:8px;
  color:#1e293b;
  border-bottom:1px solid #e2e8f0;
  padding-bottom:4px;
  text-align:center;
}

.report-field {
  margin:4px 0;
  font-size:0.95rem;
  color:#334155;
}

.report-status {
  display:inline-block;
  margin-top:8px;
  padding:6px 12px;
  border-radius:6px;
  font-weight:700;
  color:#000;
}

.report-percentage {
  margin-top:6px;
  font-weight:600;
  font-size:0.95rem;
}

.ket-list div {
  margin-left:10px;
  line-height:1.35;
  color:#475569;
}

/* ======================== HEADER MODAL PREVIEW ======================== */
.modal-header {
  text-align: center;
  color: #000;
  background: linear-gradient(to right, #3B82F6, #60A5FA);
  font-size: 1.2rem;
  padding: 6px 12px;
  border-radius: 8px;
  margin-bottom: 25px;
  font-weight: 700;
  position: relative;
}

/* Responsive */
@media screen and (max-width: 768px) {
  #reportResult { grid-template-columns: 1fr; gap: 12px; }
  #reportResult .grid-card { padding: 12px; }
  #reportResult .grid-card h3 { font-size: 1.05rem; }
  #reportResult .grid-card p { font-size: 0.9rem; }
  #reportResult .section-title { font-size: 1.1rem; }
}

/* Modal preview section title */
#reportPreviewModal .section-title {
  font-size: 1.2rem;
  font-weight: 700;
  text-align: center;
  padding: 6px 12px;
  border-radius: 8px;
  margin-top: 12px;
  margin-bottom: 6px;
  color: #fff;
}

#reportPreviewModal .cetak-title { background: linear-gradient(to right, #FF9800, #FFB74D); }
#reportPreviewModal .lem-title { background: linear-gradient(to right, #9C27B0, #BA68C8); }
#reportPreviewModal .finishing-title { background: linear-gradient(to right, #22C55E, #4ADE80); }

</style>


<script>
// ======================== HELPER ========================
function formatNumber(num) {
  if(num===undefined || num===null || num==="-" ) return "-";
  const n = Number(num);
  if(isNaN(n)) return num;
  return n.toLocaleString('id-ID');
}

const reportSearchID = document.getElementById("reportSearchID");
reportSearchID.addEventListener('input', function() {
  let value = reportSearchID.value.toUpperCase().replace(/[^A-Z0-9]/g,'');
  if(value.length>2) value = value.slice(0,2)+'-'+value.slice(2);
  if(value.length>7) value = value.slice(0,7)+'-'+value.slice(7);
  reportSearchID.value = value;
});

function normalizeKet(rawText="") {
  const map={1:"-",2:"-",3:"-",4:"-",5:"-"};
  if(rawText){ rawText.split(/\r?\n/).forEach(line=>{
    const m=line.match(/^\s*(\d+)\.\s*(.*)/);
    if(m){ const no=parseInt(m[1]); if(no>=1&&no<=5) map[no]=m[2].trim()||"-"; }
  }); }
  return map;
}

function getStatusColor(updateVal=""){
  const s=(updateVal||"").toLowerCase();
  if(s==="proses") return "#FB923C";
  if(s==="selesai") return "#4ADE80";
  if(s==="pending") return "#F87171";
  return "#94A3B8";
}

// ======================== RENDER CARD GRID ========================
function renderCard(title, item, extraFields="", processType="cetak"){
  if(!item?.noKS){
    return `<div class="grid-card"><h3>${title}</h3><p><b>No KS:</b> <i style='color:#f59e0b;'>Proses belum ada</i></p></div>`;
  }
  const color = getStatusColor(item?.update);
  const k = normalizeKet(item?.keterangan);
  const order = Number(item?.order) || 0;
  const mesin = item?.mesin||"-";

  let bagus=0,sortir=0,problem=0,totalBS=0;
  if(processType==="cetak"){ bagus=Number(item?.bagus)||0; sortir=Number(item?.sortir)||0; problem=Number(item?.problem)||0; }
  else{ bagus=Number(item?.bagus)||0; totalBS=Number(item?.lemJenisBS||item?.jenisBS||0); }

  const hasilPerc=order?((bagus/order)*100).toFixed(1):"-";
  const wastePerc=order?((processType==="cetak"?((sortir+problem)/order)*100:(totalBS/order)*100).toFixed(1)):"-";

  return `
    <div class="grid-card">
      <h3>${title}</h3>
      <p><b>Tanggal:</b> ${item?.tanggal||"-"}</p>
      <p><b>No KS:</b> ${item.noKS}</p>
      <p><b>Nama Order:</b> ${item?.nama||"-"}</p>
      <p><b>Order:</b> ${formatNumber(order)}</p>
      ${extraFields||""}
      <p><b>Mesin:</b> ${mesin}</p>
      <p><b>QC:</b> ${item?.qc||"-"}</p>
      <p><b>Keterangan:</b></p>
      <div class="ket-list">
        <div>1. ${k[1]}</div>
        <div>2. ${k[2]}</div>
        <div>3. ${k[3]}</div>
        <div>4. ${k[4]}</div>
        <div>5. ${k[5]}</div>
      </div>
      <div style="display:inline-block;margin-top:10px;padding:6px 12px;border-radius:6px;color:#000;font-weight:700;background:${color};">
        STATUS: ${item?.update||"-"}
      </div>
      <div style="margin-top:6px;font-weight:600;font-size:0.95rem;">
        <p><b>Hasil (%):</b> ${hasilPerc} %</p>
        <p><b>Waste (%):</b> ${wastePerc} %</p>
      </div>
    </div>`;
}

// ======================== RENDER CARD PREVIEW ========================
function renderCardReport(title,item,extraFields="",processType="cetak"){
  if(!item?.noKS){
    return `<div class="report-card"><h3>${title}</h3><div class="report-field"><b>No KS:</b> <i style='color:#f59e0b;'>Proses belum ada</i></div></div>`;
  }
  const color=getStatusColor(item?.update);
  const k=normalizeKet(item?.keterangan);
  const order=Number(item?.order)||0;
  const mesin=item?.mesin||"-";

  let bagus=0,totalBS=0,sortir=0,problem=0;
  if(processType==="cetak"){ bagus=Number(item?.bagus)||0; sortir=Number(item?.sortir)||0; problem=Number(item?.problem)||0; }
  else{ bagus=Number(item?.bagus)||0; totalBS=Number(item?.lemJenisBS||item?.jenisBS||0); }

  const hasilPerc=order?((bagus/order)*100).toFixed(1):"-";
  const wastePerc=order?((processType==="cetak"?((sortir+problem)/order)*100:(totalBS/order)*100).toFixed(1)):"-";

  return `
  <div class="report-card">
    <h3>${title}</h3>
    <div class="report-field"><b>Tanggal:</b> ${item?.tanggal||"-"}</div>
    <div class="report-field"><b>No KS:</b> ${item.noKS}</div>
    <div class="report-field"><b>Nama Order:</b> ${item?.nama||"-"}</div>
    <div class="report-field"><b>Order:</b> ${formatNumber(order)}</div>
    ${extraFields||""}
    <div class="report-field"><b>Mesin:</b> ${mesin}</div>
    <div class="report-field"><b>QC:</b> ${item?.qc||"-"}</div>
    <div class="report-field"><b>Keterangan:</b></div>
    <div class="ket-list">
      <div>1. ${k[1]}</div>
      <div>2. ${k[2]}</div>
      <div>3. ${k[3]}</div>
      <div>4. ${k[4]}</div>
      <div>5. ${k[5]}</div>
    </div>
    <div class="report-status" style="background:${color}">STATUS: ${item?.update||"-"}</div>
    <div class="report-percentage">
      <div><b>Hasil (%):</b> ${hasilPerc} %</div>
      <div><b>Waste (%):</b> ${wastePerc} %</div>
    </div>
  </div>`;
}

// ======================== SEARCH REPORT ========================
function searchReportByID(){
  const key=reportSearchID.value.trim().toLowerCase();
  const box=document.getElementById("reportResult");
  if(!key){ box.innerHTML=""; return; }

  const cetakItems=paItems.filter(x=> (x.noKS||"").toLowerCase()===key);
  const lemItemsMatch=lemItems.filter(x=> (x.noKS||"").toLowerCase()===key);
  const finishingItemsMatch=finishingItems.filter(x=> (x.noKS||"").toLowerCase()===key);

  let html="";
  html+=`<div class="section-title cetak-title">CETAK</div>`;
  html+=cetakItems.length? cetakItems.map(i=>renderCard("",i,`
    <p><b>Bagus:</b> ${formatNumber(i?.bagus)}</p>
    <p><b>Sortir:</b> ${formatNumber(i?.sortir)}</p>
    <p><b>Problem:</b> ${formatNumber(i?.problem)}</p>`,"cetak")).join('') : renderCard("",{update:"Proses"});

  html+=`<div class="section-title lem-title">LEM</div>`;
  html+=lemItemsMatch.length? lemItemsMatch.map(i=>renderCard("",i,`
    <p><b>Isi/Dus:</b> ${formatNumber(i?.isi)}</p>
    <p><b>Bagus:</b> ${formatNumber(i?.bagus)}</p>
    <p><b>Total BS:</b> ${formatNumber(i?.lemJenisBS)}</p>`,"lem")).join('') : renderCard("",{update:"Proses"});

  html+=`<div class="section-title finishing-title">FINISHING</div>`;
  html+=finishingItemsMatch.length? finishingItemsMatch.map(i=>renderCard("",i,`
    <p><b>Isi/Dus:</b> ${formatNumber(i?.isi)}</p>
    <p><b>Bagus:</b> ${formatNumber(i?.bagus)}</p>
    <p><b>Total BS:</b> ${formatNumber(i?.jenisBS)}</p>`,"finishing")).join('') : renderCard("",{update:"Proses"});

  box.innerHTML=html;
}

// ======================== PREVIEW REPORT ========================
const previewBtn=document.getElementById("previewReportBtn");
const modal=document.getElementById("reportPreviewModal");
const closeBtn=document.getElementById("closePreviewBtn");
const previewContent=document.getElementById("previewContent");

previewBtn.addEventListener("click",()=>{
  const key=reportSearchID.value.trim().toLowerCase();
  if(!key) return;
  let html="";

  // CETAK
  html+=`<div class="section-title cetak-title">CETAK</div>`;
  const cetakItems=paItems.filter(x=> (x.noKS||"").toLowerCase()===key);
  html+=cetakItems.length? cetakItems.map(i=>renderCardReport("",i,`
    <div class="report-field"><b>Bagus:</b> ${formatNumber(i?.bagus)}</div>
    <div class="report-field"><b>Sortir:</b> ${formatNumber(i?.sortir)}</div>
    <div class="report-field"><b>Problem:</b> ${formatNumber(i?.problem)}</div>`,"cetak")).join('') : renderCardReport("",{update:"Proses"});

  // LEM
  html+=`<div class="section-title lem-title">LEM</div>`;
  const lemItemsMatch=lemItems.filter(x=> (x.noKS||"").toLowerCase()===key);
  html+=lemItemsMatch.length? lemItemsMatch.map(i=>renderCardReport("",i,`
    <div class="report-field"><b>Isi/Dus:</b> ${formatNumber(i?.isi)}</div>
    <div class="report-field"><b>Bagus:</b> ${formatNumber(i?.bagus)}</div>
    <div class="report-field"><b>Total BS:</b> ${formatNumber(i?.lemJenisBS)}</div>`,"lem")).join('') : renderCardReport("",{update:"Proses"});

  // FINISHING
  html+=`<div class="section-title finishing-title">FINISHING</div>`;
  const finishingItemsMatch=finishingItems.filter(x=> (x.noKS||"").toLowerCase()===key);
  html+=finishingItemsMatch.length? finishingItemsMatch.map(i=>renderCardReport("",i,`
    <div class="report-field"><b>Isi/Dus:</b> ${formatNumber(i?.isi)}</div>
    <div class="report-field"><b>Bagus:</b> ${formatNumber(i?.bagus)}</div>
    <div class="report-field"><b>Total BS:</b> ${formatNumber(i?.jenisBS)}</div>`,"finishing")).join('') : renderCardReport("",{update:"Proses"});

  previewContent.innerHTML=html;
  modal.style.display="flex";
});

closeBtn.addEventListener("click",()=>{ modal.style.display="none"; });
window.addEventListener("click",e=>{ if(e.target===modal) modal.style.display="none"; });
</script>












<!-- =========================================
      ðŸŸ¦ FLOATING CHATBOT 3D + MODAL AI
========================================= -->
<div class="chatbot-wrapper" onclick="openMenuModal()">
  <div class="chatbot-bg pulse-lines">
    <div class="bg-light"></div>

    <!-- Robot -->
    <div class="chatbot-body robot">
      <div class="chatbot-face" id="cbFace">
        <div class="reflection"></div>
        <div class="eye left"></div>
        <div class="eye right"></div>
        <div class="smile"></div>
      </div>
    </div>

    <!-- Text AI -->
    <div class="chatbot-text" id="cbText">
      AI
      <div class="flare"></div>
    </div>
  </div>
</div>

<!-- =========================================
      ðŸŸ§ MODAL PILIH AI
========================================= -->
<div id="menuModal" class="pw-modal" style="display:none;">
  <div class="pw-modal__dialog modal-menu">
    <h3>Pilih Asisten AI QC</h3>
    <div class="menu-btns">
      <button class="menu-ai-btn" data-ai="bapro">AI QC BAPRO</button>
      <button class="menu-ai-btn" data-ai="cetak">AI QC CETAK</button>
      <button class="menu-ai-btn" data-ai="finishing">AI QC FINISHING</button>
      <button class="menu-ai-btn" data-ai="lem">AI QC LEM</button>
      <button class="menu-ai-btn" data-ai="register">AI QC REGISTER</button>
    </div>
    <div class="menu-cancel">
      <button id="menuCloseBtn">Batal</button>
    </div>
  </div>
</div>

<!-- =========================================
      ðŸŸ§ PASSWORD MODAL
========================================= -->
<div id="pwModal" class="pw-modal" aria-hidden="true" style="display:none;">
  <div class="pw-modal__dialog modal-pw">
    <h3>Password AI</h3>
    <input id="pwInput" type="password" placeholder="Masukkan password" autocomplete="off" />
    <div class="pw-actions">
      <button id="pwOk">Buka</button>
      <button id="pwCancel">Batal</button>
    </div>
    <p class="pw-note">Gunakan AI dengan bijak.</p>
  </div>
</div>

<!-- =========================================
      ðŸŸ¦ SCRIPT PASSWORD + ROBOT ANIM
========================================= -->
<script>
const AI_CONFIG = {
  bapro:      { pass: "spv123", url: "https://www.chatbase.co/chatbot-iframe/Ow6RgaAkkBqt6viAupxxm" },
  cetak:      { pass: "spv123", url: "https://www.chatbase.co/chatbot-iframe/xC4UNODh6Z_N6c5NrdqnJ" },
  finishing:  { pass: "spv123", url: "https://www.chatbase.co/chatbot-iframe/h8G0LYCfSqbKPrEGZO91-" },
  lem:        { pass: "spv123", url: "https://www.chatbase.co/chatbot-iframe/Bg84DJJ43GDzYAbU9o30O" },
  register:   { pass: "spv123", url: "https://www.chatbase.co/chatbot-iframe/HOzp5h4l66C3iJbun33x-" }
};

let selectedAI = null;

/* ========== OPEN / CLOSE MODAL ========== */
function openMenuModal() {
  document.getElementById("menuModal").style.display = "flex";
}
document.getElementById("menuCloseBtn").onclick = () => {
  document.getElementById("menuModal").style.display = "none";
};

/* ========== PILIH AI ========== */
document.querySelectorAll(".menu-ai-btn").forEach(btn => {
  btn.onclick = () => {
    selectedAI = btn.dataset.ai;
    document.getElementById("menuModal").style.display = "none";
    document.getElementById("pwModal").style.display = "flex";
    document.getElementById("pwInput").focus();
  };
});

/* ========== PASSWORD VALIDATE ========== */
document.getElementById("pwOk").onclick = validatePw;
document.getElementById("pwCancel").onclick = closePw;

function validatePw() {
  const input = document.getElementById("pwInput").value.trim();
  if (!selectedAI) return;

  if (input === AI_CONFIG[selectedAI].pass) {
    window.open(AI_CONFIG[selectedAI].url, "_blank");
    closePw();
  } else {
    alert("Password salah!");
    document.getElementById("pwInput").value = "";
    document.getElementById("pwInput").focus();
  }
}

function closePw() {
  document.getElementById("pwModal").style.display = "none";
  document.getElementById("pwInput").value = "";
}

/* ========== ENTER / ESCAPE ========== */
document.getElementById("pwInput").addEventListener("keydown", e => {
  if (e.key === "Enter") validatePw();
  if (e.key === "Escape") closePw();
});

/* ========== FACE â†” TEXT LOOP ========== */
let showFace = true;
function swapFaceText() {
  const face = document.getElementById("cbFace");
  const text = document.getElementById("cbText");
  if (showFace) {
    face.style.opacity = "0";
    text.style.opacity = "1";
  } else {
    text.style.opacity = "0";
    face.style.opacity = "1";
  }
  showFace = !showFace;
  setTimeout(swapFaceText, 2600);
}
setTimeout(swapFaceText, 1500);
</script>

<!-- =========================================
      ðŸŸ¦ CSS ROBOT + MODAL
========================================= -->
<style>
/* ================== MODAL STYLE ================== */
.pw-modal {
  position: fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(4px);
  z-index:99999;
}
.pw-modal__dialog {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  min-width: 280px;
  max-width: 420px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.25);
  animation: fadeIn 0.25s ease;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}
@keyframes fadeIn { from {opacity:0; transform:scale(0.85);} to{opacity:1; transform:scale(1);} }

/* ========== MODAL MENU AI ========== */
.modal-menu h3 { margin-bottom:16px; font-size:1.2rem; text-align:center; color:#222; }
.menu-btns { display:flex; flex-direction:column; gap:10px; }
.menu-ai-btn {
  padding:12px 0; border:none; border-radius:10px; font-weight:700; font-size:1rem; cursor:pointer;
  transition: all 0.25s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color:#fff;
}
.menu-ai-btn[data-ai="bapro"] { background: linear-gradient(90deg,#ff4b4b,#ff7474); }
.menu-ai-btn[data-ai="cetak"] { background: linear-gradient(90deg,#ff9800,#ffc071); color:#000; }
.menu-ai-btn[data-ai="finishing"] { background: linear-gradient(90deg,#4caf50,#7cd98a); }
.menu-ai-btn[data-ai="lem"] { background: linear-gradient(90deg,#9b59b6,#c18cd9); }
.menu-ai-btn[data-ai="register"] { background: linear-gradient(90deg,#00cfff,#62f0ff); color:#000; }
.menu-ai-btn:hover { transform:translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,0.2); }

.menu-cancel {
  margin-top: 14px;
  text-align: center;
}

.menu-cancel button {
  padding: 8px 16px;
  border: none;
  border-radius: 10px;
  background: #000;           /* HITAM */
  color: #fff;                /* Teks putih agar jelas */
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
}

.menu-cancel button:hover {
  background: #333;           /* Abu gelap saat hover */
  color: #fff;
}


/* ========== MODAL PASSWORD ========== */
.modal-pw h3 { text-align:center; margin-bottom:14px; font-size:1.2rem; }
.modal-pw input {
  width:100%; padding:10px 12px; border-radius:10px; border:1px solid #ccc; margin-bottom:12px;
  font-size:1rem; transition: border 0.25s ease, box-shadow 0.25s ease;
}
.modal-pw input:focus { outline:none; border-color:#1976D2; box-shadow: 0 0 6px rgba(25,118,210,0.5); }
.pw-actions { display:flex; justify-content:space-between; gap:10px; }
.pw-actions button { flex:1; padding:10px 0; border:none; border-radius:10px; font-weight:700; cursor:pointer; transition: all 0.25s ease; }
#pwOk { background:#1976D2; color:#fff; }
#pwOk:hover { background:#145ca8; }
#pwCancel { background:#eee; }
#pwCancel:hover { background:#ccc; }
.pw-note { margin-top:12px; font-size:12px; text-align:center; color:#555; }

/* ========== ROBOT CSS FULL ================== */
.chatbot-wrapper {
  position: fixed; 
  bottom: 80px; 
  right: 20px; 
  width:78px; 
  height:78px; 
  border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #4b68ff, #1c2ca5); 
  display:flex; 
  align-items:center; 
  justify-content:center;
  box-shadow:0 8px 25px rgba(80,120,255,0.55); 
  cursor:pointer; 
  z-index:9999; 
  overflow:hidden;
  transition: transform 0.4s ease, box-shadow 0.4s ease; 
  animation: idleFloat 5s ease-in-out infinite;
}
.chatbot-wrapper:hover { transform: scale(1.12) rotate3d(1,1,0,6deg); }
.chatbot-wrapper::after { content:""; position:absolute; bottom:-6px; width:50%; height:10px; background: rgba(0,0,0,0.25); border-radius:50%; filter: blur(8px); animation: shadowMove 5s ease-in-out infinite; }

.chatbot-bg { width:62px; height:62px; position:relative; border-radius:50%; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.pulse-lines::before { content:""; position:absolute; width:200%; height:200%; background: repeating-conic-gradient(from 0deg, rgba(255,255,255,0.18) 0deg, rgba(255,255,255,0) 12deg); animation:pulseLines 6s linear infinite; opacity:0.4; }
.bg-light { position:absolute; width:200%; height:200%; background: conic-gradient(from 0deg, #6e8cff,#3b56ff,#6e8cff); animation:rotateLight 8s linear infinite; opacity:0.25; }
.chatbot-body { position:relative; width:40px; height:42px; background: linear-gradient(145deg,#f8faff,#cad3ff); border-radius:18px; box-shadow: inset 0 -4px 10px rgba(0,0,0,0.15),0 3px 6px rgba(0,0,0,0.1); display:flex; align-items:center; justify-content:center; animation:heartbeatGlow 4s ease-in-out infinite; }

.chatbot-face { width:30px; height:20px; background: linear-gradient(180deg,#193bff 0%,#132cad 100%); border-radius:10px; position:relative; overflow:hidden; box-shadow: inset 0 0 8px rgba(255,255,255,0.25); opacity:1; transition:opacity .55s ease; }
.reflection { position:absolute; top:0; left:-40px; width:35px; height:20px; background:linear-gradient(100deg, transparent 0%, rgba(255,255,255,0.5) 50%, transparent 100%); transform:skewX(-20deg); animation: reflectionMove 4.5s ease-in-out infinite; opacity:0.35; }
.eye { position:absolute; top:5px; width:5px; height:5px; background:radial-gradient(circle,#8cd2ff 40%,#3d7eff 100%); border-radius:50%; animation: blink 6s infinite, lookAround 5s ease-in-out infinite; transition: transform 0.2s ease; }
.eye.left { left:6px; } .eye.right { right:6px; }
.chatbot-wrapper:hover .eye { transform: scale(1.25); }
.smile { position:absolute; bottom:2px; left:50%; transform:translateX(-50%); width:12px; height:5px; border-bottom:2px solid #6cb0ff; border-radius:0 0 10px 10px; animation:smileWiden 3s ease-in-out infinite; transition:width 0.2s ease; }
.chatbot-wrapper:hover .smile { width:18px; }
.chatbot-text { position:absolute; font-size:18px; font-weight:bold; color:#1976D2; text-shadow:0 0 8px rgba(255,255,255,0.8); opacity:0; transition:opacity .55s ease; }
.flare { position:absolute; width:140%; height:140%; background:radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 70%); border-radius:50%; top:-20%; left:-20%; transform:scale(0); opacity:0; animation:flarePulse 6s ease-in-out infinite; }

/* ========================== ROBOT MINI UNTUK HP ========================== */
@media only screen and (max-width: 768px) {
  .chatbot-wrapper {
    bottom: 70px;
    right: 15px;
    width: 55px;
    height: 55px;
  }

  .chatbot-bg { width:42px; height:42px; }
  .chatbot-body { width:28px; height:30px; border-radius:14px; }
  .chatbot-face { width:20px; height:14px; border-radius:7px; }
  .reflection { width:22px; height:14px; left:-28px; }
  .eye { width:3px; height:3px; top:3px; }
  .eye.left { left:4px; } 
  .eye.right { right:4px; }
  .smile { width:8px; height:3px; bottom:1.5px; border-radius:0 0 7px 7px; }
  .chatbot-wrapper:hover .smile { width:12px; }
  .chatbot-text { font-size:13px; }
}

/* ========================== Animasi robot ========================== */
@keyframes idleFloat{0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);} }
@keyframes shadowMove{0%,100%{transform:scale(1);}50%{transform:scale(1.25);} }
@keyframes rotateLight{from{transform:rotate(0);}to{transform:rotate(360deg);} }
@keyframes pulseLines{from{transform:rotate(0);}to{transform:rotate(-360deg);} }
@keyframes heartbeatGlow{0%,100%{box-shadow:0 0 4px rgba(70,140,255,0.28);}50%{box-shadow:0 0 12px rgba(70,140,255,0.45);} }
@keyframes reflectionMove{0%,100%{left:-40px;}50%{left:35px;} }
@keyframes blink{0%,94%,100%{height:5px;}96%{height:1.5px;} }
@keyframes lookAround{0%,100%{transform:translateX(0);}25%{transform:translateX(1.3px);}75%{transform:translateX(-1.3px);} }
@keyframes smileWiden{0%,100%{width:12px;}50%{width:16px;} }
@keyframes flarePulse{0%,40%{transform:scale(0);opacity:0;}50%{transform:scale(1.2);opacity:0.6;filter:blur(4px);}70%{transform:scale(1);opacity:0.3;}90%,100%{transform:scale(0);opacity:0;} }

</style>







<!-- ======================== SPINNER GLOBAL ======================== -->
<div id="loadingSpinner"
     style="display:none; position:fixed; top:10px; left:50%; transform:translateX(-50%);
            z-index:9999; background:transparent;
            display:flex; flex-direction:column; align-items:center; justify-content:center;">

<div class="spinner-accelerator"></div>

<style>
.spinner-accelerator {
  position: relative;
  width: 52px;
  height: 52px;
}

.spinner-accelerator div {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 3px solid transparent;
  animation: accelSpin 1s linear infinite;
}

/* LINGKARAN 1 â€” BIRU NEON */
.spinner-accelerator div:nth-child(1) {
  border-top-color: #00c8ff;
  filter: drop-shadow(0 0 8px #00c8ff);
}

/* LINGKARAN 2 â€” VARIASI BIRU */
.spinner-accelerator div:nth-child(2) {
  border-right-color: rgba(0, 200, 255, 0.5);
  animation-duration: 0.7s;
}

/* LINGKARAN 3 â€” VARIASI BIRU LEMBUT */
.spinner-accelerator div:nth-child(3) {
  border-left-color: rgba(0, 200, 255, 0.3);
  animation-duration: 1.3s;
}

@keyframes accelSpin {
  to { transform: rotate(360deg); }
}
</style>

<script>
document.querySelector(".spinner-accelerator").innerHTML =
  "<div></div><div></div><div></div>";
</script>




<script>
// ====================== KONFIGURASI ======================
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwpw2VWsSrkhuEEjvrYL8i75_us7ccoWss33EOV7ZBYJJQaWRjoiDBgNGguOgI1A09V/exec";

// ====================== SPINNER GLOBAL JS ======================
const spinner = document.getElementById('loadingSpinner');
const showSpinner = () => spinner.style.display = 'flex';
const hideSpinner = () => spinner.style.display = 'none';

let prosesSedangJalan = 0;

function mulaiProses() {
  prosesSedangJalan++;
  showSpinner();
}

function selesaiProses() {
  prosesSedangJalan = Math.max(0, prosesSedangJalan - 1);
  if (prosesSedangJalan === 0) hideSpinner();
}

// ====================== Hook global ======================
(function () {
  const asliJsonp = window.jsonpGet;
  const asliPost = window.postPayload;

  if (typeof asliJsonp === 'function' && !asliJsonp.__hooked) {
    window.jsonpGet = async function(...args) {
      mulaiProses();
      try { return await asliJsonp.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.jsonpGet.__hooked = true;
  }

  if (typeof asliPost === 'function' && !asliPost.__hooked) {
    window.postPayload = async function(...args) {
      mulaiProses();
      try { return await asliPost.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.postPayload.__hooked = true;
  }
})();

// ====================== Load Semua Data ======================
async function loadAllData() {
  showSpinner();
  try {
    await Promise.all([
      Promise.resolve(loadBaproItems()),
      Promise.resolve(loadPAItems()),
      Promise.resolve(loadFinishingItems()),
      Promise.resolve(loadLemItems())
    ]);
  } catch (err) {
    console.error('Gagal memuat data:', err);
  } finally {
    hideSpinner();
  }
}

window.addEventListener('load', loadAllData);

// ====================== WAKTU HEADER ======================
function updateTime() {
  const now = new Date();

  // Format tanggal (tanpa jam)
  const tanggal = now.toLocaleDateString('id-ID', {
    weekday: 'long',
    day: '2-digit',
    month: 'long',
    year: 'numeric'
  });

  // Format jam (tanpa kata 'pukul')
  let jam = now.toLocaleTimeString('id-ID', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });

  // Hapus kemungkinan ada teks 'pukul' dari locale
  jam = jam.replace('pukul', '').replace('Pukul', '').trim();

  // Masukkan hasil ke dalam elemen
  const tanggalEl = document.querySelector('#headerTime .tanggal');
  const jamEl = document.querySelector('#headerTime .jam');

  if (tanggalEl && jamEl) {
    tanggalEl.textContent = tanggal;
    jamEl.textContent = jam;
  }
}

// Jalankan setiap detik
setInterval(updateTime, 1000);
updateTime();

// ====================== MENU ======================
function showMenu(menu) {
  document.querySelectorAll('main > section').forEach(sec => sec.style.display = 'none');
  document.getElementById(menu).style.display = 'block';
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`nav button[onclick="showMenu('${menu}')"]`).classList.add('active');

  if (menu === 'dashboard') renderDashboardFinishingCompact();
}

// ====================== TABS ======================
function switchTab(btn) {
  const parent = btn.parentElement;
  parent.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  parent.parentElement.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById(btn.dataset.tab).classList.add('active');

  if (btn.dataset.tab === 'hasilFinishing') {
    loadFinishingItems(); // refresh saat buka tab hasil
  }
}

// ====================== JSONP HELPER ======================
function jsonpGet(url, params = {}) {
  return new Promise((resolve, reject) => {
    const cbName = 'jsonp_cb_' + Math.random().toString(36).slice(2, 9);
    params = params || {};
    params.callback = cbName;
    const q = Object.entries(params).map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&');
    const script = document.createElement('script');
    script.src = `${url}?${q}`;
    script.onerror = () => {
      cleanup();
      reject(new Error('JSONP load error'));
    };
    window[cbName] = (res) => {
      cleanup();
      resolve(res);
    };
    function cleanup(){
      delete window[cbName];
      script.remove();
    }
    document.body.appendChild(script);
  });
}

// ===== SCROLL OTOMATIS SETELAH DASHBOARD DIBUKA =====
function autoScrollDashboardMenu(menu) {
  const sections = [
    `section${menu}TO`,
    `section${menu}Proses`,
    `section${menu}Selesai`
  ];

  sections.forEach(id => {
    const section = document.getElementById(id);
    if (!section) return;

    const observer = new MutationObserver(() => {
      if (section.style.display !== 'none') {
        const cards = section.querySelectorAll('.grid-card');
        if (cards.length > 0) {
          cards[cards.length - 1].scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
      }
    });

    observer.observe(section, { attributes: true, attributeFilter: ['style'] });
  });
}

// panggil setelah DOM siap
document.addEventListener('DOMContentLoaded', () => {
  ['Finishing','Bapro','PA','Lem'].forEach(menu => autoScrollDashboardMenu(menu));
});

// ===== SCROLL OTOMATIS KE BAWAH SAAT TAB HASIL DIBUKA =====
function scrollGridToBottom(menu) {
  const container = document.getElementById(`grid${menu}`);
  if (!container) return;
  const cards = container.querySelectorAll('.grid-card');
  if (cards.length === 0) return;
  cards[cards.length - 1].scrollIntoView({ behavior: 'smooth', block: 'end' });
}

// Tambahkan di fungsi switchTab
function switchTab(btn) {
  const tabName = btn.dataset.tab;
  if (!tabName) return;

  // Hapus active class dari semua tab
  btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  // Tampilkan konten tab
  btn.parentElement.parentElement.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  const content = document.getElementById(tabName);
  if (content) content.classList.add('active');

  // ðŸ”¹ Scroll otomatis jika tab hasil terbuka
  ['Finishing','Bapro','PA','Lem'].forEach(menu => {
    if (tabName === `hasil${menu}`) {
      setTimeout(() => scrollGridToBottom(menu), 100);
    }
  });
}

// ====================== ESCAPE HTML ======================
function escapeHtml(s) {
  return String(s || '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}

// ====================== HIGHLIGHT KATA (SAFE) ======================
function highlightHtmlSafe(text, query) {
  if (!query) return escapeHtml(text);
  const escapedText = escapeHtml(text);
  const q = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // escape regex
  const regex = new RegExp(`(${q})`, 'gi');
  return escapedText.replace(regex, '<mark>$1</mark>');
}

// ====================== POST PAYLOAD Finishing ======================
function ensureIframe(){
  if(document.querySelector('iframe[name="hidden_iframe_post"]')) return;
  const ifr = document.createElement('iframe');
  ifr.name = 'hidden_iframe_post';
  ifr.style.display = 'none';
  ifr.addEventListener('load', ()=> setTimeout(()=> loadFinishingItems(), 10000));
  document.body.appendChild(ifr);
}
function postPayload(payloadObj){
  ensureIframe();
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = WEBAPP_URL;
  form.target = 'hidden_iframe_post';
  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = 'payload';
  input.value = JSON.stringify(payloadObj);
  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  form.remove();
}









// ====================== GLOBAL STATE (FINISHING) ======================
let finishingItems = []; // array yang diambil dari sheet Finishing

// ====================== RENDER GRID FINISHING (MENGIKUTI GAYA LEM) ======================
function renderGridFinishing(query = "") {
  const container = document.getElementById('gridFinishing');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  finishingItems.forEach((item, i) => {

    // ===== FILTER =====
    if (q && !(
      (item.nama || '').toLowerCase().includes(q) ||
      (item.noKS || '').toLowerCase().includes(q) ||
      (item.qc || '').toLowerCase().includes(q) ||
      (item.keterangan || '').toLowerCase().includes(q)
    )) return;

    const card = document.createElement('div');
    card.className = 'grid-card';
    card.dataset.index = i;

    // ===== STATUS WARNA (SAMA DENGAN LEM) =====
    let statusClass = '';
    const updateVal = (item.update || '').toString();
    if (updateVal === "Proses") statusClass = "status-proses";
    else if (updateVal === "Selesai") statusClass = "status-selesai";
    else if (updateVal === "Pending") statusClass = "status-pending";

    // ===== TANGGAL =====
    const tanggal = item.tanggal
      ? `<strong>${highlightHtmlSafe(item.tanggal, q)}</strong><br>`
      : "";

    // ===========================================================
    // NORMALISASI KETERANGAN (MENGIKUTI LOGIKA LEM)
    // ===========================================================
    const raw = (item.keterangan || "").toString().trim();
    const ketMap = {1:"",2:"",3:"",4:"",5:""};

    if (raw !== "") {
      raw.split(/\r?\n/).forEach(line => {
        const m = line.match(/^\s*(\d+)\.\s*(.*)/);
        if (m) {
          const no = parseInt(m[1]);
          if (no >= 1 && no <= 5) {
            ketMap[no] = m[2].trim() || "";
          }
        }
      });
    }

    const kets = [
      ketMap[1] || "",
      ketMap[2] || "",
      ketMap[3] || "",
      ketMap[4] || "",
      ketMap[5] || ""
    ];

    // ===========================================================
    // HTML (FORMAT KARTU MENGIKUTI LEM)
    // ===========================================================
    card.innerHTML = `
      <div>
        ${tanggal}

        <span>Nama Order: ${highlightHtmlSafe(item.nama || '', q)}</span><br>
        <span>No KS: ${highlightHtmlSafe(item.noKS || '', q)}</span><br>
        <span>Order: ${highlightHtmlSafe(item.order || '', q)}</span><br>
        <span>Isi/Dus: ${highlightHtmlSafe(item.isi || '', q)}</span><br>
        <span>Bagus: ${highlightHtmlSafe(item.bagus || '', q)}</span><br>
        <span>Total BS: ${highlightHtmlSafe(item.jenisBS || '', q)}</span><br>
        <span>BS Cetak: ${highlightHtmlSafe(item.jenisBS1 || '', q)}</span><br>
        <span>BS Lem: ${highlightHtmlSafe(item.jenisBS2 || '', q)}</span><br>
        <span>BS Ponch: ${highlightHtmlSafe(item.jenisBS3 || '', q)}</span><br>
        <span>BS Varnish: ${highlightHtmlSafe(item.jenisBS4 || '', q)}</span><br>
        <span>BS Potong: ${highlightHtmlSafe(item.jenisBS5 || '', q)}</span><br>
        <span>QC: ${highlightHtmlSafe(item.qc || '', q)}</span><br>

        <span><b>Keterangan:</b></span><br>
        <div class="ket-list">
          <div>1. ${highlightHtmlSafe(kets[0] || '-', q)}</div>
          <div>2. ${highlightHtmlSafe(kets[1] || '-', q)}</div>
          <div>3. ${highlightHtmlSafe(kets[2] || '-', q)}</div>
          <div>4. ${highlightHtmlSafe(kets[3] || '-', q)}</div>
          <div>5. ${highlightHtmlSafe(kets[4] || '-', q)}</div>
        </div>

        <br>

        <span class="${statusClass}">${highlightHtmlSafe(item.update || '', q)}</span>
      </div>

      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callFinishing(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editFinishingInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteFinishing(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Dashboard ringkas (jika ada)
  if (typeof renderDashboardFinishingCompact === 'function') {
    try { renderDashboardFinishingCompact(); } catch(e) {}
  }

  // Auto scroll ke item terakhir
  const lastCard = container.querySelector('.grid-card:last-child');
  if (lastCard) lastCard.scrollIntoView({ behavior: 'smooth', block: 'end' });
}


// ====================== LOAD DATA DARI SPREADSHEET ======================
async function loadFinishingItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Finishing' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      finishingItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridFinishing();
    } else console.warn('loadFinishingItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadFinishingItems', err); }
}


// ====================== TAMBAH DATA (FINISHING) DENGAN BS DETAIL ======================
function addFinishingItem() {
  const nama = document.getElementById('finishingNama').value.trim();
  const noKS = document.getElementById('finishingNoKS').value.trim();
  const order = document.getElementById('finishingOrder').value.trim();
  const isi = document.getElementById('finishingIsi').value.trim();
  const bagus = document.getElementById('finishingBagus').value.trim();
  const jenisBS = document.getElementById('finishingJenisBS').value.trim();
  const jenisBS1 = document.getElementById('finishingJenisBS1').value.trim();
  const jenisBS2 = document.getElementById('finishingJenisBS2').value.trim();
  const jenisBS3 = document.getElementById('finishingJenisBS3').value.trim();
  const jenisBS4 = document.getElementById('finishingJenisBS4').value.trim();
  const jenisBS5 = document.getElementById('finishingJenisBS5').value.trim();
  const qc = document.getElementById('finishingQC').value.trim();
  const update = document.getElementById('finishingUpdate').value.trim();

  // ===== Gabungkan keterangan format BAPRO =====
  const keterangan =
`1. ${document.getElementById("finKet1").value || ''}
2. ${document.getElementById("finKet2").value || ''}
3. ${document.getElementById("finKet3").value || ''}
4. ${document.getElementById("finKet4").value || ''}
5. ${document.getElementById("finKet5").value || ''}`;

// ====== VALIDASI BARU: TAMPILKAN HANYA FIELD YANG KOSONG ======
let kosong = [];

if (!nama) kosong.push("Nama Order");
if (!order) kosong.push("Nama Barang / Order");
if (!noKS) kosong.push("No KS");
if (!qc) kosong.push("QC");
if (!update) kosong.push("Proses");

if (kosong.length > 0) {
  alert("Harap isi field berikut:\n- " + kosong.join("\n- "));
  return;
}
// =================================================================


// ====== KONFIRMASI INPUTAN (FORMAT RAPI TANPA ICON) ======
const konfirmasi = confirm(
  `Yakin ingin menambah data baru?\n\n` +
  `Nama Order : ${nama}\n` +
  `Order      : ${order}\n` +
  `No KS      : ${noKS}\n` +
  `QC         : ${qc}\n` +
  `Proses     : ${update}`
);

if (!konfirmasi) return;
// =================================================================


  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = { 
    action:'add', 
    sheet:'Finishing', 
    tanggal: tanggalFormatted,
    nama,noKS,order,isi,bagus,
    jenisBS, jenisBS1, jenisBS2, jenisBS3, jenisBS4, jenisBS5, // <-- kolom BS baru
    qc, update, keterangan
  };

  // Spinner tombol
  const btnTambah = document.querySelector('#inputFinishing button');
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML;
      if (typeof clearFinishingForm === 'function') clearFinishingForm();
      loadFinishingItems();
      alert('âœ… Data berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    if (typeof clearFinishingForm === 'function') clearFinishingForm();
    setTimeout(() => loadFinishingItems(), 8000);
    alert('âœ… Data berhasil ditambahkan!');
  }
}



// ====================== PANGGIL (isi form dari item) DENGAN BS DETAIL ======================
function callFinishing(index){
  const item = finishingItems[index];
  if(!item) return;

  document.getElementById('finishingNama').value = item.nama || '';
  document.getElementById('finishingNoKS').value = item.noKS || '';
  document.getElementById('finishingOrder').value = item.order || '';
  document.getElementById('finishingIsi').value = item.isi || '';
  document.getElementById('finishingBagus').value = item.bagus || '';
  document.getElementById('finishingJenisBS').value = item.jenisBS || '';

  // ===== Tambahkan BS detail baru =====
  document.getElementById('finishingJenisBS1').value = item.jenisBS1 || '';
  document.getElementById('finishingJenisBS2').value = item.jenisBS2 || '';
  document.getElementById('finishingJenisBS3').value = item.jenisBS3 || '';
  document.getElementById('finishingJenisBS4').value = item.jenisBS4 || '';
  document.getElementById('finishingJenisBS5').value = item.jenisBS5 || '';

  document.getElementById('finishingQC').value = item.qc || '';
  document.getElementById('finishingUpdate').value = item.update || '';

  // ===== Kembalikan keterangan ke input 1â€“5 =====
  const lines = (item.keterangan || "").split(/\r?\n/);
  for (let i = 1; i <= 5; i++) {
    const el = document.getElementById("finKet" + i);
    if (el) el.value = (lines[i-1] || "").replace(new RegExp(`^\\s*${i}\\.\\s*`), "");
  }

  // ===== Pastikan pindah ke tab FINISHING INPUT =====
  showMenu('qcFinishing');
  const tabBtn = document.querySelector('#qcFinishing .tabs button[data-tab="inputFinishing"]');
  if (tabBtn) switchTab(tabBtn);
}



// ====================== HAPUS ITEM (langsung hilang dari grid) ======================
function deleteFinishing(index) {
  const item = finishingItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridFinishing');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Finishing', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // ðŸ”¹ Tunggu proses di Google Sheet (sekitar 8 detik)
  setTimeout(() => {
    // hapus dari array dan DOM agar langsung hilang dari grid
    finishingItems.splice(index, 1);
    if (card) card.remove();
    loadFinishingItems();
  }, 8000);
}

// ======================= PASSWORD PROTECT DELETE FINISHING =======================
const DELETE_FINISHING_PASSWORD = "qc123"; // ganti sesuai kebutuhan
const finishingContainer = document.getElementById('gridFinishing');
let bypassFinishingPassword = false;

if (finishingContainer) {
  finishingContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.btn-delete');
    if (!btn) return;

    if (bypassFinishingPassword) {
      // Klik asli, lewati password
      bypassFinishingPassword = false;
      return;
    }

    // cegah listener asli sementara
    e.preventDefault();
    e.stopImmediatePropagation();

    // Password prompt
    const pwd = prompt("Masukkan password untuk menghapus item ini:");
    if (pwd === null) return; // user cancel

    if (pwd === DELETE_FINISHING_PASSWORD) {
      // Password benar â†’ set flag supaya klik asli tidak terintercept
      bypassFinishingPassword = true;
      // trigger klik asli
      btn.click();
    } else {
      alert("Password salah. Aksi dibatalkan.");
    }
  }, true); // capture phase
}

// ====================== EDIT INLINE (FINISHING) DENGAN BS DETAIL ======================
function editFinishingInline(index){
  const item = finishingItems[index];
  const container = document.getElementById('gridFinishing');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama untuk cancel
  const originalHTML = card.innerHTML;
  card.innerHTML = '';
  card.dataset.oldHtml = encodeURIComponent(originalHTML);

  const keteranganRaw = item.keterangan || '';

  card.innerHTML = `
    <div class="edit-grid">

      <label>Nama Order</label>
      <input type="text" class="edit-inline" name="nama" value="${escapeHtml(item.nama||'')}">

      <label>No KS</label>
      <input type="text" class="edit-inline" name="noKS" value="${escapeHtml(item.noKS||'')}">

      <label>Order</label>
      <input type="number" class="edit-inline" name="order" value="${escapeHtml(item.order||'')}">

      <label>Isi/Dus</label>
      <input type="number" class="edit-inline" name="isi" value="${escapeHtml(item.isi||'')}">

      <label>Bagus</label>
      <input type="number" class="edit-inline" name="bagus" value="${escapeHtml(item.bagus||'')}">


      <label>BS Total</label>
      <input type="number" class="edit-inline" name="jenisBS" value="${escapeHtml(item.jenisBS||'')}">

      <label>BS Cetak</label>
      <input type="number" class="edit-inline" name="jenisBS1" value="${escapeHtml(item.jenisBS1||'')}">

      <label>BS Lem</label>
      <input type="number" class="edit-inline" name="jenisBS2" value="${escapeHtml(item.jenisBS2||'')}">

      <label>BS Ponch</label>
      <input type="number" class="edit-inline" name="jenisBS3" value="${escapeHtml(item.jenisBS3||'')}">

      <label>BS Varnish</label>
      <input type="number" class="edit-inline" name="jenisBS4" value="${escapeHtml(item.jenisBS4||'')}">

      <label>BS Potong</label>
      <input type="number" class="edit-inline" name="jenisBS5" value="${escapeHtml(item.jenisBS5||'')}">


      <label>QC</label>
      <select class="edit-inline" name="qc">
        <option value="Anom" ${item.qc==='Anom'? 'selected':''}>Anom</option>
        <option value="Irna" ${item.qc==='Irna'? 'selected':''}>Irna</option>
      </select>

      <label>Status</label>
      <select class="edit-inline" name="update">
        <option value="Pending" ${item.update==='Pending'? 'selected':''}>Pending</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <label>Keterangan</label>
      <textarea class="edit-inline" name="keterangan" rows="3">${escapeHtml(keteranganRaw)}</textarea>

    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveFinishingInline(${index}, this)">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelFinishingInline(${index}, '${encodeURIComponent(originalHTML)}')">âœ–ï¸</button>
    </div>
  `;
}




// ====================== BATAL EDIT INLINE (FINISHING) ======================
function cancelFinishingInline(index, oldHtmlEncoded) {
  const container = document.getElementById('gridFinishing');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if (!card) return;

  try {
    card.innerHTML = decodeURIComponent(oldHtmlEncoded || card.dataset.oldHtml || '');
    if (card.dataset.oldHtml) delete card.dataset.oldHtml;
  } catch (e) {
    // fallback: reload list
    loadFinishingItems();
  }
}


// ====================== SIMPAN HASIL EDIT INLINE (FINISHING) DENGAN BS DETAIL ======================
async function saveFinishingInline(index, btn) {
  const container = document.getElementById('gridFinishing');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if (!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none';

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    jenisBS: inputs[5].value.trim(),
    jenisBS1: inputs[6].value.trim(),
    jenisBS2: inputs[7].value.trim(),
    jenisBS3: inputs[8].value.trim(),
    jenisBS4: inputs[9].value.trim(),
    jenisBS5: inputs[10].value.trim(),
    qc: inputs[11].value,
    update: inputs[12].value,
    keterangan: inputs[13].value.trim()
  };

  const orig = finishingItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Finishing', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    // beri waktu sheet memproses
    await new Promise(res => setTimeout(res, 5000));
    await loadFinishingItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}





// ====================== FILTER BERDASARKAN ISI GRID FINISHING ======================
function filterFinishingGrid(query){
  const grid = document.getElementById('gridFinishing');
  if (!grid) return;

  const keyword = (query || '').toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM (FINISHING) DENGAN BS DETAIL ======================
function clearFinishingForm() {
  // Text fields
  ['finishingNama','finishingNoKS','finishingQC','finishingUpdate'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number fields
  ['finishingOrder','finishingIsi','finishingBagus','finishingJenisBS',
   'finishingJenisBS1','finishingJenisBS2','finishingJenisBS3','finishingJenisBS4','finishingJenisBS5'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });

  // Reset keterangan 1â€“5
  for (let i=1; i<=5; i++){
    const el = document.getElementById("finKet"+i);
    if(el) el.value = '';
  }
}



// ====================== DASHBOARD FINISHING (AKURAT 100%) ======================
function renderDashboardFinishingCompact(query = "", safeMode = false) {
  const q = query.toLowerCase().trim();

  const containerTO = document.getElementById('dashboardFinishingTO');
  const containerProses = document.getElementById('dashboardFinishingProses');
  const containerSelesai = document.getElementById('dashboardFinishingSelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  // --- helper parse angka aman (hapus koma/spasi) ---
  const num = (v) => {
    if (!v) return 0;
    const clean = String(v).replace(/[^0-9.-]/g, "");
    const n = Number(clean);
    return isNaN(n) ? 0 : n;
  };

  finishingItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal || "-";

    // ===========================
    // NILAI FINISHING (FINAL)
    // ===========================
    const order = num(item.order);
    const isi   = num(item.isi);
    const bagus = num(item.bagus);

    // Total BS = semua jenis BS FINISHING
    const totalBS =
        num(item.jenisBS)  +
        num(item.jenisBS1) +
        num(item.jenisBS2) +
        num(item.jenisBS3) +
        num(item.jenisBS4) +
        num(item.jenisBS5);

    // hasil bersih
    let hasilBersih = bagus - totalBS;
    if (hasilBersih < 0) hasilBersih = 0;

    // persentase
    const persen = order > 0 ? ((hasilBersih / order) * 100).toFixed(1) : "0.0";

    // ===========================
    // RENDER CARD
    // ===========================
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "pending") statusClass = "status-pending";

    card.innerHTML = `
      <strong>Nama : ${highlightHtmlSafe(item.nama || '', query)}</strong><br>
      <strong>QC : ${highlightHtmlSafe(item.qc || '', query)}</strong><br>
      <span>ðŸ“… ${highlightHtmlSafe(tanggal, query)}</span><br>

      <div style="
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin:4px 0 6px;
        background:#9ac8ff;
        padding:6px 10px;
        border-radius:8px;
        font-weight:700;
        color:#003a80;
        border:1px solid #5fa8ff;
      ">
        <span style="font-weight:600; font-size:0.92rem;">Hasil:</span>
        <span style="display:inline-block; min-width:64px; text-align:right;">${persen}%</span>
      </div>

      <span class="${statusClass}">
        ${highlightHtmlSafe(item.update || '', query)}
      </span>
    `;

    // FILTER
    const cardText = card.textContent.toLowerCase();
    if (!safeMode && q && !cardText.includes(q)) return;

    // KATEGORI
    if (updateVal === 'pending') { containerTO.appendChild(card); totalTO++; }
    else if (updateVal === 'proses') { containerProses.appendChild(card); totalProses++; }
    else if (updateVal === 'selesai') { containerSelesai.appendChild(card); totalSelesai++; }

    card.addEventListener('click', () => showDetailModal(item));
  });

  // COUNTER
  document.getElementById('countFinishing').textContent = finishingItems.length;
  document.getElementById('countTOFinishing').textContent = totalTO;
  document.getElementById('countProsesFinishing').textContent = totalProses;
  document.getElementById('countSelesaiFinishing').textContent = totalSelesai;
}




// ====================== FILTER INPUT REAL-TIME UNTUK DASHBOARD ======================
document.addEventListener('DOMContentLoaded', () => {
  const filterTO = document.getElementById('filterFinishingTO');
  const filterProses = document.getElementById('filterFinishingProses');
  const filterSelesai = document.getElementById('filterFinishingSelesai');

  if (filterTO) filterTO.addEventListener('input', () => renderDashboardFinishingCompact(filterTO.value));
  if (filterProses) filterProses.addEventListener('input', () => renderDashboardFinishingCompact(filterProses.value));
  if (filterSelesai) filterSelesai.addEventListener('input', () => renderDashboardFinishingCompact(filterSelesai.value));
});


// ====================== DETAIL ======================
function showDetailModal(item) {
  const body = document.getElementById("detailFinishingBody");

  body.innerHTML = `
    <strong>Tanggal:</strong> ${item.tanggal || '-'}<br>
    <strong>Nama:</strong> ${item.nama}<br>
    <strong>No KS:</strong> ${item.noKS}<br>
    <strong>Order:</strong> ${item.order}<br>
    <strong>Isi:</strong> ${item.isi}<br>
    <strong>Bagus:</strong> ${item.bagus}<br>
    <strong>Total BS:</strong> ${item.jenisBS}<br>
    <strong>BS Cetak:</strong> ${item.jenisBS1}<br>
    <strong>BS Lem:</strong> ${item.jenisBS2}<br>
    <strong>BS Ponch:</strong> ${item.jenisBS3}<br>
    <strong>BS Varnish:</strong> ${item.jenisBS4}<br>
    <strong>BS Potong:</strong> ${item.jenisBS5}<br>
    <strong>QC:</strong> ${item.qc}<br>
    <strong>Update:</strong> <span class="status-${(item.update || '').toLowerCase()}">${item.update}</span><br><br>
    <strong>Keterangan:</strong><br>
    ${(item.keterangan || "-").replace(/\n/g, "<br>")}
  `;

  document.getElementById("detailFinishingModal").style.display = "flex";
}

function closeDetailModal() {
  document.getElementById("detailFinishingModal").style.display = "none";
}

function closeDetailModal() {   // << SAMA seperti yang dipanggil HTML
  const modal = document.getElementById("detailFinishingModal");
  if (modal) modal.style.display = "none";
}

// Close modal jika klik area luar
document.addEventListener("click", (e) => {
  const modal = document.getElementById("detailFinishingModal");
  if (!modal) return;

  if (e.target === modal) {
    modal.style.display = "none";
  }
});


// ====================== TOGGLE VIEW + FILTER QC FINISHING ======================
document.addEventListener("DOMContentLoaded", () => {

  // Tombol toggle
  const btnTO = document.getElementById("toggleFinishingTO");
  const btnProses = document.getElementById("toggleFinishingProses");
  const btnSelesai = document.getElementById("toggleFinishingSelesai");

  // Section
  const sectionTO = document.getElementById("sectionFinishingTO");
  const sectionProses = document.getElementById("sectionFinishingProses");
  const sectionSelesai = document.getElementById("sectionFinishingSelesai");

  // Filter input (ID diperbaiki sesuai HTML)
  const filterTO = document.getElementById("filterFinishingTO");
  const filterProses = document.getElementById("filterFinishingProses");
  const filterSelesai = document.getElementById("filterFinishingSelesai");

  // Grid container
  const gridTO = document.getElementById("dashboardFinishingTO");
  const gridProses = document.getElementById("dashboardFinishingProses");
  const gridSelesai = document.getElementById("dashboardFinishingSelesai");

  // Fungsi filter
  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll(".grid-card");
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? "" : "none";
    });
  }

  // Filter real time
  [
    { input: filterTO, grid: gridTO },
    { input: filterProses, grid: gridProses },
    { input: filterSelesai, grid: gridSelesai }
  ].forEach(({ input, grid }) => {
    if (input) {
      input.addEventListener("input", () => filterCards(grid, input.value));
    }
  });

  // Tetap filter setelah data dirender ulang
  window.applyFinishingFilters = function () {
    filterCards(gridTO, filterTO?.value || "");
    filterCards(gridProses, filterProses?.value || "");
    filterCards(gridSelesai, filterSelesai?.value || "");
  };

  // Toggle section
  function toggleSection(section, btn) {
    const visible = section.style.display !== "none";
    section.style.display = visible ? "none" : "block";
    btn.textContent = visible ? "Show" : "Hide";
  }

  if (btnTO) btnTO.addEventListener("click", () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener("click", () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener("click", () => toggleSection(sectionSelesai, btnSelesai));
});


// ====================== PASSWORD PROTECT QC FINISHING ======================
const QC_FINISHING_PASSWORD = "qc123";

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcFinishing')"]`);
  if (!btn) return;

  const originalOnClick = btn.getAttribute("onclick");
  
  btn.onclick = function (e) {
    e.preventDefault();

    const input = prompt("Masukkan password untuk QC Finishing:");
    if (input === null) return;

    if (input === QC_FINISHING_PASSWORD) {
      try {
        eval(originalOnClick);
      } catch {
        if (typeof showMenu === "function") showMenu("qcFinishing");
      }
    } else {
      alert("Password salah!");
    }
  };
});



// ====================== INISIALISASI (panggil loader FINISHING) ======================
loadFinishingItems();


</script>






<!-- ====== JS QC BAPRO ====== -->
<script>
// ====================== GLOBAL STATE (BAPRO) ======================
let baproItems = []; // array yang diambil dari sheet Bapro


// ====================== RENDER GRID HASIL (BAPRO) â€“ MENGIKUTI QC LEM ======================
function renderGridBapro(query = "") {
  const container = document.getElementById('gridBapro');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  baproItems.forEach((item, i) => {

    // Filter pencarian
    if (q && !(
      (item.nama || '').toLowerCase().includes(q) ||
      (item.cso || '').toLowerCase().includes(q) ||
      (item.qc || '').toLowerCase().includes(q) ||
      (item.keterangan || '').toLowerCase().includes(q)
    )) return;

    const card = document.createElement('div');
    card.className = 'grid-card';
    card.dataset.index = i;

    // ===== STATUS WARNA =====
    let statusClass = '';
    const updateVal = (item.update || '').toString();
    if (updateVal === "Proses") statusClass = "status-proses";
    else if (updateVal === "Selesai") statusClass = "status-selesai";
    else if (updateVal === "Pending") statusClass = "status-pending";

    // ===== TANGGAL =====
    const tanggal = item.tanggal ? `<strong>${highlightHtmlSafe(item.tanggal, q)}</strong><br>` : '';

    // ============================
    // NORMALISASI KETERANGAN 1â€“5
    // ============================
    const ketMap = {1:"-",2:"-",3:"-",4:"-",5:"-"};
    const raw = (item.keterangan || "").toString().trim();
    if(raw !== ""){
      raw.split("\n").forEach(line=>{
        const m = line.match(/^\s*(\d+)\.\s*(.*)/);
        if(m){
          const no = parseInt(m[1]);
          if(no>=1 && no<=5){
            ketMap[no] = m[2].trim() || "-";
          }
        }
      });
    }

    // Render selalu 1â€“5
    let ketsHtml = '';
    for(let j=1; j<=5; j++){
      ketsHtml += `<div>${j}. ${highlightHtmlSafe(ketMap[j], q)}</div>`;
    }

    // ============================ HTML ============================
    card.innerHTML = `
      <div>
        ${tanggal}

        <span>Nama Order: ${highlightHtmlSafe(item.nama || '', q)}</span><br>
        <span>CSO: ${highlightHtmlSafe(item.cso || '', q)}</span><br>
        <span>Jenis: ${highlightHtmlSafe(item.jenisKertas || '', q)}</span><br>
        <span>GSM: ${highlightHtmlSafe(item.tebalKertas || '', q)}</span><br>
        <span>Nama Tinta: ${highlightHtmlSafe(item.NamaTinta || '', q)}</span><br>
        <span>Dmax: ${highlightHtmlSafe(item.dmax || '', q)}</span><br>

        <span>L: ${highlightHtmlSafe(item.l || '', q)}  
           A: ${highlightHtmlSafe(item.a || '', q)}  
           B: ${highlightHtmlSafe(item.b || '', q)}</span><br>

        <span>QC: ${highlightHtmlSafe(item.qc || '', q)}</span><br>

        <span><b>Keterangan:</b></span><br>
        <div class="ket-list">
          ${ketsHtml}
        </div>

        <br>
        <span class="${statusClass}">${highlightHtmlSafe(item.update || '', q)}</span>
      </div>

      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callBapro(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editBaproInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteBapro(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Dashboard
  if (typeof renderDashboardBaproCompact === "function") {
    try { renderDashboardBaproCompact(); } catch (e) {}
  }

  // Auto-scroll
  const lastCard = container.querySelector('.grid-card:last-child');
  if (lastCard) lastCard.scrollIntoView({ behavior: 'smooth', block: 'end' });
}

// ====================== LOAD DATA DARI SPREADSHEET (BAPRO) â€“ MENGIKUTI QC LEM ======================
async function loadBaproItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Bapro' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      baproItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridBapro();
    } else console.warn('loadBaproItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadBaproItems', err); }
}



// ====================== TAMBAH DATA (BAPRO) â€” SESUAI QC LEM ======================
function addBaproItem() {
  const nama = document.getElementById('baproNama').value.trim();
  const cso = document.getElementById('baprocso').value.trim();
  const jenis = document.getElementById('baproJenis') ? document.getElementById('baproJenis').value.trim() : '';
  const kertas = document.getElementById('baproKertas') ? document.getElementById('baproKertas').value.trim() : '';
  const NamaTinta = document.getElementById('baproNamaTinta') ? document.getElementById('baproNamaTinta').value.trim() : '';
  const dmax = document.getElementById('baproDmax') ? document.getElementById('baproDmax').value.trim() : '';
  const L = document.getElementById('baproL') ? document.getElementById('baproL').value.trim() : '';
  const A = document.getElementById('baproA') ? document.getElementById('baproA').value.trim() : '';
  const B = document.getElementById('baproB') ? document.getElementById('baproB').value.trim() : '';
  const qc = document.getElementById('baproQC') ? document.getElementById('baproQC').value.trim() : '';
  const update = document.getElementById('baproUpdate') ? document.getElementById('baproUpdate').value.trim() : '';

  // ===== Gabungkan keterangan 1â€“5
  const keterangan = `
1. ${document.getElementById("ket1").value}
2. ${document.getElementById("ket2").value}
3. ${document.getElementById("ket3").value}
4. ${document.getElementById("ket4").value}
5. ${document.getElementById("ket5").value}`;

// ===== VALIDASI BARU: TAMPILKAN HANYA FIELD KOSONG =====
let kosong = [];

if (!nama)      kosong.push("Nama");
if (!cso)       kosong.push("CSO");
if (!jenis)     kosong.push("Jenis Kertas");
if (!kertas)    kosong.push("Tebal Kertas");
if (!NamaTinta) kosong.push("Nama Tinta");
if (!qc)        kosong.push("QC");
if (!update)    kosong.push("Proses");

if (kosong.length > 0) {
  alert("âš ï¸ Harap isi field berikut:\n- " + kosong.join("\n- "));
  return;
}
// ============================================================


// ===== KONFIRMASI (MENAMPILKAN SEMUA INPUT YANG WAJIB) =====
const konfirmasi = confirm(
  `Yakin ingin menambah data BAPRO baru?\n\n` +
  `Nama        : ${nama}\n` +
  `CSO         : ${cso}\n` +
  `Jenis       : ${jenis}\n` +
  `Tebal       : ${kertas}\n` +
  `Nama Tinta  : ${NamaTinta}\n` +
  `QC          : ${qc}\n` +
  `Proses      : ${update}`
);

if (!konfirmasi) return;
// ============================================================


  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = {
    action:'add',
    sheet:'Bapro',
    tanggal: tanggalFormatted,
    nama,
    cso,
    jenisKertas: jenis,
    tebalKertas: kertas,
    NamaTinta: NamaTinta,
    dmax: dmax,
    l: L,
    a: A,
    b: B,
    qc,
    update,
    keterangan
  };

  // Spinner tombol
  const btnTambah = document.querySelector('#inputBapro button'); 
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML;
      clearBaproForm();
      loadBaproItems();
      alert('âœ… Data BAPRO berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearBaproForm();
    setTimeout(() => loadBaproItems(), 8000);
    alert('âœ… Data BAPRO berhasil ditambahkan!');
  }
}


// ====================== PANGGIL (ISI FORM dari item BAPRO) â€” SESUAI QC LEM ======================
function callBapro(index){
  const item = baproItems[index];
  if(!item) return;

  // Field normal
  document.getElementById('baproNama').value = item.nama || '';
  document.getElementById('baprocso').value = item.cso || '';
  document.getElementById('baproJenis').value = item.jenisKertas || '';
  document.getElementById('baproKertas').value = item.tebalKertas || '';
  document.getElementById('baproNamaTinta').value = item.NamaTinta || '';
  document.getElementById('baproDmax').value = item.dmax || '';
  document.getElementById('baproL').value = item.l || '';
  document.getElementById('baproA').value = item.a || '';
  document.getElementById('baproB').value = item.b || '';
  document.getElementById('baproQC').value = item.qc || '';
  document.getElementById('baproUpdate').value = item.update || '';

  // ===== Pecah keterangan ke input 1â€“5
  const ketMap = {1:"",2:"",3:"",4:"",5:""};
  if(item.keterangan){
    item.keterangan.split("\n").forEach(line=>{
      const m = line.match(/^\s*(\d+)\.\s*(.*)/);
      if(m){
        const no = parseInt(m[1]);
        if(no>=1 && no<=5){
          ketMap[no] = m[2].trim() || "";
        }
      }
    });
  }

  for(let i=1;i<=5;i++){
    const el = document.getElementById("ket"+i);
    if(el) el.value = ketMap[i];
  }

  // Pindah ke tab input Bapro
  showMenu('qcBapro');
  const tabBtn = document.querySelector('#qcBapro .tabs button[data-tab="inputBapro"]');
  if(tabBtn) switchTab(tabBtn);
}



// ====================== HAPUS ITEM (BAPRO) ======================
function deleteBapro(index) {
  const item = baproItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridBapro');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  const btnDelete = card?.querySelector('.btn-delete');
  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Bapro', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  setTimeout(() => {
    baproItems.splice(index, 1);
    if (card) card.remove();
    loadBaproItems();
  }, 8000);
}

// ======================= PASSWORD PROTECT DELETE BAPRO TANPA UBAH KODE ASLI (FIX LOOP) =======================
const DELETE_PASSWORD = "qc123"; 
const container = document.getElementById('gridBapro');
let bypassPassword = false; // flag untuk mencegah loop

if (container) {
  container.addEventListener('click', (e) => {
    const btn = e.target.closest('.btn-delete');
    if (!btn) return;

    if (bypassPassword) {
      // Klik asli, lewati password
      bypassPassword = false; // reset flag
      return; 
    }

    // cegah listener asli sementara
    e.preventDefault();
    e.stopImmediatePropagation();

    // Password prompt
    const pwd = prompt("Masukkan password untuk menghapus item ini:");
    if (pwd === null) return; // user cancel

    if (pwd === DELETE_PASSWORD) {
      // Password benar â†’ set flag supaya klik asli tidak terintercept
      bypassPassword = true;
      // trigger klik asli
      btn.click();
    } else {
      alert("Password salah. Aksi dibatalkan.");
    }
  }, true); // capture phase
}

// ====================== EDIT INLINE (BAPRO) ======================
function editBaproInline(index){
  const item = baproItems[index];
  const container = document.getElementById('gridBapro');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  const oldHtml = card.innerHTML;

  // Pecah keterangan 1â€“5
  const ketMap = {1:"",2:"",3:"",4:"",5:""};
  if(item.keterangan){
    item.keterangan.split("\n").forEach(line=>{
      const m = line.match(/^\s*(\d+)\.\s*(.*)/);
      if(m){
        const no = parseInt(m[1]);
        if(no>=1 && no<=5) ketMap[no] = m[2].trim() || "";
      }
    });
  }

  card.innerHTML = `
    <div class="edit-grid">

      <label class="edit-label">Nama Order</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">

      <label class="edit-label">CSO</label>
      <select class="edit-inline">
        <option value="" disabled ${!item.cso ? 'selected' : ''}>Pilih CSO</option>
        <option value="Yati" ${item.cso === 'Yati' ? 'selected' : ''}>Yati</option>
        <option value="Retni" ${item.cso === 'Retni' ? 'selected' : ''}>Retni</option>
        <option value="Aulia" ${item.cso === 'Aulia' ? 'selected' : ''}>Aulia</option>
        <option value="Yuli" ${item.cso === 'Yuli' ? 'selected' : ''}>Yuli</option>
      </select>

      <label class="edit-label">Jenis Kertas</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.jenisKertas||'')}" placeholder="Jenis Kertas">

      <label class="edit-label">Tebal Kertas</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.tebalKertas||'')}" placeholder="Tebal Kertas">

      <label class="edit-label">Nama Tinta</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.NamaTinta||'')}" placeholder="Nama Tinta">

      <label class="edit-label">Dmax</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.dmax||'')}" placeholder="Dmax">

      <label class="edit-label">L</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.l||'')}" placeholder="L">

      <label class="edit-label">A</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.a||'')}" placeholder="A">

      <label class="edit-label">B</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.b||'')}" placeholder="B">

      <label class="edit-label">QC</label>
      <select class="edit-inline">
        <option value="Marwan" ${item.qc==='Marwan'? 'selected':''}>Marwan</option>
        <option value="Kiki" ${item.qc==='Kiki'? 'selected':''}>Kiki</option>
      </select>

      <label class="edit-label">Update Status</label>
      <select class="edit-inline">
        <option value="Pending" ${item.update==='Pending'? 'selected':''}>Pending</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <label class="edit-label">Keterangan</label>
      <textarea class="edit-inline" rows="2" placeholder="Keterangan">
1. ${ketMap[1]}
2. ${ketMap[2]}
3. ${ketMap[3]}
4. ${ketMap[4]}
5. ${ketMap[5]}</textarea>

    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveBaproInline(${index}, this)">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelBaproInline(${index}, \`${encodeURIComponent(oldHtml)}\`)">âŒ</button>
    </div>
  `;
}



// ====================== BATAL EDIT INLINE (BAPRO) ======================
function cancelBaproInline(index, oldHtmlEncoded) {
  const container = document.getElementById('gridBapro');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if (!card) return;
  card.innerHTML = decodeURIComponent(oldHtmlEncoded);
}


// ====================== SIMPAN HASIL EDIT INLINE (BAPRO) ======================
async function saveBaproInline(index, btn) {
  const container = document.getElementById('gridBapro');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if (!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if (btnSave) { btnSave.textContent = 'â³ Menyimpan...'; btnSave.disabled = true; }
  if (btnCancel) btnCancel.style.display = 'none';

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    cso: inputs[1].value.trim(),
    jenisKertas: inputs[2].value.trim(),
    tebalKertas: inputs[3].value.trim(),
    NamaTinta: inputs[4].value.trim(),
    dmax: inputs[5].value.trim(),
    l: inputs[6].value.trim(),
    a: inputs[7].value.trim(),
    b: inputs[8].value.trim(),
    qc: inputs[9].value.trim(),
    update: inputs[10].value.trim(),
    keterangan: inputs[11].value.trim()
  };

  const orig = baproItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Bapro', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadBaproItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Coba lagi.');
  } finally {
    if (btnSave) { btnSave.textContent = 'ðŸ’¾ Simpan'; btnSave.disabled = false; }
  }
}




// ====================== FILTER BERDASARKAN ISI GRID (BAPRO) ======================
function filterBaproGrid(query){
  const grid = document.getElementById('gridBapro');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}

// ====================== CLEAR FORM (BAPRO) ======================
function clearBaproForm() {
  [
    'baproNama','baprocso','baproQC','baproUpdate'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Number / text fields
  ['baproJenis','baproKertas','baproNamaTinta','baproDmax','baproL','baproA','baproB'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Reset keterangan 1â€“5
  for (let i=1; i<=5; i++){
    const el = document.getElementById("ket"+i);
    if(el) el.value = '';
  }
}

// ====================== DASHBOARD BAPRO (COMPACT + FILTER + HIGHLIGHT) ======================
function renderDashboardBaproCompact(query = "", safeMode = false) {
  const q = query.toLowerCase().trim();

  const containerTO = document.getElementById('dashboardBaproTO');
  const containerProses = document.getElementById('dashboardBaproProses');
  const containerSelesai = document.getElementById('dashboardBaproSelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  baproItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal || "-";

    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "pending") statusClass = "status-pending";

    card.innerHTML = `
      <strong>Nama : ${highlightHtmlSafe(item.nama || '', query)}</strong><br>
      <strong>CSO : ${highlightHtmlSafe(item.cso || '', query)}</strong><br>
      <strong>QC : ${highlightHtmlSafe(item.qc || '', query)}</strong><br>
      <span>ðŸ“… ${highlightHtmlSafe(tanggal, query)}</span><br>
      <span class="${statusClass}">${highlightHtmlSafe(item.update || '', query)}</span>
    `;

    const cardText = card.textContent.toLowerCase();
    if (!safeMode && q && !cardText.includes(q)) return;

    if (updateVal === 'pending') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    card.addEventListener('click', () => showDetailModalBapro(item));
  });

  document.getElementById('countBapro').textContent = baproItems.length;
  document.getElementById('countTOBapro').textContent = totalTO;
  document.getElementById('countProsesBapro').textContent = totalProses;
  document.getElementById('countSelesaiBapro').textContent = totalSelesai;
}

// ====================== FILTER INPUT REAL-TIME BAPRO ======================
document.addEventListener('DOMContentLoaded', () => {
  const filterTO = document.getElementById('filterTOBapro');
  const filterProses = document.getElementById('filterProsesBapro');
  const filterSelesai = document.getElementById('filterSelesaiBapro');

  if (filterTO) filterTO.addEventListener('input', () => renderDashboardBaproCompact(filterTO.value));
  if (filterProses) filterProses.addEventListener('input', () => renderDashboardBaproCompact(filterProses.value));
  if (filterSelesai) filterSelesai.addEventListener('input', () => renderDashboardBaproCompact(filterSelesai.value));
});

// ====================== DETAIL BAPRO ======================
function showDetailModalBapro(item) {
  const body = document.getElementById("detailBaproBody");

  body.innerHTML = `
    <strong>Tanggal:</strong> ${item.tanggal || '-'}<br>
    <strong>Nama:</strong> ${item.nama || '-'}<br>
    <strong>CSO:</strong> ${item.cso || '-'}<br>
    <strong>Jenis:</strong> ${item.jenisKertas || '-'}<br>
    <strong>GSM:</strong> ${item.tebalKertas || '-'}<br>
    <strong>Nama Tinta:</strong> ${item.NamaTinta || '-'}<br>
    <strong>Dmax:</strong> ${item.dmax || '-'}<br>
    <strong>L:</strong> ${item.l || '-'}  
    <strong>A:</strong> ${item.a || '-'}  
    <strong>B:</strong> ${item.b || '-'}<br>
    <strong>QC:</strong> ${item.qc || '-'}<br>
    <strong>Update:</strong> 
      <span class="status-${(item.update || '').toLowerCase()}">
        ${item.update || '-'}
      </span><br><br>
    <strong>Keterangan:</strong><br>
    ${(item.keterangan || "-").replace(/\n/g, "<br>")}
  `;

  document.getElementById("detailBaproModal").style.display = "flex";
}

function closeDetailModalBapro() {
  document.getElementById("detailBaproModal").style.display = "none";
}

// ====================== TOGGLE VIEW + FILTER QC BAPRO ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTO = document.getElementById('toggleBaproTO');
  const btnProses = document.getElementById('toggleBaproProses');
  const btnSelesai = document.getElementById('toggleBaproSelesai');

  const sectionTO = document.getElementById('sectionBaproTO');
  const sectionProses = document.getElementById('sectionBaproProses');
  const sectionSelesai = document.getElementById('sectionBaproSelesai');

  const filterTO = document.getElementById('filterTOBapro');
  const filterProses = document.getElementById('filterProsesBapro');
  const filterSelesai = document.getElementById('filterSelesaiBapro');

  const gridTO = document.getElementById('dashboardBaproTO');
  const gridProses = document.getElementById('dashboardBaproProses');
  const gridSelesai = document.getElementById('dashboardBaproSelesai');

  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card');
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => card.style.display = card.textContent.toLowerCase().includes(term) ? '' : 'none');
  }

  [
    {input: filterTO, grid: gridTO},
    {input: filterProses, grid: gridProses},
    {input: filterSelesai, grid: gridSelesai}
  ].forEach(({input, grid}) => {
    if (input) input.addEventListener('input', () => filterCards(grid, input.value));
  });

  window.applyBaproFilters = function() {
    filterCards(gridTO, filterTO.value);
    filterCards(gridProses, filterProses.value);
    filterCards(gridSelesai, filterSelesai.value);
  };

  function toggleSection(section, btn) {
    const visible = section.style.display !== 'none';
    section.style.display = visible ? 'none' : 'block';
    btn.textContent = visible ? 'Show' : 'Hide';
  }

  if (btnTO) btnTO.addEventListener('click', () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener('click', () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener('click', () => toggleSection(sectionSelesai, btnSelesai));
});

// ===== Password untuk QC BAPRO (ubah sesuai kebutuhan) =====
const QC_BAPRO_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcBapro')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC BAPRO:');
      if (input === null) return;
      if (input === QC_BAPRO_PASSWORD) eval(originalOnClick);
      else alert('Password salah!');
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadBaproItems();

</script>







<!-- ====== JS QC PA â€“ Bagian 1 ===== -->
<script>
// ====================== GLOBAL STATE (PA) ======================
let paItems = []; // array yang diambil dari sheet PA

// ====================== RENDER GRID HASIL (PA) ======================
function renderGridPA(query = "") {
  const container = document.getElementById('gridPA');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  paItems.forEach((item, i) => {

    // Filter pencarian
    if (q && !(
      (item.nama || '').toLowerCase().includes(q) ||
      (item.noKS || '').toLowerCase().includes(q) ||
      (item.qc || '').toLowerCase().includes(q) ||
      (item.keterangan || '').toLowerCase().includes(q)
    )) return;

    const card = document.createElement('div');
    card.className = 'grid-card';
    card.dataset.index = i;

    // STATUS COLOR
    let statusClass = '';
    const updateVal = (item.update || '').toString();
    if (updateVal === "Proses") statusClass = "status-proses";
    else if (updateVal === "Selesai") statusClass = "status-selesai";
    else if (updateVal === "Pending") statusClass = "status-pending";

    const tanggal = item.tanggal ? `<strong>${highlightHtmlSafe(item.tanggal, q)}</strong><br>` : '';

    // ============================ NORMALISASI KETERANGAN 1â€“5 ============================
    const ketMap = {1:"-",2:"-",3:"-",4:"-",5:"-"};
    const raw = (item.keterangan || "").toString().trim();
    if(raw !== ""){
      raw.split("\n").forEach(line=>{
        const m = line.match(/^\s*(\d+)\.\s*(.*)/);
        if(m){
          const no = parseInt(m[1]);
          if(no>=1 && no<=5){
            ketMap[no] = m[2].trim() || "-";
          }
        }
      });
    }
    let ketsHtml = '';
    for(let j=1;j<=5;j++){
      ketsHtml += `<div>${j}. ${highlightHtmlSafe(ketMap[j], q)}</div>`;
    }

    // ============================ HTML ============================
    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${highlightHtmlSafe(item.nama || '', q)}</span><br>
        <span>No KS: ${highlightHtmlSafe(item.noKS || '', q)}</span><br>
        <span>Order: ${highlightHtmlSafe(item.order || '', q)}</span><br>
        <span>Bagus: ${highlightHtmlSafe(item.bagus || '', q)}</span><br>
        <span>Sortir: ${highlightHtmlSafe(item.sortir || '', q)}</span><br>
        <span>Problem: ${highlightHtmlSafe(item.problem || '', q)}</span><br>
        <span>QC: ${highlightHtmlSafe(item.qc || '', q)}</span><br>
        <span>Mesin: ${highlightHtmlSafe(item.mesin || '', q)}</span><br>
        <span><b>Keterangan:</b></span><br>
        <div class="ket-list">
          ${ketsHtml}
        </div>
        <br>
        <span class="${statusClass}">${highlightHtmlSafe(item.update || '', q)}</span>
      </div>

      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callPA(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editPAInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deletePA(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  renderDashboardPACompact();

  const lastCard = container.querySelector('.grid-card:last-child');
  if(lastCard) lastCard.scrollIntoView({behavior:'smooth',block:'end'});
}

// ====================== LOAD DATA DARI SPREADSHEET (PA) ======================
async function loadPAItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, {action:'get',sheet:'Cetak'});
    if(res && res.status==='ok' && Array.isArray(res.data)){
      paItems = res.data.map((it, idx)=>({__index:idx,id:(it.id||it._row||it.row||null),...it}));
      renderGridPA();
    } else console.warn('loadPAItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadPAItems', err);}
}

// ====================== TAMBAH DATA (PA) ======================
function addPAItem() {
  const nama = document.getElementById('paNama').value.trim();
  const noKS = document.getElementById('paNoKS').value.trim();
  const order = document.getElementById('paOrder') ? document.getElementById('paOrder').value.trim() : '';
  const bagus = document.getElementById('paBagus') ? document.getElementById('paBagus').value.trim() : '';
  const sortir = document.getElementById('paSortir') ? document.getElementById('paSortir').value.trim() : '';
  const problem = document.getElementById('paProblem') ? document.getElementById('paProblem').value.trim() : '';
  const qc = document.getElementById('paQC') ? document.getElementById('paQC').value.trim() : '';
  const mesin = document.getElementById('paMesin') ? document.getElementById('paMesin').value.trim() : '';
  const update = document.getElementById('paUpdate') ? document.getElementById('paUpdate').value.trim() : '';

  // ===== Gabungkan keterangan nomor 1â€“5 (FORMAT BAPRO) =====
  const keterangan =
    `1. ${document.getElementById("ketPA1").value}
2. ${document.getElementById("ketPA2").value}
3. ${document.getElementById("ketPA3").value}
4. ${document.getElementById("ketPA4").value}
5. ${document.getElementById("ketPA5").value}`;

// ====== VALIDASI BARU: TAMPILKAN HANYA FIELD YANG KOSONG ======
let kosong = [];

if (!nama) kosong.push("Nama Order");
if (!order) kosong.push("Nama Barang / Order");
if (!noKS) kosong.push("No KS");
if (!qc) kosong.push("QC");
if (!mesin) kosong.push("Mesin");
if (!update) kosong.push("Proses");

if (kosong.length > 0) {
  alert("Harap isi field berikut:\n- " + kosong.join("\n- "));
  return;
}
// =================================================================


// ====== KONFIRMASI INPUTAN (FORMAT RAPI TANPA ICON) ======
const konfirmasi = confirm(
  `Yakin ingin menambah data baru?\n\n` +
  `Nama Order : ${nama}\n` +
  `Order      : ${order}\n` +
  `No KS      : ${noKS}\n` +
  `QC         : ${qc}\n` +
  `Mesin      : ${mesin}\n` +
  `Proses     : ${update}`
);

if (!konfirmasi) return;
// =================================================================


  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = {
    action:'add', sheet:'Cetak', tanggal: tanggalFormatted,
    nama, noKS, order, bagus, sortir, problem, qc, mesin, update, keterangan
  };

  // ===== SPINNER =====
  const btnTambah = document.querySelector('#inputPA button');
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML;
      clearPAForm();
      loadPAItems();
      alert('âœ… Data PA berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    clearPAForm();
    setTimeout(() => loadPAItems(), 8000);
    alert('âœ… Data PA berhasil ditambahkan!');
  }
}

// ====================== PANGGIL (isi form dari item PA) â€” SESUAI QC LEM/BAPRO ======================
function callPA(index){
  const item = paItems[index];
  if(!item) return;

  // ===== Field normal =====
  document.getElementById('paNama').value = item.nama || '';
  document.getElementById('paNoKS').value = item.noKS || '';
  document.getElementById('paOrder').value = item.order || '';
  document.getElementById('paBagus').value = item.bagus || '';
  document.getElementById('paSortir').value = item.sortir || '';
  document.getElementById('paProblem').value = item.problem || '';
  document.getElementById('paQC').value = item.qc || '';
  document.getElementById('paMesin').value = item.mesin || '';
  document.getElementById('paUpdate').value = item.update || '';




  // ===== Pecah keterangan ke input 1â€“5 =====
  const ketMap = {1:"",2:"",3:"",4:"",5:""};
  if(item.keterangan){
    item.keterangan.split("\n").forEach(line=>{
      const m = line.match(/^\s*(\d+)\.\s*(.*)/);
      if(m){
        const no = parseInt(m[1]);
        if(no>=1 && no<=5){
          ketMap[no] = m[2].trim() || "";
        }
      }
    });
  }

  for(let i=1;i<=5;i++){
    const el = document.getElementById("ketPA"+i); // sesuai form PA
    if(el) el.value = ketMap[i];
  }

  // ===== Pindah ke tab INPUT PA =====
  showMenu('qcPA');
  const tabBtn = document.querySelector('#qcPA .tabs button[data-tab="inputPA"]');
  if(tabBtn) switchTab(tabBtn);
}




// ====================== HAPUS ITEM (PA) ======================
function deletePA(index){
  const item = paItems[index];
  if(!item) return;
  if(!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridPA');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  const btnDelete = card?.querySelector('.btn-delete');
  if(btnDelete){
    btnDelete.textContent='â³ Menghapus...';
    btnDelete.disabled=true;
  }

  const identifier = item.id||item._row||item.row||item.__index;
  const payload = {action:'delete',sheet:'Cetak',id:identifier,index:item.__index};

  postPayload(payload);

  setTimeout(()=>{
    paItems.splice(index,1);
    if(card) card.remove();
    loadPAItems();
  },8000);
}

// ======================= PASSWORD PROTECT DELETE PA =======================
const DELETE_PA_PASSWORD = "qc123"; // ganti sesuai kebutuhan
const paContainer = document.getElementById('gridPA');
let bypassPaPassword = false;

if (paContainer) {
  paContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.btn-delete');
    if (!btn) return;

    if (bypassPaPassword) {
      // Klik asli, lewati password
      bypassPaPassword = false;
      return;
    }

    // cegah listener asli sementara
    e.preventDefault();
    e.stopImmediatePropagation();

    // Password prompt
    const pwd = prompt("Masukkan password untuk menghapus item ini:");
    if (pwd === null) return; // user cancel

    if (pwd === DELETE_PA_PASSWORD) {
      // Password benar â†’ set flag supaya klik asli tidak terintercept
      bypassPaPassword = true;
      // trigger klik asli
      btn.click();
    } else {
      alert("Password salah. Aksi dibatalkan.");
    }
  }, true); // capture phase
}

// ====================== EDIT INLINE (PA) ======================
function editPAInline(index){
  const item = paItems[index];
  const container = document.getElementById('gridPA');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  const oldHtml = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">

      <label>Nama Order</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}">

      <label>No KS</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}">

      <label>Order</label>
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}">

      <label>Bagus</label>
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}">

      <label>Sortir</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.sortir||'')}">

      <label>Problem</label>
      <input type="text" class="edit-inline" value="${escapeHtml(item.problem||'')}">

      <label>QC</label>
      <select class="edit-inline">
        <option value="Suci" ${item.qc==='Suci'? 'selected':''}>Suci</option>
        <option value="Anjani" ${item.qc==='Anjani'? 'selected':''}>Anjani</option>
      </select>

      <label>Mesin</label>
      <select class="edit-inline">
        <option value="KM 640" ${item.mesin==='KM 640'? 'selected':''}>KM 640</option>
        <option value="KM 644" ${item.mesin==='KM 644'? 'selected':''}>KM 644</option>
        <option value="KM 620" ${item.mesin==='KM 620'? 'selected':''}>KM 620</option>
        <option value="MT 430" ${item.mesin==='MT 430'? 'selected':''}>MT 430</option>
        <option value="KM 640 GL" ${item.mesin==='KM 640 GL'? 'selected':''}>KM 640 GL</option>
        <option value="RL 140" ${item.mesin==='RL 140'? 'selected':''}>RL 140</option>
      </select>

      <label>Status</label>
      <select class="edit-inline">
        <option value="Pending" ${item.update==='Pending'? 'selected':''}>Pending</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <label>Keterangan</label>
      <textarea class="edit-inline" rows="2">${escapeHtml(item.keterangan||'')}</textarea>

    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="savePAInline(${index}, this)">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelPAInline(${index}, \`${encodeURIComponent(oldHtml)}\`)">âŒ</button>
    </div>
  `;
}


// ====================== BATAL EDIT INLINE (PA) ======================
function cancelPAInline(index, oldHtmlEncoded){
  const container = document.getElementById('gridPA');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if(!card) return;
  card.innerHTML = decodeURIComponent(oldHtmlEncoded);
}

// ====================== SIMPAN HASIL EDIT INLINE (PA) ======================
async function savePAInline(index, btn){
  const container = document.getElementById('gridPA');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if(!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if(btnSave){ btnSave.textContent='â³ Menyimpan...'; btnSave.disabled=true;}
  if(btnCancel) btnCancel.style.display='none';

  const inputs = card.querySelectorAll('.edit-inline');
const updated = {
  nama: inputs[0].value.trim(),
  noKS: inputs[1].value.trim(),
  order: inputs[2].value.trim(),
  bagus: inputs[3].value.trim(),
  sortir: inputs[4].value.trim(),     // â† baru
  problem: inputs[5].value.trim(),    // â† baru
  qc: inputs[6].value,
  mesin: inputs[7].value.trim(),
  update: inputs[8].value,
  keterangan: inputs[9].value.trim()
};



  const orig = paItems[index];
  const identifier = orig.id||orig._row||orig.row||orig.__index;
  const tanggalFormatted = orig.tanggal||new Date().toLocaleString('id-ID',{
    day:'2-digit',month:'long',year:'numeric',
    hour:'2-digit',minute:'2-digit',second:'2-digit'
  });

  const payload = {...updated,action:'update',sheet:'Cetak',id:identifier,index:orig.__index,tanggal:tanggalFormatted};

  try{
    await postPayload(payload);
    await new Promise(res=>setTimeout(res,5000));
    await loadPAItems();
  }catch(err){
    console.error('Gagal menyimpan:',err);
    alert('Gagal menyimpan data. Coba lagi.');
  }finally{
    if(btnSave){ btnSave.textContent='ðŸ’¾ Simpan'; btnSave.disabled=false; }
  }
}





// ====================== FILTER BERDASARKAN ISI GRID ======================
function filterPAGrid(query){
  const grid = document.getElementById('gridPA');
  if(!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card=>{
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}

// ====================== CLEAR FORM (PA) ======================
function clearPAForm(){
  ['paNama','paNoKS','paQC','paUpdate'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.value='';
  });

  ['paOrder','paBagus'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.value=0;
  });

  // reset keterangan 1â€“5
  for(let i=1;i<=5;i++){
    const el=document.getElementById('ketPA'+i);
    if(el) el.value='';
  }
}


// ====================== DASHBOARD PA (COMPACT + FILTER + HIGHLIGHT + % HASIL) ======================
function renderDashboardPACompact(query = "", safeMode = false) {
  const q = query.toLowerCase().trim();

  const containerTO = document.getElementById('dashboardPATO');
  const containerProses = document.getElementById('dashboardPAProses');
  const containerSelesai = document.getElementById('dashboardPASelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  // helper angka aman
  const num = (v) => {
    if (!v) return 0;
    const clean = String(v).replace(/[^0-9.-]/g, "");
    const n = Number(clean);
    return isNaN(n) ? 0 : n;
  };

  paItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal || "-";

    // ========== PERHITUNGAN PA ==========
    const order   = num(item.order);
    const bagus   = num(item.bagus);
    const sortir  = num(item.sortir);
    const problem = num(item.problem);

    // hasil bersih = bagus - sortir - problem
    let hasilBersih = bagus - sortir - problem;
    if (hasilBersih < 0) hasilBersih = 0;

    const persen = order > 0 ? ((hasilBersih / order) * 100).toFixed(1) : "0.0";

    // ========== RENDER CARD ==========
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "pending") statusClass = "status-pending";

    card.innerHTML = `
      <strong>Nama : ${highlightHtmlSafe(item.nama || '', query)}</strong><br>
      <strong>QC : ${highlightHtmlSafe(item.qc || '', query)}</strong><br>
      <strong>Mesin : ${highlightHtmlSafe(item.mesin || '', query)}</strong><br>
      <span>ðŸ“… ${highlightHtmlSafe(tanggal, query)}</span><br>

      <!-- ====== BOX PERSENTASE HASIL (ACUAN FINISHING) ====== -->
      <div style="
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin:6px 0 8px;
        background:#9ac8ff;
        padding:6px 10px;
        border-radius:8px;
        font-weight:700;
        color:#003a80;
        border:1px solid #5fa8ff;
      ">
        <span style="font-weight:600; font-size:0.92rem;">Hasil:</span>
        <span style="display:inline-block; min-width:64px; text-align:right;">${persen}%</span>
      </div>

      <span class="${statusClass}">
        ${highlightHtmlSafe(item.update || '', query)}
      </span>
    `;

    // FILTER
    const cardText = card.textContent.toLowerCase();
    if (!safeMode && q && !cardText.includes(q)) return;

    // KATEGORI
    if (updateVal === 'pending') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    // click membuka modal detail
    card.addEventListener('click', () => showDetailModalPA(item));
  });

  // COUNTER
  document.getElementById('countPA').textContent = paItems.length;
  document.getElementById('countTOPA').textContent = totalTO;
  document.getElementById('countProsesPA').textContent = totalProses;
  document.getElementById('countSelesaiPA').textContent = totalSelesai;
}


// ====================== FILTER INPUT REAL-TIME PA ======================
document.addEventListener('DOMContentLoaded', () => {
  const filterTO = document.getElementById('filterPATO');
  const filterProses = document.getElementById('filterPAProses');
  const filterSelesai = document.getElementById('filterPASelesai');

  if (filterTO) filterTO.addEventListener('input', () => renderDashboardPACompact(filterTO.value));
  if (filterProses) filterProses.addEventListener('input', () => renderDashboardPACompact(filterProses.value));
  if (filterSelesai) filterSelesai.addEventListener('input', () => renderDashboardPACompact(filterSelesai.value));
});

// ====================== DETAIL PA (VERSI LENGKAP) ======================
function showDetailModalPA(item){
  const body = document.getElementById('detailCetakBody');

  body.innerHTML = `
    <strong>Tanggal:</strong> ${item.tanggal || '-'}<br>
    <strong>Nama:</strong> ${item.nama || '-'}<br>
    <strong>No KS:</strong> ${item.noKS || '-'}<br>
    <strong>Order:</strong> ${item.order || '-'}<br>
    <strong>Bagus:</strong> ${item.bagus || '-'}<br>
    <strong>Sortir:</strong> ${item.sortir || '-'}<br>
    <strong>Problem:</strong> ${item.problem || '-'}<br>
    <strong>QC:</strong> ${item.qc || '-'}<br>
    <strong>Mesin:</strong> ${item.mesin || '-'}<br>
    <strong>Update:</strong>
      <span class="status-${(item.update || '').toLowerCase()}">
        ${item.update || '-'}
      </span><br><br>

    <strong>Keterangan:</strong><br>
    ${(item.keterangan || "-").replace(/\n/g,'<br>')}
  `;

  document.getElementById('detailCetakModal').style.display = 'flex';
}

function closeDetailModalCetak(){
  document.getElementById('detailCetakModal').style.display = 'none';
}


// ====================== TOGGLE VIEW + FILTER QC PA ======================
document.addEventListener('DOMContentLoaded', ()=>{
  const btnTO=document.getElementById('togglePATO');
  const btnProses=document.getElementById('togglePAProses');
  const btnSelesai=document.getElementById('togglePASelesai');

  const sectionTO=document.getElementById('sectionPATO');
  const sectionProses=document.getElementById('sectionPAProses');
  const sectionSelesai=document.getElementById('sectionPASelesai');

  const filterTO=document.getElementById('filterPATO');
  const filterProses=document.getElementById('filterPAProses');
  const filterSelesai=document.getElementById('filterPASelesai');

  const gridTO=document.getElementById('dashboardPATO');
  const gridProses=document.getElementById('dashboardPAProses');
  const gridSelesai=document.getElementById('dashboardPASelesai');

  function filterCards(container, keyword){
    if(!container) return;
    const cards=container.querySelectorAll('.grid-card');
    const term=keyword.toLowerCase().trim();
    cards.forEach(card=>{
      const text=card.textContent.toLowerCase();
      card.style.display=text.includes(term)?'':'none';
    });
  }

  [{input:filterTO,grid:gridTO},{input:filterProses,grid:gridProses},{input:filterSelesai,grid:gridSelesai}]
  .forEach(({input,grid})=>{
    if(input) input.addEventListener('input',()=>filterCards(grid,input.value));
  });

  window.applyPAFilters=function(){
    filterCards(gridTO,filterTO.value);
    filterCards(gridProses,filterProses.value);
    filterCards(gridSelesai,filterSelesai.value);
  };

  function toggleSection(section,btn){
    const visible=section.style.display!=='none';
    section.style.display=visible?'none':'block';
    btn.textContent=visible?'Show':'Hide';
  }

  if(btnTO) btnTO.addEventListener('click',()=>toggleSection(sectionTO,btnTO));
  if(btnProses) btnProses.addEventListener('click',()=>toggleSection(sectionProses,btnProses));
  if(btnSelesai) btnSelesai.addEventListener('click',()=>toggleSection(sectionSelesai,btnSelesai));
});

// ===== Password untuk QC PA (ubah sesuai kebutuhan) =====
const QC_PA_PASSWORD='qc123';
document.addEventListener('DOMContentLoaded',()=>{
  const btn=document.querySelector(`nav button[onclick="showMenu('qcPA')"]`);
  if(btn){
    const originalOnClick=btn.getAttribute('onclick');
    btn.onclick=function(e){
      e.preventDefault();
      const input=prompt('Masukkan password untuk QC CETAK:');
      if(input===null) return;
      if(input===QC_PA_PASSWORD){ eval(originalOnClick); }
      else{ alert('Password salah!'); }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadPAItems();
</script>









<!-- ====== JS QC LEM (paste this after script utama, format disesuaikan dg QC Finishing) -->
<script>
// ====================== GLOBAL STATE (LEM) ======================
let lemItems = []; // array yang diambil dari sheet Lem


// ====================== RENDER GRID HASIL (LEM) DENGAN BS DETAIL ======================
function renderGridLem(query = "") {
  const container = document.getElementById('gridLem');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  lemItems.forEach((item, i) => {

    // Filter pencarian
    if (q && !(
      (item.nama || '').toLowerCase().includes(q) ||
      (item.noKS || '').toLowerCase().includes(q) ||
      (item.qc || '').toLowerCase().includes(q) ||
      (item.keterangan || '').toLowerCase().includes(q)
    )) return;

    const card = document.createElement('div');
    card.className = 'grid-card';
    card.dataset.index = i;

    // STATUS COLOR
    let statusClass = '';
    const updateVal = (item.update || '').toString();
    if (updateVal === "Proses") statusClass = "status-proses";
    else if (updateVal === "Selesai") statusClass = "status-selesai";
    else if (updateVal === "Pending") statusClass = "status-pending";

    const tanggal = item.tanggal ? `<strong>${highlightHtmlSafe(item.tanggal, q)}</strong><br>` : '';

    // ============================ NORMALISASI KETERANGAN 1â€“5 ============================
    const ketMap = {1:"-",2:"-",3:"-",4:"-",5:"-"};
    const raw = (item.keterangan || "").toString().trim();
    if(raw !== ""){
      raw.split("\n").forEach(line=>{
        const m = line.match(/^\s*(\d+)\.\s*(.*)/);
        if(m){
          const no = parseInt(m[1]);
          if(no>=1 && no<=5){
            ketMap[no] = m[2].trim() || "-";
          }
        }
      });
    }
    let ketsHtml = '';
    for(let j=1; j<=5; j++){
      ketsHtml += `<div>${j}. ${highlightHtmlSafe(ketMap[j], q)}</div>`;
    }

    // ============================ HTML ============================
    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${highlightHtmlSafe(item.nama || '', q)}</span><br>
        <span>No KS: ${highlightHtmlSafe(item.noKS || '', q)}</span><br>
        <span>Order: ${highlightHtmlSafe(item.order || '', q)}</span><br>
        <span>Isi/Dus: ${highlightHtmlSafe(item.isi || '', q)}</span><br>
        <span>Bagus: ${highlightHtmlSafe(item.bagus || '', q)}</span><br>
        <span>Total BS: ${highlightHtmlSafe(item.lemJenisBS || '', q)}</span><br>
        <span>BS Cetak: ${highlightHtmlSafe(item.lemJenisBS1 || '', q)}</span><br>
        <span>BS Lem: ${highlightHtmlSafe(item.lemJenisBS12 || '', q)}</span><br>
        <span>BS Ponch: ${highlightHtmlSafe(item.lemJenisBS13 || '', q)}</span><br>
        <span>BS Varnish: ${highlightHtmlSafe(item.lemJenisBS14 || '', q)}</span><br>
        <span>BS Potong: ${highlightHtmlSafe(item.lemJenisBS15 || '', q)}</span><br>
        <span>QC: ${highlightHtmlSafe(item.qc || '', q)}</span><br>

        <span><b>Keterangan:</b></span><br>
        <div class="ket-list">
          ${ketsHtml}
        </div>

        <br>
        <span class="${statusClass}">${highlightHtmlSafe(item.update || '', q)}</span>
      </div>

      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callLem(${i})">ðŸ“¤</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editLemInline(${i})">âœï¸</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteLem(${i})">ðŸ—‘ï¸</button>
      </div>
    `;

    container.appendChild(card);
  });

  renderDashboardLemCompact();

  // Auto-scroll ke item terakhir
  const lastCard = container.querySelector('.grid-card:last-child');
  if (lastCard) lastCard.scrollIntoView({ behavior: 'smooth', block: 'end' });
}





// ====================== LOAD DATA DARI SPREADSHEET (LEM) ======================
async function loadLemItems(){
  try{
    // gunakan WEBAPP_URL (sama seperti Finishing) dan sheet 'Lem'
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Lem' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      lemItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridLem();
    } else console.warn('loadLemItems unexpected', res);
  }catch(err){ console.error('âš ï¸ Error loadLemItems', err); }
}


// ====================== TAMBAH DATA (LEM) DENGAN BS DETAIL ======================
function addLemItem() {
  const nama = document.getElementById('lemNama').value.trim();
  const noKS = document.getElementById('lemNoKS').value.trim();
  const order = document.getElementById('lemOrder')?.value.trim() || '';
  const isi = document.getElementById('lemIsi')?.value.trim() || '';
  const bagus = document.getElementById('lemBagus')?.value.trim() || '';
  const lemJenisBS = document.getElementById('lemJenisBS')?.value.trim() || '';
  const lemJenisBS1 = document.getElementById('lemJenisBS1')?.value.trim() || '';
  const lemJenisBS12 = document.getElementById('lemJenisBS12')?.value.trim() || '';
  const lemJenisBS13 = document.getElementById('lemJenisBS13')?.value.trim() || '';
  const lemJenisBS14 = document.getElementById('lemJenisBS14')?.value.trim() || '';
  const lemJenisBS15 = document.getElementById('lemJenisBS15')?.value.trim() || '';
  const qc = document.getElementById('lemQC')?.value.trim() || '';
  const update = document.getElementById('lemUpdate')?.value.trim() || '';

  // Gabungkan keterangan nomor 1â€“5
  const keterangan =
`1. ${document.getElementById("lemKet1")?.value || ''}
2. ${document.getElementById("lemKet2")?.value || ''}
3. ${document.getElementById("lemKet3")?.value || ''}
4. ${document.getElementById("lemKet4")?.value || ''}
5. ${document.getElementById("lemKet5")?.value || ''}`;

// ====== VALIDASI BARU: TAMPILKAN HANYA FIELD YANG KOSONG ======
let kosong = [];

if (!nama) kosong.push("Nama Order");
if (!noKS) kosong.push("No KS");
if (!qc) kosong.push("QC");
if (!update) kosong.push("Proses");

if (kosong.length > 0) {
  alert("Harap isi field berikut:\n- " + kosong.join("\n- "));
  return;
}
// =================================================================


// ====== KONFIRMASI INPUTAN (FORMAT RAPI TANPA ICON) ======
const konfirmasi = confirm(
  `Yakin ingin menambah data baru?\n\n` +
  `Nama Order : ${nama}\n` +
  `No KS      : ${noKS}\n` +
  `QC         : ${qc}\n` +
  `Proses     : ${update}`
);

if (!konfirmasi) return;
// =================================================================


  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit', month:'long', year:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  });

  const payload = { 
    action:'add', 
    sheet:'Lem', 
    tanggal: tanggalFormatted,
    nama,noKS,order,isi,bagus,lemJenisBS,lemJenisBS1,lemJenisBS12,lemJenisBS13,lemJenisBS14,lemJenisBS15,qc,update,keterangan
  };

  const btnTambah = document.querySelector('#inputLem button');
  if (btnTambah) {
    btnTambah.disabled = true;
    const originalHTML = btnTambah.innerHTML;
    btnTambah.innerHTML = `<div class="spinner"></div> Menyimpan...`;

    postPayload(payload);

    setTimeout(() => {
      btnTambah.disabled = false;
      btnTambah.innerHTML = originalHTML;
      if (typeof clearLemForm === 'function') clearLemForm();
      loadLemItems();
      alert('âœ… Data Lem berhasil ditambahkan!');
    }, 8000);
  } else {
    postPayload(payload);
    if (typeof clearLemForm === 'function') clearLemForm();
    setTimeout(() => loadLemItems(), 8000);
    alert('âœ… Data Lem berhasil ditambahkan!');
  }
}



// ====================== PANGGIL (isi form dari item) ======================
function callLem(index){
  const item = lemItems[index];
  if(!item) return;

  document.getElementById('lemNama').value = item.nama || '';
  document.getElementById('lemNoKS').value = item.noKS || '';
  document.getElementById('lemOrder').value = item.order || '';
  document.getElementById('lemIsi').value = item.isi || '';
  document.getElementById('lemBagus').value = item.bagus || '';
  document.getElementById('lemJenisBS').value = item.lemJenisBS || '';

  // BS detail baru
  document.getElementById('lemJenisBS1').value = item.lemJenisBS1 || '';
  document.getElementById('lemJenisBS12').value = item.lemJenisBS12 || '';
  document.getElementById('lemJenisBS13').value = item.lemJenisBS13 || '';
  document.getElementById('lemJenisBS14').value = item.lemJenisBS14 || '';
  document.getElementById('lemJenisBS15').value = item.lemJenisBS15 || '';

  document.getElementById('lemQC').value = item.qc || '';
  document.getElementById('lemUpdate').value = item.update || '';

  // ===== Pecah keterangan ke input 1â€“5 =====
  const lines = (item.keterangan || "").split("\n");
  for(let i=1; i<=5; i++){
    const el = document.getElementById("lemKet"+i);
    if(el) el.value = (lines[i-1] || "").replace(`${i}. `, "");
  }

  // ===== Pindah ke tab LEM INPUT =====
  showMenu('qcLem');
  const tabBtn = document.querySelector('#qcLem .tabs button[data-tab="inputLem"]');
  if(tabBtn) switchTab(tabBtn);
}


// ====================== HAPUS ITEM (LEM) ======================
function deleteLem(index) {
  const item = lemItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridLem');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = 'â³ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = {
    action: 'delete',
    sheet: 'Lem',
    id: identifier,
    index: item.__index
  };

  postPayload(payload);

  // ðŸ”¹ Delay pendek agar sheet sempat proses, lalu update UI
  setTimeout(() => {
    // Hapus item dari array & DOM agar langsung hilang dari grid
    lemItems.splice(index, 1);
    if (card) card.remove();

    // Muat ulang data agar sinkron dengan Google Sheet
    loadLemItems();
  }, 8000);
}

// ======================= PASSWORD PROTECT DELETE LEM =======================
const DELETE_LEM_PASSWORD = "qc123"; // ganti sesuai kebutuhan
const lemContainer = document.getElementById('gridLem');
let bypassLemPassword = false;

if (lemContainer) {
  lemContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.btn-delete');
    if (!btn) return;

    if (bypassLemPassword) {
      // Klik asli, lewati password
      bypassLemPassword = false;
      return;
    }

    // cegah listener asli sementara
    e.preventDefault();
    e.stopImmediatePropagation();

    // Password prompt
    const pwd = prompt("Masukkan password untuk menghapus item ini:");
    if (pwd === null) return; // user cancel

    if (pwd === DELETE_LEM_PASSWORD) {
      // Password benar â†’ set flag supaya klik asli tidak terintercept
      bypassLemPassword = true;
      // trigger klik asli
      btn.click();
    } else {
      alert("Password salah. Aksi dibatalkan.");
    }
  }, true); // capture phase
}

// ====================== EDIT INLINE (LEM) DENGAN BS DETAIL + LABEL ======================
function editLemInline(index){
  const item = lemItems[index];
  const container = document.getElementById('gridLem');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  const oldHtml = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">

      <label>Nama Order</label>
      <input type="text" class="edit-inline" name="nama" value="${escapeHtml(item.nama||'')}">

      <label>No KS</label>
      <input type="text" class="edit-inline" name="noKS" value="${escapeHtml(item.noKS||'')}">

      <label>Order</label>
      <input type="number" class="edit-inline" name="order" value="${escapeHtml(item.order||'')}">

      <label>Isi/Dus</label>
      <input type="number" class="edit-inline" name="isi" value="${escapeHtml(item.isi||'')}">

      <label>Bagus</label>
      <input type="number" class="edit-inline" name="bagus" value="${escapeHtml(item.bagus||'')}">

      <label>BS Total</label>
      <input type="number" class="edit-inline" name="jenisBS" value="${escapeHtml(item.lemJenisBS||'')}">

      <label>BS Cetak</label>
      <input type="number" class="edit-inline" name="jenisBS1" value="${escapeHtml(item.lemJenisBS1||'')}">

      <label>BS Lem</label>
      <input type="number" class="edit-inline" name="jenisBS12" value="${escapeHtml(item.lemJenisBS12||'')}">

      <label>BS Ponch</label>
      <input type="number" class="edit-inline" name="jenisBS13" value="${escapeHtml(item.lemJenisBS13||'')}">

      <label>BS Varnish</label>
      <input type="number" class="edit-inline" name="jenisBS14" value="${escapeHtml(item.lemJenisBS14||'')}">

      <label>BS Potong</label>
      <input type="number" class="edit-inline" name="jenisBS15" value="${escapeHtml(item.lemJenisBS15||'')}">

      <label>QC</label>
      <select class="edit-inline" name="qc">
        <option value="Martini" ${item.qc==='Martini'? 'selected':''}>Martini</option>
        <option value="Krestin" ${item.qc==='Krestin'? 'selected':''}>Krestin</option>
        <option value="Ismie" ${item.qc==='Ismie'? 'selected':''}>Ismie</option>
      </select>

      <label>Status</label>
      <select class="edit-inline" name="update">
        <option value="Pending" ${item.update==='Pending'? 'selected':''}>Pending</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <label>Keterangan</label>
      <textarea class="edit-inline" name="keterangan" rows="2">${escapeHtml(item.keterangan||'')}</textarea>

    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveLemInline(${index}, this)">ðŸ’¾</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelLemInline(${index}, \`${encodeURIComponent(oldHtml)}\`)">âŒ</button>
    </div>
  `;
}



// ====================== BATAL EDIT INLINE (LEM) ======================
function cancelLemInline(index, oldHtmlEncoded) {
  const container = document.getElementById('gridLem');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);

  if (!card) return;
  card.innerHTML = decodeURIComponent(oldHtmlEncoded);
}

// ====================== SIMPAN HASIL EDIT INLINE (LEM) DENGAN BS DETAIL ======================
async function saveLemInline(index, btn) {
  const container = document.getElementById('gridLem');
  const card = container.querySelector(`.grid-card[data-index="${index}"]`);
  if (!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if (btnSave) {
    btnSave.textContent = 'â³ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none';

  const inputs = card.querySelectorAll('.edit-inline');

  // Sesuaikan urutan dengan editLemInline (nama, noKS, order, isi, bagus, jenisBS, jenisBS1, jenisBS12â€“15, qc, update, keterangan)
  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    lemJenisBS: inputs[5].value.trim(),       // Total BS
    lemJenisBS1: inputs[6].value.trim(),      // BS Cetak
    lemJenisBS12: inputs[7].value.trim(),     // BS Lem
    lemJenisBS13: inputs[8].value.trim(),     // BS Ponch
    lemJenisBS14: inputs[9].value.trim(),     // BS Varnish
    lemJenisBS15: inputs[10].value.trim(),    // BS Potong
    qc: inputs[11].value,
    update: inputs[12].value,
    keterangan: inputs[13].value.trim()
  };

  const orig = lemItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Lem', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadLemItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'ðŸ’¾ Simpan';
      btnSave.disabled = false;
    }
  }
}





// ====================== FILTER BERDASARKAN ISI GRID ======================
function filterLemGrid(query){
  const grid = document.getElementById('gridLem');
  if (!grid) return;

  const keyword = query.toLowerCase().trim();
  const cards = grid.querySelectorAll('.grid-card');

  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(keyword) ? '' : 'none';
  });
}


// ====================== CLEAR FORM (LEM) DENGAN BS DETAIL ======================
function clearLemForm() {
  // Reset teks umum
  ['lemNama','lemNoKS','lemQC','lemUpdate'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // Reset semua number fields, termasuk BS baru
  [
    'lemOrder','lemIsi','lemBagus','lemJenisBS',
    'lemJenisBS1','lemJenisBS12','lemJenisBS13','lemJenisBS14','lemJenisBS15'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = 0;
  });

  // Reset keterangan 1â€“5
  for (let i = 1; i <= 5; i++) {
    const el = document.getElementById("lemKet"+i);
    if (el) el.value = '';
  }
}



// ====================== DASHBOARD LEM (AKURAT 100%) ======================
function renderDashboardLemCompact(query = "", safeMode = false) {
  const q = query.toLowerCase().trim();

  const containerTO = document.getElementById('dashboardLemTO');
  const containerProses = document.getElementById('dashboardLemProses');
  const containerSelesai = document.getElementById('dashboardLemSelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  // parsing angka aman
  const num = v => {
    if (!v) return 0;
    const clean = String(v).replace(/[^0-9.\-]/g, '');
    const n = Number(clean);
    return isFinite(n) ? n : 0;
  };

  lemItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal || "-";

    // =======================
    // NILAI LEM (FINAL)
    // =======================
    const order = num(item.order);
    const isi   = num(item.isi);
    const bagus = num(item.bagus);

    // total BS = semua BS LEM
    const totalBS =
        num(item.lemJenisBS)  +
        num(item.lemJenisBS1) +
        num(item.lemJenisBS12) +
        num(item.lemJenisBS13) +
        num(item.lemJenisBS14) +
        num(item.lemJenisBS15);

    // hasil bersih
    const hasilBersih = Math.max(0, bagus - totalBS);

    // persentase
    const persen = order > 0 ? ((hasilBersih / order) * 100).toFixed(1) : "0.0";

    // =======================
    // TEMPLATE CARD
    // =======================
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "pending") statusClass = "status-pending";

    card.innerHTML = `
      <strong>Nama : ${highlightHtmlSafe(item.nama || '', q)}</strong><br>
      <strong>QC : ${highlightHtmlSafe(item.qc || '', q)}</strong><br>
      <span>ðŸ“… ${highlightHtmlSafe(tanggal, q)}</span><br>

      <!-- HASIL -->
      <div style="
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin:4px 0 6px;
        background:#9ac8ff;
        padding:6px 10px;
        border-radius:8px;
        font-weight:700;
        color:#003a80;
        border:1px solid #5fa8ff;
      ">
        <span style="font-weight:600; font-size:0.92rem;">Hasil:</span>
        <span style="display:inline-block; min-width:64px; text-align:right;">${persen}%</span>
      </div>

      <span class="${statusClass}">
        ${highlightHtmlSafe(item.update || '', q)}
      </span>
    `;

    // FILTER
    const cardText = card.textContent.toLowerCase();
    if (!safeMode && q && !cardText.includes(q)) return;

    // KATEGORI
    if (updateVal === 'pending') { containerTO.appendChild(card); totalTO++; }
    else if (updateVal === 'proses') { containerProses.appendChild(card); totalProses++; }
    else if (updateVal === 'selesai') { containerSelesai.appendChild(card); totalSelesai++; }

    card.addEventListener('click', () => showDetailModalLem(item));
  });

  // COUNTER
  document.getElementById('countLem').textContent = lemItems.length;
  document.getElementById('countTOLem').textContent = totalTO;
  document.getElementById('countProsesLem').textContent = totalProses;
  document.getElementById('countSelesaiLem').textContent = totalSelesai;
}

// ====================== FILTER INPUT REAL-TIME LEM ======================
document.addEventListener('DOMContentLoaded', () => {
  const filterTO = document.getElementById('filterTOLem');
  const filterProses = document.getElementById('filterProsesLem');
  const filterSelesai = document.getElementById('filterSelesaiLem');

  if (filterTO) filterTO.addEventListener('input', () => renderDashboardLemCompact(filterTO.value));
  if (filterProses) filterProses.addEventListener('input', () => renderDashboardLemCompact(filterProses.value));
  if (filterSelesai) filterSelesai.addEventListener('input', () => renderDashboardLemCompact(filterSelesai.value));
});

// ====================== DETAIL LEM ======================
function showDetailModalLem(item) {
  const body = document.getElementById("detailLemBody");

  body.innerHTML = `
    <strong>Tanggal:</strong> ${item.tanggal || '-'}<br>
    <strong>Nama:</strong> ${item.nama || '-'}<br>
    <strong>No KS:</strong> ${item.noKS || '-'}<br>
    <strong>Order:</strong> ${item.order || '-'}<br>
    <strong>Isi/Dus:</strong> ${item.isi || '-'}<br>
    <strong>Bagus:</strong> ${item.bagus || '-'}<br>
    <strong>Total BS:</strong> ${item.lemJenisBS}<br>
    <strong>BS Cetak:</strong> ${item.lemJenisBS1}<br>
    <strong>BS Lem:</strong> ${item.lemJenisBS12}<br>
    <strong>BS Ponch:</strong> ${item.lemJenisBS13}<br>
    <strong>BS Varnish:</strong> ${item.lemJenisBS14}<br>
    <strong>BS Potong:</strong> ${item.lemJenisBS15}<br>
    <strong>QC:</strong> ${item.qc || '-'}<br>
    <strong>Update:</strong> 
      <span class="status-${(item.update || '').toLowerCase()}">
        ${item.update || '-'}
      </span><br><br>

    <strong>Keterangan:</strong><br>
    ${(item.keterangan || "-").replace(/\n/g, "<br>")}
  `;

  document.getElementById("detailLemModal").style.display = "flex";
}

function closeDetailModalLem() {
  document.getElementById("detailLemModal").style.display = "none";
}


// ====================== TOGGLE VIEW + FILTER QC LEM ======================
document.addEventListener('DOMContentLoaded', () => {
  // Tombol
  const btnTO = document.getElementById('toggleLemTO');
  const btnProses = document.getElementById('toggleLemProses');
  const btnSelesai = document.getElementById('toggleLemSelesai');

  // Section
  const sectionTO = document.getElementById('sectionLemTO');
  const sectionProses = document.getElementById('sectionLemProses');
  const sectionSelesai = document.getElementById('sectionLemSelesai');

  // Filter input
  const filterTO = document.getElementById('filterTOLem');
  const filterProses = document.getElementById('filterProsesLem');
  const filterSelesai = document.getElementById('filterSelesaiLem');

  // Grid container
  const gridTO = document.getElementById('dashboardLemTO');
  const gridProses = document.getElementById('dashboardLemProses');
  const gridSelesai = document.getElementById('dashboardLemSelesai');

  // ðŸ” Fungsi filter universal (per grid)
  function filterCards(container, keyword) {
    if (!container) return;
    const cards = container.querySelectorAll('.grid-card');
    const term = keyword.toLowerCase().trim();
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(term) ? '' : 'none';
    });
  }

  // Event input untuk filter real-time
  [
    {input: filterTO, grid: gridTO},
    {input: filterProses, grid: gridProses},
    {input: filterSelesai, grid: gridSelesai}
  ].forEach(({input, grid}) => {
    if (input) {
      input.addEventListener('input', () => filterCards(grid, input.value));
    }
  });

  // Fungsi supaya filter tetap aktif setelah reload data
  window.applyLemFilters = function() {
    filterCards(gridTO, filterTO.value);
    filterCards(gridProses, filterProses.value);
    filterCards(gridSelesai, filterSelesai.value);
  };

  // Toggle show/hide tiap section
  function toggleSection(section, btn) {
    const visible = section.style.display !== 'none';
    section.style.display = visible ? 'none' : 'block';
    btn.textContent = visible ? 'Show' : 'Hide';
  }

  if (btnTO) btnTO.addEventListener('click', () => toggleSection(sectionTO, btnTO));
  if (btnProses) btnProses.addEventListener('click', () => toggleSection(sectionProses, btnProses));
  if (btnSelesai) btnSelesai.addEventListener('click', () => toggleSection(sectionSelesai, btnSelesai));
});



// ===== Password untuk QC Lem (ubah sesuai kebutuhan) =====
const QC_LEM_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcLem')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC LEM:');
      if (input === null) return;
      if (input === QC_LEM_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadLemItems();
</script>




<script>
/* ====================== TAB QC Register ====================== */
function showSPVTab(tab, btn) {
  document.getElementById('spvInputSection').style.display = (tab === 'input') ? 'block' : 'none';
  document.getElementById('spvHasilSection').style.display = (tab === 'hasil') ? 'block' : 'none';

  document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');

  if (tab === 'input') {
    setupUppercaseInputs();
    updateSPVDateTime();
    if (window._spvTimer) clearInterval(window._spvTimer);
    window._spvTimer = setInterval(updateSPVDateTime, 1000);

    document.getElementById('spvTanggal').setAttribute('readonly', true);
    document.getElementById('spvJam').setAttribute('readonly', true);
  } else {
    if (window._spvTimer) clearInterval(window._spvTimer);
    loadSPV();
  }
}

/* ====================== UPDATE WAKTU REAL-TIME ====================== */
function updateSPVDateTime() {
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth() + 1).padStart(2, '0');
  const dd = String(now.getDate()).padStart(2, '0');
  const hh = String(now.getHours()).padStart(2, '0');
  const min = String(now.getMinutes()).padStart(2, '0');
  const ss = String(now.getSeconds()).padStart(2, '0');

  document.getElementById('spvTanggal').value = `${yyyy}-${mm}-${dd}`;
  document.getElementById('spvJam').value = `${hh}:${min}:${ss}`;
}

/* ====================== UPPERCASE INPUT AMAN ====================== */
function setupUppercaseInputs() {
  const inputs = document.querySelectorAll('#spvForm input[type="text"], #spvForm textarea, #spvTable input[type="text"], #spvTable textarea');
  inputs.forEach(el => {
    if (el._uppercaseListener) el.removeEventListener('input', el._uppercaseListener);

    const listener = (e) => {
      const start = e.target.selectionStart;
      const end = e.target.selectionEnd;
      e.target.value = e.target.value.toUpperCase();
      e.target.setSelectionRange(start, end);
    };

    el.addEventListener('input', listener);
    el._uppercaseListener = listener;

    el.style.textTransform = 'uppercase';
  });
}

/* ====================== FILE TO BASE64 ====================== */
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    if (!file) return resolve("");
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* ====================== SUBMIT FORM ====================== */
async function submitSPV(e) {
  e.preventDefault();
  const spinner = document.getElementById("spvSpinner");

  const payload = {
    sheet: "Register",
    action: "add",
    tanggal: document.getElementById('spvTanggal').value,
    jam: document.getElementById('spvJam').value,
    namaOrder: (document.getElementById('spvOrder').value || '').trim().toUpperCase(),
    noKS: (document.getElementById('spvNoKS').value || '').trim().toUpperCase(),
    ket: (document.getElementById('spvKet').value || '').trim().toUpperCase(),
    ket1: (document.getElementById('spvKet1').value || '').trim().toUpperCase(),
    namaQC: document.getElementById('spvNama').value,
    proses: document.getElementById('spvProses').value,
    foto: document.getElementById('spvFoto').files[0] ? await fileToBase64(document.getElementById('spvFoto').files[0]) : "",
    foto1: document.getElementById('spvFoto1').files[0] ? await fileToBase64(document.getElementById('spvFoto1').files[0]) : ""
  };

  if (!payload.namaOrder || !payload.noKS || !payload.tanggal || !payload.jam || !payload.namaQC || !payload.proses) {
    alert('âš ï¸ Harap lengkapi semua field termasuk Proses.');
    return;
  }

  if (!confirm('Kirim data ini?')) return;

  document.getElementById('spvForm').reset();
  spinner.style.display = "flex";

  try {
    await fetch(WEBAPP_URL, {
      method: "POST",
      body: new URLSearchParams({ payload: JSON.stringify(payload) })
    });
    alert("âœ… Data SPV berhasil dikirim!");
    loadSPV();
  } catch (err) {
    alert("âŒ Gagal mengirim data SPV!");
    console.error(err);
  } finally { spinner.style.display = "none"; }
}

/* ====================== LOAD DATA HASIL + EDIT ====================== */
function loadSPV() {
  const tbody = document.querySelector('#spvTable tbody');
  if (!tbody) return;
  let spinner = document.getElementById("spvLoadingSpinner");
  if (!spinner) {
    spinner = document.createElement("div");
    spinner.id = "spvLoadingSpinner";
    spinner.style.display = "none";
    spinner.innerHTML = `<div style="text-align:center; padding:10px;"><div class="spinner"></div><p style="font-size:0.9rem; color:#555; margin-top:6px;">Memuat Data QC</p></div>`;
    tbody.parentElement.insertAdjacentElement("beforebegin", spinner);
  }

  spinner.style.display = "block";

  fetch(WEBAPP_URL + '?action=get&sheet=Register')
    .then(res => res.text())
    .then(text => {
      let data;
      try { data = JSON.parse(text); }
      catch { const match = text.match(/\((.*)\)/); if (match) data = JSON.parse(match[1]); }
      if (!data) { spinner.style.display = "none"; return; }

      const list = data.data || data || [];
      tbody.innerHTML = "";

      list.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.dataset.index = index;
        tr.innerHTML = `
          <td>${formatTanggal(item.tanggal || item.Tanggal)}</td>
          <td>${item.namaOrder || item['Nama Order'] || ''}</td>
          <td>${item.noKS || item['No KS'] || ''}</td>
          <td>${formatJam(item.jam || item.Jam)}</td>
          <td>${item.ket || item['Keterangan Acuan'] || ''}</td>
          <td>${item.fotoUrl ? `<a href="${item.fotoUrl}" target="_blank">ðŸ“· Lihat Foto</a>` : '-'}</td>
          <td>${item.ket1 || item['Keterangan Temuan'] || ''}</td>
          <td>${item.fotoUrl1 ? `<a href="${item.fotoUrl1}" target="_blank">ðŸ“· Lihat Foto</a>` : '-'}</td>
          <td>${item.namaQC || item['Nama QC'] || ''}</td>
          <td>${item.proses || item['Proses'] || ''}</td>
          <td class="action-cell"><button class="edit-btn">âœï¸ Edit</button></td>
        `;
        tbody.appendChild(tr);
      });

      enableSPVEdit();
    })
    .catch(err => console.error("Gagal memuat data SPV:", err))
    .finally(() => spinner.style.display = "none");
}

/* ====================== ENABLE EDIT ====================== */
function enableSPVEdit() {
  document.querySelectorAll("#spvTable tbody tr").forEach((row, rowIndex) => {
    const editBtn = row.querySelector(".edit-btn");
    if (!editBtn) return;

    editBtn.onclick = () => {
      if (!confirm("Apakah Anda ingin mengedit data ini?")) return;

      row._original = [...row.children].map(td => td.innerHTML);

      for (let i = 0; i < 10; i++) {
        const cell = row.cells[i];
        const value = cell.textContent.trim();

        // ===== Foto Acuan & Foto Temuan =====
        if (i === 5 || i === 7) {
          const wrapper = document.createElement("div");
          wrapper.style.display = "flex";
          wrapper.style.flexDirection = "column";
          wrapper.style.alignItems = "center";

          const label = document.createElement("label");
          label.textContent = "ðŸ“ Pilih File";
          label.style.background = "#00bcd4";
          label.style.color = "#fff";
          label.style.padding = "6px 10px";
          label.style.borderRadius = "6px";
          label.style.cursor = "pointer";
          label.style.fontSize = "13px";
          label.style.textAlign = "center";
          label.style.width = "fit-content";

          const fileInput = document.createElement("input");
          fileInput.type = "file";
          fileInput.accept = "image/*";
          fileInput.style.display = "none";

          const fileName = document.createElement("div");
          fileName.style.fontSize = "12px";
          fileName.style.color = "#555";
          fileName.style.marginTop = "6px";
          fileName.style.wordBreak = "break-word";
          fileName.style.textAlign = "center";

          fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            fileName.textContent = file ? file.name : "";
          });

          label.onclick = () => fileInput.click();

          wrapper.appendChild(label);
          wrapper.appendChild(fileInput);
          wrapper.appendChild(fileName);

          cell.innerHTML = "";
          cell.appendChild(wrapper);
        } 
        // ===== Keterangan =====
        else if (i === 4 || i === 6) {
          const textarea = document.createElement("textarea");
          textarea.value = value;
          textarea.rows = 2;
          textarea.style.width = "100%";
          cell.innerHTML = "";
          cell.appendChild(textarea);
        } 
        // ===== Nama QC / Proses (Dropdown) =====
        else if (i === 8 || i === 9) {
          const select = document.createElement("select");
          select.style.width = "100%";
          select.style.padding = "6px";
          select.style.borderRadius = "6px";
          select.style.border = "1px solid #ccc";
          select.style.fontSize = "13px";

          let options = [];
          if (i === 8) options = ["NANI","ANJANI","SUCI","ANOM","IRNA","MARWAN","KIKI","MARTINI","KRESTIN","ISMIE"];
          else options = ["QC BAPRO","QC CETAK","QC FINISHING","QC LEM","RETUR"];

          options.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            if (opt === value) option.selected = true;
            select.appendChild(option);
          });

          cell.innerHTML = "";
          cell.appendChild(select);
        } 
        // ===== Input teks biasa =====
        else {
          const input = document.createElement("input");
          input.type = "text";
          input.value = value;
          input.style.width = "100%";

          if (i === 0 || i === 3) input.setAttribute('readonly', true);

          cell.innerHTML = "";
          cell.appendChild(input);
        }
      }

      setupUppercaseInputs(); // pastikan semua input edit otomatis uppercase

      // ===== Tombol aksi =====
      const aksiCell = row.cells[10];
      aksiCell.innerHTML = `
        <button class="save-btn">ðŸ’¾ Simpan</button>
        <button class="cancel-btn">âŒ Batal</button>
      `;

      const spinner = document.createElement("span");
      spinner.innerHTML = " â³ Menyimpan...";
      spinner.style.display = "none";
      aksiCell.appendChild(spinner);

      // ===== Simpan perubahan =====
      aksiCell.querySelector(".save-btn").onclick = async () => {
        if (!confirm("Apakah yakin ingin menyimpan perubahan ini?")) return;

        spinner.style.display = "inline";
        const updated = {
          tanggal: row.cells[0].querySelector("input")?.value || row.cells[0].textContent,
          namaOrder: (row.cells[1].querySelector("input")?.value || row.cells[1].textContent).toUpperCase(),
          noKS: (row.cells[2].querySelector("input")?.value || row.cells[2].textContent).toUpperCase(),
          jam: row.cells[3].querySelector("input")?.value || row.cells[3].textContent,
          ket: (row.cells[4].querySelector("textarea")?.value || row.cells[4].textContent).toUpperCase(),
          ket1: (row.cells[6].querySelector("textarea")?.value || row.cells[6].textContent).toUpperCase(),
          namaQC: row.cells[8].querySelector("select")?.value || row.cells[8].textContent,
          proses: row.cells[9].querySelector("select")?.value || row.cells[9].textContent,
          foto: row.cells[5].querySelector("input")?.files[0] ? await fileToBase64(row.cells[5].querySelector("input").files[0]) : null,
          foto1: row.cells[7].querySelector("input")?.files[0] ? await fileToBase64(row.cells[7].querySelector("input").files[0]) : null
        };

        fetch(WEBAPP_URL, {
          method: "POST",
          body: new URLSearchParams({
            payload: JSON.stringify({ sheet: "Register", action: "update", index: rowIndex, data: updated })
          })
        })
        .then(res => res.text())
        .then(() => {
          alert("âœ… Data berhasil diperbarui!");
          row._original.forEach((html, i) => (row.cells[i].innerHTML = html));
          enableSPVEdit();
          loadSPV();
        })
        .catch(err => {
          console.error(err);
          alert("âŒ Gagal memperbarui data!");
        })
        .finally(() => spinner.style.display = "none");
      };

      aksiCell.querySelector(".cancel-btn").onclick = () => {
        if (!confirm("Batalkan edit? Semua perubahan akan hilang!")) return;
        row._original.forEach((html, i) => (row.cells[i].innerHTML = html));
        enableSPVEdit();
      };
    };
  });
}

/* ====================== FILTER & HIGHLIGHT SPV (STABIL) ====================== */
document.addEventListener("input", function (e) {

  if (e.target.id !== "spvSearch") return;

  const filter = e.target.value.trim().toLowerCase();
  const tbody = document.querySelector("#spvTable tbody");
  if (!tbody) return;

  tbody.querySelectorAll("tr").forEach(tr => {

    const tds = tr.querySelectorAll("td");
    let rowMatches = false;

    // === JIKA FILTER KOSONG â†’ RESET & TAMPILKAN BARIS ===
    if (!filter) {
      tds.forEach((td, idx) => {
        if (idx === 10) return;                // kolom aksi
        if (td.dataset.originalHtml) {
          td.innerHTML = td.dataset.originalHtml;
        }
      });
      tr.style.display = "";                  // tampilkan baris
      return;                                 // STOP di sini
    }

    // ========== JIKA FILTER ADA ========== 
    tds.forEach((td, idx) => {

      if (idx === 10) return; // kolom aksi

      // Simpan HTML asli sekali
      if (!td.dataset.originalHtml) {
        td.dataset.originalHtml = td.innerHTML;
      }

      const originalHtml = td.dataset.originalHtml;
      const plain = originalHtml.replace(/<[^>]+>/g, "").toLowerCase();

      if (plain.includes(filter)) {
        rowMatches = true;

        /* --- Highlight aman --- */
        const temp = document.createElement("div");
        temp.innerHTML = originalHtml;

        const walker = document.createTreeWalker(temp, NodeFilter.SHOW_TEXT);
        const escaped = filter.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
        const regex = new RegExp(escaped, "gi");

        let node;
        while ((node = walker.nextNode())) {
          if (node.nodeValue.toLowerCase().includes(filter)) {
            const highlighted = node.nodeValue.replace(regex, m =>
              `<span style="background:yellow">${m}</span>`
            );

            const wrap = document.createElement("span");
            wrap.innerHTML = highlighted;
            node.replaceWith(...wrap.childNodes);
          }
        }

        td.innerHTML = temp.innerHTML;

      } else {
        td.innerHTML = originalHtml;
      }
    });

    tr.style.display = rowMatches ? "" : "none";
  });

});




/* ====================== FORMAT ====================== */
function formatTanggal(tgl) { if (!tgl) return ""; const parts = tgl.split("-"); return parts.length === 3 ? `${parts[2]}-${parts[1]}-${parts[0]}` : tgl; }
function formatJam(jam) { if (!jam) return ""; return jam.length >= 5 ? jam.slice(0, 5) : jam; }

/* ====================== PASSWORD ====================== */
const QC_SPV_PASSWORD = 'spv123';
document.addEventListener('DOMContentLoaded', () => {
  setupUppercaseInputs();
  const menuBtn = document.querySelector(`nav button[onclick="showMenu('qcSPV')"]`);
  if (menuBtn) {
    const originalOnClick = menuBtn.getAttribute('onclick');
    menuBtn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC REGISTER:');
      if (input === null) return;
      if (input === QC_SPV_PASSWORD) eval(originalOnClick);
      else alert('Password salah!');
    };
  }
  const inputSection = document.getElementById('spvInputSection');
  if (inputSection && inputSection.style.display !== 'none') {
    updateSPVDateTime();
    window._spvTimer = setInterval(updateSPVDateTime, 1000);
    document.getElementById('spvTanggal').setAttribute('readonly', true);
    document.getElementById('spvJam').setAttribute('readonly', true);
  }
});


/* ====================== SCROLL OTOMATIS KE BARIS TERAKHIR ====================== */
document.addEventListener('DOMContentLoaded', () => {
  const tbody = document.querySelector('#spvTable tbody');
  if (!tbody) return;

  const observer = new MutationObserver((mutations) => {
    mutations.forEach(mutation => {
      if (mutation.addedNodes.length > 0) {
        const rows = tbody.querySelectorAll('tr');
        if (rows.length) {
          const lastRow = rows[rows.length - 1];
          // scroll hanya jika tidak ada input aktif di table
          if (!tbody.querySelector('input:focus, textarea:focus, select:focus')) {
            lastRow.scrollIntoView({ behavior: 'smooth', block: 'end' });
          }
        }
      }
    });
  });

  observer.observe(tbody, { childList: true });
});

</script>





<script>
// ====================== QC MEETING ======================

// ===== PASSWORD =====
const QC_MEETING_PASSWORD = 'spv123'; // ganti sesuai kebutuhan

// ===== FORMAT TANGGAL & JAM =====
function formatTanggal(tgl){
  if(!tgl) return "";
  const d = new Date(tgl);
  if(isNaN(d)) return tgl;
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${dd}-${mm}-${yyyy}`;
}
function formatJam(jam){
  if(!jam) return "";
  const d = new Date(jam);
  if(isNaN(d)) return jam;
  const hh = String(d.getHours()).padStart(2,"0");
  const min = String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${min}`;
}

// ===== FILE TO BASE64 =====
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    if(!file) return resolve("");
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ===== UPPERCASE INPUT GLOBAL (TANPA CURSOR LONCAT) =====
function setupMeetingUppercase(){
  const inputs = document.querySelectorAll(
    '#meetingForm input[type="text"], #meetingForm textarea, ' +
    '#meetingTable input[type="text"], #meetingTable textarea'
  );

  inputs.forEach(el=>{
    if(el._uppercaseListener) el.removeEventListener('input', el._uppercaseListener);

    const listener = (e)=>{
      const start = e.target.selectionStart;
      const end = e.target.selectionEnd;
      e.target.value = e.target.value.toUpperCase();
      e.target.setSelectionRange(start, end);
    };

    el.addEventListener('input', listener);
    el._uppercaseListener = listener;

    el.style.textTransform = 'uppercase';
  });
}

// ===== TANGGAL & JAM OTOMATIS =====
function setMeetingDateTime(){
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,'0');
  const dd = String(now.getDate()).padStart(2,'0');
  const hh = String(now.getHours()).padStart(2,'0');
  const min = String(now.getMinutes()).padStart(2,'0');

  const tglInput = document.getElementById('meetingTanggal');
  const jamInput = document.getElementById('meetingJam');
  if(tglInput) tglInput.value = `${yyyy}-${mm}-${dd}`;
  if(jamInput) jamInput.value = `${hh}:${min}`;
  if(tglInput) tglInput.setAttribute('readonly',true);
  if(jamInput) jamInput.setAttribute('readonly',true);
}

// ===== TAB QC MEETING =====
function showMeetingTab(tab, btn){
  document.getElementById('meetingInputSection').style.display = (tab==='input')?'block':'none';
  document.getElementById('meetingHasilSection').style.display = (tab==='hasil')?'block':'none';

  document.querySelectorAll('#qcMeeting .tabs button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');

  if(tab==='input'){
    setupMeetingUppercase();
    setMeetingDateTime();
    if(window._meetingTimer) clearInterval(window._meetingTimer);
    window._meetingTimer = setInterval(setMeetingDateTime,1000);
  }else{
    if(window._meetingTimer) clearInterval(window._meetingTimer);
    loadMeeting();
  }
}

// ===== SUBMIT FORM =====
async function submitMeeting(e){
  e.preventDefault();
  const spinner = document.getElementById("meetingSpinner");

  const pesertaChecked = Array.from(document.querySelectorAll('#meetingForm input[type="checkbox"]:checked')).map(cb=>cb.value);

  const payload = {
    sheet:"Meeting",
    action:"add",
    tanggal: document.getElementById('meetingTanggal').value || '',
    jam: document.getElementById('meetingJam').value || '',
    namaMeeting: (document.getElementById('meetingNama').value || '').trim().toUpperCase(),
    ket: (document.getElementById('meetingKet').value || '').trim().toUpperCase(),
    akar: (document.getElementById('meetingAkar').value || '').trim().toUpperCase(),
    tindakan: (document.getElementById('meetingTindakan').value || '').trim().toUpperCase(),
    catatan: (document.getElementById('meetingCatatan').value || '').trim().toUpperCase(),
    peserta: pesertaChecked.join(", "),
    foto: await fileToBase64(document.getElementById('meetingFoto').files[0])
  };

  if(!payload.namaMeeting || !payload.tanggal || !payload.jam || pesertaChecked.length===0){
    alert('âš ï¸ Harap lengkapi semua field termasuk Peserta.');
    return;
  }

  if(!confirm('Kirim data Meeting ini?')) return;

  document.getElementById('meetingForm').reset();
  spinner.style.display="flex";

  try{
    await fetch(WEBAPP_URL,{
      method: "POST",
      body: new URLSearchParams({payload:JSON.stringify(payload)})
    });
    alert("âœ… Data Meeting berhasil dikirim!");
    loadMeeting();
  }catch(err){
    console.error(err);
    alert("âŒ Gagal mengirim data Meeting!");
  }finally{
    spinner.style.display="none";
  }
}

// ===== LOAD DATA HASIL =====
async function loadMeeting(){
  const tbody = document.querySelector('#meetingTable tbody');
  if(!tbody) return;
  const spinner = document.getElementById("meetingLoading");
  if(spinner) spinner.style.display="block";

  try{
    const res = await fetch(`${WEBAPP_URL}?action=get&sheet=Meeting`);
    let text = await res.text();
    let data;
    try{ data = JSON.parse(text); } 
    catch{ const match = text.match(/\((.*)\)/); if(match) data = JSON.parse(match[1]); }
    if(!data) return;

    const list = data.data || data || [];
    tbody.innerHTML="";

    list.forEach((item,index)=>{
      const tr = document.createElement('tr');
      tr.dataset.index = index;

      tr.innerHTML = `
        <td>${formatTanggal(item.tanggal)}</td>
        <td>${item.namaMeeting || ''}</td>
        <td>${formatJam(item.jam)}</td>
        <td>${item.ket || ''}</td>
        <td>${item.fotoUrl?`<a href="${item.fotoUrl}" target="_blank">ðŸ“· Lihat Foto</a>`:'-'}</td>
        <td>${item.akar || ''}</td>
        <td>${item.tindakan || ''}</td>
        <td>${item.catatan || ''}</td>
        <td>${item.peserta || ''}</td>
        <td class="action-cell">
          <button class="edit-btn">âœï¸ Edit</button>
          <button class="share-btn">ðŸ“¤ Share WA</button>
        </td>
      `;
      tbody.appendChild(tr);

      // Tombol Share WA
      const shareBtn = tr.querySelector(".share-btn");
      shareBtn.onclick = ()=>{
        let textWA = "";
        const br = "\n\n";

        textWA += `ðŸ“… Tanggal:\n${formatTanggal(item.tanggal)}${br}`;
        textWA += `â° Jam:\n${formatJam(item.jam)}${br}`;
        textWA += `ðŸ“Œ Nama Meeting:\n${item.namaMeeting || '-'}${br}`;
        textWA += `ðŸ“ Keterangan Foto:\n${item.ket || '-'}${br}`;
        textWA += `ðŸ” Akar Masalah:\n${item.akar || '-'}${br}`;
        textWA += `ðŸ›  Tindakan:\n${item.tindakan || '-'}${br}`;
        textWA += `ðŸ“š Catatan:\n${item.catatan || '-'}${br}`;
        textWA += `ðŸ‘¥ Peserta:\n${item.peserta || '-'}${br}`;

        if(item.fotoUrl){
          textWA += `ðŸ“· Foto:\n${item.fotoUrl}${br}`;
        }

        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const url = isMobile 
          ? `https://wa.me/?text=${encodeURIComponent(textWA)}`
          : `https://web.whatsapp.com/send?text=${encodeURIComponent(textWA)}`;
        window.open(url, "_blank");
      };
    });

    enableMeetingEdit();
  }catch(err){ console.error(err); }
  finally{ if(spinner) spinner.style.display="none"; }
}

// ===== ENABLE EDIT =====
function enableMeetingEdit(){
  document.querySelectorAll("#meetingTable tbody tr").forEach((row,rowIndex)=>{
    const editBtn = row.querySelector(".edit-btn");
    if(!editBtn) return;

    editBtn.onclick = ()=>{
      if(!confirm("Apakah Anda ingin mengedit data ini?")) return;
      row._original = [...row.children].map(td=>td.innerHTML);

      const fieldIndices = { tanggal:0, namaMeeting:1, jam:2, ket:3, foto:4, akar:5, tindakan:6, catatan:7, peserta:8 };

      for(const key in fieldIndices){
        const idx = fieldIndices[key];
        const cell = row.cells[idx];
        const value = cell.textContent.trim();

        if(key==='peserta'){
          const wrapper = document.createElement("div");
          wrapper.style.display="flex"; wrapper.style.flexWrap="wrap"; wrapper.style.gap="6px";
          const pesertaList = ["NANI","ANJANI","SUCI","ANOM","IRNA","MARWAN","KIKI","MARTINI","KRESTIN","ISMIE"];
          pesertaList.forEach(name=>{
            const label = document.createElement("label");
            label.style.fontSize="12px"; label.style.cursor="pointer";
            const cb = document.createElement("input");
            cb.type="checkbox"; cb.value=name;
            if(value.includes(name)) cb.checked = true;
            label.appendChild(cb); label.appendChild(document.createTextNode(" "+name));
            wrapper.appendChild(label);
          });
          cell.innerHTML=""; cell.appendChild(wrapper);

        }else if(key==='foto'){
          const wrapper = document.createElement("div");
          wrapper.style.display="flex"; wrapper.style.flexDirection="column"; wrapper.style.alignItems="center";
          const label = document.createElement("label"); 
          label.textContent="ðŸ“ Pilih File"; 
          label.style.cursor="pointer"; label.style.background="#00BCD4"; label.style.color="#fff"; 
          label.style.padding="6px 10px"; label.style.borderRadius="6px"; label.style.fontSize="13px";
          const fileInput = document.createElement("input"); fileInput.type="file"; fileInput.accept="image/*"; fileInput.style.display="none";
          const fileName = document.createElement("div"); fileName.style.fontSize="12px"; fileName.style.color="#555"; fileName.style.marginTop="6px";
          fileInput.addEventListener("change",e=>{ fileName.textContent = e.target.files[0]?.name || ""; });
          label.onclick = ()=>fileInput.click();
          wrapper.appendChild(label); wrapper.appendChild(fileInput); wrapper.appendChild(fileName);
          cell.innerHTML=""; cell.appendChild(wrapper);

        }else if(key==='tanggal' || key==='jam'){
          const input = document.createElement("input");
          input.type = "text"; 
          input.value = value;
          input.setAttribute('readonly',true);
          cell.innerHTML=""; cell.appendChild(input);

        }else if(key==='namaMeeting'){
          const input = document.createElement("input");
          input.type="text"; input.value=value.toUpperCase(); input.style.width="100%";
          cell.innerHTML=""; cell.appendChild(input);

        }else{
          const textarea = document.createElement("textarea");
          textarea.value=value; textarea.rows=2; textarea.style.width="100%";
          cell.innerHTML=""; cell.appendChild(textarea);
        }
      }

      // ===== PANGGIL UPPERCASE SETUP UNTUK EDIT =====
      setupMeetingUppercase();

      const aksiCell = row.cells[9];
      aksiCell.innerHTML=`<button class="save-btn">ðŸ’¾ Simpan</button> <button class="cancel-btn">âŒ Batal</button>`;
      const spinner = document.createElement("span"); spinner.style.display="none"; spinner.textContent=" â³ Menyimpan..."; aksiCell.appendChild(spinner);

      aksiCell.querySelector(".save-btn").onclick=async()=>{
        if(!confirm("Apakah yakin ingin menyimpan perubahan ini?")) return;
        spinner.style.display="inline";

        const pesertaChecked = Array.from(row.cells[8].querySelectorAll("input[type='checkbox']:checked")).map(cb=>cb.value);

        const updated={
          tanggal: row.cells[0].querySelector("input")?.value,
          namaMeeting: row.cells[1].querySelector("input")?.value.toUpperCase(),
          jam: row.cells[2].querySelector("input")?.value,
          ket: row.cells[3].querySelector("textarea")?.value || "",
          akar: row.cells[5].querySelector("textarea")?.value || "",
          tindakan: row.cells[6].querySelector("textarea")?.value || "",
          catatan: row.cells[7].querySelector("textarea")?.value || "",
          peserta: pesertaChecked.join(", "),
          foto: await fileToBase64(row.cells[4].querySelector("input")?.files[0])
        };

        try{
          await fetch(WEBAPP_URL,{
            method:"POST",
            body:new URLSearchParams({payload:JSON.stringify({sheet:"Meeting",action:"update",index:rowIndex,data:updated})})
          });
          alert("âœ… Data berhasil diperbarui!");
          row._original.forEach((html,i)=>row.cells[i].innerHTML=html);
          enableMeetingEdit();
          loadMeeting();
        }catch(err){ console.error(err); alert("âŒ Gagal memperbarui data!"); }
        finally{ spinner.style.display="none"; }
      };

      aksiCell.querySelector(".cancel-btn").onclick=()=>{ 
        if(!confirm("Batalkan edit? Semua perubahan akan hilang!")) return;
        row._original.forEach((html,i)=>row.cells[i].innerHTML=html);
        enableMeetingEdit();
      };
    };
  });
}

// ====================== FILTER & HIGHLIGHT MEETING (LINK TETAP AMAN) ======================
document.addEventListener("input", function (e) {

  if (e.target.id !== "meetingSearch") return;

  const filter = e.target.value.toLowerCase();
  const tableBody = document.querySelector("#meetingTable tbody");
  if (!tableBody) return;

  const rows = tableBody.querySelectorAll("tr");

  rows.forEach(row => {
    let match = false;

    row.querySelectorAll("td:not(.action-cell)").forEach(cell => {

      // Simpan HTML asli hanya sekali
      if (!cell.dataset.originalHtml) {
        cell.dataset.originalHtml = cell.innerHTML;
      }

      const originalHtml = cell.dataset.originalHtml;
      const plainText = originalHtml.replace(/<[^>]+>/g, '').toLowerCase(); // hilangkan tag HTML saat compare

      if (filter && plainText.includes(filter)) {
        const regex = new RegExp("(" + filter.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&") + ")", "gi");

        // highlight hanya pada teks, tidak merusak tag <a>
        const highlighted = originalHtml.replace(regex, '<span style="background:yellow">$1</span>');
        cell.innerHTML = highlighted;

        match = true;
      } else {
        // Kembalikan HTML original secara aman
        cell.innerHTML = originalHtml;
      }
    });

    row.style.display = match || !filter ? "" : "none";
  });
});



// ===== PASSWORD OTOMATIS TAB =====
document.addEventListener('DOMContentLoaded',()=>{
  const menuBtn = document.querySelector(`nav button[onclick="showMenu('qcMeeting')"]`);
  if(menuBtn){
    const originalOnClick = menuBtn.getAttribute('onclick');
    menuBtn.onclick=function(e){
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC MEETING:');
      if(input===null) return;
      if(input===QC_MEETING_PASSWORD) eval(originalOnClick);
      else alert('Password salah!');
    };
  }
  setMeetingDateTime();
  setupMeetingUppercase();
});


/* ====================== SCROLL OTOMATIS QC MEETING ====================== */
document.addEventListener('DOMContentLoaded', () => {
  const tbody = document.querySelector('#meetingTable tbody');
  if (!tbody) return;

  const observer = new MutationObserver((mutations) => {
    mutations.forEach(mutation => {
      if (mutation.addedNodes.length > 0) {
        const rows = tbody.querySelectorAll('tr');
        if (rows.length) {
          const lastRow = rows[rows.length - 1];
          // scroll hanya jika tidak ada input/textarea/select aktif
          if (!tbody.querySelector('input:focus, textarea:focus, select:focus')) {
            lastRow.scrollIntoView({ behavior: 'smooth', block: 'end' });
          }
        }
      }
    });
  });

  observer.observe(tbody, { childList: true });
});

</script>




<script>
// ====================== UNIVERSAL AUTO-DEFAULT 0 (FINAL STABLE VERSION) ======================
(function(){
  'use strict';

  // === daftar semua id input number ===
  const UNIVERSAL_NUMBER_IDS = [
    'finishingOrder','finishingIsi','finishingBagus','finishingJenisBS',
    'baproDmax','baproL','baproA','baproB',
    'paOrder','paBagus','paSortir','paProblem',
    'lemOrder','lemIsi','lemBagus','lemJenisBS'
  ];

  // Helper universal: selalu pastikan value valid
  function forceZeroIfEmpty(input){
    if (!input) return;
    if (input.tagName !== 'INPUT' || input.type !== 'number') return;
    if (input.value === '' || input.value === null) {
      input.value = 0;
    }
  }

  // Attach behavior BUT tetap bebas hapus
  function attachNumberZeroBehavior(input){
    if (!input || input._attachedAutoZero) return;
    input._attachedAutoZero = true;

    if (input.tagName !== 'INPUT' || input.type !== 'number') return;

    // default awal
    forceZeroIfEmpty(input);

    // saat blur â†’ kosong jadi 0
    input.addEventListener('blur', () => {
      forceZeroIfEmpty(input);
    });

    // saat change â†’ kosong jadi 0
    input.addEventListener('change', () => {
      forceZeroIfEmpty(input);
    });
  }

  // Terapkan ke ID yang dikenal
  function applyByIDs(){
    UNIVERSAL_NUMBER_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) attachNumberZeroBehavior(el);
    });
  }

  // Terapkan ke seluruh input number
  function applyToAllNumberInputs(){
    document.querySelectorAll('input[type="number"]').forEach(inp => {
      attachNumberZeroBehavior(inp);
    });
  }

  // Observer
  const observer = new MutationObserver(mList => {
    mList.forEach(m => {
      m.addedNodes.forEach(node => {
        if (!node || node.nodeType !== 1) return;

        if (node.matches && node.matches('input[type="number"]')){
          attachNumberZeroBehavior(node);
        }

        node.querySelectorAll && node.querySelectorAll('input[type="number"]').forEach(el => {
          attachNumberZeroBehavior(el);
        });
      });
    });
  });

  function startObserver(){
    observer.observe(document.body, { childList:true, subtree:true });
  }

  // === FIX PALING PENTING ===
  // Digunakan oleh kode submit kamu kapanpun (AMAKAN)
  window.getSafeNumberValue = function(id){
    const el = document.getElementById(id);
    if (!el) return 0;
    if (el.value === '' || el.value === null) return 0;
    return Number(el.value) || 0;
  };

  // Patch fungsi clear (tanpa mengganggu)
  function patchClearFunction(funcName){
    const ori = window[funcName];
    if (typeof ori !== 'function') return;
    if (ori._patchedAutoZero) return;

    const wrap = function(...args){
      const r = ori.apply(this, args);
      setTimeout(() => {
        applyByIDs();
        applyToAllNumberInputs();
      }, 20);
      return r;
    };

    wrap._patchedAutoZero = true;
    window[funcName] = wrap;
  }

  function patchAllClearFunctions(){
    ['clearFinishingForm','clearBaproForm','clearPAForm','clearLemForm']
      .forEach(patchClearFunction);
  }

  // Init
  function init(){
    applyByIDs();
    applyToAllNumberInputs();
    startObserver();
    patchAllClearFunctions();
  }

  // Run
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>



<script>
/* ====================== HOME QC ====================== */
function goHome() {
  // Password yang harus diinput
  const correctPass = "spv123";   // <-- ubah sesuai kebutuhan

  // Popup password
  const input = prompt("Password Database QC :");

  // Jika ditekan Cancel
  if (input === null) return;

  // Cek password
  if (input === correctPass) {
    // Jika benar â†’ buka link
    window.location.href = "https://docs.google.com/spreadsheets/d/e/2PACX-1vROGN48zxFvmG2HQTqJ0BLC4pWodmS3WlQ4lpavjI5juf8xDHs2bNfKYN6lluyfoFzzQSAR5SV2tNkA/pubhtml"; 
  } else {
    alert("Password salah!");
  }
}
</script>







</body>
</html>

