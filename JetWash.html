<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JetWash Laundry UX Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding-bottom: 70px;
  background-color: #f0f4f8;
  overflow-x: hidden;
}
h1 { text-align:center; color:#007bff; margin:15px 0; font-size:1.6em; }

.tab-content {
  display: none;
  padding: 15px 10px 10px 10px;
  background-color: #fff;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  margin-bottom: 10px;
  max-height: calc(100vh - 130px);
  overflow-y: auto;
  transition: all 0.3s ease-in-out;
}
.tab-content.active { display: block; opacity:1; transform: translateY(0); }

.tabs {
  display: flex;
  justify-content: space-around;
  position: fixed;
  bottom: 0; left:0; right:0;
  height:60px;
  background-color:#fff;
  border-top:1px solid #ddd;
  box-shadow:0 -2px 6px rgba(0,0,0,0.1);
  z-index:1000;
  font-size:0.75em;
}
.tab {
  flex:1; text-align:center; padding-top:5px; cursor:pointer;
  transition: all 0.2s;
}
.tab.active {
  color:#007bff; font-weight:bold;
  border-top:3px solid #007bff;
  background-color:#f0f4f8;
}
.tab:hover { background-color:#e6ecf3; }
.tab-icon{ font-size:1.2em; display:block; }
.tab-text{ font-size:0.75em; display:block; margin-top:2px; }

.form-section label{
  display:block; font-size:0.85em; margin-top:10px; font-weight:600;
}
.form-section input,.form-section select,.form-section textarea{
  width:100%; padding:8px; margin:5px 0;
  border:1px solid #ccc; border-radius:6px; font-size:0.9em;
}
.form-section input:focus,.form-section select:focus,.form-section textarea:focus{
  outline:none; border-color:#007bff; box-shadow:0 0 4px rgba(0,123,255,0.3);
}
textarea{ resize:vertical; min-height:50px; }

.form-section button{
  margin:5px 5px 5px 0; padding:8px 14px; cursor:pointer;
  border:none; border-radius:8px; color:#fff;
  background:linear-gradient(145deg,#007bff,#0056b3);
  font-size:0.9em; transition: all 0.2s;
}
.form-section button:hover{
  background:linear-gradient(145deg,#0056b3,#007bff);
  transform: translateY(-1px);
}

.card{
  border:1px solid #ddd; padding:10px 12px; margin:6px 0;
  border-radius:12px; background-color:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  word-break:break-word; font-size:0.85em;
  transition: transform 0.3s, box-shadow 0.3s;
  cursor:pointer;
}
.card:hover{ transform: translateY(-2px); box-shadow:0 4px 14px rgba(0,0,0,0.15); }

.card-details {
  max-height: 0;
  overflow: hidden;
  margin-top: 5px;
  font-size: 0.82em;
  color: #333;
  transition: max-height 0.3s ease, opacity 0.3s ease;
  opacity: 0;
}
.card.expanded .card-details {
  max-height: 500px;
  opacity: 1;
}

.card-details img {
  max-width: 70px;
  max-height: 70px;
  border-radius: 8px;
  object-fit: cover;
  border: 1px solid #ccc;
  transition: transform 0.3s ease, opacity 0.3s ease;
  transform: translateY(-10px);
  opacity: 0;
}
.card.expanded .card-details img {
  transform: translateY(0);
  opacity: 1;
}

.foto-preview{ margin-top:4px; }
.foto-preview img{
  max-width:70px; max-height:70px; border-radius:8px;
  object-fit:cover; border:1px solid #ccc;
}

.tab-content::-webkit-scrollbar{ width:6px; }
.tab-content::-webkit-scrollbar-track{ background:#f0f4f8; }
.tab-content::-webkit-scrollbar-thumb{ background:#ccc; border-radius:3px; }

@media (max-width:480px){
  .form-section input,.form-section select,.form-section textarea{ font-size:0.85em; padding:6px; }
  .form-section button{ width:100%; margin-bottom:6px; font-size:0.85em; padding:7px; }
  .card{ font-size:0.8em; padding:8px 10px; }
  .foto-preview img{ max-width:60px; max-height:60px; }
  .card-details img{ max-width:60px; max-height:60px; }
}
</style>
</head>
<body>

<h1>üìå Aplikasi Laundry</h1>

<div class="tabs">
  <div class="tab active" data-tab="absenTab"><span class="tab-icon">üìù</span><br><span class="tab-text">Absen</span></div>
  <div class="tab" data-tab="hasilTab"><span class="tab-icon">üß∫</span><br><span class="tab-text">Laundry</span></div>
  <div class="tab" data-tab="komplainTab"><span class="tab-icon">‚ö†Ô∏è</span><br><span class="tab-text">Komplain</span></div>
</div>

<!-- Absen Tab -->
<div id="absenTab" class="tab-content form-section active">
  <h2>Form Absen</h2>
  <form id="absenForm">
    <label for="namaPegawai">Nama Pegawai</label>
    <input type="text" id="namaPegawai" placeholder="Nama Pegawai" required>
    
    <label for="tanggalAbsen">Tanggal Absen</label>
    <input type="date" id="tanggalAbsen" required>
    
    <label for="jamAbsen">Jam Absen</label>
    <input type="time" id="jamAbsen" required>
    
    <label for="tipeAbsen">Tipe Absen</label>
    <select id="tipeAbsen">
      <option value="Masuk">Masuk</option>
      <option value="Pulang">Pulang</option>
    </select>
    
    <label for="fotoAbsen">Foto Absen</label>
    <input type="file" id="fotoAbsen" accept="image/*">
    <div id="fotoAbsenPreview" class="foto-preview"></div>
    
    <button type="submit">Simpan</button>
    <button type="button" id="savePdfAbsenBtn" style="display:none;">Simpan PDF</button>
    <button type="button" id="resetAbsenBtn" style="display:none;">Reset</button>
  </form>
  <div id="cardsAbsen"></div>
</div>

<!-- Laundry Tab -->
<div id="hasilTab" class="tab-content form-section">
  <h2>Form Hasil Laundry</h2>
  <form id="hasilForm">
    <label for="namaPelangganHasil">Nama Pelanggan</label>
    <input type="text" id="namaPelangganHasil" placeholder="Nama Pelanggan" required>
    
    <label for="beratLaundry">Berat Laundry (kg)</label>
    <input type="number" id="beratLaundry" placeholder="Berat (kg)" required>
    
    <label for="baju">Jumlah Baju</label>
    <input type="number" id="baju" placeholder="Jumlah Baju" required>
    
    <label for="celana">Jumlah Celana</label>
    <input type="number" id="celana" placeholder="Jumlah Celana" required>
    
    <label for="jaket">Jumlah Jaket</label>
    <input type="number" id="jaket" placeholder="Jumlah Jaket" required>
    
    <label for="total">Total Item</label>
    <input type="number" id="total" placeholder="Total" readonly>
    
    <label for="tanggalSelesai">Tanggal Selesai</label>
    <input type="date" id="tanggalSelesai" required>
    
    <label for="jamMulai">Jam Mulai</label>
    <input type="time" id="jamMulai" required>
    
    <label for="jamSelesai">Jam Selesai</label>
    <input type="time" id="jamSelesai" required>
    
    <button type="submit">Simpan</button>
    <button type="button" id="savePdfLaundryBtn" style="display:none;">Simpan PDF</button>
    <button type="button" id="resetLaundryBtn" style="display:none;">Reset Laundry</button>
  </form>
  <div id="cardsHasilLaundry"></div>
</div>

<!-- Komplain Tab -->
<div id="komplainTab" class="tab-content form-section">
  <h2>Form Komplain</h2>
  <form id="komplainForm">
    <label for="namaPelanggan">Nama Pelanggan</label>
    <input type="text" id="namaPelanggan" placeholder="Nama Pelanggan" required>
    
    <label for="tanggalKomplain">Tanggal Komplain</label>
    <input type="date" id="tanggalKomplain" required>
    
    <label for="jamKomplain">Jam Komplain</label>
    <input type="time" id="jamKomplain" required>
    
    <label for="komplainText">Isi Komplain</label>
    <textarea id="komplainText" placeholder="Isi Komplain" required></textarea>
    
    <label for="fotoKomplain">Foto Komplain</label>
    <input type="file" id="fotoKomplain" accept="image/*">
    <div id="fotoPreview" class="foto-preview"></div>
    
    <button type="submit">Simpan</button>
    <button type="button" id="savePdfKomplainBtn" style="display:none;">Simpan PDF</button>
    <button type="button" id="resetKomplainBtn" style="display:none;">Reset Komplain</button>
  </form>
  <div id="cardsKomplain"></div>
</div>

<script>
// --- TAB MENU ---
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>{
      c.classList.remove('active');
      c.style.opacity=0; c.style.transform='translateY(20px)';
    });
    tab.classList.add('active');
    const target=document.getElementById(tab.dataset.tab);
    target.classList.add('active');
    setTimeout(()=>{ target.style.opacity=1; target.style.transform='translateY(0)'; },50);
  });
});

// --- IMAGE RESIZE ---
function resizeImage(file, maxWidth, maxHeight, callback){
  const reader = new FileReader();
  reader.onload = function(e){
    const img = new Image();
    img.onload = function(){
      const canvas = document.createElement("canvas");
      let width = img.width; let height = img.height;
      if(width > height){ if(width>maxWidth){height*=maxWidth/width; width=maxWidth;} } 
      else { if(height>maxHeight){width*=maxHeight/height; height=maxHeight;} }
      canvas.width = width; canvas.height = height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img,0,0,width,height);
      const dataUrl = canvas.toDataURL("image/jpeg",0.7);
      callback(dataUrl);
    }
    img.src = e.target.result;
  }
  reader.readAsDataURL(file);
}

// --- PREVIEW FOTO ---
document.getElementById('fotoAbsen').addEventListener('change', function(e){
  const file = e.target.files[0];
  if(file){
    resizeImage(file,800,800,function(resizedDataUrl){
      document.getElementById('fotoAbsenPreview').innerHTML='<img src="'+resizedDataUrl+'">';
      document.getElementById('fotoAbsenPreview').dataset.img=resizedDataUrl;
    });
  }
});
document.getElementById('fotoKomplain').addEventListener('change', function(e){
  const file = e.target.files[0];
  if(file){
    resizeImage(file,800,800,function(resizedDataUrl){
      document.getElementById('fotoPreview').innerHTML='<img src="'+resizedDataUrl+'">';
      document.getElementById('fotoPreview').dataset.img=resizedDataUrl;
    });
  }
});

// --- AUTO HITUNG TOTAL ---
function updateTotalLaundry(){
  const b = parseInt(document.getElementById('baju').value)||0;
  const c = parseInt(document.getElementById('celana').value)||0;
  const j = parseInt(document.getElementById('jaket').value)||0;
  document.getElementById('total').value = b+c+j;
}
document.getElementById('baju').addEventListener('input',updateTotalLaundry);
document.getElementById('celana').addEventListener('input',updateTotalLaundry);
document.getElementById('jaket').addEventListener('input',updateTotalLaundry);

// --- LOAD CARDS & BUTTONS ---
function loadCards(key,targetId,fields){
  const data=JSON.parse(localStorage.getItem(key))||[];
  const container=document.getElementById(targetId); container.innerHTML="";
  data.forEach((d,i)=>{
    const card=document.createElement("div"); card.className="card";
    let mainHTML=`<strong>${fields[0]}:</strong> ${d[fields[0]]}`;
    let detailsHTML='';
    fields.slice(1).forEach(f=>{
      if(f==='foto' && d[f]) detailsHTML+=`<div><img src="${d[f]}" width="70"></div>`;
      else detailsHTML+=`<div><strong>${f}:</strong> ${d[f]}</div>`;
    });
    card.innerHTML=mainHTML+`<div class="card-details">${detailsHTML}</div>`;
    card.addEventListener('click',()=>{ card.classList.toggle('expanded'); });
    container.appendChild(card);
  });
}

function updateButtons(){
  loadCards('absen','cardsAbsen',['nama','tanggal','jam','tipe','foto']);
  loadCards('hasilLaundry','cardsHasilLaundry',['nama','berat','baju','celana','jaket','total','tanggalSelesai','jamMulai','jamSelesai']);
  loadCards('komplain','cardsKomplain',['nama','tanggal','jam','isi','foto']);
  const absenData=JSON.parse(localStorage.getItem('absen'))||[];
  const laundryData=JSON.parse(localStorage.getItem('hasilLaundry'))||[];
  const komplainData=JSON.parse(localStorage.getItem('komplain'))||[];
  document.getElementById('savePdfAbsenBtn').style.display=absenData.length>0?"inline-block":"none";
  document.getElementById('resetAbsenBtn').style.display=absenData.length>0?"inline-block":"none";
  document.getElementById('savePdfLaundryBtn').style.display=laundryData.length>0?"inline-block":"none";
  document.getElementById('resetLaundryBtn').style.display=laundryData.length>0?"inline-block":"none";
  document.getElementById('savePdfKomplainBtn').style.display=komplainData.length>0?"inline-block":"none";
  document.getElementById('resetKomplainBtn').style.display=komplainData.length>0?"inline-block":"none";
}
updateButtons();

// --- FORM SUBMIT ---
document.getElementById('absenForm').addEventListener('submit',function(e){
  e.preventDefault();
  const nama=document.getElementById('namaPegawai').value;
  const tanggal=document.getElementById('tanggalAbsen').value;
  const jam=document.getElementById('jamAbsen').value;
  const tipe=document.getElementById('tipeAbsen').value;
  const foto=document.getElementById('fotoAbsenPreview').dataset.img||'';
  let data=JSON.parse(localStorage.getItem('absen'))||[];
  data.push({nama,tanggal,jam,tipe,foto});
  localStorage.setItem('absen',JSON.stringify(data));
  fetch("https://script.google.com/macros/s/AKfycbwaG7dT4LnqJ_kMEd7dGvqiw0iarO9AcL0o8Oli0aa3nfa4vtzKfQc7ahwgvtVQxSsR/exec",{method:"POST", body:JSON.stringify({type:"absen", payload:{nama,tanggal,jam,tipe,foto}})});
  this.reset(); document.getElementById('fotoAbsenPreview').textContent=''; document.getElementById('fotoAbsenPreview').dataset.img='';
  updateButtons();
});

document.getElementById('hasilForm').addEventListener('submit',function(e){
  e.preventDefault();
  const nama=document.getElementById('namaPelangganHasil').value;
  const berat=document.getElementById('beratLaundry').value;
  const baju=document.getElementById('baju').value;
  const celana=document.getElementById('celana').value;
  const jaket=document.getElementById('jaket').value;
  const total=document.getElementById('total').value; // <-- ambil dari input readonly
  const tanggalSelesai=document.getElementById('tanggalSelesai').value;
  const jamMulai=document.getElementById('jamMulai').value;
  const jamSelesai=document.getElementById('jamSelesai').value;

  let data=JSON.parse(localStorage.getItem('hasilLaundry'))||[];
  data.push({nama,berat,baju,celana,jaket,total,tanggalSelesai,jamMulai,jamSelesai});
  localStorage.setItem('hasilLaundry',JSON.stringify(data));

  fetch("https://script.google.com/macros/s/AKfycbwaG7dT4LnqJ_kMEd7dGvqiw0iarO9AcL0o8Oli0aa3nfa4vtzKfQc7ahwgvtVQxSsR/exec",{
    method:"POST", 
    body:JSON.stringify({type:"hasilLaundry", payload:{nama,berat,baju,celana,jaket,total,tanggalSelesai,jamMulai,jamSelesai}})
  });

  this.reset(); document.getElementById('total').value=''; updateButtons();
});

document.getElementById('komplainForm').addEventListener('submit',function(e){
  e.preventDefault();
  const nama=document.getElementById('namaPelanggan').value;
  const tanggal=document.getElementById('tanggalKomplain').value;
  const jam=document.getElementById('jamKomplain').value;
  const isi=document.getElementById('komplainText').value;
  const foto=document.getElementById('fotoPreview').dataset.img||'';
  let data=JSON.parse(localStorage.getItem('komplain'))||[];
  data.push({nama,tanggal,jam,isi,foto});
  localStorage.setItem('komplain',JSON.stringify(data));
  fetch("https://script.google.com/macros/s/AKfycbwaG7dT4LnqJ_kMEd7dGvqiw0iarO9AcL0o8Oli0aa3nfa4vtzKfQc7ahwgvtVQxSsR/exec",{method:"POST", body:JSON.stringify({type:"komplain", payload:{nama,tanggal,jam,isi,foto}})});
  this.reset(); document.getElementById('fotoPreview').textContent=''; document.getElementById('fotoPreview').dataset.img='';
  updateButtons();
});

// --- RESET & PDF BUTTONS ---
document.getElementById('resetAbsenBtn').addEventListener('click',()=>{if(confirm("Yakin reset semua data Absen?")){ localStorage.removeItem('absen'); updateButtons(); alert("Data Absen berhasil di-reset!"); }});
document.getElementById('savePdfAbsenBtn').addEventListener('click',()=>{ const { jsPDF }=window.jspdf; const data=JSON.parse(localStorage.getItem('absen'))||[]; if(data.length>0){ const doc=new jsPDF(); let y=20; doc.setFontSize(12); doc.text("Data Absen",10,10); doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Tanggal",70,y); doc.text("Jam",110,y); doc.text("Tipe",140,y); doc.text("Foto",170,y); y+=10; data.forEach((d,i)=>{ if(y>270){ doc.addPage(); y=20; doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Tanggal",70,y); doc.text("Jam",110,y); doc.text("Tipe",140,y); doc.text("Foto",170,y); y+=10;} doc.text(String(i+1),10,y); doc.text(d.nama,20,y); doc.text(d.tanggal,70,y); doc.text(d.jam,110,y); doc.text(d.tipe,140,y); if(d.foto) doc.addImage(d.foto,'JPEG',170,y-7,20,15); y+=10;}); doc.save("data_absen.pdf"); }});

document.getElementById('resetLaundryBtn').addEventListener('click',()=>{if(confirm("Yakin reset semua data Hasil Laundry?")){ localStorage.removeItem('hasilLaundry'); updateButtons(); alert("Data Hasil Laundry berhasil di-reset!"); }});
document.getElementById('savePdfLaundryBtn').addEventListener('click',()=>{ const { jsPDF }=window.jspdf; const data=JSON.parse(localStorage.getItem('hasilLaundry'))||[]; if(data.length>0){ const doc=new jsPDF(); let y=20; doc.setFontSize(12); doc.text("Data Hasil Laundry",10,10); doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Berat",70,y); doc.text("Baju",100,y); doc.text("Celana",120,y); doc.text("Jaket",140,y); doc.text("Total",160,y); y+=10; data.forEach((d,i)=>{ if(y>270){ doc.addPage(); y=20; doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Berat",70,y); doc.text("Baju",100,y); doc.text("Celana",120,y); doc.text("Jaket",140,y); doc.text("Total",160,y); y+=10; } doc.text(String(i+1),10,y); doc.text(d.nama,20,y); doc.text(d.berat,70,y); doc.text(d.baju,100,y); doc.text(d.celana,120,y); doc.text(d.jaket,140,y); doc.text(d.total,160,y); y+=10;}); doc.save("data_hasil_laundry.pdf"); }});

document.getElementById('resetKomplainBtn').addEventListener('click',()=>{if(confirm("Yakin reset semua data Komplain?")){ localStorage.removeItem('komplain'); updateButtons(); alert("Data Komplain berhasil di-reset!"); }});
document.getElementById('savePdfKomplainBtn').addEventListener('click',()=>{ const { jsPDF }=window.jspdf; const data=JSON.parse(localStorage.getItem('komplain'))||[]; if(data.length>0){ const doc=new jsPDF(); let y=20; doc.setFontSize(12); doc.text("Data Komplain",10,10); doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Tanggal",70,y); doc.text("Jam",110,y); doc.text("Isi",140,y); doc.text("Foto",180,y); y+=10; data.forEach((d,i)=>{ if(y>270){ doc.addPage(); y=20; doc.text("No",10,y); doc.text("Nama",20,y); doc.text("Tanggal",70,y); doc.text("Jam",110,y); doc.text("Isi",140,y); doc.text("Foto",180,y); y+=10; } doc.text(String(i+1),10,y); doc.text(d.nama,20,y); doc.text(d.tanggal,70,y); doc.text(d.jam,110,y); doc.text(d.isi,140,y); if(d.foto) doc.addImage(d.foto,'JPEG',180,y-7,15,10); y+=10;}); doc.save("data_komplain.pdf"); }});
</script>
</body>
</html>

