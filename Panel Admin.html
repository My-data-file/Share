<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Admin - JetWash Laundry</title>
<style>
:root{
  --primary:#007bff;
  --primary-dark:#0056b3;
  --success:#28a745;
  --danger:#dc3545;
  --bg:#f0f4f8;
  --card:#ffffff;
  --muted:#f8f9fa;
  --text:#2b2b2b;
  --dark-bg:#121212;
  --dark-card:#1e1e1e;
  --dark-text:#e0e0e0;
}
/* Reset */
*{box-sizing:border-box;margin:0;padding:0}
/* Body */
body{
  font-family:'Segoe UI',sans-serif;
  background:var(--bg);
  display:flex;
  min-height:100vh;
  overflow:hidden;
  transition:background .3s, color .3s;
  color:var(--text);
}
/* Dark mode */
body.dark{background:var(--dark-bg);color:var(--dark-text);}
body.dark .card{background:var(--dark-card);}
body.dark table{background:var(--dark-card);}
body.dark th{background:#2c2c2c;border-color:#3a3a3a;}
body.dark tr:hover{background:#333;}
/* Sidebar */
.sidebar{
  width:240px;
  background:var(--primary);
  color:#fff;
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  padding-top:20px;
  transition:all .3s ease;
}
.sidebar h2{text-align:center;margin-bottom:18px;font-size:1.2em;font-weight:600}
.sidebar a{
  color:#fff;
  text-decoration:none;
  padding:12px 20px;
  display:flex;
  align-items:center;
  gap:8px;
  transition:background .2s, padding-left .2s;
  border-left:4px solid transparent;
}
.sidebar a:hover{background:rgba(255,255,255,.12);padding-left:24px}
.sidebar a.active{background:rgba(255,255,255,.18);border-left-color:#fff}
/* Content */
.content{
  flex:1;
  padding:20px;
  overflow-y:auto;
}
h1{margin-bottom:14px;color:var(--primary);font-size:1.4em;font-weight:700}
/* Dashboard cards */
.cards{display:flex;flex-wrap:wrap;gap:14px;margin-bottom:20px}
.card{
  flex:1 1 200px;
  background:var(--card);
  padding:14px 18px;
  border-radius:12px;
  box-shadow:0 3px 10px rgba(0,0,0,.08);
  cursor:pointer;
  transition:transform .15s, box-shadow .15s;
}
.card:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.12)}
.card h3{font-size:1.1em;margin-bottom:6px}
.card p{font-size:.92em;}
/* Table */
.table-container{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  box-shadow:0 3px 10px rgba(0,0,0,.08);
  overflow-x:auto;
  margin-bottom:14px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:.9em;
}
th,td{
  padding:10px 12px;
  border-bottom:1px solid #e9ecef;
  text-align:left;
  vertical-align:top;
}
th{background:var(--muted);font-weight:600}
tr:hover{background:#f7faff}
td img{border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.15)}
.empty-row{text-align:center;color:#999;font-style:italic}
/* Buttons */
.btn{
  display:inline-block;
  margin:8px 6px 0 0;
  padding:8px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-size:.9em;
  font-weight:600;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  transition:transform .08s ease-in-out, filter .2s;
}
.btn:hover{transform:translateY(-1px)}
.btn-export{background:linear-gradient(145deg,var(--success),#218838);color:#fff}
.btn-reset{background:linear-gradient(145deg,var(--danger),#a71d2a);color:#fff}
.btn-toggle{background:var(--primary-dark);color:#fff;margin-left:auto;}
/* Search input */
.search-box{
  margin-bottom:10px;
}
.search-box input{
  padding:8px 12px;
  width:250px;
  border-radius:8px;
  border:1px solid #ccc;
}
/* Responsive */
@media(max-width:900px){
  .sidebar{width:70px;align-items:center}
  .sidebar h2{display:none}
  .sidebar a{justify-content:center;padding:14px}
  .sidebar a span{display:none}
  .content{padding:16px}
}
@media(max-width:600px){
  body{flex-direction:column}
  .sidebar{width:100%;flex-direction:row;justify-content:space-around;padding:8px 0;position:sticky;top:0;z-index:5}
  .sidebar a{border-left:none;border-bottom:4px solid transparent}
  .sidebar a.active{border-bottom-color:#fff}
  table,th,td{font-size:.82em}
  .btn{font-size:.82em;padding:7px 14px}
  .search-box input{width:100%}
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>JetWash Admin</h2>
  <a href="#" class="active" data-page="dashboard">üìä <span>Dashboard</span></a>
  <a href="#" data-page="absen">üìù <span>Absen</span></a>
  <a href="#" data-page="laundry">üß∫ <span>Laundry</span></a>
  <a href="#" data-page="komplain">‚ö†Ô∏è <span>Komplain</span></a>
  <button class="btn btn-toggle" onclick="toggleDarkMode()">üåì</button>
</div>

<div class="content">
  <div id="dashboard" class="page active">
    <h1>Dashboard</h1>
    <div class="cards">
      <div class="card" onclick="showPage('absen')"><h3>Total Absen</h3><p id="countAbsen">0</p></div>
      <div class="card" onclick="showPage('laundry')"><h3>Total Laundry</h3><p id="countLaundry">0</p></div>
      <div class="card" onclick="showPage('komplain')"><h3>Total Komplain</h3><p id="countKomplain">0</p></div>
    </div>
  </div>

  <div id="absen" class="page" style="display:none;">
    <h1>Data Absen</h1>
    <div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableAbsen',this.value)"></div>
    <div class="table-container">
      <table id="tableAbsen">
        <thead><tr><th>No</th><th>Nama</th><th>Tanggal</th><th>Jam</th><th>Tipe</th><th>Foto</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="btn btn-export" onclick="exportPdf('absen')">Export PDF</button>
    <button class="btn btn-reset" onclick="resetData('absen')">Reset Data</button>
  </div>

  <div id="laundry" class="page" style="display:none;">
    <h1>Data Laundry</h1>
    <div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableLaundry',this.value)"></div>
    <div class="table-container">
      <table id="tableLaundry">
        <thead><tr><th>No</th><th>Nama</th><th>Berat</th><th>Baju</th><th>Celana</th><th>Jaket</th><th>Total</th><th>Tgl Selesai</th><th>Jam Mulai</th><th>Jam Selesai</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="btn btn-export" onclick="exportPdf('laundry')">Export PDF</button>
    <button class="btn btn-reset" onclick="resetData('laundry')">Reset Data</button>
  </div>

  <div id="komplain" class="page" style="display:none;">
    <h1>Data Komplain</h1>
    <div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableKomplain',this.value)"></div>
    <div class="table-container">
      <table id="tableKomplain">
        <thead><tr><th>No</th><th>Nama</th><th>Tanggal</th><th>Jam</th><th>Isi</th><th>Foto</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="btn btn-export" onclick="exportPdf('komplain')">Export PDF</button>
    <button class="btn btn-reset" onclick="resetData('komplain')">Reset Data</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
// ======= NAVIGATION =========
function showPage(pageId){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(pageId).style.display='block';
  document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'));
  document.querySelector(`.sidebar a[data-page="${pageId}"]`)?.classList.add('active');
}
document.querySelectorAll('.sidebar a').forEach(link=>{
  link.addEventListener('click',e=>{
    e.preventDefault();
    showPage(link.dataset.page);
  });
});

// ======= DARK MODE =======
function toggleDarkMode(){
  document.body.classList.toggle('dark');
}

// ======= SEARCH / FILTER =======
function filterTable(tableId,value){
  const filter=value.toLowerCase();
  const rows=document.querySelectorAll('#'+tableId+' tbody tr');
  rows.forEach(r=>{
    r.style.display = [...r.cells].some(td=>td.textContent.toLowerCase().includes(filter)) ? '' : 'none';
  });
}

// ======= JS ASLI ANDA =======
document.addEventListener('DOMContentLoaded',()=>{
  function loadTables(){
    let absen = JSON.parse(localStorage.getItem('absen'))||[];
    let laundry = JSON.parse(localStorage.getItem('hasilLaundry'))||[];
    let komplain = JSON.parse(localStorage.getItem('komplain'))||[];
    document.getElementById('countAbsen').textContent=absen.length;
    document.getElementById('countLaundry').textContent=laundry.length;
    document.getElementById('countKomplain').textContent=komplain.length;

    fillTable('tableAbsen',absen,(d,i)=>`<td>${i+1}</td><td>${d.nama}</td><td>${d.tanggal}</td><td>${d.jam}</td><td>${d.tipe}</td><td>${d.foto?'<img src="'+d.foto+'" width="40">':'-'}</td>`);
    fillTable('tableLaundry',laundry,(d,i)=>`<td>${i+1}</td><td>${d.nama}</td><td>${d.berat}</td><td>${d.baju}</td><td>${d.celana}</td><td>${d.jaket}</td><td>${d.total}</td><td>${d.tanggalSelesai}</td><td>${d.jamMulai}</td><td>${d.jamSelesai}</td>`);
    fillTable('tableKomplain',komplain,(d,i)=>`<td>${i+1}</td><td>${d.nama}</td><td>${d.tanggal}</td><td>${d.jam}</td><td>${d.isi}</td><td>${d.foto?'<img src="'+d.foto+'" width="40">':'-'}</td>`);
  }

  function fillTable(tableId,data,rowBuilder){
    const tbody=document.querySelector('#'+tableId+' tbody');
    tbody.innerHTML='';
    if(data.length===0){
      tbody.innerHTML=`<tr class="empty-row"><td colspan="${document.querySelector('#'+tableId+' thead tr').children.length}">Belum ada data</td></tr>`;
    } else {
      data.forEach((d,i)=>{ tbody.innerHTML+=`<tr>${rowBuilder(d,i)}</tr>`; });
    }
  }

  loadTables();

  // Auto refresh real-time
  window.addEventListener("storage", loadTables);

  // Patch setItem & removeItem agar auto-refresh di tab ini juga
  (function(){
    const originalSetItem = localStorage.setItem;
    localStorage.setItem = function(key, value){
      originalSetItem.apply(this, arguments);
      loadTables();
    };
    const originalRemoveItem = localStorage.removeItem;
    localStorage.removeItem = function(key){
      originalRemoveItem.apply(this, arguments);
      loadTables();
    };
  })();

  // Reset Data
  window.resetData=function(key){
    if(confirm("Yakin reset data "+key+"?")){
      let storageKey = key==='laundry' ? 'hasilLaundry' : key;
      localStorage.removeItem(storageKey);
    }
  };

  // Export PDF
  window.exportPdf=function(type){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let data = JSON.parse(localStorage.getItem(type==='laundry'?'hasilLaundry':type))||[];
    if(data.length===0){ alert("Data kosong!"); return; }
    let columns=[], rows=[];
    if(type==="absen"){ columns=["No","Nama","Tanggal","Jam","Tipe","Foto"]; rows=data.map((d,i)=>[i+1,d.nama,d.tanggal,d.jam,d.tipe,d.foto?"Ada":""]); }
    else if(type==="laundry"){ columns=["No","Nama","Berat","Baju","Celana","Jaket","Total","Tgl Selesai","Jam Mulai","Jam Selesai"]; rows=data.map((d,i)=>[i+1,d.nama,d.berat,d.baju,d.celana,d.jaket,d.total,d.tanggalSelesai,d.jamMulai,d.jamSelesai]); }
    else if(type==="komplain"){ columns=["No","Nama","Tanggal","Jam","Isi","Foto"]; rows=data.map((d,i)=>[i+1,d.nama,d.tanggal,d.jam,d.isi,d.foto?"Ada":""]); }
    doc.setFontSize(14);
    doc.text("Export Data "+type,14,15);
    doc.autoTable({ head:[columns], body:rows, startY:20, styles:{fontSize:8} });
    if(type==="absen"||type==="komplain"){
      let finalY = doc.lastAutoTable.finalY +10;
      doc.text("Lampiran Foto:",14,finalY);
      let y=finalY+5, x=14;
      data.forEach(d=>{
        if(d.foto){
          try{ doc.addImage(d.foto,"JPEG",x,y,30,30); x+=35; if(x>160){x=14;y+=35;} }
          catch(e){console.log("Gagal load foto",e);}
        }
      });
    }
    doc.save("data_"+type+".pdf");
  };
});
</script>
</body>
</html>
