<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Admin - JetWash Laundry</title>
<style>
:root{--primary:#007bff;--success:#28a745;--danger:#dc3545;--bg:#f0f4f8;--card:#fff;--muted:#f8f9fa;--text:#2b2b2b;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);display:flex;min-height:100vh;overflow:hidden;color:var(--text);transition:background .3s,color .3s;}
body.dark{background:#121212;color:#e0e0e0;}
body.dark .card, body.dark .table-container{background:#1e1e1e;}
body.dark th{background:#2c2c2c;border-color:#3a3a3a;}
body.dark tr:hover{background:#333;}
.sidebar{width:240px;background:var(--primary);color:#fff;flex-shrink:0;display:flex;flex-direction:column;padding-top:20px;transition:all .3s;}
.sidebar h2{text-align:center;margin-bottom:18px;font-size:1.2em;font-weight:600;}
.sidebar a{color:#fff;text-decoration:none;padding:12px 20px;display:flex;align-items:center;gap:8px;transition:all .3s;border-left:4px solid transparent;}
.sidebar a:hover{background:rgba(255,255,255,.12);padding-left:24px;}
.sidebar a.active{background:rgba(255,255,255,.18);border-left-color:#fff;}
.sidebar .btn-toggle{background:#0056b3;color:#fff;margin-top:auto;margin:8px;cursor:pointer;}
.content{flex:1;padding:20px;overflow-y:auto;}
h1{margin-bottom:14px;color:var(--primary);font-size:1.4em;font-weight:700;}
.cards{display:flex;flex-wrap:wrap;gap:14px;margin-bottom:20px;transition:all .3s;}
.card{flex:1 1 200px;background:var(--card);padding:14px 18px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.08);cursor:pointer;transition:transform .3s,box-shadow .3s,background .3s;}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(0,0,0,.12);}
.card h3{font-size:1.1em;margin-bottom:6px;}
.card p{font-size:.92em;}
.table-container{background:var(--card);border-radius:14px;padding:14px;box-shadow:0 3px 10px rgba(0,0,0,.08);overflow-x:auto;margin-bottom:14px;transition:all .3s;}
table{width:100%;border-collapse:collapse;font-size:.9em;transition:all .3s;}
th,td{padding:10px 12px;border-bottom:1px solid #e9ecef;text-align:left;vertical-align:top;transition:all .3s;}
th{background:var(--muted);font-weight:600;cursor:pointer;}
tr{transition:all .3s;}
tr:hover{background:#f7faff;}
td img{border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.15);}
td input.comment{width:95%;padding:4px 6px;border-radius:6px;border:1px solid #ccc;font-size:.85em;}
.empty-row{text-align:center;color:#999;font-style:italic;opacity:.6;}
.btn{display:inline-block;margin:8px 6px 0 0;padding:8px 16px;border:none;border-radius:10px;cursor:pointer;font-size:.9em;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.12);transition:transform .2s ease,filter .2s;}
.btn:hover{transform:translateY(-1px);}
.btn-export{background:linear-gradient(145deg,var(--success),#218838);color:#fff;}
.btn-reset{background:linear-gradient(145deg,var(--danger),#a71d2a);color:#fff;}
.btn-toggle{padding:6px 12px;border-radius:8px;}
.search-box{margin-bottom:10px;}
.search-box input{padding:8px 12px;width:250px;border-radius:8px;border:1px solid #ccc;transition:all .3s;}
.pagination{display:flex;gap:6px;margin:6px 0;flex-wrap:wrap;}
.pagination .btn{padding:5px 10px;font-size:.85em;}
.rows-per-page{margin:6px 0;display:flex;align-items:center;gap:6px;font-size:.85em;}
.rows-per-page select{padding:4px 8px;border-radius:6px;border:1px solid #ccc;}
@media(max-width:900px){.sidebar{width:70px;align-items:center}.sidebar h2{display:none}.sidebar a{justify-content:center;padding:14px}.sidebar a span{display:none}.content{padding:16px}}
@media(max-width:600px){body{flex-direction:column}.sidebar{width:100%;flex-direction:row;justify-content:space-around;padding:8px 0;position:sticky;top:0;z-index:5}.sidebar a{border-left:none;border-bottom:4px solid transparent}.sidebar a.active{border-bottom-color:#fff}table,th,td{font-size:.82em}.btn{font-size:.82em;padding:7px 14px}.search-box input{width:100%}}
</style>
</head>
<body>

<div class="sidebar">
<h2>JetWash Admin</h2>
<a href="#" class="active" data-page="dashboard">üìä <span>Dashboard</span></a>
<a href="#" data-page="absen">üìù <span>Absen</span></a>
<a href="#" data-page="laundry">üß∫ <span>Laundry</span></a>
<a href="#" data-page="komplain">‚ö†Ô∏è <span>Komplain</span></a>
<button class="btn-toggle" onclick="toggleDarkMode()">üåì</button>
</div>

<div class="content">

<!-- Dashboard -->
<div id="dashboard" class="page active">
<h1>Dashboard</h1>
<div class="cards">
<div class="card" onclick="showPage('absen')"><h3>Total Absen</h3><p id="countAbsen">0</p></div>
<div class="card" onclick="showPage('laundry')"><h3>Total Laundry</h3><p id="countLaundry">0</p></div>
<div class="card" onclick="showPage('komplain')"><h3>Total Komplain</h3><p id="countKomplain">0</p></div>
</div>
</div>

<!-- Absen -->
<div id="absen" class="page" style="display:none;">
<h1>Data Absen</h1>
<div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableAbsen',this.value)"></div>
<div class="table-container">
<div class="rows-per-page"></div>
<table id="tableAbsen">
<thead><tr><th>No</th><th>Nama</th><th>Tanggal</th><th>Jam</th><th>Tipe</th><th>Foto</th><th>Komentar</th></tr></thead>
<tbody></tbody>
</table>
<div class="pagination"></div>
</div>
<button class="btn btn-export" onclick="exportPdf('absen')">Export PDF</button>
<button class="btn btn-reset" onclick="resetData('absen')">Reset Data</button>
</div>

<!-- Laundry -->
<div id="laundry" class="page" style="display:none;">
<h1>Data Laundry</h1>
<div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableLaundry',this.value)"></div>
<div class="table-container">
<div class="rows-per-page"></div>
<table id="tableLaundry">
<thead><tr><th>No</th><th>Nama</th><th>Berat</th><th>Baju</th><th>Celana</th><th>Jaket</th><th>Total</th><th>Tgl Selesai</th><th>Jam Mulai</th><th>Jam Selesai</th><th>Komentar</th></tr></thead>
<tbody></tbody>
</table>
<div class="pagination"></div>
</div>
<button class="btn btn-export" onclick="exportPdf('laundry')">Export PDF</button>
<button class="btn btn-reset" onclick="resetData('laundry')">Reset Data</button>
</div>

<!-- Komplain -->
<div id="komplain" class="page" style="display:none;">
<h1>Data Komplain</h1>
<div class="search-box"><input type="text" placeholder="Cari nama..." onkeyup="filterTable('tableKomplain',this.value)"></div>
<div class="table-container">
<div class="rows-per-page"></div>
<table id="tableKomplain">
<thead><tr><th>No</th><th>Nama</th><th>Tanggal</th><th>Jam</th><th>Isi</th><th>Foto</th><th>Komentar</th></tr></thead>
<tbody></tbody>
</table>
<div class="pagination"></div>
</div>
<button class="btn btn-export" onclick="exportPdf('komplain')">Export PDF</button>
<button class="btn btn-reset" onclick="resetData('komplain')">Reset Data</button>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
// Sidebar
document.querySelectorAll('.sidebar a').forEach(link=>{link.addEventListener('click',()=>{document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'));link.classList.add('active');showPage(link.dataset.page);});});
function showPage(page){document.querySelectorAll('.page').forEach(p=>p.style.display='none');document.getElementById(page).style.display='block';}

// Dark mode
function toggleDarkMode(){document.body.classList.toggle('dark');}

// Load tables with comments
function loadTables(){
  let absen=JSON.parse(localStorage.getItem('absen'))||[];
  let laundry=JSON.parse(localStorage.getItem('hasilLaundry'))||[];
  let komplain=JSON.parse(localStorage.getItem('komplain'))||[];
  let comments=JSON.parse(localStorage.getItem('comments'))||{};
  document.getElementById('countAbsen').textContent=absen.length;
  document.getElementById('countLaundry').textContent=laundry.length;
  document.getElementById('countKomplain').textContent=komplain.length;

  fillTableWithComments('tableAbsen',absen,['nama','tanggal','jam','tipe','foto'],comments,'absen');
  fillTableWithComments('tableLaundry',laundry,['nama','berat','baju','celana','jaket','total','tanggalSelesai','jamMulai','jamSelesai'],comments,'laundry');
  fillTableWithComments('tableKomplain',komplain,['nama','tanggal','jam','isi','foto'],comments,'komplain');
}

// Fill table
function fillTableWithComments(tableId,data,fields,comments,type){
  const tbody=document.querySelector('#'+tableId+' tbody');
  tbody.innerHTML='';
  if(data.length===0){tbody.innerHTML='<tr class="empty-row"><td colspan="20">Data Kosong</td></tr>';return;}
  data.forEach((d,i)=>{
    let row='<td>'+(i+1)+'</td>';
    fields.forEach(f=>{row+='<td>'+(f==='foto'?(d[f]?'<img src="'+d[f]+'" width="40">':''):d[f])+'</td>';});
    const commentKey=type+'_'+i;
    row+='<td><input class="comment" type="text" placeholder="Tambahkan komentar" value="'+(comments[commentKey]||'')+'" onblur="saveComment(\''+type+'\','+i+',this.value)"></td>';
    tbody.innerHTML+='<tr>'+row+'</tr>';
  });
}

// Save comment
function saveComment(type,index,value){
  let comments=JSON.parse(localStorage.getItem('comments'))||{};
  comments[type+'_'+index]=value;
  localStorage.setItem('comments',JSON.stringify(comments));
}

// Reset data
function resetData(key){
  if(confirm("Yakin reset data "+key+"?")){
    let storageKey = key==='laundry'? 'hasilLaundry': key;
    localStorage.removeItem(storageKey);
    loadTables();
  }
}

// Export PDF with comments
function exportPdf(type){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let data = JSON.parse(localStorage.getItem(type==='laundry'?'hasilLaundry':type))||[];
  let comments = JSON.parse(localStorage.getItem('comments'))||{};
  if(data.length===0){ alert("Data kosong!"); return; }

  let columns=[], rows=[];
  if(type==='absen'){columns=["No","Nama","Tanggal","Jam","Tipe","Foto","Komentar"];
    rows=data.map((d,i)=>[i+1,d.nama,d.tanggal,d.jam,d.tipe,d.foto?"Ada":"",comments[type+'_'+i]||""]);
  } else if(type==='laundry'){columns=["No","Nama","Berat","Baju","Celana","Jaket","Total","Tgl Selesai","Jam Mulai","Jam Selesai","Komentar"];
    rows=data.map((d,i)=>[i+1,d.nama,d.berat,d.baju,d.celana,d.jaket,d.total,d.tanggalSelesai,d.jamMulai,d.jamSelesai,comments[type+'_'+i]||""]);
  } else if(type==='komplain'){columns=["No","Nama","Tanggal","Jam","Isi","Foto","Komentar"];
    rows=data.map((d,i)=>[i+1,d.nama,d.tanggal,d.jam,d.isi,d.foto?"Ada":"",comments[type+'_'+i]||""]);
  }

  doc.setFontSize(14);
  doc.text("Export Data "+type,14,15);
  doc.autoTable({head:[columns],body:rows,startY:20,styles:{fontSize:8}});

  if(type==='absen'||type==='komplain'){
    let finalY=doc.lastAutoTable.finalY+10;
    doc.text("Lampiran Foto:",14,finalY);
    let y=finalY+5,x=14;
    data.forEach(d=>{
      if(d.foto){ try{doc.addImage(d.foto,"JPEG",x,y,30,30);x+=35;if(x>160){x=14;y+=35;}}catch(e){console.log(e);} }
    });
  }
  doc.save("data_"+type+".pdf");
}

// Auto refresh on localStorage changes
window.addEventListener("storage", loadTables);
(function(){
  const originalSetItem=localStorage.setItem;
  localStorage.setItem=function(k,v){originalSetItem.apply(this,arguments);loadTables();};
  const originalRemoveItem=localStorage.removeItem;
  localStorage.removeItem=function(k){originalRemoveItem.apply(this,arguments);loadTables();};
})();
loadTables();
</script>
</body>
</html>
