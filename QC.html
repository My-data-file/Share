<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QC System</title>

<style>
/* ======================== Variabel Warna & Radius ======================== */
:root{
  --bg:#f4f7fb; 
  --card:#ffffff; 
  --accent:#0ea5a4; 
  --accent-2:#0369a1;
  --muted:#6b7280; 
  --danger:#dc2626; 
  --success:#16a34a; 
  --warning:#facc15;
  --radius:12px;
}

/* ======================== Reset & Body ======================== */
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:var(--bg);
  color:#111;
  min-height:100vh;
  width:100%;
  overflow-x:hidden;
}

/* ======================== Header ======================== */
header{
  background:var(--accent);
  color:#fff;
  padding:1rem 1.5rem;
  font-size:1.4rem;
  font-weight:bold;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

#headerTitle {
  font-size: 1.2rem;
  font-weight: bold;
  text-transform: uppercase; /* Hanya judul kapital */
  text-align: center;
}

#headerTime {
  font-size: 0.7rem;
  font-weight: normal;
  text-transform: none;
  text-align: right; /* atau center */
  margin-top: 2px;
  line-height: 1.2; /* biar rapat sedikit */
}

#headerTime .tanggal {
  display: block;
}

#headerTime .jam {
  display: block;
  font-size: 0.7rem;
}
  
/* ======================== Layout Container & Nav ======================== */
.container{
  display:flex;
  flex-direction:row;
  width:100%;
  min-height:100vh;
}

nav{
  width:220px;
  background:#fff;
  border-right:1px solid #e5e7eb;
  padding:1rem;
  box-shadow:2px 0 6px rgba(0,0,0,0.05);
  flex-shrink:0;
}

nav button{
  display:block;
  width:100%;
  padding:.8rem 1rem;
  margin-bottom:.6rem;
  border:none;
  border-radius:var(--radius);
  background:var(--accent);
  color:#fff;
  font-weight:500;
  cursor:pointer;
  transition:all .2s ease;
}
nav button:hover{
  background:var(--accent-2);
  transform:translateY(-1px);
}
nav button.active{
  background:var(--accent-2);
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

/* ======================== Main & Card ======================== */
main{
  flex:1;
  padding:1.5rem;
  display:grid;
  gap:1rem;
}

.card{
  background:var(--card);
  padding:1.2rem;
  border-radius:var(--radius);
  box-shadow:0 2px 8px rgba(0,0,0,.06);
}

/* ======================== Tabs ======================== */
.tabs{
  display:flex;
  gap:.5rem;
  margin-bottom:.75rem;
  flex-wrap:wrap;
}

.tabs button{
  flex:1;
  padding:.6rem;
  border:none;
  border-radius:var(--radius);
  background:#e5e7eb;
  cursor:pointer;
  font-weight:500;
  transition:.2s;
}
.tabs button.active{
  background:var(--accent);
  color:#fff;
}

.tab-content{display:none;}
.tab-content.active{display:block;}

/* ======================== Form Input ======================== */
input[type=text], input[type=number], select{
  padding:.5rem .7rem;
  border:1px solid #ccc;
  border-radius:8px;
  margin-bottom:6px;
  width:100%;
  transition:border .2s, box-shadow .2s;
}

/* ======================== Grid ======================== */
.grid-container{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:0.8rem;
}

.grid-card{
  background:#fff;
  padding:.8rem;
  border-radius:var(--radius);
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  gap:6px;
  position:relative;
}

.grid-card input{
  padding:.4rem .6px;
  border:1px solid #ccc;
  border-radius:6px;
  margin-bottom:4px;
  width:100%;
}

/* ======================== Tombol Aksi di Grid ======================== */
.grid-card .btn-icon{
  border:none;
  cursor:pointer;
  border-radius:6px;
  padding:4px 6px;
  font-size:0.9rem;
  transition:.2s;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.btn-call{background:var(--accent);color:#fff;}
.btn-edit{background:#facc15;color:#111;}
.btn-delete{background:var(--danger);color:#fff;}
.btn-save{background:var(--success);color:#fff;}
.btn-icon:hover{opacity:.9;transform:translateY(-1px);}

/* ======================== Edit Inline ======================== */
.edit-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.edit-grid input,
.edit-grid select {
  flex: 1 1 48%;
  min-width: 100px;
}

/* Khusus kolom Keterangan agar melebar penuh */
.edit-grid textarea {
  flex: 1 1 100%;
  width: 100%;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px;
  font-family: inherit;
  resize: vertical; /* bisa ubah tinggi tapi tidak lebar */
}

/* ======================== Status ======================== */
.status-to {
  background: #fee2e2;   /* merah muda lembut */
  color: #b91c1c;        /* merah tua */
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
}
.status-proses{
  background:var(--warning);
  color:#111;
  padding:2px 6px;
  border-radius:6px;
  font-weight:600;
}
.status-selesai{
  background:var(--success);
  color:#fff;
  padding:2px 6px;
  border-radius:6px;
  font-weight:600;
}

.form-group { margin-bottom: 10px; }

/* ======================== Responsif ======================== */
@media(max-width:768px){
  .container{flex-direction:column;}
  nav{
    width:100%;
    display:flex;
    overflow-x:auto;
    padding:.5rem;
  }
  nav button{
    flex:1;
    min-width:120px;
    margin:0 4px 0 0;
  }
  main{padding:1rem;}
}

/* ================= GRID RESPONSIVE UNIVERSAL ================= */
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* Atur ukuran minimum per grid */
  gap: 10px;
  justify-items: stretch;
  align-items: stretch;
  width: 100%;
}

/* Konsistensi antar menu agar tinggi & padding card sama */
.grid-container > div {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  min-height: 90px;

  /* üîß ini bagian penting */
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* ‚¨ÜÔ∏è teks mulai dari atas */
  align-items: flex-start;     /* ‚¨ÖÔ∏è teks ke kiri */
  text-align: left;            /* pastikan teks kiri juga */
}

/* Responsif di HP ‚Äî biar tetap sejajar, tidak 1 kolom besar */
@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 8px;
  }
}
@media (max-width: 480px) {
  .grid-container {
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 6px;
  }
}

/* ==================== RATA KIRI UNTUK SEMUA DASHBOARD QC ==================== */
[id^="dashboard"] .grid-card,
[id^="dashboard"] .grid-card * {
  text-align: left !important;
  align-items: flex-start !important;
  justify-content: flex-start !important;
}


</style>
</head>
<body>

<!-- ======================== Header ======================== -->
<header style="
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 24px;
  background: linear-gradient(90deg, #0ea5a4, #0369a1);
  color: white;
  font-family: 'Inter', sans-serif;
  font-weight: 500;
  letter-spacing: 0.3px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 1px solid rgba(255,255,255,0.1);
">
  <div style="display: flex; align-items: center; gap: 10px;">
    <div style="
      background: white;
      color: #0ea5a4;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 6px 10px;
      border-radius: 10px;
    ">QC</div>
    <div id="headerTitle" style="font-size: 0.8rem;">System 2.0</div>
  </div>
  <div id="headerTime">
    <div class="tanggal">Selasa, 5 Oktober 2025</div>
    <div class="jam">14:30</div>
  </div>
</header>

<!-- ======================== Container ======================== -->
<div class="container">

  <!-- ======================== Menu Nav ======================== -->
  <nav>
    <button onclick="showMenu('dashboard')" class="active">DASBOARD</button>
    <button onclick="showMenu('qcBapro')">QC BAPRO</button>
    <button onclick="showMenu('qcPA')">QC CETAK</button>
    <button onclick="showMenu('qcFinishing')">QC FINISHING</button>
    <button onclick="showMenu('qcLem')">QC LEM</button>
    <button onclick="showMenu('qcSPV')">QC REGISTER</button>
  </nav>

  <!-- ======================== Main Section ======================== -->
  <main>

    <!-- ======================== Dashboard ======================== -->
    <section id="dashboard" class="card qc-section">

<!-- ======================== QC Bapro ======================== -->
<h2 style="text-align:center; color:#fff; background:#dc2626; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
  QC BAPRO
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="flex:1; min-width:120px; background:rgba(220,38,38,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Order<br><strong id="countBapro">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(220,38,38,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total TO<br><strong id="countTOBapro">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(220,38,38,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Proses<br><strong id="countProsesBapro">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(220,38,38,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Selesai<br><strong id="countSelesaiBapro">0</strong>
  </div>
</div>

<!-- Grid TO -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">TO</h4>
  <button id="toggleBaproTO" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardBaproTO" class="grid-container" style="display:none;"></div>

<!-- Grid Proses -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Proses</h4>
  <button id="toggleBaproProses" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardBaproProses" class="grid-container" style="display:none;"></div>

<!-- Grid Selesai -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Selesai</h4>
  <button id="toggleBaproSelesai" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardBaproSelesai" class="grid-container" style="display:none;"></div>

    <!-- ======================== QC PA ======================== -->
<h2 style="text-align:center; color:#fff; background:#ff9800; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
  QC CETAK
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="flex:1; min-width:120px; background:rgba(255,152,0,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Order<br><strong id="countPA">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(255,152,0,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total TO<br><strong id="countTOPA">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(255,152,0,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Proses<br><strong id="countProsesPA">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(255,152,0,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Selesai<br><strong id="countSelesaiPA">0</strong>
  </div>
</div>

<!-- Grid TO -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">TO</h4>
  <button id="togglePATO" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardPATO" class="grid-container" style="display:none;"></div>

<!-- Grid Proses -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Proses</h4>
  <button id="togglePAProses" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardPAProses" class="grid-container" style="display:none;"></div>

<!-- Grid Selesai -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Selesai</h4>
  <button id="togglePASelesai" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardPASelesai" class="grid-container" style="display:none;"></div>

<!-- ======================== QC Finishing ======================== -->
<h2 style="text-align:center; color:#fff; background:#22c55e; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
  QC FINISHING
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="flex:1; min-width:120px; background:rgba(34,197,94,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Order<br><strong id="countFinishing">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(34,197,94,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total TO<br><strong id="countTO">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(34,197,94,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Proses<br><strong id="countProses">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(34,197,94,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Selesai<br><strong id="countSelesai">0</strong>
  </div>
</div>

<!-- Grid TO -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">TO</h4>
  <button id="toggleTO" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardFinishingTO" class="grid-container" style="display:none;"></div>

<!-- Grid Proses -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Proses</h4>
  <button id="toggleProses" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardFinishingProses" class="grid-container" style="display:none;"></div>

<!-- Grid Selesai -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Selesai</h4>
  <button id="toggleSelesai" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardFinishingSelesai" class="grid-container" style="display:none;"></div>

    <!-- ======================== QC Lem ======================== -->
<h2 style="text-align:center; color:#fff; background:#9c27b0; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
  QC LEM
</h2>

<!-- Info Total -->
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; justify-content:center;">
  <div style="flex:1; min-width:120px; background:rgba(156,39,176,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Order<br><strong id="countLem">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(156,39,176,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total TO<br><strong id="countTOLem">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(156,39,176,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Proses<br><strong id="countProsesLem">0</strong>
  </div>
  <div style="flex:1; min-width:120px; background:rgba(156,39,176,0.75); padding:6px 10px; border-radius:8px; text-align:center;">
    Total Selesai<br><strong id="countSelesaiLem">0</strong>
  </div>
</div>

<!-- Grid TO -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">TO</h4>
  <button id="toggleLemTO" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardLemTO" class="grid-container" style="display:none;"></div>

<!-- Grid Proses -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Proses</h4>
  <button id="toggleLemProses" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardLemProses" class="grid-container" style="display:none;"></div>

<!-- Grid Selesai -->
<div style="text-align:center; margin-top:12px; margin-bottom:4px;">
  <h4 style="display:inline-block; margin:0;">Selesai</h4>
  <button id="toggleLemSelesai" style="margin-left:8px; padding:2px 6px; font-size:0.8rem;">Show</button>
</div>
<div id="dashboardLemSelesai" class="grid-container" style="display:none;"></div>

    </section>

<!-- ======================== QC BAPRO ======================== -->
<section id="qcBapro" class="card qc-section" style="display:none;">

  <h2 style="text-align:center; color:#fff; background:#dc2626; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
    MENU QC BAPRO
  </h2>

  <div class="tabs">
    <button class="active" data-tab="inputBapro" onclick="switchTab(this)">Inputan</button>
    <button data-tab="hasilBapro" onclick="switchTab(this)">Hasil</button>
  </div>

  <div id="inputBapro" class="tab-content active">
    <div class="form-group"><input type="text" id="baproNama" placeholder="Nama Order"></div>
    <div class="form-group">
      <select id="baproNoKS">
        <option value="">CSO</option>
        <option value="Yati">Yati</option>
        <option value="Retni">Retni</option>
        <option value="Aulia">Aulia</option>
        <option value="Yuli">Yuli</option>
      </select>
    </div>
    <div class="form-group"><input type="text" id="baproJenis" placeholder="Jenis Kertas"></div>
    <div class="form-group"><input type="number" id="baproKertas" placeholder="Tebal Kertas (gsm)"></div>
    <div class="form-group"><input type="text" id="baproNamaTinta" placeholder="Nama Tinta"></div>
    <div class="form-group"><input type="number" id="baproDmax" placeholder="Dmax"></div>
    <div class="form-group"><input type="number" id="baproL" placeholder="L"></div>
    <div class="form-group"><input type="number" id="baproA" placeholder="A"></div>
    <div class="form-group"><input type="number" id="baproB" placeholder="B"></div>
    <div class="form-group">
      <select id="baproQC">
        <option value="">QC</option>
        <option value="Marwan">Marwan</option>
        <option value="Kiki">Kiki</option>
      </select>
    </div>
    <div class="form-group">
      <select id="baproUpdate">
  <option value="Proses">Proses</option>
  <option value="Selesai">Selesai</option>
  <option value="TO">TO</option>
      </select>
    </div>
    <div class="form-group">
      <textarea id="baproKeterangan" placeholder="Keterangan (opsional)" rows="3" style="width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px;"></textarea>
    </div>
    <div class="form-group"><button onclick="addBaproItem()">‚ûï Tambah</button></div>
  </div>

  <div id="hasilBapro" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterBaproGrid(this.value)">
    <div id="gridBapro" class="grid-container"></div>
  </div>
</section>

<!-- ======================== QC PA ======================== -->
<section id="qcPA" class="card qc-section" style="display:none;">

  <h2 style="text-align:center; color:#fff; background:#ff9800; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
    MENU QC CETAK
  </h2>

  <div class="tabs">
    <button class="active" data-tab="inputPA" onclick="switchTab(this)">Inputan</button>
    <button data-tab="hasilPA" onclick="switchTab(this)">Hasil</button>
  </div>

  <div id="inputPA" class="tab-content active">
    <div class="form-group"><input type="text" id="paNama" placeholder="Nama Order"></div>
    <div class="form-group"><input type="text" id="paNoKS" placeholder="No KS"></div>
    <div class="form-group"><input type="number" id="paOrder" placeholder="Total Order (lembar)"></div>
    <div class="form-group"><input type="number" id="paBagus" placeholder="Bagus (lembar)"></div>
    <div class="form-group"><input type="number" id="paSortir" placeholder="Sortir (lembar)"></div>
    <div class="form-group"><input type="number" id="paProblem" placeholder="Problem (lembar)"></div>
    <div class="form-group">
      <select id="paQC">
        <option value="">QC</option>
        <option value="Suci">Suci</option>
        <option value="Anjani">Anjani</option>
      </select>
    </div>
    <div class="form-group">
      <select id="paMesin">
        <option value="">Mesin</option>
        <option value="KM 640">KM 640</option>
        <option value="KM 644">KM 644</option>
        <option value="KM 620">KM 620</option>
        <option value="MT 430">MT 430</option>
        <option value="KM 640 GL">KM 640 GL</option>
        <option value="RL 140">RL 140</option>
      </select>
    </div>
    <div class="form-group">
      <select id="paUpdate">
        <option value="">Update</option>
  <option value="Proses">Proses</option>
  <option value="Selesai">Selesai</option>
  <option value="TO">TO</option>
      </select>
    </div>
    <div class="form-group">
      <textarea id="paKeterangan" placeholder="Keterangan (opsional)" rows="3" style="width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px;"></textarea>
    </div>
    <div class="form-group"><button onclick="addPAItem()">‚ûï Tambah</button></div>
  </div>

  <div id="hasilPA" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterPAGrid(this.value)">
    <div id="gridPA" class="grid-container"></div>
  </div>
</section>

<!-- ======================== QC FINISHING ======================== -->
<section id="qcFinishing" class="card qc-section" style="display:none;">

  <h2 style="text-align:center; color:#fff; background:#22c55e; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
    MENU QC FINISHING
  </h2>

  <div class="tabs">
    <button class="active" data-tab="inputFinishing" onclick="switchTab(this)">Inputan</button>
    <button data-tab="hasilFinishing" onclick="switchTab(this)">Hasil</button>
  </div>

  <div id="inputFinishing" class="tab-content active">
    <div class="form-group"><input type="text" id="finishingNama" placeholder="Nama Order"></div>
    <div class="form-group"><input type="text" id="finishingNoKS" placeholder="No KS"></div>
    <div class="form-group"><input type="number" id="finishingOrder" placeholder="Total Order (lembar)"></div>
    <div class="form-group"><input type="number" id="finishingIsi" placeholder="Isi/Dus (pcs)"></div>
    <div class="form-group"><input type="number" id="finishingBagus" placeholder="Total Bagus (pcs)"></div>
    <div class="form-group"><input type="number" id="finishingJenisBS" placeholder="Total BS (pcs)"></div>
    <div class="form-group">
      <select id="finishingQC">
        <option value="">QC</option>
        <option value="Anom">Anom</option>
        <option value="Irna">Irna</option>
      </select>
    </div>
    <div class="form-group">
      <select id="finishingUpdate">
  <option value="Proses">Proses</option>
  <option value="Selesai">Selesai</option>
  <option value="TO">TO</option>
      </select>
    </div>
    <div class="form-group">
      <textarea id="finishingKeterangan" placeholder="Keterangan (opsional)" rows="3" style="width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px;"></textarea>
    </div>
    <div class="form-group"><button onclick="addFinishingItem()">‚ûï Tambah</button></div>
  </div>

  <div id="hasilFinishing" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterFinishingGrid(this.value)">
    <div id="gridFinishing" class="grid-container"></div>
  </div>
</section>

<!-- ======================== QC LEM ======================== -->
<section id="qcLem" class="card qc-section" style="display:none;">

  <h2 style="text-align:center; color:#fff; background:#9c27b0; font-size:1.2rem; padding:6px 12px; border-radius:8px; margin-bottom:12px;">
    MENU QC LEM
  </h2>

  <div class="tabs">
    <button class="active" data-tab="inputLem" onclick="switchTab(this)">Inputan</button>
    <button data-tab="hasilLem" onclick="switchTab(this)">Hasil</button>
  </div>

  <div id="inputLem" class="tab-content active">
    <div class="form-group"><input type="text" id="lemNama" placeholder="Nama Order"></div>
    <div class="form-group"><input type="text" id="lemNoKS" placeholder="No KS"></div>
    <div class="form-group"><input type="number" id="lemOrder" placeholder="Total Order (lembar)"></div>
    <div class="form-group"><input type="number" id="lemIsi" placeholder="Isi/Dus (pcs)"></div>
    <div class="form-group"><input type="number" id="lemBagus" placeholder="Total Bagus (pcs)"></div>
    <div class="form-group"><input type="number" id="lemJenisBS" placeholder="Total BS (pcs)"></div>
    <div class="form-group">
      <select id="lemQC">
        <option value="">QC</option>
        <option value="Martini">Martini</option>
        <option value="Krestin">Krestin</option>
        <option value="Ismie">Ismie</option>
      </select>
    </div>
    <div class="form-group">
      <select id="lemUpdate">
  <option value="Proses">Proses</option>
  <option value="Selesai">Selesai</option>
  <option value="TO">TO</option>
      </select>
    </div>
    <div class="form-group">
      <textarea id="lemKeterangan" placeholder="Keterangan (opsional)" rows="3" style="width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px;"></textarea>
    </div>
    <div class="form-group"><button onclick="addLemItem()">‚ûï Tambah</button></div>
  </div>

  <div id="hasilLem" class="tab-content">
    <input type="text" placeholder="Cari..." oninput="filterLemGrid(this.value)">
    <div id="gridLem" class="grid-container"></div>
  </div>
</section>

<!-- ======================== QC SPV ======================== -->
<section id="qcSPV" class="card qc-section" style="display:none;">

  <h2 style="
    text-align:center;
    color:#fff;
    background:#00BCD4;
    font-size:1.2rem;
    padding:6px 12px;
    border-radius:8px;
    margin-bottom:12px;">
    MENU QC REGISTER
  </h2>

  <div class="tabs">
    <button class="active" data-tab="spvInputSection" onclick="showSPVTab('input', this)">Inputan</button>
    <button data-tab="spvHasilSection" onclick="showSPVTab('hasil', this)">Hasil</button>
  </div>

<!-- ========== INPUTAN ========== -->
<div id="spvInputSection" style="margin-top:10px;">
  <form id="spvForm">

    <style>
      /* ===== Style Form QC SPV ===== */
      #spvForm .form-group { margin-bottom: 10px; }

      #spvForm input[type="text"],
      #spvForm input[type="date"],
      #spvForm input[type="time"],
      #spvForm textarea,
      #spvForm select {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 0.95rem;
        box-sizing: border-box;
      }

      #spvForm button {
        width: 100%;
        padding: .6rem;
        background: #00BCD4;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
      }
      #spvForm button:hover { background: #00BCD4; }

      .tabs { display: flex; margin-bottom: 10px; }
      .tabs button {
        flex: 1;
        padding: 8px;
        border: none;
        cursor: pointer;
        background: #ddd;
        font-weight: bold;
      }
      .tabs button.active {
        background: #00BCD4;
        color: white;
      }

      /* ===== Spinner ===== */
      #spvSpinner {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }

      #spvSpinner div {
        width: 50px;
        height: 50px;
        border: 6px solid #fff;
        border-top-color: #00BCD4;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>

    <!-- SPINNER OVERLAY -->
    <div id="spvSpinner"><div></div></div>

    <!-- Input Nama Order -->
    <div class="form-group">
      <input type="text" id="spvOrder" placeholder="Nama Order" required>
    </div>

    <!-- Input No KS -->
    <div class="form-group">
      <input type="text" id="spvNoKS" placeholder="No KS" required>
    </div>

    <!-- Tanggal & Jam -->
    <div class="form-group" style="display:flex; gap:10px;">
      <input type="date" id="spvTanggal" required style="flex:1;">
      <input type="time" id="spvJam" required style="flex:1;">
    </div>

    <!-- Foto Acuan -->
    <label for="spvFoto">Foto Acuan :</label><br>
    <input type="file" id="spvFoto" accept="image/*" capture="camera"><br><br>

    <div class="form-group">
      <textarea id="spvKet" placeholder="Keterangan Acuan (opsional)" rows="3"></textarea>
    </div>

    <!-- Foto Temuan -->
    <label for="spvFoto1">Foto Temuan :</label><br>
    <input type="file" id="spvFoto1" accept="image/*" capture="camera"><br><br>

    <div class="form-group">
      <textarea id="spvKet1" placeholder="Keterangan Temuan (opsional)" rows="3"></textarea>
    </div>

    <!-- Nama QC (Dropdown) -->
    <div class="form-group">
      <select id="spvNama" required>
        <option value="" disabled selected>Pilih Nama QC</option>
        <option value="NANI">NANI</option>
        <option value="ANJANI">ANJANI</option>
        <option value="SUCI">SUCI</option>
        <option value="ANOM">ANOM</option>
        <option value="IRNA">IRNA</option>
        <option value="MARWAN">MARWAN</option>
        <option value="KIKI">KIKI</option>
        <option value="MARTINI">MARTINI</option>
        <option value="KRESTIN">KRESTIN</option>
        <option value="ISMIE">ISMIE</option>
      </select>
    </div>

    <div class="form-group">
      <select id="spvProses" required>
        <option value="" disabled selected>Pilih Proses</option>
        <option value="QC BAPRO">QC BAPRO</option>
        <option value="QC CETAK">QC CETAK</option>
        <option value="QC FINISHING">QC FINISHING</option>
        <option value="QC LEM">QC LEM</option>
        <option value="RETUR">RETUR</option>
      </select>
    </div>

    <!-- Tombol Submit -->
    <div class="form-group">
      <button type="button" onclick="submitSPV(event)">‚ûï Tambah</button>
    </div>
  </form>
</div>

<!-- ========== HASIL ========== -->
<div id="spvHasilSection" style="display:none;">
  
  <!-- Spinner Loading -->
  <div id="spvLoading" style="display:none; text-align:center; padding:10px;">
    <div class="spinner"></div>
    <p style="font-size:0.9rem; color:#555;">Memuat data SPV...</p>
  </div>

  <!-- Wrapper agar tabel bisa di-scroll di HP -->
  <div class="table-responsive">
    <table id="spvTable" border="1">
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Nama Order</th>
          <th>No KS</th>
          <th>Jam</th>
          <th>Keterangan Acuan</th>
          <th>Foto Acuan</th>
          <th>Keterangan Temuan</th>
          <th>Foto Temuan</th>
          <th>Nama QC</th>
          <th>Proses</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<style>
/* ==================== Spinner ==================== */
.spinner {
  width: 28px;
  height: 28px;
  border: 3px solid #ddd;
  border-top: 3px solid #00BCD4;
  border-radius: 50%;
  margin: 0 auto;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ==================== Tabel Responsive ==================== */
.table-responsive {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

#spvTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
  min-width: 700px; /* agar scroll muncul di layar kecil */
}

#spvTable th,
#spvTable td {
  padding: 8px 10px;
  border: 1px solid #ddd;
  text-align: left;
  white-space: nowrap; /* mencegah teks turun ke bawah */
}

#spvTable thead {
  background: #00BCD4;
  color: #fff;
  font-weight: 600;
}

#spvTable tbody tr:nth-child(even) {
  background: #f9f9f9;
}

/* ==================== Responsif Tambahan ==================== */
@media (max-width: 600px) {
  #spvTable th, #spvTable td {
    font-size: 0.8rem;
    padding: 6px;
  }
}
</style>


<!-- ======================== Floating API Button ======================== -->
<a href="https://www.chatbase.co/chatbot-iframe/WQV6nYLIpvH1KdrwilMKh" 
   target="_blank"
   id="aiButton"
   title="Buka API QC AI"
   style="
     position: fixed;
     bottom: 22px;
     right: 22px;
     width: 64px;
     height: 64px;
     border-radius: 50%;
     background: linear-gradient(135deg, #6a11cb, #2575fc);
     color: #fff;
     font-size: 22px;
     font-weight: bold;
     display: flex;
     align-items: center;
     justify-content: center;
     box-shadow: 0 0 18px rgba(101, 80, 255, 0.6);
     cursor: pointer;
     text-decoration: none;
     z-index: 9999;
     transition: all 0.3s ease;
   "
   onmouseover="this.style.transform='scale(1.15)'; this.style.boxShadow='0 0 25px rgba(101, 80, 255, 0.8)'"
   onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 18px rgba(101, 80, 255, 0.6)'">
  AI
</a>

  </main>
</div>

<!-- ======================== SPINNER GLOBAL ======================== -->
<div id="loadingSpinner"
     style="display:none; position:fixed; top:10px; left:50%; transform:translateX(-50%);
            z-index:9999; background:transparent;
            display:flex; flex-direction:column; align-items:center; justify-content:center;">

  <div class="spinner-ring"></div>
</div>

<style>
/* ================== SPINNER HEADER STYLE (HITAM‚ÄìHIJAU MODERN) ================== */
.spinner-ring {
  position: relative;
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background: radial-gradient(circle at center, #22c55e 10%, #0f766e 30%, #000 60%);
  animation: rotate-eye 1.2s linear infinite;
  box-shadow: inset 0 0 8px rgba(34,197,94,0.5), 0 0 10px rgba(34,197,94,0.4);
}
.spinner-ring::after {
  content: '';
  position: absolute;
  inset: 6px;
  border: 2px solid #22c55e;
  border-radius: 50%;
  animation: pulse-eye 1.5s ease-in-out infinite;
}
@keyframes rotate-eye {
  to { transform: rotate(360deg); }
}
@keyframes pulse-eye {
  0%,100% { opacity: 0.8; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

</style>


<script>
// ====================== KONFIGURASI ======================
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxq5fNPOfVKlULq-gk8lYFsqhsH4Yt43QTev4ijFDpNSLF453k84Q2EBhW7YEnONnOC/exec";

// ====================== SPINNER GLOBAL JS ======================
const spinner = document.getElementById('loadingSpinner');
const showSpinner = () => spinner.style.display = 'flex';
const hideSpinner = () => spinner.style.display = 'none';

let prosesSedangJalan = 0;

function mulaiProses() {
  prosesSedangJalan++;
  showSpinner();
}

function selesaiProses() {
  prosesSedangJalan = Math.max(0, prosesSedangJalan - 1);
  if (prosesSedangJalan === 0) hideSpinner();
}

// ====================== Hook global ======================
(function () {
  const asliJsonp = window.jsonpGet;
  const asliPost = window.postPayload;

  if (typeof asliJsonp === 'function' && !asliJsonp.__hooked) {
    window.jsonpGet = async function(...args) {
      mulaiProses();
      try { return await asliJsonp.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.jsonpGet.__hooked = true;
  }

  if (typeof asliPost === 'function' && !asliPost.__hooked) {
    window.postPayload = async function(...args) {
      mulaiProses();
      try { return await asliPost.apply(this, args); }
      finally { selesaiProses(); }
    };
    window.postPayload.__hooked = true;
  }
})();

// ====================== Load Semua Data ======================
async function loadAllData() {
  showSpinner();
  try {
    await Promise.all([
      Promise.resolve(loadBaproItems()),
      Promise.resolve(loadPAItems()),
      Promise.resolve(loadFinishingItems()),
      Promise.resolve(loadLemItems())
    ]);
  } catch (err) {
    console.error('Gagal memuat data:', err);
  } finally {
    hideSpinner();
  }
}

window.addEventListener('load', loadAllData);

// ====================== WAKTU HEADER ======================
function updateTime() {
  const now = new Date();

  // Format tanggal (tanpa jam)
  const tanggal = now.toLocaleDateString('id-ID', {
    weekday: 'long',
    day: '2-digit',
    month: 'long',
    year: 'numeric'
  });

  // Format jam (tanpa kata 'pukul')
  let jam = now.toLocaleTimeString('id-ID', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });

  // Hapus kemungkinan ada teks 'pukul' dari locale
  jam = jam.replace('pukul', '').replace('Pukul', '').trim();

  // Masukkan hasil ke dalam elemen
  const tanggalEl = document.querySelector('#headerTime .tanggal');
  const jamEl = document.querySelector('#headerTime .jam');

  if (tanggalEl && jamEl) {
    tanggalEl.textContent = tanggal;
    jamEl.textContent = jam;
  }
}

// Jalankan setiap detik
setInterval(updateTime, 1000);
updateTime();

// ====================== MENU ======================
function showMenu(menu) {
  document.querySelectorAll('main > section').forEach(sec => sec.style.display = 'none');
  document.getElementById(menu).style.display = 'block';
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`nav button[onclick="showMenu('${menu}')"]`).classList.add('active');

  if (menu === 'dashboard') renderDashboardFinishingCompact();
}

// ====================== TABS ======================
function switchTab(btn) {
  const parent = btn.parentElement;
  parent.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  parent.parentElement.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById(btn.dataset.tab).classList.add('active');

  if (btn.dataset.tab === 'hasilFinishing') {
    loadFinishingItems(); // refresh saat buka tab hasil
  }
}

// ====================== JSONP HELPER ======================
function jsonpGet(url, params = {}) {
  return new Promise((resolve, reject) => {
    const cbName = 'jsonp_cb_' + Math.random().toString(36).slice(2, 9);
    params = params || {};
    params.callback = cbName;
    const q = Object.entries(params).map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&');
    const script = document.createElement('script');
    script.src = `${url}?${q}`;
    script.onerror = () => {
      cleanup();
      reject(new Error('JSONP load error'));
    };
    window[cbName] = (res) => {
      cleanup();
      resolve(res);
    };
    function cleanup(){
      delete window[cbName];
      script.remove();
    }
    document.body.appendChild(script);
  });
}

// ====================== GLOBAL STATE ======================
let finishingItems = []; // array yang diambil dari sheet

// ====================== RENDER GRID HASIL (Fix: tampilkan TO juga) ======================
function renderGridFinishing(query = "") {
  const container = document.getElementById('gridFinishing');
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  finishingItems.forEach((item, i) => {
    // Filter pencarian
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // üîß Tambahkan status TO
    let statusClass = '';
    if (item.update === "Proses") statusClass = "status-proses";
    else if (item.update === "Selesai") statusClass = "status-selesai";
    else if (item.update === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Isi/Dus: ${escapeHtml(item.isi || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>BS: ${escapeHtml(item.jenisBS || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callFinishing(${i})">üì§</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editFinishingInline(${i})">‚úèÔ∏è</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteFinishing(${i})">üóëÔ∏è</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardFinishingCompact();
}

function escapeHtml(s) {
  return String(s || '')
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;');
}

// ====================== LOAD DATA DARI SPREADSHEET ======================
async function loadFinishingItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Finishing' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      finishingItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridFinishing();
    } else console.warn('loadFinishingItems unexpected', res);
  }catch(err){ console.error('‚ö†Ô∏è Error loadFinishingItems', err); }
}

// ====================== TAMBAH DATA ======================
function addFinishingItem() {
  const nama = document.getElementById('finishingNama').value.trim();
  const noKS = document.getElementById('finishingNoKS').value.trim();
  const order = document.getElementById('finishingOrder').value.trim();
  const isi = document.getElementById('finishingIsi').value.trim();
  const bagus = document.getElementById('finishingBagus').value.trim();
  const jenisBS = document.getElementById('finishingJenisBS').value.trim();
  const qc = document.getElementById('finishingQC').value.trim();
  const update = document.getElementById('finishingUpdate').value.trim();
  const keterangan = document.getElementById('finishingKeterangan').value.trim(); // ‚ú≥Ô∏è tambahan baru

  if (!nama || !noKS) return alert('Nama dan No KS wajib diisi!');

// === Tambah konfirmasi sederhana ===
  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return; // jika tekan Cancel, berhenti di sini

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'
  });

  const payload = { action:'add', sheet:'Finishing', tanggal: tanggalFormatted, nama,noKS,order,isi,bagus,jenisBS,qc,update,keterangan };

  postPayload(payload);
  clearFinishingForm();
  setTimeout(() => loadFinishingItems(), 20000);
}

// ====================== PANGGIL (isi form dari item) ======================
function callFinishing(index){
  const item = finishingItems[index];
  if(!item) return;
  document.getElementById('finishingNama').value = item.nama || '';
  document.getElementById('finishingNoKS').value = item.noKS || '';
  document.getElementById('finishingOrder').value = item.order || '';
  document.getElementById('finishingIsi').value = item.isi || '';
  document.getElementById('finishingBagus').value = item.bagus || '';
  document.getElementById('finishingJenisBS').value = item.jenisBS || '';
  document.getElementById('finishingQC').value = item.qc || '';
  document.getElementById('finishingUpdate').value = item.update || '';
  document.getElementById('finishingKeterangan').value = item.keterangan || ''; // ‚ú≥Ô∏è tambahan

  showMenu('qcFinishing');
  const tabBtn = document.querySelector('#qcFinishing .tabs button[data-tab="inputFinishing"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (langsung hilang dari grid) ======================
function deleteFinishing(index) {
  const item = finishingItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = '‚è≥ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Finishing', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // üîπ Tunggu proses di Google Sheet (sekitar 8 detik)
  setTimeout(() => {
    // hapus dari array dan DOM setelah spinner tampil cukup lama
    finishingItems.splice(index, 1);
    card.remove();
    loadFinishingItems();
  }, 8000);
}

// ====================== EDIT INLINE (FINISHING) ======================
function editFinishingInline(index){
  const item = finishingItems[index];
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama untuk cancel
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.isi||'')}" placeholder="Isi/Dus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.jenisBS||'')}" placeholder="BS">

      <select class="edit-inline">
        <option value="Anom" ${item.qc==='Anom'? 'selected':''}>Anom</option>
        <option value="Irna" ${item.qc==='Irna'? 'selected':''}>Irna</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveFinishingInline(${index})">üíæ</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelFinishingInline(${index})">‚úñÔ∏è</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (FINISHING) ======================
function cancelFinishingInline(index){
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if(!card) return;
  delete card.dataset.originalHTML;
  renderGridFinishing(); // tampilkan ulang tampilan normal
}

// ====================== SIMPAN HASIL EDIT INLINE (FINISHING) ======================
async function saveFinishingInline(index) {
  const container = document.getElementById('gridFinishing');
  const card = container.children[index];
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // üîπ ambil tombol cancel

  if (btnSave) {
    btnSave.textContent = '‚è≥ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // üîπ sembunyikan tombol cancel saat menyimpan

  const inputs = card.querySelectorAll('.edit-inline');

  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    jenisBS: inputs[5].value.trim(),
    qc: inputs[6].value,
    update: inputs[7].value,
    keterangan: inputs[8].value.trim()
  };

  const orig = finishingItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Finishing', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadFinishingItems();
  } catch (err) {
    console.error('Gagal menyimpan data Finishing:', err);
    alert('Gagal menyimpan data. Silakan coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'üíæ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== POST PAYLOAD ======================
function ensureIframe(){
  if(document.querySelector('iframe[name="hidden_iframe_post"]')) return;
  const ifr = document.createElement('iframe');
  ifr.name = 'hidden_iframe_post';
  ifr.style.display = 'none';
  ifr.addEventListener('load', ()=> setTimeout(()=> loadFinishingItems(), 10000));
  document.body.appendChild(ifr);
}
function postPayload(payloadObj){
  ensureIframe();
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = WEBAPP_URL;
  form.target = 'hidden_iframe_post';
  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = 'payload';
  input.value = JSON.stringify(payloadObj);
  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  form.remove();
}

// ====================== FILTER ======================
function filterFinishingGrid(query){ renderGridFinishing(query); }

// ====================== CLEAR FORM ======================
function clearFinishingForm() {
  ['finishingNama','finishingNoKS','finishingOrder','finishingIsi','finishingBagus','finishingJenisBS','finishingQC','finishingUpdate','finishingKeterangan']
    .forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
}

// ====================== DASHBOARD (UPDATE: TAMBAH STATUS "TO") ======================
function renderDashboardFinishingCompact() {
  const containerTO = document.getElementById('dashboardFinishingTO');      // üîπ container baru untuk TO
  const containerProses = document.getElementById('dashboardFinishingProses');
  const containerSelesai = document.getElementById('dashboardFinishingSelesai');

  // pastikan elemen tidak null agar tidak error
  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  finishingItems.forEach(item => {
    const updateVal = (item.update || "").trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    // üü¢ Tentukan warna/status class
    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to"; // üíô class baru untuk TO

    // üß© Isi kartu
    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <span>üìÖ ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    // üß† Kelompokkan berdasarkan status
    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    // üìã klik kartu untuk lihat detail
    card.addEventListener('click', () => showDetailModal(item));
  });

  // üßÆ Update counter
  document.getElementById('countFinishing').textContent = finishingItems.length;
  document.getElementById('countTO').textContent = totalTO;
  document.getElementById('countProses').textContent = totalProses;
  document.getElementById('countSelesai').textContent = totalSelesai;
}

// ====================== DETAIL ======================
function showDetailModal(item) {
  alert(`Detail Order:
Nama: ${item.nama}
No KS: ${item.noKS}
Order: ${item.order}
Isi: ${item.isi}
Bagus: ${item.bagus}
BS: ${item.jenisBS}
QC: ${item.qc}
Update: ${item.update}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW (UPDATE: TAMBAH TO) ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTO = document.getElementById('toggleTO');
  const btnProses = document.getElementById('toggleProses');
  const btnSelesai = document.getElementById('toggleSelesai');

  const gridTO = document.getElementById('dashboardFinishingTO');
  const gridProses = document.getElementById('dashboardFinishingProses');
  const gridSelesai = document.getElementById('dashboardFinishingSelesai');

  // üîπ Toggle untuk TO
  if (btnTO && gridTO) {
    btnTO.addEventListener('click', () => {
      const visible = gridTO.style.display !== 'none';
      gridTO.style.display = visible ? 'none' : 'grid';
      btnTO.textContent = visible ? 'Show' : 'Hide';
    });
  }

  // üîπ Toggle untuk Proses
  if (btnProses && gridProses) {
    btnProses.addEventListener('click', () => {
      const visible = gridProses.style.display !== 'none';
      gridProses.style.display = visible ? 'none' : 'grid';
      btnProses.textContent = visible ? 'Show' : 'Hide';
    });
  }

  // üîπ Toggle untuk Selesai
  if (btnSelesai && gridSelesai) {
    btnSelesai.addEventListener('click', () => {
      const visible = gridSelesai.style.display !== 'none';
      gridSelesai.style.display = visible ? 'none' : 'grid';
      btnSelesai.textContent = visible ? 'Show' : 'Hide';
    });
  }
});

// ====================== AUTO UPPERCASE ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;

  // Berlaku untuk input text dan textarea di dalam #qcFinishing
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcFinishing')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcFinishing'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC FINISHING (ubah sesuai kebutuhan) =====
const QC_FINISHING_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcFinishing')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC FINISHING:');
      if (input === null) return;
      if (input === QC_FINISHING_PASSWORD) {
        eval(originalOnClick); // jalankan fungsi aslinya
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI ======================
showMenu('dashboard');
loadFinishingItems();


</script>

<!-- ====== JS QC BAPRO (paste ini setelah script utama) ====== -->
<script>
// ====================== GLOBAL STATE (BAPRO) ======================
let baproItems = []; // array yang diambil dari sheet Bapro

// ====================== RENDER GRID HASIL (BAPRO) ======================
function renderGridBapro(query = "") {
  const container = document.getElementById('gridBapro');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  baproItems.forEach((item, i) => {
    // Filter pencarian (nama atau noKS)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (cocokkan nilai case-sensitive seperti di sheet)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Jenis: ${escapeHtml(item.jenisKertas || '')}</span><br>
        <span>GSM: ${escapeHtml(item.tebalKertas || '')}</span><br>
        <span>Nama Tinta: ${escapeHtml(item.NamaTinta || '')}</span><br>
        <span>Dmax: ${escapeHtml(item.dmax || '')}</span><br>
        <span>L: ${escapeHtml(item.l || '')}  A: ${escapeHtml(item.a || '')}  B: ${escapeHtml(item.b || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callBapro(${i})">üì§</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editBaproInline(${i})">‚úèÔ∏è</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteBapro(${i})">üóëÔ∏è</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardBaproCompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (BAPRO) ======================
async function loadBaproItems(){
  try{
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Bapro' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      // NOTE: getDataFromSheet returns objects with keys sesuai header names
      baproItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridBapro();
    } else console.warn('loadBaproItems unexpected', res);
  }catch(err){ console.error('‚ö†Ô∏è Error loadBaproItems', err); }
}

// ====================== TAMBAH DATA (BAPRO) ======================
function addBaproItem() {
  const nama = document.getElementById('baproNama').value.trim();
  const noKS = document.getElementById('baproNoKS').value.trim();
  const jenis = document.getElementById('baproJenis') ? document.getElementById('baproJenis').value.trim() : '';
  const kertas = document.getElementById('baproKertas') ? document.getElementById('baproKertas').value.trim() : '';
  const NamaTinta = document.getElementById('baproNamaTinta') ? document.getElementById('baproNamaTinta').value.trim() : '';
  const dmax = document.getElementById('baproDmax') ? document.getElementById('baproDmax').value.trim() : '';
  const L = document.getElementById('baproL') ? document.getElementById('baproL').value.trim() : '';
  const A = document.getElementById('baproA') ? document.getElementById('baproA').value.trim() : '';
  const B = document.getElementById('baproB') ? document.getElementById('baproB').value.trim() : '';
  const qc = document.getElementById('baproQC') ? document.getElementById('baproQC').value.trim() : '';
  const update = document.getElementById('baproUpdate') ? document.getElementById('baproUpdate').value.trim() : '';
  const keterangan = document.getElementById('baproKeterangan') ? document.getElementById('baproKeterangan').value.trim() : '';

  if (!nama || !noKS) return alert('Nama dan No KS wajib diisi!');

// === Tambah konfirmasi sederhana ===
  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return; // jika tekan Cancel, berhenti di sini

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'
  });

  // Kunci perubahan: gunakan key names sesuai header sheet Bapro
  const payload = { action:'add', sheet:'Bapro', tanggal: tanggalFormatted,
    nama, noKS,
    jenisKertas: jenis,
    tebalKertas: kertas,
    NamaTinta: NamaTinta,
    dmax: dmax,
    l: L,
    a: A,
    b: B,
    qc, update, keterangan
  };

  postPayload(payload);
  clearBaproForm();
  // reload setelah delay agar sheet ter-update
  setTimeout(() => loadBaproItems(), 20000);
}

// ====================== PANGGIL (isi form dari item) ======================
function callBapro(index){
  const item = baproItems[index];
  if(!item) return;
  if (document.getElementById('baproNama')) document.getElementById('baproNama').value = item.nama || '';
  if (document.getElementById('baproNoKS')) document.getElementById('baproNoKS').value = item.noKS || '';
  if (document.getElementById('baproJenis')) document.getElementById('baproJenis').value = item.jenisKertas || '';
  if (document.getElementById('baproKertas')) document.getElementById('baproKertas').value = item.tebalKertas || '';
  if (document.getElementById('baproNamaTinta')) document.getElementById('baproNamaTinta').value = item.NamaTinta || '';
  if (document.getElementById('baproDmax')) document.getElementById('baproDmax').value = item.dmax || '';
  if (document.getElementById('baproL')) document.getElementById('baproL').value = item.l || '';
  if (document.getElementById('baproA')) document.getElementById('baproA').value = item.a || '';
  if (document.getElementById('baproB')) document.getElementById('baproB').value = item.b || '';
  if (document.getElementById('baproQC')) document.getElementById('baproQC').value = item.qc || '';
  if (document.getElementById('baproUpdate')) document.getElementById('baproUpdate').value = item.update || '';
  if (document.getElementById('baproKeterangan')) document.getElementById('baproKeterangan').value = item.keterangan || '';

  showMenu('qcBapro');
  const tabBtn = document.querySelector('#qcBapro .tabs button[data-tab="inputBapro"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (BAPRO) ======================
function deleteBapro(index) {
  const item = baproItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = '‚è≥ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'Bapro', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // üîπ Tunda sedikit agar spinner terlihat dan Sheet sempat update
  setTimeout(() => {
    // hapus dari array dan DOM supaya langsung hilang
    baproItems.splice(index, 1);
    if (card) card.remove();
    // muat ulang data dari spreadsheet
    loadBaproItems();
  }, 8000);
}


// ====================== EDIT INLINE (BAPRO) ======================
function editBaproInline(index){
  const item = baproItems[index];
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="text" class="edit-inline" value="${escapeHtml(item.jenisKertas||'')}" placeholder="Jenis">
      <input type="number" class="edit-inline" value="${escapeHtml(item.tebalKertas||'')}" placeholder="GSM">
      <input type="text" class="edit-inline" value="${escapeHtml(item.NamaTinta||'')}" placeholder="Nama Tinta">
      <input type="number" class="edit-inline" value="${escapeHtml(item.dmax||'')}" placeholder="Dmax">
      <input type="number" class="edit-inline" value="${escapeHtml(item.l||'')}" placeholder="L">
      <input type="number" class="edit-inline" value="${escapeHtml(item.a||'')}" placeholder="A">
      <input type="number" class="edit-inline" value="${escapeHtml(item.b||'')}" placeholder="B">

      <select class="edit-inline">
        <option value="Marwan" ${item.qc==='Marwan'? 'selected':''}>Marwan</option>
        <option value="Kiki" ${item.qc==='Kiki'? 'selected':''}>Kiki</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveBaproInline(${index})">üíæ</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelBaproInline(${index})">‚úñÔ∏è</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (BAPRO) ======================
function cancelBaproInline(index){
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if(!card) return;

  // Hapus data lama dan render ulang item sesuai data aslinya
  delete card.dataset.originalHTML;
  renderGridBapro(); // panggil ulang fungsi render untuk menampilkan ulang grid normal
}

// ====================== SIMPAN HASIL EDIT INLINE (BAPRO) ======================
async function saveBaproInline(index) {
  const container = document.getElementById('gridBapro');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // ‚úÖ tambahkan ambil tombol cancel

  // Saat mulai menyimpan
  if (btnSave) {
    btnSave.textContent = '‚è≥ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // ‚úÖ sembunyikan tombol cancel saat simpan

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    jenisKertas: inputs[2].value.trim(),
    tebalKertas: inputs[3].value.trim(),
    NamaTinta: inputs[4].value.trim(),
    dmax: inputs[5].value.trim(),
    l: inputs[6].value.trim(),
    a: inputs[7].value.trim(),
    b: inputs[8].value.trim(),
    qc: inputs[9].value,
    update: inputs[10].value,
    keterangan: inputs[11].value.trim()
  };

  const orig = baproItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = {
    action: 'update',
    sheet: 'Bapro',
    id: identifier,
    index: orig.__index,
    tanggal: tanggalFormatted,
    ...updated
  };

  try {
    // kirim ke Apps Script
    await postPayload(payload);

    // beri jeda sedikit agar sheet sempat ter-update
    await new Promise(res => setTimeout(res, 5000));

    // refresh data
    await loadBaproItems();
  } catch (err) {
    console.error('Gagal menyimpan data:', err);
    alert('Gagal menyimpan perubahan. Silakan coba lagi.');
  } finally {
    // Kembalikan tombol save ke normal
    if (btnSave) {
      btnSave.textContent = 'üíæ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== POST PAYLOAD BAPRO ======================
function ensureIframeBapro() {
  if (document.querySelector('iframe[name="hidden_iframe_post_bapro"]')) return;

  const ifr = document.createElement('iframe');
  ifr.name = 'hidden_iframe_post_bapro';
  ifr.style.display = 'none';

  // setelah kirim data, reload data Bapro dari sheet
  ifr.addEventListener('load', () => setTimeout(() => loadBaproItems(), 10000));

  document.body.appendChild(ifr);
}

function postPayloadBapro(payloadObj) {
  ensureIframeBapro();

  const form = document.createElement('form');
  form.method = 'POST';
  form.action = WEBAPP_URL_BAPRO; // ‚ö†Ô∏è pastikan ganti dengan URL WebApp sheet Bapro
  form.target = 'hidden_iframe_post_bapro';

  const input = document.createElement('input');
  input.type = 'hidden';
  input.name = 'payload';
  input.value = JSON.stringify(payloadObj);

  form.appendChild(input);
  document.body.appendChild(form);
  form.submit();
  form.remove();
}

// ====================== FILTER ======================
function filterBaproGrid(query){ renderGridBapro(query); }

// ====================== CLEAR FORM (BAPRO) ======================
function clearBaproForm() {
  ['baproNama','baproNoKS','baproJenis','baproKertas','baproNamaTinta','baproDmax','baproL','baproA','baproB','baproQC','baproUpdate','baproKeterangan']
    .forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
}

// ====================== DASHBOARD BAPRO (TO / PROSES / SELESAI) ======================
function renderDashboardBaproCompact() {
  const containerTO = document.getElementById('dashboardBaproTO');
  const containerProses = document.getElementById('dashboardBaproProses');
  const containerSelesai = document.getElementById('dashboardBaproSelesai');

  // jika elemen dashboard tidak ada, jangan error
  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  baproItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>CSO: ${escapeHtml(item.noKS || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <strong>Tinta: ${escapeHtml(item.NamaTinta || '')}</strong><br>
      <span>üìÖ ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    // ‚úÖ panggil fungsi detail yang benar
    card.addEventListener('click', () => showDetailModalBapro(item));
  });

  // update counters
  const elTotal = document.getElementById('countBapro');
  if (elTotal) elTotal.textContent = baproItems.length;
  const elTO = document.getElementById('countTOBapro');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesBapro');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiBapro');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL BAPRO ======================
function showDetailModalBapro(item) {
  alert(`Detail QC Bapro:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
Nama CSO: ${item.noKS || '-'}
Jenis Kertas: ${item.jenisKertas || '-'}
Tebal Kertas: ${item.tebalKertas || '-'}
Nama Tinta: ${item.NamaTinta || '-'}
Dmax: ${item.dmax || '-'}
L: ${item.l || '-'}
A: ${item.a || '-'}
B: ${item.b || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW BAPRO (TO / PROSES / SELESAI) ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTOBapro = document.getElementById('toggleBaproTO');
  const btnProsesBapro = document.getElementById('toggleBaproProses');
  const btnSelesaiBapro = document.getElementById('toggleBaproSelesai');

  const gridTOBapro = document.getElementById('dashboardBaproTO');
  const gridProsesBapro = document.getElementById('dashboardBaproProses');
  const gridSelesaiBapro = document.getElementById('dashboardBaproSelesai');

  // üîπ Toggle untuk TO
  if (btnTOBapro && gridTOBapro) {
    btnTOBapro.addEventListener('click', () => {
      const visible = gridTOBapro.style.display !== 'none';
      gridTOBapro.style.display = visible ? 'none' : 'grid';
      btnTOBapro.textContent = visible ? 'Show' : 'Hide';
    });
  }

  // üîπ Toggle untuk Proses
  if (btnProsesBapro && gridProsesBapro) {
    btnProsesBapro.addEventListener('click', () => {
      const visible = gridProsesBapro.style.display !== 'none';
      gridProsesBapro.style.display = visible ? 'none' : 'grid';
      btnProsesBapro.textContent = visible ? 'Show' : 'Hide';
    });
  }

  // üîπ Toggle untuk Selesai
  if (btnSelesaiBapro && gridSelesaiBapro) {
    btnSelesaiBapro.addEventListener('click', () => {
      const visible = gridSelesaiBapro.style.display !== 'none';
      gridSelesaiBapro.style.display = visible ? 'none' : 'grid';
      btnSelesaiBapro.textContent = visible ? 'Show' : 'Hide';
    });
  }
});

// ====================== AUTO UPPERCASE KHUSUS BAPRO ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;

  // Berlaku untuk input text dan textarea di dalam #qcBapro
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcBapro')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcBapro'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC BAPRO (ubah sesuai kebutuhan) =====
const QC_BAPRO_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcBapro')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC BAPRO:');
      if (input === null) return;
      if (input === QC_BAPRO_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI TAMBAHAN (panggil loader) ======================
loadBaproItems();
</script>

<!-- ====== JS QC PA (struktur match Bapro/Finishing) ====== -->
<script>
// ====================== GLOBAL STATE (PA) ======================
let paItems = []; // array yang diambil dari sheet PA

// ====================== RENDER GRID HASIL (PA) ======================
function renderGridPA(query = "") {
  const container = document.getElementById('gridPA');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  paItems.forEach((item, i) => {
    // Filter pencarian (nama atau noKS)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (sama gaya dengan Bapro/Finishing)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>Sortir: ${escapeHtml(item.sortir || '')}</span><br>
        <span>Problem: ${escapeHtml(item.problem || '')}</span><br>
        <span>Mesin: ${escapeHtml(item.mesin || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callPA(${i})">üì§</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editPAInline(${i})">‚úèÔ∏è</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deletePA(${i})">üóëÔ∏è</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardPACompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (PA) ======================
async function loadPAItems(){
  try{
    // PENTING: pakai WEBAPP_URL (sama seperti Bapro/Finishing)
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'PA' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      // sisipkan __index & id (baris)
      paItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridPA();
    } else console.warn('loadPAItems unexpected', res);
  }catch(err){ console.error('‚ö†Ô∏è Error loadPAItems', err); }
}

// ====================== TAMBAH DATA (PA) ======================
function addPAItem() {
  const nama = document.getElementById('paNama').value.trim();
  const noKS = document.getElementById('paNoKS').value.trim();
  const order = document.getElementById('paOrder') ? document.getElementById('paOrder').value.trim() : '';
  const bagus = document.getElementById('paBagus') ? document.getElementById('paBagus').value.trim() : '';
  const sortir = document.getElementById('paSortir') ? document.getElementById('paSortir').value.trim() : '';
  const problem = document.getElementById('paProblem') ? document.getElementById('paProblem').value.trim() : '';
  const qc = document.getElementById('paQC') ? document.getElementById('paQC').value.trim() : '';
  const mesin = document.getElementById('paMesin') ? document.getElementById('paMesin').value.trim() : '';
  const update = document.getElementById('paUpdate') ? document.getElementById('paUpdate').value.trim() : '';
  const keterangan = document.getElementById('paKeterangan') ? document.getElementById('paKeterangan').value.trim() : '';

  if (!nama || !noKS) return alert('Nama dan No KS wajib diisi!');

// === Tambah konfirmasi sederhana ===
  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return; // jika tekan Cancel, berhenti di sini

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'
  });

  // gunakan key names sesuai header di sheet PA (sama pola seperti Bapro)
  const payload = {
    action:'add', sheet:'PA', tanggal: tanggalFormatted,
    nama, noKS, order, bagus, sortir, problem, qc, mesin, update, keterangan
  };

  // PENTING: kirim ke WEBAPP yang sama dengan postPayload()
  postPayload(payload);
  clearPAForm();
  // reload setelah delay agar sheet ter-update
  setTimeout(() => loadPAItems(), 20000);
}

// ====================== PANGGIL (isi form dari item) ======================
function callPA(index){
  const item = paItems[index];
  if(!item) return;
  if (document.getElementById('paNama')) document.getElementById('paNama').value = item.nama || '';
  if (document.getElementById('paNoKS')) document.getElementById('paNoKS').value = item.noKS || '';
  if (document.getElementById('paOrder')) document.getElementById('paOrder').value = item.order || '';
  if (document.getElementById('paBagus')) document.getElementById('paBagus').value = item.bagus || '';
  if (document.getElementById('paSortir')) document.getElementById('paSortir').value = item.sortir || '';
  if (document.getElementById('paProblem')) document.getElementById('paProblem').value = item.problem || '';
  if (document.getElementById('paQC')) document.getElementById('paQC').value = item.qc || '';
  if (document.getElementById('paMesin')) document.getElementById('paMesin').value = item.mesin || '';
  if (document.getElementById('paUpdate')) document.getElementById('paUpdate').value = item.update || '';
  if (document.getElementById('paKeterangan')) document.getElementById('paKeterangan').value = item.keterangan || '';

  showMenu('qcPA');
  const tabBtn = document.querySelector('#qcPA .tabs button[data-tab="inputPA"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (PA) ======================
function deletePA(index) {
  const item = paItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = '‚è≥ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = { 
    action: 'delete', 
    sheet: 'PA', 
    id: identifier, 
    index: item.__index 
  };

  postPayload(payload);

  // üîπ Spinner tetap tampil beberapa detik sebelum data hilang
  setTimeout(() => {
    // hapus dari array & DOM supaya tampilan langsung update
    paItems.splice(index, 1);
    if (card) card.remove();

    // reload data dari sheet untuk sinkronisasi
    loadPAItems();
  }, 8000);
}

// ====================== EDIT INLINE (PA) ======================
function editPAInline(index){
  const item = paItems[index];
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // Simpan HTML lama untuk tombol Cancel
  const originalHTML = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.sortir||'')}" placeholder="Sortir">
      <input type="number" class="edit-inline" value="${escapeHtml(item.problem||'')}" placeholder="Problem">

      <select class="edit-inline">
        <option value="Suci" ${item.qc==='Suci'? 'selected':''}>Suci</option>
        <option value="Anjani" ${item.qc==='Anjani'? 'selected':''}>Anjani</option>
      </select>

      <select class="edit-inline">
        <option value="KM 640" ${item.mesin==='KM 640'? 'selected':''}>KM 640</option>
        <option value="KM 644" ${item.mesin==='KM 644'? 'selected':''}>KM 644</option>
        <option value="KM 620" ${item.mesin==='KM 620'? 'selected':''}>KM 620</option>
        <option value="MT 430" ${item.mesin==='MT 430'? 'selected':''}>MT 430</option>
        <option value="KM 640 GL" ${item.mesin==='KM 640 GL'? 'selected':''}>KM 640 GL</option>
        <option value="RL 140" ${item.mesin==='RL 140'? 'selected':''}>RL 140</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="savePAInline(${index})">üíæ</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelPAInline(${index})">‚úñÔ∏è</button>
    </div>`;

  card.dataset.originalHTML = originalHTML;
}

// ====================== CANCEL INLINE (PA) ======================
function cancelPAInline(index){
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if(!card) return;
  delete card.dataset.originalHTML;
  renderGridPA(); // kembalikan tampilan normal grid PA
}

// ====================== SIMPAN HASIL EDIT INLINE (PA) ======================
async function savePAInline(index) {
  const container = document.getElementById('gridPA');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = card.querySelector('.btn-save');
  const btnCancel = card.querySelector('.btn-cancel'); // ‚úÖ ambil tombol cancel

  // Saat mulai menyimpan
  if (btnSave) {
    btnSave.textContent = '‚è≥ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // ‚úÖ sembunyikan tombol cancel saat proses simpan

  const inputs = card.querySelectorAll('.edit-inline');

  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    bagus: inputs[3].value.trim(),
    sortir: inputs[4].value.trim(),
    problem: inputs[5].value.trim(),
    qc: inputs[6].value,
    mesin: inputs[7].value,
    update: inputs[8].value,
    keterangan: inputs[9].value.trim()
  };

  const orig = paItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = {
    action: 'update',
    sheet: 'PA',
    id: identifier,
    index: orig.__index,
    tanggal: tanggalFormatted,
    ...updated
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadPAItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Silakan coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'üíæ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== FILTER ======================
function filterPAGrid(query){ renderGridPA(query); }

// ====================== CLEAR FORM (PA) ======================
function clearPAForm() {
  ['paNama','paNoKS','paOrder','paBagus','paSortir','paProblem','paQC','paMesin','paUpdate','paKeterangan']
    .forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
}

// ====================== DASHBOARD PA (TO / PROSES / SELESAI) ======================
function renderDashboardPACompact() {
  const containerTO = document.getElementById('dashboardPATO');
  const containerProses = document.getElementById('dashboardPAProses');
  const containerSelesai = document.getElementById('dashboardPASelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  paItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <strong>Mesin: ${escapeHtml(item.mesin || '')}</strong><br>
      <span>üìÖ ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    card.addEventListener('click', () => showDetailModalPA(item));
  });

  // update counters
  const elTotal = document.getElementById('countPA');
  if (elTotal) elTotal.textContent = paItems.length;
  const elTO = document.getElementById('countTOPA');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesPA');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiPA');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL PA ======================
function showDetailModalPA(item) {
  alert(`Detail QC PA:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
No KS: ${item.noKS || '-'}
Order: ${item.order || '-'}
Bagus: ${item.bagus || '-'}
Sortir: ${item.sortir || '-'}
Problem: ${item.problem || '-'}
Mesin: ${item.mesin || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW PA (TO / PROSES / SELESAI) ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTO = document.getElementById('togglePATO');
  const btnProses = document.getElementById('togglePAProses');
  const btnSelesai = document.getElementById('togglePASelesai');

  const gridTO = document.getElementById('dashboardPATO');
  const gridProses = document.getElementById('dashboardPAProses');
  const gridSelesai = document.getElementById('dashboardPASelesai');

  if (btnTO && gridTO) {
    btnTO.addEventListener('click', () => {
      const visible = gridTO.style.display !== 'none';
      gridTO.style.display = visible ? 'none' : 'grid';
      btnTO.textContent = visible ? 'Show' : 'Hide';
    });
  }

  if (btnProses && gridProses) {
    btnProses.addEventListener('click', () => {
      const visible = gridProses.style.display !== 'none';
      gridProses.style.display = visible ? 'none' : 'grid';
      btnProses.textContent = visible ? 'Show' : 'Hide';
    });
  }

  if (btnSelesai && gridSelesai) {
    btnSelesai.addEventListener('click', () => {
      const visible = gridSelesai.style.display !== 'none';
      gridSelesai.style.display = visible ? 'none' : 'grid';
      btnSelesai.textContent = visible ? 'Show' : 'Hide';
    });
  }
});

// ====================== AUTO UPPERCASE KHUSUS PA ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcPA')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcPA'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC PA (ubah sesuai kebutuhan) =====
const QC_PA_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcPA')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC PA:');
      if (input === null) return;
      if (input === QC_PA_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadPAItems();
</script>

<!-- ====== JS QC LEM (paste this after script utama, format disesuaikan dg QC Finishing) -->
<script>
// ====================== GLOBAL STATE (LEM) ======================
let lemItems = []; // array yang diambil dari sheet Lem

// ====================== RENDER GRID HASIL (LEM) ======================
function renderGridLem(query = "") {
  const container = document.getElementById('gridLem');
  if (!container) return;
  container.innerHTML = '';

  const q = (query || '').toLowerCase();

  lemItems.forEach((item, i) => {
    // Filter pencarian (nama atau noKS)
    if (q && !(String(item.nama || '').toLowerCase().includes(q) || String(item.noKS || '').toLowerCase().includes(q))) return;

    const card = document.createElement('div');
    card.className = 'grid-card';

    // status class (sama seperti referensi)
    let statusClass = '';
    if ((item.update || '').toString() === "Proses") statusClass = "status-proses";
    else if ((item.update || '').toString() === "Selesai") statusClass = "status-selesai";
    else if ((item.update || '').toString() === "TO") statusClass = "status-to";

    const tanggal = item.tanggal ? `<strong>${escapeHtml(item.tanggal)}</strong><br>` : '';

    card.innerHTML = `
      <div>
        ${tanggal}
        <span>Nama Order: ${escapeHtml(item.nama || '')}</span><br>
        <span>No KS: ${escapeHtml(item.noKS || '')}</span><br>
        <span>Order: ${escapeHtml(item.order || '')}</span><br>
        <span>Isi/Dus: ${escapeHtml(item.isi || '')}</span><br>
        <span>Bagus: ${escapeHtml(item.bagus || '')}</span><br>
        <span>BS: ${escapeHtml(item.jenisBS || '')}</span><br>
        <span>QC: ${escapeHtml(item.qc || '')}</span><br>
        <span>Keterangan: ${escapeHtml(item.keterangan || '')}</span><br>
        <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
      </div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
        <button class="btn-icon btn-call" title="Panggil" onclick="callLem(${i})">üì§</button>
        <button class="btn-icon btn-edit" title="Edit Inline" onclick="editLemInline(${i})">‚úèÔ∏è</button>
        <button class="btn-icon btn-delete" title="Hapus" onclick="deleteLem(${i})">üóëÔ∏è</button>
      </div>
    `;

    container.appendChild(card);
  });

  // Render ulang dashboard setelah daftar hasil berubah
  renderDashboardLemCompact();
}

// ====================== LOAD DATA DARI SPREADSHEET (LEM) ======================
async function loadLemItems(){
  try{
    // gunakan WEBAPP_URL (sama seperti Finishing) dan sheet 'Lem'
    const res = await jsonpGet(WEBAPP_URL, { action: 'get', sheet: 'Lem' });
    if(res && res.status === 'ok' && Array.isArray(res.data)){
      lemItems = res.data.map((it, idx) => ({ __index: idx, id: (it.id||it._row||it.row||null), ...it }));
      renderGridLem();
    } else console.warn('loadLemItems unexpected', res);
  }catch(err){ console.error('‚ö†Ô∏è Error loadLemItems', err); }
}

// ====================== TAMBAH DATA (LEM) ======================
function addLemItem() {
  const nama = document.getElementById('lemNama').value.trim();
  const noKS = document.getElementById('lemNoKS').value.trim();
  const order = document.getElementById('lemOrder') ? document.getElementById('lemOrder').value.trim() : '';
  const isi = document.getElementById('lemIsi') ? document.getElementById('lemIsi').value.trim() : '';
  const bagus = document.getElementById('lemBagus') ? document.getElementById('lemBagus').value.trim() : '';
  const jenisBS = document.getElementById('lemJenisBS') ? document.getElementById('lemJenisBS').value.trim() : '';
  const qc = document.getElementById('lemQC') ? document.getElementById('lemQC').value.trim() : '';
  const update = document.getElementById('lemUpdate') ? document.getElementById('lemUpdate').value.trim() : '';
  const keterangan = document.getElementById('lemKeterangan') ? document.getElementById('lemKeterangan').value.trim() : '';

  if (!nama || !noKS) return alert('Nama dan No KS wajib diisi!');

// === Tambah konfirmasi sederhana ===
  const konfirmasi = confirm(`Yakin ingin menambah data baru?\n\nNama: ${nama}\nNo KS: ${noKS}`);
  if (!konfirmasi) return; // jika tekan Cancel, berhenti di sini

  const tanggalFormatted = new Date().toLocaleString('id-ID', {
    day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'
  });

  // key names mengikuti header sheet "Lem"
  const payload = {
    action:'add', sheet:'Lem', tanggal: tanggalFormatted,
    nama, noKS, order, isi, bagus, jenisBS, qc, update, keterangan
  };

  // gunakan postPayload sama seperti Finishing (kirim ke WEBAPP_URL)
  postPayload(payload);
  clearLemForm();
  setTimeout(() => loadLemItems(), 20000);
}

// ====================== PANGGIL (isi form dari item) ======================
function callLem(index){
  const item = lemItems[index];
  if(!item) return;
  if (document.getElementById('lemNama')) document.getElementById('lemNama').value = item.nama || '';
  if (document.getElementById('lemNoKS')) document.getElementById('lemNoKS').value = item.noKS || '';
  if (document.getElementById('lemOrder')) document.getElementById('lemOrder').value = item.order || '';
  if (document.getElementById('lemIsi')) document.getElementById('lemIsi').value = item.isi || '';
  if (document.getElementById('lemBagus')) document.getElementById('lemBagus').value = item.bagus || '';
  if (document.getElementById('lemJenisBS')) document.getElementById('lemJenisBS').value = item.jenisBS || '';
  if (document.getElementById('lemQC')) document.getElementById('lemQC').value = item.qc || '';
  if (document.getElementById('lemUpdate')) document.getElementById('lemUpdate').value = item.update || '';
  if (document.getElementById('lemKeterangan')) document.getElementById('lemKeterangan').value = item.keterangan || '';

  showMenu('qcLem');
  const tabBtn = document.querySelector('#qcLem .tabs button[data-tab="inputLem"]');
  if(tabBtn) switchTab(tabBtn);
}

// ====================== HAPUS ITEM (LEM) ======================
function deleteLem(index) {
  const item = lemItems[index];
  if (!item) return;
  if (!confirm('Hapus data ini?')) return;

  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  const btnDelete = card?.querySelector('.btn-delete');

  if (btnDelete) {
    btnDelete.textContent = '‚è≥ Menghapus...';
    btnDelete.disabled = true;
  }

  const identifier = item.id || item._row || item.row || item.__index;
  const payload = {
    action: 'delete',
    sheet: 'Lem',
    id: identifier,
    index: item.__index
  };

  postPayload(payload);

  // üîπ Delay pendek agar sheet sempat proses, lalu update UI
  setTimeout(() => {
    // Hapus item dari array & DOM agar langsung hilang dari grid
    lemItems.splice(index, 1);
    if (card) card.remove();

    // Muat ulang data agar sinkron dengan Google Sheet
    loadLemItems();
  }, 8000);
}

// ====================== EDIT INLINE (LEM) ======================
function editLemInline(index){
  const item = lemItems[index];
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if(!card) return;
  if(card.querySelector('.edit-inline')) return;

  // simpan HTML lama untuk tombol cancel
  const oldHtml = card.innerHTML;

  card.innerHTML = `
    <div class="edit-grid">
      <input type="text" class="edit-inline" value="${escapeHtml(item.nama||'')}" placeholder="Nama Order">
      <input type="text" class="edit-inline" value="${escapeHtml(item.noKS||'')}" placeholder="No KS">
      <input type="number" class="edit-inline" value="${escapeHtml(item.order||'')}" placeholder="Order">
      <input type="number" class="edit-inline" value="${escapeHtml(item.isi||'')}" placeholder="Isi/Dus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.bagus||'')}" placeholder="Bagus">
      <input type="number" class="edit-inline" value="${escapeHtml(item.jenisBS||'')}" placeholder="BS">

      <select class="edit-inline">
        <option value="Martini" ${item.qc==='Martini'? 'selected':''}>Martini</option>
        <option value="Krestin" ${item.qc==='Krestin'? 'selected':''}>Krestin</option>
        <option value="Ismie" ${item.qc==='Ismie'? 'selected':''}>Ismie</option>
      </select>

      <select class="edit-inline">
        <option value="TO" ${item.update==='TO'? 'selected':''}>TO</option>
        <option value="Proses" ${item.update==='Proses'? 'selected':''}>Proses</option>
        <option value="Selesai" ${item.update==='Selesai'? 'selected':''}>Selesai</option>
      </select>

      <textarea class="edit-inline" rows="2" placeholder="Keterangan">${escapeHtml(item.keterangan||'')}</textarea>
    </div>

    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">
      <button class="btn-icon btn-save" title="Simpan" onclick="saveLemInline(${index}, this)">üíæ</button>
      <button class="btn-icon btn-cancel" title="Batal" onclick="cancelLemInline(${index}, \`${encodeURIComponent(oldHtml)}\`)">‚ùå</button>
    </div>`;
}

// ====================== BATAL EDIT INLINE (LEM) ======================
function cancelLemInline(index, oldHtmlEncoded) {
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if (!card) return;
  card.innerHTML = decodeURIComponent(oldHtmlEncoded);
}

// ====================== SIMPAN HASIL EDIT INLINE (LEM) ======================
async function saveLemInline(index, btn) {
  const container = document.getElementById('gridLem');
  const card = container ? container.children[index] : null;
  if (!card) return;

  const btnSave = btn;
  const btnCancel = card.querySelector('.btn-cancel');
  if (btnSave) {
    btnSave.textContent = '‚è≥ Menyimpan...';
    btnSave.disabled = true;
  }
  if (btnCancel) btnCancel.style.display = 'none'; // sembunyikan cancel saat menyimpan

  const inputs = card.querySelectorAll('.edit-inline');
  const updated = {
    nama: inputs[0].value.trim(),
    noKS: inputs[1].value.trim(),
    order: inputs[2].value.trim(),
    isi: inputs[3].value.trim(),
    bagus: inputs[4].value.trim(),
    jenisBS: inputs[5].value.trim(),
    qc: inputs[6].value,
    update: inputs[7].value,
    keterangan: inputs[8].value.trim()
  };

  const orig = lemItems[index];
  const identifier = orig.id || orig._row || orig.row || orig.__index;

  const tanggalFormatted = orig.tanggal || new Date().toLocaleString('id-ID', {
    day: '2-digit', month: 'long', year: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  const payload = { 
    action: 'update', 
    sheet: 'Lem', 
    id: identifier, 
    index: orig.__index, 
    tanggal: tanggalFormatted, 
    ...updated 
  };

  try {
    await postPayload(payload);
    await new Promise(res => setTimeout(res, 5000));
    await loadLemItems();
  } catch (err) {
    console.error('Gagal menyimpan:', err);
    alert('Gagal menyimpan data. Coba lagi.');
  } finally {
    if (btnSave) {
      btnSave.textContent = 'üíæ Simpan';
      btnSave.disabled = false;
    }
  }
}

// ====================== FILTER ======================
function filterLemGrid(query){ renderGridLem(query); }

// ====================== CLEAR FORM (LEM) ======================
function clearLemForm() {
  ['lemNama','lemNoKS','lemOrder','lemIsi','lemBagus','lemJenisBS','lemQC','lemUpdate','lemKeterangan']
    .forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
}

// ====================== DASHBOARD LEM (TO / PROSES / SELESAI) ======================
function renderDashboardLemCompact() {
  const containerTO = document.getElementById('dashboardLemTO');
  const containerProses = document.getElementById('dashboardLemProses');
  const containerSelesai = document.getElementById('dashboardLemSelesai');

  if (!containerProses || !containerSelesai) return;

  if (containerTO) containerTO.innerHTML = '';
  containerProses.innerHTML = '';
  containerSelesai.innerHTML = '';

  let totalTO = 0, totalProses = 0, totalSelesai = 0;

  lemItems.forEach(item => {
    const updateVal = (item.update || "").toString().trim().toLowerCase();
    const tanggal = item.tanggal ? item.tanggal : "-";
    const card = document.createElement('div');
    card.className = 'grid-card';

    let statusClass = "";
    if (updateVal === "proses") statusClass = "status-proses";
    else if (updateVal === "selesai") statusClass = "status-selesai";
    else if (updateVal === "to") statusClass = "status-to";

    card.innerHTML = `
      <strong>${escapeHtml(item.nama || '')}</strong><br>
      <strong>QC: ${escapeHtml(item.qc || '')}</strong><br>
      <span>üìÖ ${escapeHtml(tanggal)}</span><br>
      <span class="${statusClass}">${escapeHtml(item.update || '')}</span>
    `;

    if (updateVal === 'to') {
      if (containerTO) containerTO.appendChild(card);
      totalTO++;
    } else if (updateVal === 'proses') {
      containerProses.appendChild(card);
      totalProses++;
    } else if (updateVal === 'selesai') {
      containerSelesai.appendChild(card);
      totalSelesai++;
    }

    card.addEventListener('click', () => showDetailModalLem(item));
  });

  // update counters
  const elTotal = document.getElementById('countLem');
  if (elTotal) elTotal.textContent = lemItems.length;
  const elTO = document.getElementById('countTOLem');
  if (elTO) elTO.textContent = totalTO;
  const elProses = document.getElementById('countProsesLem');
  if (elProses) elProses.textContent = totalProses;
  const elSelesai = document.getElementById('countSelesaiLem');
  if (elSelesai) elSelesai.textContent = totalSelesai;
}

// ====================== DETAIL LEM ======================
function showDetailModalLem(item) {
  alert(`Detail QC Lem:
Tanggal: ${item.tanggal || '-'}
Nama: ${item.nama || '-'}
No KS: ${item.noKS || '-'}
Order: ${item.order || '-'}
Isi/Dus: ${item.isi || '-'}
Bagus: ${item.bagus || '-'}
BS: ${item.jenisBS || '-'}
QC: ${item.qc || '-'}
Update: ${item.update || '-'}
Keterangan: ${item.keterangan || '-'}`);
}

// ====================== TOGGLE VIEW LEM (TO / PROSES / SELESAI) ======================
document.addEventListener('DOMContentLoaded', () => {
  const btnTO = document.getElementById('toggleLemTO');
  const btnProses = document.getElementById('toggleLemProses');
  const btnSelesai = document.getElementById('toggleLemSelesai');

  const gridTO = document.getElementById('dashboardLemTO');
  const gridProses = document.getElementById('dashboardLemProses');
  const gridSelesai = document.getElementById('dashboardLemSelesai');

  if (btnTO && gridTO) {
    btnTO.addEventListener('click', () => {
      const visible = gridTO.style.display !== 'none';
      gridTO.style.display = visible ? 'none' : 'grid';
      btnTO.textContent = visible ? 'Show' : 'Hide';
    });
  }

  if (btnProses && gridProses) {
    btnProses.addEventListener('click', () => {
      const visible = gridProses.style.display !== 'none';
      gridProses.style.display = visible ? 'none' : 'grid';
      btnProses.textContent = visible ? 'Show' : 'Hide';
    });
  }

  if (btnSelesai && gridSelesai) {
    btnSelesai.addEventListener('click', () => {
      const visible = gridSelesai.style.display !== 'none';
      gridSelesai.style.display = visible ? 'none' : 'grid';
      btnSelesai.textContent = visible ? 'Show' : 'Hide';
    });
  }
});

// ====================== AUTO UPPERCASE KHUSUS LEM ======================
document.addEventListener('input', (e) => {
  if (!e.target) return;
  const el = e.target;
  if (
    (el.tagName === 'INPUT' && el.type === 'text' && el.closest('#qcLem')) ||
    (el.tagName === 'TEXTAREA' && el.closest('#qcLem'))
  ) {
    el.value = el.value.toUpperCase();
  }
});

// ===== Password untuk QC Lem (ubah sesuai kebutuhan) =====
const QC_LEM_PASSWORD = 'qc123';
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector(`nav button[onclick="showMenu('qcLem')"]`);
  if (btn) {
    const originalOnClick = btn.getAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC LEM:');
      if (input === null) return;
      if (input === QC_LEM_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});

// ====================== INISIALISASI (panggil loader) ======================
loadLemItems();
</script>

<script>
/* ====================== TAB QC SPV ====================== */
// Tidak pakai SPV_URL lagi ‚Äî pakai WEBAPP_URL utama (dari Finishing)

function showSPVTab(tab, btn) {
  document.getElementById('spvInputSection').style.display = (tab === 'input') ? 'block' : 'none';
  document.getElementById('spvHasilSection').style.display = (tab === 'hasil') ? 'block' : 'none';

  document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  if (tab === 'input') {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');

    document.getElementById('spvTanggal').value = `${yyyy}-${mm}-${dd}`;
    document.getElementById('spvJam').value = `${hh}:${min}`;

    setupUppercaseInputs();
  }

  if (tab === 'hasil') loadSPV();
}

/* ====================== KONVERSI INPUT KE KAPITAL ====================== */
function setupUppercaseInputs() {
  const inputs = document.querySelectorAll('#spvForm input[type="text"], #spvForm textarea');
  inputs.forEach(el => {
    el.removeEventListener('input', el._uppercaseListener);
    const listener = () => el.value = el.value.toUpperCase();
    el.addEventListener('input', listener);
    el._uppercaseListener = listener;
  });
}

/* ====================== FILE TO BASE64 ====================== */
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* ====================== SUBMIT FORM ====================== */
async function submitSPV(e) {
  e.preventDefault();
  const spinner = document.getElementById("spvSpinner");
  const namaOrder = document.getElementById('spvOrder').value.trim().toUpperCase();
  const noKS = document.getElementById('spvNoKS').value.trim().toUpperCase();
  const tanggal = document.getElementById('spvTanggal').value;
  const jam = document.getElementById('spvJam').value;
  const ket = document.getElementById('spvKet').value.trim().toUpperCase();
  const ket1 = document.getElementById('spvKet1').value.trim().toUpperCase();
  const namaQC = document.getElementById('spvNama').value;
  const proses = document.getElementById('spvProses').value;
  const fotoFile = document.getElementById('spvFoto').files[0];
  const fotoFile1 = document.getElementById('spvFoto1').files[0];

  if (!namaOrder || !noKS || !tanggal || !jam || !namaQC || !proses) {
    alert('‚ö†Ô∏è Harap lengkapi semua field termasuk Proses.');
    return;
  }

  if (!confirm('Kirim data ini?')) return;

  document.getElementById('spvForm').reset(); // langsung reset setelah konfirmasi OK
  spinner.style.display = "flex"; // tampilkan spinner

  let base64Foto = "", base64Foto1 = "";
  if (fotoFile) base64Foto = await fileToBase64(fotoFile);
  if (fotoFile1) base64Foto1 = await fileToBase64(fotoFile1);

  const payload = {
    sheet: "SPV",
    action: "add",
    tanggal,
    namaOrder,
    noKS,
    jam,
    ket,
    foto: base64Foto,
    ket1,
    foto1: base64Foto1,
    namaQC,
    proses
  };

  fetch(WEBAPP_URL, {
    method: "POST",
    body: new URLSearchParams({ payload: JSON.stringify(payload) })
  })
  .then(res => res.text())
  .then(() => {
    spinner.style.display = "none"; // sembunyikan spinner
    alert("‚úÖ Data SPV berhasil dikirim!");
    loadSPV();
  })
  .catch(err => {
    spinner.style.display = "none";
    alert("‚ùå Gagal mengirim data SPV!");
    console.error(err);
  });
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}


/* ====================== LOAD HASIL (PASTI MUNCUL) ====================== */
function loadSPV() {
  const tbody = document.querySelector('#spvTable tbody');
  if (!tbody) return;

  // üîπ Tambahkan spinner (hanya sekali, jika belum ada)
  let spinner = document.getElementById("spvLoadingSpinner");
  if (!spinner) {
    spinner = document.createElement("div");
    spinner.id = "spvLoadingSpinner";
    spinner.innerHTML = `
      <div style="
        text-align:center;
        padding:10px;
        font-weight:bold;
        color:#00BCD4;
      ">
        ‚è≥ Memuat data QC 
      </div>
    `;
    tbody.parentElement.insertAdjacentElement("beforebegin", spinner);
  }
  spinner.style.display = "block";

  fetch(WEBAPP_URL + '?action=get&sheet=SPV')
    .then(res => res.text())
    .then(text => {
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        const match = text.match(/\((.*)\)/);
        if (match) data = JSON.parse(match[1]);
      }

      if (!data) {
        console.warn("Format data SPV tidak dikenali:", text);
        spinner.style.display = "none";
        return;
      }

      const list = data.data || data || [];
      tbody.innerHTML = "";

      list.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${formatTanggal(item.tanggal || item.Tanggal)}</td>
          <td>${item.namaOrder || item['Nama Order'] || ''}</td>
          <td>${item.noKS || item['No KS'] || ''}</td>
          <td>${formatJam(item.jam || item.Jam)}</td>
          <td>${item.ket || item['Keterangan Acuan'] || ''}</td>
          <td>${item.fotoUrl || item['Foto Acuan'] ? `<a href="${item.fotoUrl || item['Foto Acuan']}" target="_blank">üì∑ Lihat Foto</a>` : '-'}</td>
          <td>${item.ket1 || item['Keterangan Temuan'] || ''}</td>
          <td>${item.fotoUrl1 || item['Foto Temuan'] ? `<a href="${item.fotoUrl1 || item['Foto Temuan']}" target="_blank">üì∑ Lihat Foto</a>` : '-'}</td>
          <td>${item.namaQC || item['Nama QC'] || ''}</td>
          <td>${item.proses || item['Proses'] || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => console.error("Gagal memuat data SPV:", err))
    .finally(() => {
      spinner.style.display = "none"; // üîπ Hilangkan spinner setelah selesai
    });
}


/* ====================== FORMAT TANGGAL & JAM ====================== */
function formatTanggal(tgl) {
  if (!tgl) return "";
  const parts = tgl.split("-");
  return parts.length === 3 ? `${parts[2]}-${parts[1]}-${parts[0]}` : tgl;
}

function formatJam(jam) {
  if (!jam) return "";
  return jam.length >= 5 ? jam.slice(0, 5) : jam;
}

/* ====================== PASSWORD QC SPV ====================== */
const QC_SPV_PASSWORD = 'spv123';
document.addEventListener('DOMContentLoaded', () => {
  setupUppercaseInputs();

  const menuBtn = document.querySelector(`nav button[onclick="showMenu('qcSPV')"]`);
  if (menuBtn) {
    const originalOnClick = menuBtn.getAttribute('onclick');
    menuBtn.onclick = function(e) {
      e.preventDefault();
      const input = prompt('Masukkan password untuk QC Register:');
      if (input === null) return;
      if (input === QC_SPV_PASSWORD) {
        eval(originalOnClick);
      } else {
        alert('Password salah!');
      }
    };
  }
});
</script>



</body>
</html>


