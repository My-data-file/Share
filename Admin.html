<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sea Laundry Admin</title>
<style>
body { font-family:'Segoe UI', Tahoma, sans-serif; margin:0; background:#f9fafb; color:#1f2937; }
header { background:#3b82f6; color:white; padding:15px; text-align:center; font-size:1.5em; }
.container { padding:15px; max-width:1200px; margin:auto; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #ddd; padding:8px; text-align:left; }
th { background:#60a5fa; color:white; position:sticky; top:0; }
select { padding:5px; }
@media (max-width:768px) {
  table, thead, tbody, th, td, tr { display:block; }
  th { position:relative; top:auto; }
  td { border:none; padding:8px 0; }
  td::before { content: attr(data-label); font-weight:bold; display:inline-block; width:120px; }
}
button { padding:5px 10px; background:#3b82f6; color:white; border:none; cursor:pointer; }
button:hover { background:#2563eb; }
</style>
</head>
<body>
<header>Sea Laundry Admin</header>
<div class="container">
  <button onclick="loadOrders()">Refresh Data</button>
  <table id="ordersTable">
    <thead>
      <tr id="headerRow"></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
function loadOrders() {
  google.script.run.withSuccessHandler(renderTable).getOrders();
}

function renderTable(data) {
  const table = document.getElementById('ordersTable');
  const thead = table.querySelector('thead tr');
  const tbody = table.querySelector('tbody');

  thead.innerHTML = '';
  tbody.innerHTML = '';

  if(data.length === 0) return;

  // Header
  Object.keys(data[0]).filter(k => k !== "_row").forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    thead.appendChild(th);
  });
  thead.appendChild(document.createElement('th')).textContent = 'Aksi';

  // Rows
  data.forEach(row => {
    const tr = document.createElement('tr');
    Object.keys(row).filter(k => k !== "_row").forEach(k => {
      const td = document.createElement('td');
      td.setAttribute('data-label', k);

      if(k === "Status") {
        const sel = document.createElement('select');
        ["Dipesan","Diambil","Dicuci","Selesai","Batal"].forEach(s => {
          const opt = document.createElement('option');
          opt.value = s; opt.textContent = s;
          if(row[k] === s) opt.selected = true;
          sel.appendChild(opt);
        });
        sel.onchange = () => updateStatus(row._row, sel.value);
        td.appendChild(sel);
      } else {
        td.textContent = row[k];
      }
      tr.appendChild(td);
    });

    const aksiTd = document.createElement('td');
    aksiTd.setAttribute('data-label','Aksi');
    const btn = document.createElement('button');
    btn.textContent = 'Update';
    btn.onclick = () => alert('Status sudah diperbarui otomatis!');
    aksiTd.appendChild(btn);
    tr.appendChild(aksiTd);

    tbody.appendChild(tr);
  });
}

function updateStatus(rowIndex, value) {
  google.script.run.withSuccessHandler(() => console.log('Update sukses'))
                   .updateOrder(rowIndex, "Status", value);
}

// Load data otomatis saat buka
loadOrders();
</script>
</body>
</html>
