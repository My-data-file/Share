<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Sea Laundry</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 0; background: #f9fafb; color: #1f2937; }
    header { background: #2563eb; color: white; padding: 15px; text-align: center; font-size: 1.5em; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #1e40af; color: white; }
    tr:nth-child(even) { background: #f3f4f6; }
    button { background: #2563eb; color: white; border: none; padding: 8px 16px; cursor: pointer; border-radius: 5px; }
    button:hover { background: #1e40af; }
    .maps-link { color: #1d4ed8; text-decoration: underline; }
  </style>
</head>
<body>

<header>Admin Panel - Sea Laundry</header>

<div style="padding: 0 20px;">
  <button onclick="refreshOrders()">Refresh Manual</button>

  <table id="ordersTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Waktu</th>
        <th>Nama</th>
        <th>Alamat</th>
        <th>No HP</th>
        <th>Layanan</th>
        <th>Catatan</th>
        <th>Jadwal</th>
        <th>Maps</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="ordersBody">
      <tr><td colspan="10" style="text-align:center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
  // Fungsi untuk panggil Apps Script
  async function fetchOrders() {
    try {
      const payload = { type: 'GetAllStatus' };
      const response = await fetch('', {
        method: 'POST',
        body: JSON.stringify(payload)
      });
      const data = await response.json();
      return data.status || [];
    } catch (err) {
      console.error(err);
      return [];
    }
  }

  async function refreshOrders() {
    const tableBody = document.getElementById('ordersBody');
    tableBody.innerHTML = '<tr><td colspan="10" style="text-align:center;">Loading...</td></tr>';

    try {
      // Ambil semua data dari Sheet
      const response = await google.script.run.withSuccessHandler(renderOrders).getAllOrders();
    } catch (err) {
      tableBody.innerHTML = `<tr><td colspan="10" style="color:red;">Error: ${err}</td></tr>`;
    }
  }

  function renderOrders(rows) {
    const tableBody = document.getElementById('ordersBody');
    if (!rows || rows.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="10" style="text-align:center;">Tidak ada order</td></tr>';
      return;
    }

    let html = '';
    rows.slice(1).forEach((r, i) => {
      html += `<tr>
        <td>${i+1}</td>
        <td>${r[0] || ''}</td>
        <td>${r[1] || ''}</td>
        <td>${r[2] || ''}</td>
        <td>${r[3] || ''}</td>
        <td>${r[4] || ''}</td>
        <td>${r[5] || ''}</td>
        <td>${r[6] || ''}</td>
        <td>${r[7] ? `<a class="maps-link" href="${r[7]}" target="_blank">Maps</a>` : ''}</td>
        <td>${r[8] || ''}</td>
      </tr>`;
    });
    tableBody.innerHTML = html;
  }

  // Auto load saat halaman dibuka
  window.onload = refreshOrders;
</script>

</body>
</html>
