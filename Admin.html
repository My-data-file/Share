<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sea Laundry Admin</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { background:#1f2937; color:white; padding:15px; text-align:center; }
.container { padding:20px; }
table { width:100%; border-collapse: collapse; margin-top:20px; background:white; }
th, td { border:1px solid #ccc; padding:8px; text-align:left; }
th { background:#e5e7eb; }
button { padding:5px 10px; margin:2px; cursor:pointer; }
select { padding:3px; }
.status-select { width:120px; }
</style>
</head>
<body>

<header>
  <h1>Admin Panel - Sea Laundry</h1>
</header>

<div class="container">
  <button onclick="loadOrders()">Refresh Orders</button>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Alamat</th>
        <th>No HP</th>
        <th>Layanan</th>
        <th>Catatan</th>
        <th>Jadwal</th>
        <th>Maps</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="10" style="text-align:center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbzUi45pbENNxmua_SaIpFFxnE-E2EtxRyC_vwT538ytVqaUPSMzWkPmhq16E67tkvpJPg/exec"; // Ganti dengan URL Apps Script web app

function loadOrders(){
  fetch(GAS_URL,{
    method:"POST",
    body: JSON.stringify({ type:"GetAllOrders" })
  })
  .then(res=>res.json())
  .then(data=>{
    const tbody = document.querySelector("#ordersTable tbody");
    tbody.innerHTML = "";
    if(!data.orders || data.orders.length===0){
      tbody.innerHTML = "<tr><td colspan='10' style='text-align:center;'>Tidak ada order</td></tr>";
      return;
    }
    data.orders.forEach((o,i)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${o.Nama || ""}</td>
        <td>${o.Alamat || ""}</td>
        <td>${o['No HP'] || ""}</td>
        <td>${o.Layanan || ""}</td>
        <td>${o.Catatan || ""}</td>
        <td>${o.Jadwal || ""}</td>
        <td>${o.Maps ? `<a href="${o.Maps}" target="_blank">Lihat</a>` : ""}</td>
        <td>
          <select class="status-select" data-row="${i+2}">
            <option ${o.Status==="Dipesan"?"selected":""}>Dipesan</option>
            <option ${o.Status==="Dijemput"?"selected":""}>Dijemput</option>
            <option ${o.Status==="Diproses"?"selected":""}>Diproses</option>
            <option ${o.Status==="Selesai"?"selected":""}>Selesai</option>
            <option ${o.Status==="Diantar"?"selected":""}>Diantar</option>
          </select>
        </td>
        <td><button onclick="updateStatus(this)">Update</button></td>
      `;
      tbody.appendChild(tr);
    });
  })
  .catch(err=>{
    console.error(err);
    alert("Gagal load order");
  });
}

function updateStatus(btn){
  const select = btn.parentElement.previousElementSibling.querySelector("select");
  const newStatus = select.value;
  const rowIndex = parseInt(select.dataset.row);

  fetch(GAS_URL,{
    method:"POST",
    body: JSON.stringify({
      type:"UpdateStatus",
      payload: { rowIndex, status: newStatus }
    })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.result==="ok") alert("Status berhasil diperbarui");
    else alert("Gagal update status");
  })
  .catch(err=>{
    console.error(err);
    alert("Gagal update status");
  });
}

// Load otomatis saat halaman dibuka
window.addEventListener("DOMContentLoaded", loadOrders);
</script>

</body>
</html>
